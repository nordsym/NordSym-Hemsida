<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- UPPDATERAT: 'Vi' -> 'NordSym' för tyngd -->
    <meta name="description" content="NordSym AB är en byrå för systemautomation och AI-arkitektur. NordSym optimerar er verksamhet för AEO (Answer Engine Optimization) och bygger intelligenta ekosystem.">
    <meta name="keywords" content="Systemautomation Sverige, intelligenta system, AEO, GEO, AI-arkitektur, digital transformation, NordSym">
    <meta name="author" content="NordSym AB">
    <link rel="canonical" href="https://nordsym.com">
    <!-- UPPDATERAT: Ny titel -->
    <title>NordSym AB - Bygg bort begränsningar</title>
    
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="NordSym AB">
    <meta property="og:locale" content="sv_SE">
    <!-- UPPDATERAT: Ny OG-titel -->
    <meta property="og:title" content="NordSym AB - Bygg bort begränsningar.">
    <!-- UPPDATERAT: Ny OG-beskrivning (Mjukvara) -->
    <meta property="og:description" content="NordSym designar intelligent mjukvara och bygger digitala verktyg som FAKTISKT gör skillnad.">
    <meta property="og:image" content="https://raw.githubusercontent.com/GusHem/Logga-utan-text/refs/heads/main/Final%20logo%20no%20text.svg">
    <meta property="og:url" content="https://nordsym.com">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@NordSym">
    <meta name="twitter:creator" content="@NordSym">
    <!-- UPPDATERAT: Ny Twitter-titel -->
    <meta name="twitter:title" content="NordSym AB - Bygg bort begränsningar.">
    <!-- UPPDATERAT: Ny Twitter-beskrivning (Mjukvara) -->
    <meta name="twitter:description" content="NordSym designar intelligent mjukvara och bygger digitala verktyg som FAKTISKT gör skillnad.">
    
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-KRLNF7DHVJ"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-KRLNF7DHVJ', { page_title: document.title, page_location: window.location.href });
    </script>
    
    <script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "s6ismr0411");
    </script>

    <!-- FORENSISK ÅTGÄRD: Ersatt script-baserad Tailwind med stabil CSS-version -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollToPlugin.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/examples/js/postprocessing/EffectComposer.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/examples/js/postprocessing/RenderPass.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/examples/js/postprocessing/UnrealBloomPass.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/examples/js/shaders/LuminosityHighPassShader.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/examples/js/shaders/CopyShader.js"></script>


    <!-- NORDSYM TRUTHLAYER (JSON-LD STRUCTURED DATA) -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@graph": [
        {
          "@type": "Organization",
          "@id": "https://nordsym.com/#organization",
          "name": "NordSym AB",
          "url": "https://nordsym.com",
          "logo": {
            "@type": "ImageObject",
            "url": "https://raw.githubusercontent.com/GusHem/Logga-utan-text/refs/heads/main/Final%20logo%20no%20text.svg",
            "width": 512,
            "height": 512
          },
          "sameAs": [
            "https://www.linkedin.com/company/nordsym-ab/",
            "https://x.com/NordSym",
            "https://www.instagram.com/nordsym_ab/"
          ],
          "address": {
            "@type": "PostalAddress",
            "streetAddress": "Rörläggarvägen 39",
            "addressLocality": "Bromma",
            "postalCode": "168 33",
            "addressRegion": "Stockholm",
            "addressCountry": "SE"
          },
          "geo": {
            "@type": "GeoCoordinates",
            "latitude": 59.3390,
            "longitude": 17.9380
          },
          "hasMap": "https://www.google.com/maps/search/?api=1&query=Rörläggarvägen+39,+168+33+Bromma",
          "contactPoint": {
            "@type": "ContactPoint",
            "email": "contact@nordsym.com",
            "contactType": "customer support"
          },
          "knowsAbout": [
            "Systemautomation",
            "AI-arkitektur",
            "AEO (Answer Engine Optimization)",
            "GEO (Generative Engine Optimization)",
            "Intelligent Process Automation",
            "Micro-SaaS Development"
          ]
        },
        {
          "@type": "Service",
          "@id": "https://nordsym.com/#service-ai-agenter",
          "name": "AI-Agenter",
          "description": "Design och implementering av autonoma digitala medarbetare för kundtjänst, research och administration.",
          "provider": { "@id": "https://nordsym.com/#organization" },
          "areaServed": [
            { "@type": "Country", "name": "Sverige" },
            { "@type": "AdministrativeArea", "name": "Stockholms län" }
          ],
          "serviceType": "Artificial Intelligence"
        },
        {
          "@type": "Service",
          "@id": "https://nordsym.com/#service-ai-first",
          "name": "AI-First Arkitektur",
          "description": "Strategisk systemdesign där AI utgör kärnan i verksamhetens operativsystem för maximal skalbarhet.",
          "provider": { "@id": "https://nordsym.com/#organization" },
          "areaServed": [
            { "@type": "Country", "name": "Sverige" },
            { "@type": "AdministrativeArea", "name": "Stockholms län" }
          ],
          "serviceType": "Software Architecture"
        },
        {
          "@type": "Service",
          "@id": "https://nordsym.com/#service-mcp",
          "name": "Model Context Protocol",
          "description": "Implementation av MCP för att säkerställa delad kontext och minne mellan olika AI-modeller och system.",
          "provider": { "@id": "https://nordsym.com/#organization" },
          "areaServed": [
            { "@type": "Country", "name": "Sverige" },
            { "@type": "AdministrativeArea", "name": "Stockholms län" }
          ],
          "serviceType": "System Integration"
        },
        {
          "@type": "Service",
          "@id": "https://nordsym.com/#service-ui",
          "name": "Intelligenta Gränssnitt",
          "description": "Utveckling av adaptiva gränssnitt och dashboards som anpassar sig efter användarens kontext i realtid.",
          "provider": { "@id": "https://nordsym.com/#organization" },
          "areaServed": [
            { "@type": "Country", "name": "Sverige" },
            { "@type": "AdministrativeArea", "name": "Stockholms län" }
          ],
          "serviceType": "Web Development"
        },
        {
          "@type": "Service",
          "@id": "https://nordsym.com/#service-automation",
          "name": "Intelligent Automation",
          "description": "End-to-end automation av affärsprocesser genom att koppla samman legacy-system med moderna AI-flöden.",
          "provider": { "@id": "https://nordsym.com/#organization" },
          "areaServed": [
            { "@type": "Country", "name": "Sverige" },
            { "@type": "AdministrativeArea", "name": "Stockholms län" }
          ],
          "serviceType": "Process Automation"
        },
        {
          "@type": "Service",
          "@id": "https://nordsym.com/#service-data",
          "name": "Data & Insikter",
          "description": "Avancerad dataanalys och prediktiva insikter drivna av AI för att stödja strategiska beslut.",
          "provider": { "@id": "https://nordsym.com/#organization" },
          "areaServed": [
            { "@type": "Country", "name": "Sverige" },
            { "@type": "AdministrativeArea", "name": "Stockholms län" }
          ],
          "serviceType": "Data Analytics"
        },
        {
          "@type": "BreadcrumbList",
          "@id": "https://nordsym.com/#breadcrumb",
          "itemListElement": [
            { "@type": "ListItem", "position": 1, "name": "Hem", "item": "https://nordsym.com" },
            { "@type": "ListItem", "position": 2, "name": "Micro-SaaS", "item": "https://nordsym.com/#om-oss" },
            { "@type": "ListItem", "position": 3, "name": "System", "item": "https://nordsym.com/#system" },
            { "@type": "ListItem", "position": 4, "name": "R&D", "item": "https://nordsym.com/#ritbordet" }
          ]
        },
        {
          "@type": "FAQPage",
          "@id": "https://nordsym.com/#faq",
          "mainEntity": [
            {
              "@type": "Question",
              "name": "Vad menar ni med 'AI som operativsystem'?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "För oss är AI inte bara ett verktyg man lägger ovanpå gamla processer. Vi bygger om arkitekturen så att intelligens blir kärnan som driver flödena. Systemet förstår er affärslogik och agerar autonomt, snarare än att bara vänta på input."
              }
            },
            {
              "@type": "Question",
              "name": "Hur säkert är det? Äger vi vår egen data?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "Absolut. Vi bygger systemen så att ni behåller fullt ägandeskap och kontroll över er data. Vi designar 'vallgravar' runt er kärnverksamhet och säkerställer att ingen känslig data tränar publika modeller utan ert medgivande."
              }
            },
            {
              "@type": "Question",
              "name": "Kan ni integrera med våra gamla system (Legacy)?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "Ja. En stor del av vår arkitektur handlar om att bygga bryggor mellan beprövade legacy-system (som affärssystem och databaser) och moderna AI-agenter. Vi moderniserar utan att ni behöver byta ut hela er infrastruktur dag ett."
              }
            },
            {
              "@type": "Question",
              "name": "Vad händer om AI-modellerna förändras?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "Vi bygger modulärt och modell-agnostiskt. Det betyder att vi snabbt kan byta ut 'hjärnan' (t.ex. från GPT-4 till Claude 3.5 eller en lokal modell) utan att behöva bygga om hela systemet. Er arkitektur är framtidssäkrad."
              }
            },
            {
              "@type": "Question",
              "name": "Hur snabbt ser vi ROI?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "Vårt mål är alltid snabb 'time-to-value'. Genom att börja med att automatisera tydliga flaskhalsar (t.ex. administration, kundtjänst eller dataanalys) ser våra kunder ofta en mätbar ROI inom 4-8 veckor efter driftsättning."
              }
            }
          ]
        },
        {
          "@type": "ProfessionalService",
          "@id": "https://nordsym.com/#service",
          "name": "NordSym - Intelligent Systemarkitektur",
          "url": "https://nordsym.com",
          "parentOrganization": {
            "@id": "https://nordsym.com/#organization"
          },
          "description": "Vi bygger framtidssäkra, intelligenta AI-arkitekturer och system som tänker med er.",
          "priceRange": "75000 SEK - 500000+ SEK"
        },
        {
          "@type": "WebSite",
          "@id": "https://nordsym.com/#website",
          "url": "https://nordsym.com",
          "name": "NordSym AB",
          /* UPPDATERAT: Synkroniserat JSON-LD med nya pitchen (Mjukvara) */
          "description": "NordSym designar intelligent mjukvara och bygger digitala verktyg som FAKTISKT gör skillnad.",
          "publisher": {
            "@id": "https://nordsym.com/#organization"
          }
        }
      ]
    }
    </script>

    <link rel="preconnect" href="https://www.google-analytics.com">
    <link rel="dns-prefetch" href="//fonts.gstatic.com">
    <link rel="dns-prefetch" href="//formspree.io">
    <link rel="preload" href="https://raw.githubusercontent.com/GusHem/Logga-utan-text/refs/heads/main/Final%20logo%20no%20text.svg" as="image">
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@700&display=swap" as="style">
    <link rel="preload" href="https://unpkg.com/@phosphor-icons/web" as="script">

    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@700&family=Inter:wght@300;400;500;600;700;800&family=Source+Code+Pro:wght@400;700&display=swap" rel="stylesheet">
    <!-- NYTT: Outfit font för GenPRD -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@700&display=swap" rel="stylesheet">
    <!-- NYTT: DM Serif Display för "Tidning/Pop" rubriker -->
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link rel="icon" href="https://raw.githubusercontent.com/GusHem/Logga-utan-text/refs/heads/main/Final%20logo%20no%20text.svg">
    <style>
        /* --- TAILWIND V3 COMPATIBILITY PATCH (FORENSISK ÅTGÄRD) --- */
        /* UPPDATERAD: Kopplar dessa klasser till variabler för att kunna styra tonen globalt */
        .text-sky-100 { color: var(--nord-sym-text-primary) !important; }
        .text-sky-200 { color: var(--nord-sym-text-primary) !important; } /* Gör dessa vitare/renare */
        .text-sky-300 { color: var(--nord-sym-text-secondary) !important; } /* Gör dessa till en ren grå */
        .text-sky-400 { color: #38bdf8 !important; } /* Behåll accent-färg */
        
        .bg-sky-700\/50 { background-color: rgba(51, 65, 85, 0.5) !important; } /* Slate-baserad bakgrund */
        .bg-sky-800\/50 { background-color: rgba(30, 41, 59, 0.5) !important; }
        .bg-sky-900\/70 { background-color: rgba(15, 23, 42, 0.7) !important; }
        .border-sky-700\/50 { border-color: rgba(71, 85, 105, 0.5) !important; }
        .border-sky-800\/50 { border-color: rgba(51, 65, 85, 0.5) !important; }
        
        /* NÖD-FÄRGER (Mörkt läge som standard) */
        .bg-nord-sym-deep-space-blue { background-color: var(--nord-sym-deep-space-blue) !important; }
        .bg-nord-sym-deep-space-blue\/95 { background-color: rgba(5, 6, 8, 0.95) !important; } /* Uppdaterad till Obsidian */
        .bg-nord-sym-deep-space-blue\/80 { background-color: rgba(5, 6, 8, 0.8) !important; }
        .bg-nord-sym-deep-space-blue\/50 { background-color: rgba(5, 6, 8, 0.5) !important; }
        
        .backdrop-blur-sm { backdrop-filter: blur(4px); -webkit-backdrop-filter: blur(4px); }
        .backdrop-blur-md { backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); }
        
        /* --- OPERATION BALANS: LAYOUT-SÄKRING --- */
        /* Dessa regler ser till att dölja/visa element korrekt även om Tailwind v2 laddas långsamt eller blockeras */
        .hidden { display: none !important; }
        .flex { display: flex !important; }
        .block { display: block !important; }
        
        @media (min-width: 768px) {
            .md\:flex { display: flex !important; }
            .md\:hidden { display: none !important; }
            .md\:block { display: block !important; }
        }
        /* --- SLUT PÅ PATCH --- */

        html {
            /* scroll-behavior: smooth; */ /* BORTTAGEN FÖR ATT LÖSA MOBIL SCROLL-KONFLIKT */
        }
        html, body {
            height: 100%; margin: 0; padding: 0;
            /* Harmoni-fix: Utrotar scroll-konflikten genom att ta bort den globala 'scroll-behavior',
               vilket ger GSAP och JS full, oinskränkt kontroll över alla animationer. */
        }
        body {
            font-family: 'Inter', sans-serif; color: #E2E8F0; 
            padding-top: 80px; display: flex; flex-direction: column;
            background-color: var(--nord-sym-deep-space-blue); /* Använd variabel */
            /* TEXTUR-UPPDATERING: Subtil noise-gradient för "griffeltavla"-känsla */
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.04'/%3E%3C/svg%3E");
            min-height: 100vh;
            overflow-y: auto; /* Harmoni-fix: Säkerställer vertikal scrollning på alla enheter. */
        }
        body.labb-active { 
            overflow: hidden;
        }
        @media (min-width: 1024px) { 
            body { padding-top: 116px; } 
        }
        main { flex-grow: 1; background: transparent; }
        :root {
            --nord-sym-cyan: #00D4FF;
            --nord-sym-orange: #FF8C00;
            --nord-sym-purple: #9370DB;
            /* MATT OBSIDIAN UPDATE: Djupare, mindre mättad svart */
            --nord-sym-deep-space-blue: #050608; 
            --nord-sym-mid-space-blue: #1e3a8a; 
            --nord-sym-light-accent: #7dd3fc; 
            
            /* DARK MODE (Standard) - UPPDATERAD: Vit Krita (Whiter Text) */
            --nord-sym-text-primary: #FFFFFF; /* Helt vit (Tidigare F3F4F6) */
            --nord-sym-text-secondary: #E2E8F0; /* Mycket ljus grå/vit (Tidigare 9CA3AF) */
            --nord-sym-text-light: #F8FAFC; 
            --nord-sym-text-medium: #CBD5E1; /* Ljusare mellan-ton (Tidigare 9CA3AF) */

            --nord-sym-cyan-rgb: 0, 212, 255;
            --nord-sym-light-accent-rgb: 125, 211, 252;
            /* UPPDATERAD RGB FÖR OBSIDIAN */
            --nord-sym-deep-space-blue-rgb: 5, 6, 8;
            --nord-sym-mid-space-blue-rgb: 30, 58, 138;
            
            /* LIGHT MODE (Blåkopia / Arkitekt) - NY PALETT */
            --nord-sym-blueprint-bg: #F0F4F8; /* Tekniskt Papper (Slate 50/100 mix) */
            --nord-sym-blueprint-ink: #0F172A; /* Slate 900 (Bläck) */
            --nord-sym-blueprint-text-primary: #1E293B; /* Slate 800 */
            --nord-sym-blueprint-text-secondary: #475569; /* Slate 600 */
            --nord-sym-blueprint-lines: #94A3B8; /* Slate 400 (Linjer) */
            --nord-sym-blueprint-lines-faint: #CBD5E1; /* Slate 300 (Rutnät) */
            --nord-sym-blueprint-cyan: #0284C7; /* Sky 600 (Ingenjörsblå) */
            --nord-sym-blueprint-cyan-rgb: 2, 132, 199;
            --nord-sym-blueprint-bg-rgb: 240, 244, 248; 
            --nord-sym-blueprint-ink-rgb: 15, 23, 42; 
        }
        .nord-accent-text { color: var(--nord-sym-cyan); }
        h1, h2, .section-title { font-family: 'Comfortaa', sans-serif; }
        .page-content-padding { padding-top: 4rem; padding-bottom: 4rem; }
        .space-background-section {
            background: transparent !important;
            position: relative; overflow: hidden; width: 100%; 
            display: flex; flex-direction: column; align-items: center;
            /* SCROLL-SAKERHET: Se till att ankarlänkar inte hamnar under headern */
            scroll-margin-top: 120px; 
        }
        #hero {
             min-height: calc(100vh - 80px); min-height: calc(100dvh - 80px); /* MODERNISERING FÖR IOS */
             justify-content: center; 
             /* UPPDATERAT: Mer luft i toppen (8rem) på mobil för att undvika header-klipp */
             padding-top: 8rem; 
             padding-bottom: 4rem;
             position: relative; /* For canvas positioning */
        }
        @media (min-width: 1024px) { 
            /* Återställ till normal padding på desktop där vi har mer kontroll */
            #hero { 
                min-height: calc(100vh - 116px); min-height: calc(100dvh - 116px); 
                padding-top: 4rem;
            } 
        }
        .section-content-wrapper { 
            position: relative; z-index: 1; width: 100%; max-width: 1280px; 
            padding-left: 1.5rem; padding-right: 1.5rem; margin-left: auto; margin-right: auto;
        }
        .nav-link.active { color: var(--nord-sym-cyan); font-weight: 700; } 
        .btn-base {
            font-weight: 600; border-radius: 9999px; transition: all 0.3s ease;
            box-shadow: 0px 6px 12px rgba(0, 0, 0, 0.25), 0px 2px 4px rgba(0,0,0,0.2), 
                        inset 0px -2px 1px rgba(255,255,255,0.05), inset 0px 1px 1px rgba(0,0,0,0.1); 
            display: inline-flex; align-items: center; justify-content: center;
            gap: 0.5rem; text-align: center;
        }
        .btn-cta-revised {
            padding: 0.85rem 2.25rem;
            background: rgba(0, 31, 63, 0.8);
            border: 2px solid #ffffff; /* UPPDATERAT: Vit kant (Krita) */
            color: #ffffff; /* UPPDATERAT: Vit text (Krita) */
            backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
            font-weight: 600;
        }
        .btn-cta-revised:hover {
            background: rgba(255, 255, 255, 0.1); /* Vit tint vid hover */
            box-shadow: 0 0 25px rgba(255, 255, 255, 0.4); /* Vit glöd */
            transform: translateY(-3px) scale(1.03);
        }
        .btn-secondary-on-dark {
            /* UPPDATERAT: White Chalk Standard - Helt vit outline och text */
            padding: 0.85rem 2.25rem; 
            color: #ffffff;
            border: 2px solid #ffffff;
            background: transparent;
        }
        .btn-secondary-on-dark:hover {
            background-color: #ffffff; 
            color: var(--nord-sym-deep-space-blue);
            transform: translateY(-3px) scale(1.03);
             box-shadow: 0px 0px 20px rgba(255, 255, 255, 0.3);
        }
        .btn-service-cta { 
            /* UPPDATERAT: White Chalk Standard för footer-knapp */
            padding: 0.6rem 1.5rem; 
            font-size: 0.875rem; 
            background-color: transparent;
            color: #ffffff; 
            border: 1px solid #ffffff;
        }
        .btn-service-cta:hover {
            background-color: #ffffff; 
            color: var(--nord-sym-deep-space-blue);
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0px 0px 15px rgba(255, 255, 255, 0.4);
        }
        
        /* --- KNAPP FÖR LJUS/MÖRKT TEMA (ERSATT MED SWITCH) --- */
        /* Behåller .theme-toggle-btn class för mobil-knappen tills vidare, men desktop får ny */

        /* --- STILAR FÖR LIGHT THEME (BLÅKOPIA - ARKITEKT EDITION) --- */
        body.light-theme {
            background-color: var(--nord-sym-blueprint-bg);
            color: var(--nord-sym-blueprint-ink);
            /* Bakgrunden hanteras nu av .blueprint-grid div */
            background-image: none; 
            
            /* GLOBAL TEXT VARIABLE REMAPPING FOR LIGHT MODE */
            /* Detta säkerställer att alla element som använder dessa variabler automatiskt blir mörka */
            --nord-sym-text-primary: var(--nord-sym-blueprint-text-primary);
            --nord-sym-text-secondary: var(--nord-sym-blueprint-text-secondary);
            --nord-sym-text-light: var(--nord-sym-blueprint-text-primary);
            --nord-sym-text-medium: var(--nord-sym-blueprint-text-secondary);
        }

        /* Blueprint Grid (Light Mode Only) */
        .blueprint-grid {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: 
                linear-gradient(rgba(148, 163, 184, 0.15) 1px, transparent 1px),
                linear-gradient(90deg, rgba(148, 163, 184, 0.15) 1px, transparent 1px);
            background-size: 40px 40px;
            z-index: -6; pointer-events: none;
            opacity: 0; transition: opacity 0.5s ease;
        }
        body.light-theme .blueprint-grid { opacity: 1; }
        
        /* Header */
        body.light-theme #header {
            background-color: rgba(240, 244, 248, 0.95) !important; /* Matcha papper */
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--nord-sym-blueprint-lines);
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
        }
        
        /* Nav-länkar */
        body.light-theme .nav-link {
            color: var(--nord-sym-blueprint-text-primary) !important; /* Mörkare (Slate 800) för tydlighet */
            font-weight: 600; /* Lite fetare */
        }
        body.light-theme .nav-link:hover {
            color: var(--nord-sym-blueprint-cyan) !important;
        }
        body.light-theme .nav-link.active {
            color: var(--nord-sym-blueprint-cyan) !important;
            font-weight: 800;
        }
        
        /* Header CTA-knapp */
        body.light-theme .btn-cta-revised {
            background: var(--nord-sym-blueprint-ink); /* Mörk knapp för kontrast */
            border: 2px solid var(--nord-sym-blueprint-ink);
            color: #ffffff !important;
            box-shadow: 4px 4px 0px rgba(148, 163, 184, 0.4); /* Hård skugga */
            border-radius: 6px; /* Lite kantigare */
        }
        body.light-theme .btn-cta-revised:hover {
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0px rgba(148, 163, 184, 0.6);
            background: var(--nord-sym-blueprint-cyan);
            border-color: var(--nord-sym-blueprint-cyan);
        }
        
        /* NYTT: Secondary Button (Light Mode - Blueprint Style) */
        body.light-theme .btn-secondary-on-dark {
            color: var(--nord-sym-blueprint-ink);
            border: 2px solid var(--nord-sym-blueprint-ink);
            background: transparent;
            box-shadow: 4px 4px 0px rgba(148, 163, 184, 0.4);
        }
        body.light-theme .btn-secondary-on-dark:hover {
            background-color: var(--nord-sym-blueprint-ink);
            color: #ffffff;
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0px rgba(148, 163, 184, 0.6);
        }

        /* --- DAY/NIGHT SWITCH CSS (Från Varvet) --- */
        .theme-switch {
            --toggle-size: 10px; 
            --container-width: 5.625em;
            --container-height: 2.5em;
            --container-radius: 6.25em;
            --container-light-bg: #3D7EAE;
            --container-night-bg: #0f172a; /* Matchar deep space */
            --circle-container-diameter: 3.375em;
            --sun-moon-diameter: 2.125em;
            --sun-bg: #ECCA2F;
            --moon-bg: #C4C9D1;
            --spot-color: #959DB1;
            --circle-container-offset: calc((var(--circle-container-diameter) - var(--container-height)) / 2 * -1);
            --stars-color: #fff;
            --clouds-color: #F3FDFF;
            --back-clouds-color: #AACADF;
            --transition: .5s cubic-bezier(0, -0.02, 0.4, 1.25);
            --circle-transition: .3s cubic-bezier(0, -0.02, 0.35, 1.17);
        }

        .theme-switch, .theme-switch *, .theme-switch *::before, .theme-switch *::after {
            -webkit-box-sizing: border-box; box-sizing: border-box; margin: 0; padding: 0; font-size: var(--toggle-size);
        }

        .theme-switch__container {
            width: var(--container-width); height: var(--container-height);
            background-color: var(--container-light-bg); border-radius: var(--container-radius);
            overflow: hidden; cursor: pointer;
            box-shadow: 0em -0.062em 0.062em rgba(0, 0, 0, 0.25), 0em 0.062em 0.125em rgba(255, 255, 255, 0.94);
            transition: var(--transition); position: relative; border: 1px solid rgba(255,255,255,0.2); 
        }
        /* ... (Resten av Theme Switch CSS är identisk med Varvet, inbäddad för att spara plats i chatten men fullt implementerad i filen) ... */
        .theme-switch__checkbox { display: none; }
        .theme-switch__circle-container { width: var(--circle-container-diameter); height: var(--circle-container-diameter); background-color: rgba(255, 255, 255, 0.1); position: absolute; left: var(--circle-container-offset); top: var(--circle-container-offset); border-radius: var(--container-radius); box-shadow: inset 0 0 0 3.375em rgba(255, 255, 255, 0.1), inset 0 0 0 3.375em rgba(255, 255, 255, 0.1), 0 0 0 0.625em rgba(255, 255, 255, 0.1), 0 0 0 1.25em rgba(255, 255, 255, 0.1); display: flex; transition: var(--circle-transition); pointer-events: none; }
        .theme-switch__sun-moon-container { pointer-events: auto; position: relative; z-index: 2; width: var(--sun-moon-diameter); height: var(--sun-moon-diameter); margin: auto; border-radius: var(--container-radius); background-color: var(--sun-bg); box-shadow: 0.062em 0.062em 0.062em 0em rgba(254, 255, 239, 0.61) inset, 0em -0.062em 0.062em 0em #a1872a inset; filter: drop-shadow(0.062em 0.125em 0.125em rgba(0, 0, 0, 0.25)) drop-shadow(0em 0.062em 0.125em rgba(0, 0, 0, 0.25)); overflow: hidden; transition: var(--transition); }
        .theme-switch__moon { transform: translateX(100%); width: 100%; height: 100%; background-color: var(--moon-bg); border-radius: inherit; box-shadow: 0.062em 0.062em 0.062em 0em rgba(254, 255, 239, 0.61) inset, 0em -0.062em 0.062em 0em #969696 inset; transition: var(--transition); position: relative; }
        .theme-switch__spot { position: absolute; top: 0.75em; left: 0.312em; width: 0.75em; height: 0.75em; border-radius: var(--container-radius); background-color: var(--spot-color); box-shadow: 0em 0.0312em 0.062em rgba(0, 0, 0, 0.25) inset; }
        .theme-switch__spot:nth-of-type(2) { width: 0.375em; height: 0.375em; top: 0.937em; left: 1.375em; }
        .theme-switch__spot:nth-last-of-type(3) { width: 0.25em; height: 0.25em; top: 0.312em; left: 0.812em; }
        .theme-switch__clouds { width: 1.25em; height: 1.25em; background-color: var(--clouds-color); border-radius: var(--container-radius); position: absolute; bottom: -0.625em; left: 0.312em; box-shadow: 0.937em 0.312em var(--clouds-color), -0.312em -0.312em var(--back-clouds-color), 1.437em 0.375em var(--clouds-color), 0.5em -0.125em var(--back-clouds-color), 2.187em 0 var(--clouds-color), 1.25em -0.062em var(--back-clouds-color), 2.937em 0.312em var(--clouds-color), 2em -0.312em var(--back-clouds-color), 3.625em -0.062em var(--clouds-color), 2.625em 0em var(--back-clouds-color), 4.5em -0.312em var(--clouds-color), 3.375em -0.437em var(--back-clouds-color), 4.625em -1.75em 0 0.437em var(--clouds-color), 4em -0.625em var(--back-clouds-color), 4.125em -2.125em 0 0.437em var(--back-clouds-color); transition: 0.5s cubic-bezier(0, -0.02, 0.4, 1.25); }
        .theme-switch__stars-container { position: absolute; color: var(--stars-color); top: -100%; left: 0.312em; width: 2.75em; height: auto; transition: var(--transition); }
        .theme-switch__checkbox:checked + .theme-switch__container { background-color: var(--container-night-bg); border-color: rgba(255,255,255,0.1); }
        .theme-switch__checkbox:checked + .theme-switch__container .theme-switch__circle-container { left: calc(100% - var(--circle-container-offset) - var(--circle-container-diameter)); }
        .theme-switch__checkbox:checked + .theme-switch__container .theme-switch__circle-container:hover { left: calc(100% - var(--circle-container-offset) - var(--circle-container-diameter) - 0.187em) }
        .theme-switch__circle-container:hover { left: calc(var(--circle-container-offset) + 0.187em); }
        .theme-switch__checkbox:checked + .theme-switch__container .theme-switch__moon { transform: translate(0); }
        .theme-switch__checkbox:checked + .theme-switch__container .theme-switch__clouds { bottom: -4.062em; }
        .theme-switch__checkbox:checked + .theme-switch__container .theme-switch__stars-container { top: 50%; transform: translateY(-50%); }


        /* Mobilmeny-bakgrund */
        body.light-theme #mobile-menu {
            background-color: var(--nord-sym-blueprint-bg) !important;
            backdrop-filter: none;
        }
        body.light-theme #mobile-menu a {
            color: var(--nord-sym-blueprint-ink) !important;
            opacity: 0.8;
            border-color: var(--nord-sym-blueprint-lines-faint);
        }
         body.light-theme #mobile-menu a:hover {
            background-color: rgba(var(--nord-sym-blueprint-cyan-rgb), 0.05) !important;
            color: var(--nord-sym-blueprint-cyan) !important;
            opacity: 1;
        }

        /* Atom Gallery (Blåkopia / Arkitekt) - SOLIDA KORT */
        body.light-theme .archetype-card {
            background: #ffffff; /* Solid vit */
            border: 2px solid var(--nord-sym-blueprint-lines); /* Skarp kant */
            backdrop-filter: none;
            box-shadow: 8px 8px 0px rgba(148, 163, 184, 0.2); /* Hård skugga */
            border-radius: 12px; /* Mindre rundade */
        }
        body.light-theme .archetype-card::before { /* Ta bort glöd */
            background: none;
            opacity: 0;
        }
        body.light-theme .archetype-card:hover {
            border-color: var(--nord-sym-blueprint-cyan);
            box-shadow: 12px 12px 0px rgba(2, 132, 199, 0.2); /* Hårdare blå skugga */
            transform: translate(-2px, -2px); /* Mekaniskt lyft */
        }
        body.light-theme .archetype-card > i {
            color: var(--nord-sym-blueprint-cyan);
        }
        body.light-theme .archetype-card h4 {
            color: var(--nord-sym-blueprint-ink);
        }
        body.light-theme .archetype-card .description,
        body.light-theme .archetype-card .indicator,
        body.light-theme .tech-signature-item i,
        body.light-theme .tech-signature-item span {
            color: var(--nord-sym-blueprint-ink);
            opacity: 0.8;
        }
        body.light-theme .archetype-card .avatar-image {
             filter: none; /* Ingen skugga på bilder */
             border: 2px solid var(--nord-sym-blueprint-lines-faint);
        }
        body.light-theme .archetype-card:hover > i,
        body.light-theme .archetype-card:hover > .avatar-image {
            filter: none;
            border-color: var(--nord-sym-blueprint-cyan);
        }
        body.light-theme .archetype-card .indicator {
            border-top-color: var(--nord-sym-blueprint-lines-faint);
        }
        body.light-theme .archetype-cta {
            border: 2px solid var(--nord-sym-blueprint-ink); /* Solid knapp */
            color: var(--nord-sym-blueprint-ink);
            box-shadow: none;
            font-weight: 700;
        }
        body.light-theme .archetype-cta:hover {
            border-color: var(--nord-sym-blueprint-cyan);
            color: #ffffff;
            background: var(--nord-sym-blueprint-cyan);
            box-shadow: 4px 4px 0px rgba(148, 163, 184, 0.4);
        }

        /* --- GALLERI-VÄXLARE: BAS-STILAR (DARK MODE) --- */
        #gallery-switch-container {
            background-color: rgba(12, 20, 39, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        #gallery-switch-slider {
            /* UPPDATERAT: Djupare blå (Sky 600) istället för Neon Cyan för att vit text ska synas */
            background-color: #0284c7 !important; 
            box-shadow: 0 0 20px rgba(2, 132, 199, 0.4);
        }
        .gallery-switch-btn {
            color: var(--nord-sym-text-secondary); /* Inaktiv */
            transition: all 0.3s ease;
        }
        .gallery-switch-btn:hover {
            color: #ffffff;
        }
        .gallery-switch-btn.active {
            color: #ffffff !important; /* Aktiv: Vit text */
            font-weight: 800; /* Extra fet för tydlighet */
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }

        /* NYTT: Stilar för Galleri-växlare (Blåkopia) */
        body.light-theme #gallery-switch-container {
            background-color: #ffffff; /* Ren vit */
            border: 2px solid var(--nord-sym-blueprint-lines); /* Tydlig kant */
        }
        /* UPPDATERAD: Slider-elementet (Ljust läge) */
        body.light-theme #gallery-switch-slider {
            background-color: var(--nord-sym-blueprint-cyan);
            box-shadow: none; /* Platt design */
        }
        /* UPPDATERAD: Knappstilar (Ljust läge) */
        body.light-theme .gallery-switch-btn {
            background-color: transparent;
            color: #64748b; /* Slate 500 - Tydlig inaktiv text */
            opacity: 1; /* Full opacitet för läsbarhet */
        }
        body.light-theme .gallery-switch-btn.active {
            color: #ffffff !important; /* VIKTIGT: Vit text på det blå pillret */
            opacity: 1;
        }
        body.light-theme .gallery-switch-btn:hover:not(.active) {
            color: var(--nord-sym-blueprint-ink);
            opacity: 1;
        }
        body.light-theme #gallery-description-text {
            color: var(--nord-sym-blueprint-text-secondary) !important;
            font-weight: 500;
        }

        /* Galleri-kontroller (Blåkopia) */
        body.light-theme .gallery-control-btn {
            background: #ffffff;
            border: 2px solid var(--nord-sym-blueprint-lines);
            color: var(--nord-sym-blueprint-ink);
            opacity: 1;
            box-shadow: 4px 4px 0px rgba(148, 163, 184, 0.2);
        }
        body.light-theme .gallery-control-btn:hover:not(.disabled) {
            background: var(--nord-sym-blueprint-cyan);
            border-color: var(--nord-sym-blueprint-cyan);
            color: #ffffff;
            opacity: 1;
            box-shadow: 4px 4px 0px rgba(2, 132, 199, 0.2);
            transform: translate(-1px, -1px);
        }
        
        /* Om Oss / Arkitektur-sida (Blåkopia) */
        body.light-theme .arkitektur-card {
            background: #ffffff;
            border: 2px solid var(--nord-sym-blueprint-lines);
            box-shadow: 8px 8px 0px rgba(148, 163, 184, 0.2);
            backdrop-filter: none;
            border-radius: 12px;
        }
        body.light-theme .arkitektur-card:hover {
            border-color: var(--nord-sym-blueprint-cyan);
            box-shadow: 12px 12px 0px rgba(2, 132, 199, 0.2);
            transform: translate(-2px, -2px);
        }

        /* System / Pris-sida (Blåkopia) */
        body.light-theme .pricing-card {
            background: #ffffff;
            border: 2px solid var(--nord-sym-blueprint-lines);
            backdrop-filter: none;
            box-shadow: 8px 8px 0px rgba(148, 163, 184, 0.2);
            border-radius: 12px;
        }
        body.light-theme .pricing-card:hover {
            border-color: var(--nord-sym-blueprint-cyan);
            box-shadow: 12px 12px 0px rgba(2, 132, 199, 0.2);
            transform: translate(-2px, -2px);
        }
        body.light-theme .pricing-card.ignite-package { /* "Struktur"-paketet */
            border-color: var(--nord-sym-blueprint-cyan);
            box-shadow: 10px 10px 0px rgba(2, 132, 199, 0.15);
            transform: scale(1.02);
            background: #F8FAFC; /* Lite tint */
        }
        body.light-theme .pricing-card.ignite-package:hover {
            transform: scale(1.04) translate(-2px, -2px);
            box-shadow: 14px 14px 0px rgba(2, 132, 199, 0.25);
        }
        body.light-theme .pricing-card-header h3,
        body.light-theme .price-display {
            color: var(--nord-sym-blueprint-ink);
        }
        body.light-theme .price-period,
        body.light-theme .pricing-card li,
        body.light-theme .pricing-card .text-sky-300 {
            color: var(--nord-sym-blueprint-text-primary) !important; 
            opacity: 1;
        }
        body.light-theme .pricing-card li i {
            color: var(--nord-sym-blueprint-cyan);
            opacity: 1;
        }
        /* Återställ knappar i light mode */
        body.light-theme .pricing-card .btn-base {
             border: 2px solid var(--nord-sym-blueprint-ink) !important;
             color: var(--nord-sym-blueprint-ink) !important;
             box-shadow: none;
        }
        body.light-theme .pricing-card .btn-base:hover {
             border-color: var(--nord-sym-blueprint-cyan) !important;
             color: var(--nord-sym-blueprint-cyan) !important;
             background: rgba(var(--nord-sym-blueprint-cyan-rgb), 0.1) !important;
        }
        /* FIX: Tvinga "Diskutera Behov" (CTA) att vara fylld och synlig i Light Mode */
        body.light-theme .pricing-card .btn-cta-revised {
            background: var(--nord-sym-blueprint-ink) !important;
            color: #ffffff !important; /* Vit text på mörk knapp */
            border-color: var(--nord-sym-blueprint-ink) !important;
        }
        body.light-theme .pricing-card .btn-cta-revised:hover {
            background: var(--nord-sym-blueprint-cyan) !important;
            border-color: var(--nord-sym-blueprint-cyan) !important;
            color: #ffffff !important;
        }

        /* Juridiska sidor (Blåkopia) */
        body.light-theme .legal-content-card {
            background: #ffffff;
            border: 2px solid var(--nord-sym-blueprint-lines);
            backdrop-filter: none;
            box-shadow: 8px 8px 0px rgba(148, 163, 184, 0.2);
        }
        body.light-theme .legal-content-container h4 {
            color: var(--nord-sym-blueprint-ink);
        }
        body.light-theme .legal-content-container p,
        body.light-theme .legal-content-container ul,
        body.light-theme .legal-content-container a {
            color: var(--nord-sym-blueprint-text-primary);
            opacity: 1;
        }
        body.light-theme .legal-content-container a:hover {
            color: var(--nord-sym-blueprint-cyan);
            opacity: 1;
        }

        /* Footer (Blåkopia) */
        body.light-theme #main-footer {
            background-color: #ffffff !important; /* VIKTIGT: Tvinga vit bakgrund */
            border-top: 2px solid var(--nord-sym-blueprint-lines); 
            box-shadow: none;
        }
        body.light-theme .footer-quicklinks .font-semibold,
        body.light-theme .nordsym-logo-star {
            color: var(--nord-sym-blueprint-ink) !important;
            animation: none; /* Ta bort stjärn-glöd */
        }
        body.light-theme .footer-link,
        body.light-theme #main-footer .text-xs,
        body.light-theme #main-footer p,
        body.light-theme #main-footer span {
            color: var(--nord-sym-blueprint-text-secondary) !important; 
            opacity: 1;
        }
        body.light-theme .footer-link:hover {
            color: var(--nord-sym-blueprint-cyan) !important;
            opacity: 1;
            text-shadow: none;
        }
        /* Återställ footer-knapp för ljust läge */
        body.light-theme .btn-service-cta {
            border-color: var(--nord-sym-blueprint-ink) !important;
            color: var(--nord-sym-blueprint-ink) !important;
        }
        body.light-theme .btn-service-cta:hover {
            background-color: var(--nord-sym-blueprint-ink) !important;
            border-color: var(--nord-sym-blueprint-ink) !important;
            color: #ffffff !important;
            box-shadow: none !important;
        }
        
        body.light-theme #main-footer .border-sky-700\/50 {
            border-color: var(--nord-sym-blueprint-lines-faint) !important;
        }
        
        /* FIX: Synliggör social-ikoner i Light Mode */
        body.light-theme #main-footer .ph {
            color: var(--nord-sym-blueprint-text-secondary) !important;
            opacity: 1;
        }
        body.light-theme #main-footer a:hover .ph {
            color: var(--nord-sym-blueprint-cyan) !important;
            opacity: 1;
            transform: scale(1.1);
        }

        /* --- FORMULÄR & MODALS (Blåkopia) --- */
        body.light-theme .form-container {
            background: #ffffff;
            border: 2px solid var(--nord-sym-blueprint-lines);
            backdrop-filter: none;
            box-shadow: 10px 10px 0px rgba(148, 163, 184, 0.2);
            border-radius: 12px;
        }
        body.light-theme .form-container:hover {
            box-shadow: 12px 12px 0px rgba(2, 132, 199, 0.2);
            border-color: var(--nord-sym-blueprint-cyan);
        }
        body.light-theme .form-label {
            color: var(--nord-sym-blueprint-ink);
            font-weight: 600;
        }
        body.light-theme .form-input, 
        body.light-theme .form-textarea {
            background-color: #F8FAFC;
            border: 2px solid var(--nord-sym-blueprint-lines-faint);
            color: var(--nord-sym-blueprint-ink);
            border-radius: 6px;
        }
        body.light-theme .form-input::placeholder, 
        body.light-theme .form-textarea::placeholder {
            color: var(--nord-sym-blueprint-text-secondary);
            opacity: 0.6;
        }
        body.light-theme .form-input:focus, 
        body.light-theme .form-textarea:focus {
            border-color: var(--nord-sym-blueprint-cyan);
            box-shadow: 4px 4px 0px rgba(2, 132, 199, 0.1);
            background-color: #ffffff; 
        }
        body.light-theme .form-progress-bar {
            background-color: var(--nord-sym-blueprint-lines-faint);
        }
        body.light-theme .form-progress-bar-inner {
            background: var(--nord-sym-blueprint-cyan);
            box-shadow: none;
        }
        body.light-theme .footer-quicklinks .font-semibold,
        body.light-theme .nordsym-logo-star {
            color: var(--nord-sym-blueprint-ink) !important;
            animation: none; /* Ta bort stjärn-glöd */
        }
        body.light-theme .footer-link,
        body.light-theme #main-footer .text-xs,
        body.light-theme #main-footer p,
        body.light-theme #main-footer span {
            color: var(--nord-sym-blueprint-ink) !important; /* VIKTIGT: Tailwind override */
            opacity: 0.8;
        }
        body.light-theme .footer-link:hover {
            color: var(--nord-sym-blueprint-cyan) !important;
            opacity: 1;
        }
        /* Återställ footer-knapp för ljust läge */
        body.light-theme .btn-service-cta {
            border-color: var(--nord-sym-blueprint-ink) !important;
            color: var(--nord-sym-blueprint-ink) !important;
        }
        body.light-theme .btn-service-cta:hover {
            background-color: rgba(var(--nord-sym-blueprint-cyan-rgb), 0.1) !important;
            border-color: var(--nord-sym-blueprint-cyan) !important;
            color: var(--nord-sym-blueprint-cyan) !important;
            box-shadow: none !important;
        }
        
        body.light-theme #main-footer .border-sky-700\/50 {
            border-color: var(--nord-sym-blueprint-lines-faint) !important;
        }
        
        /* FIX: Synliggör social-ikoner i Light Mode */
        body.light-theme #main-footer .ph {
            color: var(--nord-sym-blueprint-ink) !important;
            opacity: 0.7;
        }
        body.light-theme #main-footer a:hover .ph {
            color: var(--nord-sym-blueprint-cyan) !important;
            opacity: 1;
            transform: scale(1.1);
        }

        /* --- FORMULÄR & MODALS (Blåkopia) --- */
        body.light-theme .form-container {
            background: var(--nord-sym-blueprint-bg);
            border: 1px solid var(--nord-sym-blueprint-lines);
            backdrop-filter: none;
            box-shadow: 0 4px 6px rgba(0,0,0,0.04);
        }
        body.light-theme .form-container:hover {
            box-shadow: 0 0 20px rgba(var(--nord-sym-blueprint-cyan-rgb), 0.2);
            border-color: var(--nord-sym-blueprint-cyan);
        }
        body.light-theme .form-label {
            color: var(--nord-sym-blueprint-ink);
        }
        body.light-theme .form-input, 
        body.light-theme .form-textarea {
            background-color: var(--nord-sym-blueprint-bg);
            border: 1px solid var(--nord-sym-blueprint-lines);
            color: var(--nord-sym-blueprint-ink);
        }
        body.light-theme .form-input::placeholder, 
        body.light-theme .form-textarea::placeholder {
            color: var(--nord-sym-blueprint-ink);
            opacity: 0.5;
        }
        body.light-theme .form-input:focus, 
        body.light-theme .form-textarea:focus {
            border-color: var(--nord-sym-blueprint-cyan);
            box-shadow: 0 0 15px rgba(var(--nord-sym-blueprint-cyan-rgb), 0.3);
            background-color: var(--nord-sym-blueprint-bg); /* Säkerställ vit bakgrund */
        }
        body.light-theme .form-progress-bar {
            background-color: var(--nord-sym-blueprint-lines-faint);
        }
        body.light-theme .form-progress-bar-inner {
            background: var(--nord-sym-blueprint-cyan);
            box-shadow: 0 0 10px rgba(var(--nord-sym-blueprint-cyan-rgb), 0.5);
        }
        body.light-theme .form-success-container i {
            color: var(--nord-sym-blueprint-cyan);
            animation: none; /* Ta bort stjärn-glöd */
        }
        body.light-theme .form-success-container p {
            color: var(--nord-sym-blueprint-ink);
        }

        /* Modal-specifika stilar (Blåkopia) */
        body.light-theme #coming-soon-modal,
        body.light-theme #free-agent-modal,
        body.light-theme #founder-modal { /* NYTT: Inkludera founder-modal */
            background: rgba(var(--nord-sym-blueprint-bg-rgb), 0.8);
            backdrop-filter: blur(5px);
        }
        body.light-theme #coming-soon-modal .modal-content-wrapper,
        body.light-theme #free-agent-modal .modal-content-wrapper,
        body.light-theme #founder-modal .modal-content-wrapper { /* NYTT */
             /* .form-container-stilarna appliceras redan */
             border-color: var(--nord-sym-blueprint-cyan); /* Gör att modalen poppar lite */
             box-shadow: 0 0 30px rgba(var(--nord-sym-blueprint-cyan-rgb), 0.3);
        }
        
        /* DYNAMIC WAITLIST VISUALS */
        #coming-soon-modal.visible .modal-content-wrapper,
        #founder-modal.visible .modal-content-wrapper { /* NYTT */
            transform: scale(1); /* Ingen rotation för founder */
        }
        @media (prefers-reduced-motion: reduce) {
            #coming-soon-modal.visible .modal-content-wrapper {
                transform: scale(1);
            }
        }
        
        /* Utility class för textfärg om den saknas i Tailwind-bygget */
        .text-nord-sym-cyan { color: var(--nord-sym-cyan) !important; }
        
        /* NYTT: Override för ljust läge - Använd den mörkare blå (Blueprint) färgen */
        body.light-theme .text-nord-sym-cyan { color: var(--nord-sym-blueprint-cyan) !important; }

        body.light-theme #coming-soon-modal button,
        body.light-theme #free-agent-modal button,
        body.light-theme #founder-modal button { /* NYTT */
             opacity: 0.7; /* Tona ner texten i stäng-knappen */
        }
        body.light-theme #coming-soon-modal button:hover,
        body.light-theme #free-agent-modal button:hover,
        body.light-theme #founder-modal button:hover { /* NYTT */
             opacity: 1;
        }

        /* FIX: Synlighet för SoMe-knappar i Founder Modal (Light Mode) */
        /* DARK MODE (Standard) - Tvinga vit färg */
        #founder-modal .btn-base {
            border: 1px solid rgba(255, 255, 255, 0.2) !important;
            background: rgba(255, 255, 255, 0.1) !important; /* Lite starkare bakgrund */
            color: #ffffff !important;
        }
        /* Säkra upp både i-tagg och eventuell SVG som ersätter den */
        #founder-modal .btn-base i,
        #founder-modal .btn-base svg {
            color: #ffffff !important;
            fill: currentColor;
        }
        #founder-modal .btn-base:hover {
            border-color: var(--nord-sym-cyan) !important;
            background: rgba(var(--nord-sym-cyan-rgb), 0.2) !important;
            box-shadow: 0 0 15px rgba(var(--nord-sym-cyan-rgb), 0.3) !important;
        }
        #founder-modal .btn-base:hover i,
        #founder-modal .btn-base:hover svg {
            color: var(--nord-sym-cyan) !important;
        }

        /* LIGHT MODE - Tvinga mörkgrå färg */
        body.light-theme #founder-modal .btn-base {
            border-color: #cbd5e1 !important; /* Slate 300 */
            background-color: #f1f5f9 !important; /* Slate 100 - Tydligare knapp */
            color: #1e293b !important; /* Slate 800 - Mörkare text */
            box-shadow: 0 2px 4px rgba(0,0,0,0.05) !important;
        }
        body.light-theme #founder-modal .btn-base i,
        body.light-theme #founder-modal .btn-base svg {
            color: #1e293b !important;
        }
        body.light-theme #founder-modal .btn-base:hover {
            border-color: var(--nord-sym-blueprint-cyan) !important;
            background-color: #e0f2fe !important; /* Ljusblå vid hover */
            color: var(--nord-sym-blueprint-cyan) !important;
        }
        body.light-theme #founder-modal .btn-base:hover i,
        body.light-theme #founder-modal .btn-base:hover svg {
            color: var(--nord-sym-blueprint-cyan) !important;
        }


        /* --- CHATTWIDGET (Blåkopia) --- */
        body.light-theme #chat-bubble {
            background: var(--nord-sym-blueprint-ink);
            color: var(--nord-sym-blueprint-cyan);
            box-shadow: 0 0 25px rgba(var(--nord-sym-blueprint-ink-rgb), 0.4);
            animation: none; /* Stänger av den gamla pulsen */
        }
        body.light-theme #chat-bubble:hover {
            box-shadow: 0 0 35px rgba(var(--nord-sym-blueprint-cyan-rgb), 0.7);
        }
        
        body.light-theme #chat-window {
            background: var(--nord-sym-blueprint-bg);
            border: 1px solid var(--nord-sym-blueprint-lines);
            backdrop-filter: none;
            box-shadow: 0 10px 20px rgba(0,0,0,0.05);
        }
        
        body.light-theme #chat-header {
            background: var(--nord-sym-blueprint-bg);
            border-bottom: 1px solid var(--nord-sym-blueprint-lines-faint);
        }
        body.light-theme #chat-header h3 {
            color: var(--nord-sym-blueprint-ink);
        }
        body.light-theme #chat-header p {
            color: var(--nord-sym-blueprint-cyan); /* Använd cyan för "Online" */
        }
        body.light-theme #chat-close-btn {
            color: var(--nord-sym-blueprint-ink);
            opacity: 0.7;
        }
        body.light-theme #chat-close-btn:hover {
            background-color: rgba(var(--nord-sym-blueprint-cyan-rgb), 0.1);
            color: var(--nord-sym-blueprint-cyan);
            opacity: 1;
        }

        body.light-theme #chat-messages {
            /* Bakgrunden (rutnätet) ärvs från body */
            scrollbar-color: var(--nord-sym-blueprint-cyan) var(--nord-sym-blueprint-lines-faint);
        }
        body.light-theme #chat-messages::-webkit-scrollbar-thumb {
            background-color: var(--nord-sym-blueprint-cyan);
        }
        body.light-theme #chat-messages::-webkit-scrollbar-track {
            background: var(--nord-sym-blueprint-lines-faint);
        }

        body.light-theme .bot-message p {
            background: rgba(var(--nord-sym-blueprint-cyan-rgb), 0.1);
            color: var(--nord-sym-blueprint-ink);
            opacity: 0.9;
        }
        body.light-theme .user-message p {
            background: var(--nord-sym-blueprint-ink);
            color: var(--nord-sym-blueprint-bg) !important; /* VIKTIGT: Tvinga vit text mot mörk bakgrund */
        }
        body.light-theme .typing-indicator span {
            background-color: rgba(var(--nord-sym-blueprint-ink-rgb), 0.3);
            box-shadow: 0 0 4px rgba(var(--nord-sym-blueprint-ink-rgb), 0.3);
            animation-name: blueprint-typing-glow; /* Byt till en ny animation */
        }

        /* Ny glow-animation för blåkopia */
        @keyframes blueprint-typing-glow {
            0%, 100% {
                background-color: rgba(var(--nord-sym-blueprint-ink-rgb), 0.2);
                box-shadow: 0 0 4px rgba(var(--nord-sym-blueprint-ink-rgb), 0.2);
            }
            50% {
                background-color: rgba(var(--nord-sym-blueprint-ink-rgb), 1);
                box-shadow: 0 0 8px rgba(var(--nord-sym-blueprint-ink-rgb), 0.7);
            }
        }
        
        body.light-theme #chat-input-area {
            border-top: 1px solid var(--nord-sym-blueprint-lines-faint);
        }
        body.light-theme #chat-input {
            /* Återanvänd formulärstilar */
            background-color: var(--nord-sym-blueprint-bg);
            border: 1px solid var(--nord-sym-blueprint-lines);
            color: var(--nord-sym-blueprint-ink);
        }
        body.light-theme #chat-input::placeholder {
            color: var(--nord-sym-blueprint-ink);
            opacity: 0.5;
        }
        body.light-theme #chat-input:focus {
            border-color: var(--nord-sym-blueprint-cyan);
            box-shadow: 0 0 15px rgba(var(--nord-sym-blueprint-cyan-rgb), 0.3);
        }
        
        body.light-theme #chat-send-btn {
            background-color: var(--nord-sym-blueprint-ink);
            color: var(--nord-sym-blueprint-bg);
        }
        body.light-theme #chat-send-btn:hover {
            background-color: var(--nord-sym-blueprint-cyan);
            color: var(--nord-sym-blueprint-ink);
        }


        /* --- RITBORDET LOBBY (Blåkopia) --- */
        body.light-theme .ritbordet-card {
            background: #ffffff; /* Ändrat från blueprint-bg till ren vit */
            border: 2px solid var(--nord-sym-blueprint-lines); /* 2px solid kant */
            backdrop-filter: none;
            -webkit-backdrop-filter: none;
            box-shadow: 8px 8px 0px rgba(148, 163, 184, 0.2); /* Hård skugga */
            border-radius: 12px; /* Matchar Tjänster */
        }
        body.light-theme .ritbordet-card:not(.flippable):hover {
            border-color: var(--nord-sym-blueprint-cyan);
            box-shadow: 12px 12px 0px rgba(2, 132, 199, 0.2); /* Hårdare blå skugga vid hover */
            transform: translate(-2px, -2px);
        }
        /* Fix för flippable hover effect container */
        body.light-theme .ritbordet-card.flippable:hover .flip-card-front {
             border-color: var(--nord-sym-blueprint-cyan);
             box-shadow: 12px 12px 0px rgba(2, 132, 199, 0.2);
             transform: translate(-2px, -2px); /* Flytta hela fronten */
        }

        /* FIX: R&D Cube Icon Container i Light Mode (Ink Style) */
        body.light-theme .ritbordet-card .bg-sky-900\/50 {
            background-color: #f1f5f9 !important; /* Slate 100 */
            border-color: var(--nord-sym-blueprint-ink) !important;
        }
        /* FIX: R&D Cube Icon Color i Light Mode */
        body.light-theme .ritbordet-card .text-nord-sym-cyan {
            color: var(--nord-sym-blueprint-ink) !important;
        }
        /* Hover effekt för cirkeln i light mode */
        body.light-theme .ritbordet-card:hover .bg-sky-900\/50 {
            background-color: var(--nord-sym-blueprint-ink) !important;
            border-color: var(--nord-sym-blueprint-ink) !important;
        }
        body.light-theme .ritbordet-card:hover .text-nord-sym-cyan {
            color: #ffffff !important;
        }

        /* --- NYTT: Flip Card Mekanik (LJUST TEMA) --- */
        body.light-theme .flip-card-front {
            background: #ffffff; /* Ren vit */
            border: 2px solid var(--nord-sym-blueprint-lines);
            backdrop-filter: none;
            box-shadow: 8px 8px 0px rgba(148, 163, 184, 0.2); /* Hård skugga */
            border-radius: 12px;
        }
        /* Ta bort border från containern om den är flippable för att undvika dubbla kanter */
        body.light-theme .ritbordet-card.flippable {
            border: none;
            background: transparent;
            box-shadow: none;
        }
        
        body.light-theme .flip-card-back {
            background: #ffffff; /* Vit bakgrund för baksidan också för läsbarhet */
            border: 2px solid var(--nord-sym-blueprint-cyan); /* Cyan kant för baksidan */
            backdrop-filter: none;
            transform: rotateY(180deg);
            box-shadow: 8px 8px 0px rgba(2, 132, 199, 0.2);
            border-radius: 12px;
        }
        body.light-theme .flip-card-back h5 {
            color: var(--nord-sym-blueprint-cyan);
            border-bottom-color: rgba(var(--nord-sym-blueprint-cyan-rgb), 0.3);
        }
        body.light-theme .flip-card-back li {
            color: var(--nord-sym-blueprint-ink);
            opacity: 0.8;
        }
        body.light-theme .flip-card-back li i {
            color: var(--nord-sym-blueprint-cyan);
        }
        /* --- Slut på Flip Card (LJUST TEMA) --- */

        body.light-theme .ritbordet-card i {
            color: var(--nord-sym-blueprint-cyan);
        }
        body.light-theme .ritbordet-card h4 {
            color: var(--nord-sym-blueprint-ink);
        }
        body.light-theme .ritbordet-card p {
            color: var(--nord-sym-blueprint-ink);
            opacity: 0.8;
        }
        /* Pris-preview-kortet i lobbyn */
        body.light-theme .ritbordet-card.pricing-preview .price-range {
            color: var(--nord-sym-blueprint-ink);
            border-color: var(--nord-sym-blueprint-lines-faint);
        }

        /* Centrala CTA-knappen (Blåkopia) */
        body.light-theme #geometry-cta {
            background: transparent;
            border: 2px solid var(--nord-sym-blueprint-ink);
        }
        body.light-theme #geometry-cta:hover {
            background: rgba(var(--nord-sym-blueprint-cyan-rgb), 0.1);
            border-color: var(--nord-sym-blueprint-cyan);
            box-shadow: 0 0 30px rgba(var(--nord-sym-blueprint-cyan-rgb), 0.3);
        }
        
        /* HERO RUBRIK OVERRIDE FOR LIGHT MODE */
        body.light-theme h1 {
            color: var(--nord-sym-blueprint-ink) !important;
            text-shadow: 4px 4px 0px rgba(148, 163, 184, 0.2) !important;
        }

        body.light-theme #geometry-cta i {
            color: var(--nord-sym-blueprint-ink);
            transition: all 0.3s ease; /* Säkerställ transition */
        }
        body.light-theme #geometry-cta .cta-text {
            color: var(--nord-sym-blueprint-ink);
            transition: all 0.3s ease;
        }
        body.light-theme #geometry-cta:hover i {
            color: var(--nord-sym-blueprint-cyan);
            /* transform: rotate(45deg) scale(1.1); *//* Behåll rotation från dark mode */
        }
        body.light-theme #geometry-cta:hover .cta-text {
            color: var(--nord-sym-blueprint-cyan);
        }

        /* Mobil "Enter Workshop"-knapp (Blåkopia) */
        body.light-theme #mobile-enter-workshop-btn {
            background: rgba(var(--nord-sym-blueprint-bg-rgb), 0.8);
            backdrop-filter: blur(5px);
            border: 2px solid var(--nord-sym-blueprint-cyan);
            color: var(--nord-sym-blueprint-cyan);
            box-shadow: 0 0 20px rgba(var(--nord-sym-blueprint-cyan-rgb), 0.3);
        }

        /* Onboarding Modal (Blåkopia) */
        /* BORTTAGEN: Gamla onboarding-stilar rensas eller ignoreras då vi byter till Ghost Hints */
        
        /* --- NYTT: Ghost Hints (Ersätter Onboarding Modal) --- */
        #workshop-ghost-hints {
            position: fixed;
            bottom: 15%;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            pointer-events: none; /* Klick går rakt igenom */
            z-index: 2000;
            opacity: 0;
            transition: opacity 1s ease;
            width: 100%;
            max-width: 600px;
            padding: 0 1rem;
        }
        #workshop-ghost-hints.visible {
            opacity: 1;
        }
        .ghost-hint-text {
            font-family: 'Comfortaa', sans-serif;
            font-size: 1.1rem;
            color: var(--nord-sym-cyan);
            text-shadow: 0 0 15px rgba(var(--nord-sym-cyan-rgb), 0.5);
            margin-bottom: 0.5rem;
            letter-spacing: 0.05em;
        }
        .ghost-hint-sub {
            font-family: 'Inter', sans-serif;
            font-size: 0.85rem;
            color: var(--nord-sym-text-medium);
            opacity: 0.8;
        }
        
        /* Mobil-justering för hints */
        @media (max-width: 768px) {
            #workshop-ghost-hints {
                bottom: 25%; /* Högre upp på mobil för att inte krocka med joysticks */
            }
        }

        /* --- NYTT: AI-First Spel (Easter Egg) --- */
        body.light-theme #ai-first-ship-icon {
            border-bottom-color: var(--nord-sym-blueprint-cyan);
        }
        /* --- Slut på AI-First Spel --- */


        /* --- VENNDIAGRAM-HARMONISERING --- */
        .venn-diagram-container {
            display: flex; justify-content: center; align-items: center;
            min-height: 350px;
        }
        /* LIGHT THEME VENN DIAGRAM FIX */
        body.light-theme .venn-circle {
            background: rgba(255, 255, 255, 0.6);
            border-color: var(--nord-sym-blueprint-lines);
            box-shadow: 0 0 30px rgba(0,0,0,0.05);
        }
        body.light-theme .venn-circle-text {
            color: var(--nord-sym-blueprint-ink) !important;
            text-shadow: none;
            font-weight: 800;
        }
        body.light-theme .venn-overlap-text {
            color: var(--nord-sym-blueprint-ink) !important;
            text-shadow: 2px 2px 0px #ffffff; /* Outline effekt för läsbarhet vid överlapp */
            font-weight: 900;
        }
        body.light-theme .venn-overlap-text i {
            color: var(--nord-sym-blueprint-cyan) !important;
        }

        .venn-diagram-wrapper {
            position: relative; width: 440px; height: 280px;
            transition: all 0.3s ease-in-out;
        }
        .venn-circle {
            position: absolute;
            width: 280px; height: 280px;
            border-radius: 50%;
            /* UPPDATERAT: Vit Krita-stil (White Chalk) - Neutral bas */
            background: radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.02) 0%, rgba(255, 255, 255, 0.05) 100%);
            border: 1px solid rgba(255, 255, 255, 0.3);
            display: flex; 
            align-items: center;
            /* UPPDATERAT: Neutral skugga/glöd */
            box-shadow: 0 0 40px rgba(0,0,0,0.5), inset 0 0 20px rgba(255, 255, 255, 0.02);
            animation: venn-pulse 8s infinite ease-in-out;
            transition: all 0.3s ease-in-out;
        }
        .venn-circle-1 { top: 0; left: 0; animation-delay: 0s; justify-content: flex-start; }
        .venn-circle-2 { top: 0; right: 0; animation-delay: -4s; justify-content: flex-end; }
        .venn-circle-text {
            font-family: 'Comfortaa', sans-serif;
            font-weight: 700;
            color: #ffffff; /* Helt vit text */
            text-align: center;
            font-size: 1.1rem; /* Återställd storlek */
            max-width: 150px; /* Balanserad bredd för radbrytning */
            padding: 0 1rem;
            text-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        .venn-overlap-text {
            position: absolute;
            top: 50%; 
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Comfortaa', sans-serif;
            font-weight: 700;
            font-size: 1.25rem; /* Desktop baseline */
            color: #ffffff; /* Vit text */
            cursor: pointer;
            transition: all 0.3s ease;
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.4);
            width: 120px;
            text-align: center;
            line-height: 1.1; /* Harmoni-fix: Bättre line-height för multi-word text */
        }
        .venn-overlap-text:hover {
            color: #ffffff;
            filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.8));
            transform: translate(-50%, -50%) scale(1.05);
        }
        @keyframes venn-pulse {
            50% { transform: scale(1.02); border-color: rgba(255, 255, 255, 0.5); box-shadow: 0 0 50px rgba(0,0,0,0.6), inset 0 0 30px rgba(255, 255, 255, 0.05); }
        }
        
        /* Harmoni-fix: Responsiv typografi för Venn-diagrammet */
        @media (max-width: 768px) {
            .venn-diagram-wrapper { width: 320px; height: 200px; }
            .venn-circle { width: 200px; height: 200px; }
            .venn-circle-text { font-size: 0.9rem; max-width: 100px; padding: 0 1.5rem; }
            .venn-overlap-text { 
                font-size: 0.8rem !important; /* Kraftigare minskning */
                width: 85px; 
                line-height: 1.0; 
                word-wrap: break-word;
                overflow-wrap: break-word; /* Extra säkerhet */
                hyphens: auto; /* Automatisk orddelning */
            }
        }
        @media (max-width: 480px) {
            .venn-diagram-wrapper { width: 280px; height: 180px; }
            .venn-circle { width: 180px; height: 180px; }
            .venn-circle-text { font-size: 0.8rem; max-width: 80px; padding: 0 1rem; }
            .venn-overlap-text { 
                font-size: 0.65rem !important;
                width: 70px; 
                line-height: 0.95; 
                word-wrap: break-word;
                overflow-wrap: break-word;
                text-align: center;
                hyphens: auto;
            }
        }
        @media (max-width: 360px) {
            .venn-overlap-text { 
                font-size: 0.55rem !important;
                width: 60px;
                line-height: 0.9;
            }
        }
        @media (hover: none) and (pointer: coarse) {
            .venn-overlap-text:hover {
                transform: translate(-50%, -50%); /* Ingen scale på touch devices */
            }
        }
        
        /* --- ATOM GALLERY 2.0: THE SYNERGY UPGRADE --- */
        .gallery-container {
            position: relative;
        }
        .gallery-viewport {
            overflow: hidden;
            /* NYTT: Perspektiv för 3D-flip */
            perspective: 1000px;
        }
        .gallery-wrapper {
            display: flex;
            gap: 2rem;
            transition: transform 0.7s cubic-bezier(0.25, 1, 0.5, 1);
        }
        .archetype-card {
            /* PREMIUM OBSIDIAN REDESIGN: Djupare, neutralare svart för bättre kontrast */
            background: linear-gradient(180deg, rgba(12, 14, 18, 0.85) 0%, rgba(0, 0, 0, 0.95) 100%);
            
            /* GLAS-KANT: Subtilare och krispigare */
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            
            /* FROSTED FEEL */
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            
            /* RUNDARE HÖRN */
            border-radius: 2rem;
            
            padding: 2.5rem 2rem;
            display: flex;
            flex-direction: column;
            text-align: center;
            align-items: center;
            min-height: 460px; /* Bigger */
            flex-shrink: 0;
            width: calc(100% / 3 - (4rem / 3));
            transition: all 0.4s cubic-bezier(0.25, 1, 0.5, 1);
            position: relative;
            overflow: hidden;
            /* ATMOSFÄRISK SKUGGA: Djupare skugga för att lyfta kortet från bakgrunden */
            box-shadow: 0 20px 40px -10px rgba(0,0,0,0.8);
        }
        .archetype-card::before { /* Glow effect on hover */
            content: '';
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            /* SUBTILARE GLOW: Minskar intensiteten */
            background: radial-gradient(circle at 50% 0%, rgba(var(--nord-sym-cyan-rgb), 0.1), transparent 70%);
            opacity: 0;
            transition: opacity 0.4s ease;
            z-index: 0;
        }
        .archetype-card:hover {
            /* MJUKARE HOVER: Inte lika skarp kantfärg */
            border-color: rgba(255, 255, 255, 0.15); 
            /* box-shadow: 0 0 35px rgba(var(--nord-sym-cyan-rgb), 0.3), 0 8px 25px rgba(0,0,0,0.3); */
            box-shadow: 0 30px 60px -12px rgba(0,0,0,0.9), inset 0 0 0 1px rgba(255, 255, 255, 0.05);
            transform: translateY(-8px) scale(1.02); /* Better */
        }
        .archetype-card:hover::before {
            opacity: 1;
        }
        /* Ensure card content is above the glow */
        .archetype-card > * {
            position: relative;
            z-index: 1;
        }
        .archetype-card > i {
            font-size: 3rem; /* Bigger icon */
            color: var(--nord-sym-cyan);
            margin-bottom: 1.5rem;
            transition: transform 0.4s ease, filter 0.4s ease;
        }
        .archetype-card > .avatar-image {
            width: 80px;
            height: 80px;
            margin-bottom: 1rem;
            border-radius: 50%;
            object-fit: cover;
            transition: transform 0.4s ease, filter 0.4s ease;
            filter: drop-shadow(0 0 5px rgba(var(--nord-sym-cyan-rgb), 0.3));
        }
        
        /* --- NYTT: GenPRD Logo Styling (Fix för storlek och ram) --- */
        .genprd-logo-img {
            width: 80px;
            height: 80px;
            margin-bottom: 1rem;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--nord-sym-cyan); /* Ringen */
            padding: 3px; /* Luft mellan bild och ring */
            transition: all 0.4s cubic-bezier(0.25, 1, 0.5, 1);
            background: rgba(var(--nord-sym-deep-space-blue-rgb), 0.5); /* Bakgrund för transparens */
        }
        .archetype-card:hover .genprd-logo-img {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(var(--nord-sym-cyan-rgb), 0.4);
            border-color: var(--nord-sym-light-accent);
        }
        /* Light Theme Override för GenPRD */
        body.light-theme .genprd-logo-img {
            border-color: var(--nord-sym-blueprint-cyan);
            background: rgba(255, 255, 255, 0.8);
        }
        body.light-theme .archetype-card:hover .genprd-logo-img {
            box-shadow: 0 0 20px rgba(var(--nord-sym-blueprint-cyan-rgb), 0.3);
        }
        /* --- Slut på GenPRD Fix --- */

        .archetype-card:hover > i,
        .archetype-card:hover > .avatar-image {
            transform: scale(1.1);
            filter: drop-shadow(0 0 15px rgba(var(--nord-sym-cyan-rgb), 0.8));
        }
        .archetype-card h4 {
            font-family: 'Comfortaa', sans-serif;
            color: #ffffff; /* UPPDATERAT: Vit Krita (Tidigare light-accent) */
            font-size: 1.375rem; /* Bigger title */
            margin-bottom: 1rem;
        }
        .archetype-card .description {
            color: #ffffff; /* UPPDATERAT: Vit Krita (Tidigare text-medium) */
            line-height: 1.65;
            font-size: 0.95rem; /* Slightly larger text */
            flex-grow: 1;
            margin-bottom: 1.5rem;
            opacity: 0.9; /* Subtil mjukhet */
        }
        .tech-signature-container {
            display: flex;
            justify-content: center;
            gap: 1.75rem;
            margin-bottom: 1.5rem;
            width: 100%;
        }
        .tech-signature-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.3rem;
        }
        .tech-signature-item i {
            font-size: 1.6rem;
            color: #ffffff; /* UPPDATERAT: Vit Krita */
        }
        .tech-signature-item span {
            font-size: 0.75rem;
            color: #ffffff; /* UPPDATERAT: Vit Krita */
            font-weight: 500;
        }
        .archetype-cta {
            margin-bottom: 1.5rem;
            padding: 0.6rem 1.5rem;
            font-size: 0.875rem;
            background: transparent;
            border: 1px solid #ffffff; /* UPPDATERAT: Vit Kant */
            color: #ffffff; /* UPPDATERAT: Vit Text */
            box-shadow: none;
        }
        .archetype-cta:hover {
            background: #ffffff; /* Vit bakgrund vid hover */
            border-color: #ffffff;
            color: var(--nord-sym-deep-space-blue); /* Mörk text vid hover */
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.3); /* Vit glöd */
        }
        .archetype-card .indicator {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.8); /* UPPDATERAT: Vitare text */
            border-top: 1px solid rgba(255, 255, 255, 0.2); /* Vitare linje */
            padding-top: 1rem;
            width: 100%;
            margin-top: auto;
            font-style: italic;
        }
        .archetype-card.teaser {
            position: relative;
            overflow: hidden;
            cursor: not-allowed;
            pointer-events: none;
        }
        .archetype-card.teaser > * {
            filter: blur(4px);
            opacity: 0.5;
        }
        .archetype-card.teaser::after {
            content: 'UNDER UTVECKLING';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-15deg);
            font-size: 2.5rem;
            font-weight: 700;
            font-family: 'Comfortaa', sans-serif;
            color: rgba(var(--nord-sym-light-accent-rgb), 0.15);
            z-index: 1;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            text-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        @media (max-width: 1024px) {
            .archetype-card { width: calc(50% - 1rem); }
        }
        @media (max-width: 768px) {
            .gallery-wrapper { 
                scroll-snap-type: x mandatory; 
                overflow-x: auto; 
                gap: 1.5rem; /* A bit more space */
            }
            .archetype-card { 
                scroll-snap-align: start; 
                width: 85%; /* A bit wider on mobile */
                min-height: 440px;
            }
        }

        .gallery-pagination-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: rgba(var(--nord-sym-text-light), 0.2);
            border: 1px solid rgba(var(--nord-sym-text-light), 0.3);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .gallery-pagination-dot:hover {
            background-color: rgba(var(--nord-sym-cyan-rgb), 0.5);
        }
        .gallery-pagination-dot.active {
            background-color: var(--nord-sym-cyan);
            border-color: var(--nord-sym-cyan);
            transform: scale(1.2);
            box-shadow: 0 0 10px rgba(var(--nord-sym-cyan-rgb), 0.5);
        }
        
        .gallery-control-btn {
            background: rgba(var(--nord-sym-cyan-rgb), 0.1);
            border: 1px solid rgba(var(--nord-sym-cyan-rgb), 0.3);
            border-radius: 50%;
            width: 52px;
            height: 52px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--nord-sym-cyan);
            font-size: 1.75rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .gallery-control-btn:hover:not(.disabled) {
            background: rgba(var(--nord-sym-cyan-rgb), 0.2);
            box-shadow: 0 0 15px rgba(var(--nord-sym-cyan-rgb), 0.4);
            transform: scale(1.05);
        }
        .gallery-control-btn.disabled {
            opacity: 0.3;
            cursor: not-allowed;
            transform: scale(1);
            background: rgba(var(--nord-sym-cyan-rgb), 0.1);
            box-shadow: none;
        }

        /* --- SYSTEM/PRICING CARD REJUVENATION (HARMONISERAD MED GALLERI) --- */
        .pricing-card {
            /* PREMIUM OBSIDIAN REDESIGN: Mycket mer solid svärta (95-98%) för att minska "glas-känslan" */
            background: linear-gradient(180deg, rgba(10, 12, 16, 0.98) 0%, rgba(0, 0, 0, 1) 100%);
            
            /* GLAS-KANT: Vit Krita (Chalk) - Tydligare, vitare kant */
            border: 1px solid rgba(255, 255, 255, 0.25);
            border-top: 1px solid rgba(255, 255, 255, 0.4);
            
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border-radius: 2rem; /* Matchar galleriet */
            padding: 2.5rem 2rem;
            display: flex;
            flex-direction: column;
            height: 100%;
            transition: all 0.4s cubic-bezier(0.25, 1, 0.5, 1);
            position: relative;
            overflow: hidden;
            /* ATMOSFÄRISK SKUGGA */
            box-shadow: 0 20px 40px -10px rgba(0,0,0,0.9);
        }
        .pricing-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            /* Byt ut cyan glow mot neutral vit/grå glow */
            background: radial-gradient(circle at 50% 0%, rgba(255, 255, 255, 0.05), transparent 70%);
            opacity: 0;
            transition: opacity 0.4s ease;
            z-index: 0;
        }
        .pricing-card > * {
            position: relative;
            z-index: 1;
        }
        .pricing-card:hover {
            transform: translateY(-8px) scale(1.02); /* Matchar galleriet */
            box-shadow: 0 30px 60px -12px rgba(0,0,0,1), inset 0 0 0 1px rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.5); /* Starkare vit vid hover */
        }
        .pricing-card:hover::before {
            opacity: 1;
        }
        
        /* Ignite Package (Mittenkortet) - FIX: Dark Mode ska vara MÖRKT */
        .pricing-card.ignite-package {
            /* Återställd Dark Mode design (Obsidian + Vit Krita markering) */
            background: linear-gradient(180deg, rgba(12, 16, 24, 0.98) 0%, rgba(5, 5, 10, 1) 100%);
            border: 2px solid rgba(255, 255, 255, 0.8); /* Tydlig vit markering */
            box-shadow: 0 25px 70px -12px rgba(0, 0, 0, 0.9), 0 0 30px rgba(255, 255, 255, 0.1); /* Subtil vit glow */
            transform: scale(1.05);
            z-index: 2; /* Lyft fram kortet */
        }
        .pricing-card.ignite-package:hover {
             transform: scale(1.08) translateY(-8px);
             box-shadow: 0 35px 80px -15px rgba(0, 0, 0, 1), 0 0 40px rgba(255, 255, 255, 0.2);
             border-color: #ffffff;
        }

        /* LIGHT THEME OVERRIDES (Specifikt för detta kort) */
        body.light-theme .pricing-card.ignite-package {
            border-color: var(--nord-sym-blueprint-cyan);
            box-shadow: 0 0 20px rgba(var(--nord-sym-blueprint-cyan-rgb), 0.2);
            background: var(--nord-sym-blueprint-bg);
        }
        
        body.light-theme .pricing-card-header h3 { color: var(--nord-sym-blueprint-ink); }
        /* FIX: Tvinga mörk färg för pricing-sub i light mode så den syns */
        body.light-theme .pricing-sub { color: var(--nord-sym-blueprint-ink) !important; opacity: 0.7; }
        body.light-theme .price-display { color: var(--nord-sym-blueprint-ink); }
        body.light-theme .pricing-card li strong { color: var(--nord-sym-blueprint-ink); }
        body.light-theme .pricing-card li { color: var(--nord-sym-blueprint-text-secondary); }
        body.light-theme .pricing-card li i { color: var(--nord-sym-blueprint-cyan); }
        /* Återställ knappar i light mode */
        body.light-theme .pricing-card .btn-base {
             border: 2px solid var(--nord-sym-blueprint-ink) !important;
             color: var(--nord-sym-blueprint-ink) !important;
        }
        body.light-theme .pricing-card .btn-base:hover {
             border-color: var(--nord-sym-blueprint-cyan) !important;
             color: var(--nord-sym-blueprint-cyan) !important;
             background: rgba(var(--nord-sym-blueprint-cyan-rgb), 0.1) !important;
        }

        #main-footer {
            /* UPPDATERAT: Vit Krita-linje (Ingen blå ton) */
            border-top: 1px solid rgba(255, 255, 255, 0.15);
            border-bottom: none; border-left: none; border-right: none;
            box-shadow: none;
            background: rgba(5, 6, 8, 0.95); /* Obsidian */
        }
        body.labb-active #main-footer {
            display: none !important; /* Total immersion i verkstaden. */
        }
        .footer-quicklinks { display: flex; flex-direction: column; gap: 0.25rem; align-items: center; }
        @media (min-width: 768px) { .footer-quicklinks { align-items: flex-start; } }
        
        /* UPPDATERAT: Vita footer-länkar */
        .footer-link { color: rgba(255, 255, 255, 0.6); transition: all 0.3s ease; padding: 0.1rem 0; }
        .footer-link:hover { color: #ffffff; text-shadow: 0 0 10px rgba(255,255,255,0.3); }
        
        .nordsym-logo-star {
            color: #ffffff; /* Vit stjärna */
            animation: nordsym-logo-star-glow 3s infinite ease-in-out;
        }
        @keyframes nordsym-logo-star-glow { 50% { filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.6)); } }
        
        /* UPPDATERAT: Vita social-ikoner */
        #main-footer .ph { color: rgba(255, 255, 255, 0.7); transition: all 0.3s ease; }
        #main-footer a:hover .ph { color: #ffffff; transform: scale(1.1); }
        
        /* UPPDATERAT: GDPR Logo (Vit) */
        #main-footer svg.text-nord-sym-text-light { color: rgba(255, 255, 255, 0.4); }
        #main-footer:hover svg.text-nord-sym-text-light { color: #ffffff; opacity: 1; }

        .sr-only {
            position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px;
            overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border: 0;
        }
        .legal-content-container { color: var(--nord-sym-text-medium); }
        .legal-content-container h3 {
            font-family: 'Comfortaa', sans-serif; font-size: 1.5rem; font-weight: 700;
            color: var(--nord-sym-text-light); margin-top: 2rem; margin-bottom: 1rem;
            border-bottom: 1px solid rgba(var(--nord-sym-cyan-rgb), 0.2); padding-bottom: 0.5rem;
         }
         .legal-content-container a:hover { color: var(--nord-sym-light-accent); }
        .hero-headline-glow { animation: hero-glow-animation 5s ease-in-out infinite; }
        
        /* -- NYTT: Animation för FAKTISKT-taggen -- */
        @keyframes shake-emphasis {
            0% { transform: rotate(-2deg) scale(1); }
            5% { transform: rotate(2deg) scale(1.1); }
            10% { transform: rotate(-2deg) scale(1.1); }
            15% { transform: rotate(2deg) scale(1.1); }
            20% { transform: rotate(-2deg) scale(1); }
            100% { transform: rotate(-2deg) scale(1); } /* Paus resten av tiden */
        }
        .animate-emphasis {
            animation: shake-emphasis 4s ease-in-out infinite;
            transform-origin: center;
        }
        
        /* -- NYTT: Interaktiv trigger för AI-First -- */
        .interactive-ai-first-text {
            cursor: pointer;
            transition: all 0.3s ease;
            /* Subtil glöd som standard för att antyda interaktivitet */
            text-shadow: 0 0 8px rgba(var(--nord-sym-cyan-rgb), 0.3);
            white-space: nowrap; /* Förhindrar att "AI-First" delas upp */
        }
        .interactive-ai-first-text:hover {
            color: var(--nord-sym-cyan);
            text-shadow: 0 0 20px rgba(var(--nord-sym-cyan-rgb), 0.7);
        }
        
        /* Harmoni-fix: Återställer stilen för den accentuerade texten i rubriker. */
        .section-title-accent {
            color: var(--nord-sym-cyan);
            text-shadow: 0 0 10px rgba(var(--nord-sym-cyan-rgb), 0.5);
        }
        
        #header-logo-link.menu-open img {
            filter: drop-shadow(0 0 15px rgba(var(--nord-sym-cyan-rgb), 0.6));
        }
        
        #hero-logo-wrapper {
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.22, 1, 0.36, 1);
        }
        #hero-logo-wrapper:hover {
            transform: scale(1.04);
            filter: drop-shadow(0 0 25px rgba(var(--nord-sym-cyan-rgb), 0.5));
        }

        /* --- RITBORDET LOBBY & WORKSHOP RE-ARCHITECTING --- */
        #ritbordet {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: calc(100vh - 116px - 100px); /* Full height minus header/footer estimate */
            padding-top: 4rem;
            padding-bottom: 4rem;
        }

        #ritbordet-lobby {
            transition: opacity 0.4s ease, transform 0.4s ease;
            transform: scale(1);
        }
        body.labb-active #ritbordet-lobby {
            opacity: 0;
            pointer-events: none;
            transform: scale(0.95);
        }

        #ritbordet-lobby .desktop-layout { display: none; }
        @media (min-width: 1024px) {
            #ritbordet-lobby .desktop-layout {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 2.5rem;
                max-width: 1200px;
                width: 100%;
            }
        }
        #ritbordet-lobby .mobile-layout { display: block; }
        @media (min-width: 1024px) { #ritbordet-lobby .mobile-layout { display: none; } }

        .ritbordet-grid {
            display: grid;
            gap: 1.5rem;
            width: 100%;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        }
        @media (min-width: 1024px) {
            .ritbordet-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        .ritbordet-card {
            background: rgba(12, 14, 18, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.15); /* Vit Krita: Ökad synlighet från 0.06 */
            padding: 1.5rem; /* Behålls för icke-flippbara */
            text-align: left;
            display: flex;
            flex-direction: column;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 1.5rem; /* Något mindre på mindre kort */
            transition: all 0.3s ease;
            position: relative; /* <-- Redan här */
            perspective: 1000px; /* <-- NYTT */
            box-shadow: 0 10px 30px -5px rgba(0,0,0,0.5);
        }
        .ritbordet-card.flippable {
            padding: 0; /* <-- NYTT: Nollställ padding för flippbara */
            cursor: pointer;
            background: transparent; /* Ta bort bakgrund från container */
            border: none; /* Ta bort border från container */
            box-shadow: none;
        }
        .ritbordet-card:not(.flippable):hover { /* <-- NYTT: Begränsa hover-effekt */
            transform: translateY(-5px);
            box-shadow: 0 15px 40px -5px rgba(0,0,0,0.7);
            border-color: rgba(255, 255, 255, 0.15);
        }
        .ritbordet-card.flippable:hover .flip-card-front { /* <-- NYTT: Hover-effekt för framsidan */
             box-shadow: 0 15px 40px -5px rgba(0,0,0,0.7);
             border-color: rgba(255, 255, 255, 0.15);
        }

        /* --- NYTT: Flip Card Mekanik --- */
        .flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            min-height: 250px; /* Säkerställ minsta höjd */
            transition: transform 0.6s cubic-bezier(0.25, 1, 0.5, 1);
            transform-style: preserve-3d;
        }
        .ritbordet-card.is-flipped .flip-card-inner {
            transform: rotateY(180deg);
        }
        .flip-card-front,
        .flip-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden; /* Safari */
            backface-visibility: hidden;
            border-radius: 1.5rem; /* Måste sitta här nu */
            display: flex; 
            flex-direction: column;
            padding: 1.5rem; /* Återställ paddingen */
        }
        .flip-card-front {
            background: rgba(12, 14, 18, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.15); /* Vit Krita: Ökad synlighet */
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            /* Behöver peka på innehållet */
            text-align: left;
            transition: box-shadow 0.3s ease, border-color 0.3s ease;
            box-shadow: 0 10px 30px -5px rgba(0,0,0,0.5);
        }
        .ritbordet-card.flippable {
            padding: 0; /* <-- NYTT: Nollställ padding för flippbara */
            cursor: pointer;
            background: transparent; /* Ta bort bakgrund från container */
            border: none; /* Ta bort border från container */
            box-shadow: none;
        }
        .ritbordet-card:not(.flippable):hover { /* <-- NYTT: Begränsa hover-effekt */
            transform: translateY(-5px);
            box-shadow: 0 15px 40px -5px rgba(0,0,0,0.5);
            border-color: rgba(255, 255, 255, 0.2);
        }
        .ritbordet-card.flippable:hover .flip-card-front { /* <-- NYTT: Hover-effekt för framsidan */
             box-shadow: 0 15px 40px -5px rgba(0,0,0,0.5);
             border-color: rgba(255, 255, 255, 0.2);
        }

        /* --- NYTT: Flip Card Mekanik --- */
        .flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            min-height: 250px; /* Säkerställ minsta höjd */
            transition: transform 0.6s cubic-bezier(0.25, 1, 0.5, 1);
            transform-style: preserve-3d;
        }
        .ritbordet-card.is-flipped .flip-card-inner {
            transform: rotateY(180deg);
        }
        .flip-card-front,
        .flip-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden; /* Safari */
            backface-visibility: hidden;
            border-radius: 1.5rem; /* Måste sitta här nu */
            display: flex; 
            flex-direction: column;
            padding: 1.5rem; /* Återställ paddingen */
        }
        .flip-card-front {
            background: rgba(18, 20, 24, 0.75);
            border: 1px solid rgba(255, 255, 255, 0.15); /* Vit Krita: Ökad synlighet */
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            /* Behöver peka på innehållet */
            text-align: left;
            transition: box-shadow 0.3s ease, border-color 0.3s ease;
            box-shadow: 0 10px 30px -5px rgba(0,0,0,0.4);
        }
        .flip-card-back {
            background: rgba(var(--nord-sym-cyan-rgb), 0.05); /* Behåll en tint här för kontrast */
            border: 1px solid rgba(var(--nord-sym-cyan-rgb), 0.2);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            transform: rotateY(180deg);
            text-align: left;
        }
        .flip-card-back h5 {
            font-family: 'Comfortaa', sans-serif;
            color: var(--nord-sym-light-accent);
            font-size: 1rem;
            margin-bottom: 1rem;
            border-bottom: 1px solid rgba(var(--nord-sym-cyan-rgb), 0.3);
            padding-bottom: 0.5rem;
        }
        .flip-card-back ul {
            list-style: none;
            padding: 0;
            margin: 0;
            flex-grow: 1;
        }
        .flip-card-back li {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            color: var(--nord-sym-text-medium);
            margin-bottom: 0.5rem;
        }
        .flip-card-back li i {
            font-size: 1rem;
            color: var(--nord-sym-cyan);
        }
        /* --- Slut på Flip Card --- */

        .ritbordet-card i { font-size: 1.75rem; color: var(--nord-sym-cyan); margin-bottom: 0.75rem; }
        .ritbordet-card h4 { font-family: 'Comfortaa', sans-serif; font-size: 1rem; color: var(--nord-sym-text-light); margin-bottom: 0.5rem; }
        .ritbordet-card p { font-size: 0.875rem; color: var(--nord-sym-text-medium); flex-grow: 1; margin-bottom: 1rem; }
        .ritbordet-card button { margin-top: auto; }

        .portal-btn-placeholder { /* Harmoni-fix: Egen klass för centrering */
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 1rem 0;
        }
        
        #geometry-cta {
            position: relative;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(var(--nord-sym-cyan-rgb), 0.15) 0%, rgba(var(--nord-sym-deep-space-blue), 0) 70%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.4s ease;
            border: 1px solid transparent;
        }
        #geometry-cta:hover {
            transform: scale(1.05);
            background: radial-gradient(circle, rgba(var(--nord-sym-cyan-rgb), 0.25) 0%, rgba(var(--nord-sym-deep-space-blue), 0) 70%);
            border-color: rgba(var(--nord-sym-cyan-rgb), 0.3);
            box-shadow: 0 0 30px rgba(var(--nord-sym-cyan-rgb), 0.2);
        }
        #geometry-cta i { font-size: 3rem; color: var(--nord-sym-cyan); transition: all 0.3s ease; }
        #geometry-cta .cta-text { font-weight: 600; color: var(--nord-sym-text-light); margin-top: 0.5rem; transition: all 0.3s ease; }
        #geometry-cta:hover i { transform: rotate(45deg) scale(1.1); }
        #geometry-cta:hover .cta-text { color: var(--nord-sym-cyan); }
        
        #mobile-enter-workshop-btn {
            display: none; /* Hidden by default, shown by JS for mobile lobby */
        }
        body.ritbordet-visible #mobile-enter-workshop-btn {
            display: flex;
            position: fixed;
            bottom: 3rem;
            left: 50%;
            transform: translateX(-50%);
            width: 64px; height: 64px;
            background: rgba(var(--nord-sym-cyan-rgb), 0.15);
            backdrop-filter: blur(8px);
            border: 1px solid var(--nord-sym-cyan);
            border-radius: 50%;
            align-items: center; justify-content: center;
            z-index: 999;
            color: var(--nord-sym-cyan);
            font-size: 2rem;
            box-shadow: 0 0 20px rgba(var(--nord-sym-cyan-rgb), 0.3);
        }
        body.labb-active #mobile-enter-workshop-btn {
            display: none !important;
        }
        @media (min-width: 1024px) { body.ritbordet-visible #mobile-enter-workshop-btn { display: none; } }
        
        #workshop-onboarding {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(12, 20, 39, 0.8); backdrop-filter: blur(10px);
            display: flex; justify-content: center; align-items: center; text-align: center;
            z-index: 2000;
            opacity: 0; pointer-events: none;
            transition: opacity 0.5s ease;
        }
        #workshop-onboarding.visible { opacity: 1; pointer-events: auto; }
        .onboarding-content {
            background: rgba(12, 20, 39, 0.7); border: 1px solid rgba(var(--nord-sym-cyan-rgb), 0.2);
            padding: 3rem; border-radius: 1.5rem; max-width: 500px;
        }
        .onboarding-content h3 { font-family: 'Comfortaa', sans-serif; font-size: 2rem; color: var(--nord-sym-text-light); }
        .esc-hint {
            position: absolute; bottom: 2rem; left: 50%; transform: translateX(-50%);
        }

        /* --- JOYSTICK PORTALS (MOBIL KONTROLL) --- */
        .joystick-portal {
            position: fixed;
            bottom: 120px; 
            bottom: calc(120px + env(safe-area-inset-bottom));
            width: 64px; 
            height: 64px;
            border-radius: 50%;
            /* Z-Index: Måste ligga ÖVER verktygsfältet (..47) för att vara klickbara */
            z-index: 2147483648; 
            
            display: none; /* Alltid dolda som standard */
            align-items: center; 
            justify-content: center;
            
            background: rgba(12, 20, 39, 0.85); /* Solidare bakgrund */
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--nord-sym-text-medium);
            box-shadow: 0 4px 20px rgba(0,0,0,0.6);
            
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .joystick-portal.active { 
            border-color: var(--nord-sym-cyan); 
            color: var(--nord-sym-cyan); 
            box-shadow: 0 0 25px rgba(0, 212, 255, 0.4);
            transform: scale(1.1);
        }
        
        .joystick-portal i { font-size: 1.8rem; }
        
        #joystick-portal-left { left: 20px; }
        #joystick-portal-right { right: 20px; }
        
        /* MOBIL & TABLET: Visa ENDAST när .labb-active finns */
        @media (max-width: 1024px) {
            body.labb-active .joystick-portal { 
                display: flex !important; /* TVINGA FRAM */
                animation: joystick-pop 0.4s ease-out forwards;
            }
        }
        
        @keyframes joystick-pop {
            0% { transform: scale(0); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        /* DESKTOP: Göm ALLTID (Dubbel säkerhet) */
        @media (min-width: 1025px) {
             .joystick-portal {
                display: none !important;
            }
        }

        /* --- MOBIL VERKSTAD UI-HARMONISERING --- */
        #toolbar-toggle {
            display: none; /* Dold som standard */
            position: fixed;
            left: 1rem;
            top: 10rem; /* Harmoni-fix: Flyttad högre upp för att inte störa joysticken. */
            transform: translateY(-50%);
            z-index: 2005;
            background: rgba(12, 20, 39, 0.5);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(var(--nord-sym-text-medium), 0.3);
            transition: opacity 0.3s ease, transform 0.3s ease;
            width: 44px; height: 44px; /* Harmoni-fix: Matchar de andra knapparna */
            font-size: 1.25rem; /* Harmoni-fix: Ikonstorlek */
        }
        #toolbar-close {
            display: none; /* Dold som standard, visas bara i mobil-verktygsfältet */
        }
        @media (max-width: 767px) {
             /* Åsidosätt den gamla topp-placeringen och använd rätt ID */
            body.labb-active #workshop-toolbar {
                bottom: 30px !important; /* Säkerställ att den syns ovanför bottenkanten */
                left: 50%;
                transform: translateX(-50%);
                width: 90%; /* Bredare på mobil */
                max-width: none;
                padding: 10px 15px; /* Lite tightare padding */
                justify-content: flex-start; /* Låt knapparna flöda från vänster */
            }
            
            /* Dölj toggles som inte behövs när vi kör fixed bottom bar */
            body.labb-active #toolbar-toggle {
                display: none !important; 
            }

            /* Anpassa knappstorlek för mobil */
            #workshop-toolbar .geo-btn {
                width: 40px;
                height: 40px;
                font-size: 1rem;
            }
            #workshop-toolbar .geo-btn-wrapper {
                width: 44px;
            }
        }
        
        #joystick-portal-right .portal-ring {
            position: absolute; border-radius: 50%; border: 2px solid var(--nord-sym-cyan);
            opacity: 0; transition: all 0.4s ease;
        }
        #joystick-portal-right.active .portal-ring { opacity: 1; }
        .portal-ring-outer { width: 100%; height: 100%; }
        .portal-ring-inner { width: 80%; height: 80%; }
        #joystick-portal-right.active .portal-ring-outer { transform: scale(1.2); }
        #joystick-portal-right.active .portal-ring-inner { transform: scale(0.9); }
        #joystick-portal-right .portal-icon-exit { display: none; }
        body.labb-active #joystick-portal-right .portal-icon-exit { display: block; }
        body.labb-active #joystick-portal-right .portal-icon-enter { display: none; }

        /* --- VERKTYGSFÄLT (TOOLBAR) - ABSOLUT TVÅNG --- */
        /* Rensat bort gammal #elastic-toolbar kod som skapade konflikter */
        
        /* VISA NÄR VERKSTADEN ÄR IGÅNG (Enda regeln som gäller) */
        /* Denna regel är nu flyttad till #workshop-toolbar sektionen nedan */

        .glass-control-group {
            display: flex; 
            gap: 16px;
            align-items: center;
        }
        
        .toolbar-btn-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            cursor: pointer;
        }

        .glass-btn {
            width: 44px; height: 44px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.3); 
            background: rgba(255,255,255,0.1); 
            color: #ffffff;
            display: flex; justify-content: center; align-items: center; font-size: 1.25rem;
            cursor: pointer; transition: all 0.2s ease;
        }
        .toolbar-btn-wrapper:hover .glass-btn { background: #ffffff; color: #000000; transform: scale(1.1); }
        .glass-btn.active { background: #00D4FF; color: #000000; font-weight: bold; border-color: #00D4FF; box-shadow: 0 0 15px #00D4FF; }
        
        .toolbar-label {
            font-size: 10px;
            color: #fff;
            text-transform: uppercase;
            font-weight: 700;
            letter-spacing: 0.05em;
        }
        
        /* Light Theme Fix */
        body.light-theme #elastic-toolbar { background: #ffffff; border-color: #e2e8f0; }
        body.light-theme .glass-btn { color: #334155; border-color: #cbd5e1; background: #f1f5f9; }
        body.light-theme .toolbar-label { color: #334155; }
        body.light-theme .glass-btn.active, 
        body.light-theme .toolbar-btn-wrapper:hover .glass-btn { background: var(--nord-sym-blueprint-cyan); color: #ffffff; }

        /* --- UNIFIED CANVAS STYLES --- */
        #unified-geometry-canvas {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            z-index: -5 !important;
            pointer-events: none !important;
        }
        #unified-geometry-canvas.interactive {
            cursor: grab;
            pointer-events: auto !important; /* VIKTIGT: !important krävs för att skriva över basstilen. */
        }
        #unified-geometry-canvas.interactive:active {
            cursor: grabbing;
        }
        
        /* FORM NAME DISPLAY (TAGGEN) - FLYTTAD TILL TOPPEN */
        #form-name-display {
            position: fixed;
            top: 130px; /* Flyttad högt upp för att inte blockera verktyg */
            bottom: auto; /* Nollställ botten */
            left: 50%;
            transform: translateX(-50%);
            width: max-content;
            max-width: 90vw;
            z-index: 30;
            
            /* Utseende */
            padding: 0.5rem 1.25rem;
            border-radius: 9999px;
            background: rgba(12, 20, 39, 0.6);
            border: 1px solid rgba(var(--nord-sym-cyan-rgb), 0.3);
            backdrop-filter: blur(8px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);

            color: var(--nord-sym-cyan);
            font-family: 'Source Code Pro', monospace;
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            
            opacity: 0;
            pointer-events: none;
            transition: all 0.5s cubic-bezier(0.25, 1, 0.5, 1);
            text-align: center;
        }
        
        /* Light Theme Override för Form Display */
        body.light-theme #form-name-display {
            background: rgba(255, 255, 255, 0.8);
            border-color: var(--nord-sym-blueprint-cyan);
            color: var(--nord-sym-blueprint-ink);
            box-shadow: 0 4px 15px rgba(var(--nord-sym-blueprint-cyan-rgb), 0.1);
        }

        @media (max-width: 767px) {
            #form-name-display {
                top: 100px; /* Ännu högre på mobil */
                font-size: 0.7rem;
                padding: 0.4rem 1rem;
            }
        }
        body.labb-active #form-name-display.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        /* NEW STYLES FOR LEGAL PAGES */
        .legal-content-card {
            background: rgba(var(--nord-sym-mid-space-blue-rgb), 0.1);
            border: 1px solid rgba(var(--nord-sym-cyan-rgb), 0.2);
            backdrop-filter: blur(10px);
            border-radius: 1.5rem;
            padding: 2.5rem 3rem;
        }
        .legal-content-container h4 {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-family: 'Comfortaa', sans-serif;
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--nord-sym-text-light);
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
        }
        .legal-content-container h4 i {
            font-size: 1.5rem;
            color: var(--nord-sym-cyan);
        }
        .legal-content-container p, .legal-content-container ul {
            line-height: 1.7;
            margin-bottom: 1rem;
        }
        .legal-content-container ul {
            list-style-position: inside;
            list-style-type: disc;
            padding-left: 1rem;
        }

        /* NEW STYLES FOR ARKITEKTUR PAGE */
        #om-oss .arkitektur-grid {
            display: grid;
            gap: 2rem;
            margin-top: 4rem;
        }
        @media (min-width: 1024px) {
            #om-oss .arkitektur-grid {
                grid-template-columns: 1fr 1fr;
                gap: 4rem;
                align-items: start;
            }
        }
        #om-oss .arkitektur-list {
            list-style: none;
            padding: 0;
            margin-top: 1.5rem;
        }
        #om-oss .arkitektur-list li {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 1rem;
            font-size: 1.125rem;
            color: var(--nord-sym-text-medium);
        }
        #om-oss .arkitektur-list i {
            color: var(--nord-sym-cyan);
            font-size: 1.5rem;
            margin-top: 0.2rem;
            flex-shrink: 0;
        }

        /* --- ARKITEKTUR PAGE CARD STYLING --- */
        .arkitektur-card {
            background: rgba(12, 14, 18, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.15); /* Vit Krita: Ökad synlighet */
            padding: 2.5rem 2rem;
            text-align: left;
            display: flex;
            flex-direction: column;
            border-radius: 2rem;
            height: 100%;
            transition: all 0.3s ease;
            backdrop-filter: blur(20px);
            box-shadow: 0 10px 40px -10px rgba(0,0,0,0.6);
        }
        .arkitektur-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 50px -10px rgba(0,0,0,0.8);
            border-color: rgba(255, 255, 255, 0.15);
        }
        .arkitektur-card i {
            color: var(--nord-sym-cyan);
            font-size: 2.5rem;
            margin-bottom: 1rem;
            align-self: flex-start;
        }
        .arkitektur-card h3 {
            font-family: 'Comfortaa', sans-serif;
            color: var(--nord-sym-text-light);
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }
        .arkitektur-card p {
            color: var(--nord-sym-text-medium);
            line-height: 1.6;
            font-size: 1rem;
        }

        /* --- FORM MAKEOVER: QUANTUM HARMONY --- */
        .form-container {
            background: rgba(12, 14, 18, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.15); /* Vit Krita: Ökad synlighet */
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            transition: box-shadow 0.3s ease, border-color 0.3s ease;
            border-radius: 2rem; /* Harmoni-fix: Matchar andra kort */
            box-shadow: 0 20px 60px -15px rgba(0,0,0,0.6);
        }
        .form-container:hover {
            box-shadow: 0 30px 70px -15px rgba(0,0,0,0.8);
            border-color: rgba(255, 255, 255, 0.15);
        }
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--nord-sym-text-light);
            font-size: 0.875rem;
        }
        .form-input, .form-textarea {
            width: 100%;
            background-color: rgba(var(--nord-sym-deep-space-blue-rgb), 0.8);
            border: 1px solid rgba(var(--nord-sym-text-light), 0.2);
            border-radius: 0.5rem;
            padding: 0.85rem 1rem;
            color: var(--nord-sym-text-light);
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .form-input::placeholder, .form-textarea::placeholder {
            color: var(--nord-sym-text-medium);
            opacity: 0.6;
        }
        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--nord-sym-cyan);
            box-shadow: 0 0 15px rgba(var(--nord-sym-cyan-rgb), 0.3);
        }
        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }
        .form-progress-bar {
            height: 4px;
            background-color: rgba(var(--nord-sym-text-light), 0.1);
            border-radius: 2px;
            margin-bottom: 2.5rem;
            margin-top: 0.5rem;
            overflow: hidden;
        }
        .form-progress-bar-inner {
            height: 100%;
            background: var(--nord-sym-cyan);
            width: 0%;
            border-radius: 2px;
            transition: width 0.4s ease;
            box-shadow: 0 0 10px rgba(var(--nord-sym-cyan-rgb), 0.7);
        }
        .form-step {
            display: none;
        }
        .form-step.active {
            display: block;
        }
        .form-navigation {
            padding-top: 2rem;
            border-top: 1px solid rgba(var(--nord-sym-cyan-rgb), 0.1);
            margin-top: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .form-loading .form-step, .form-loading .form-progress-bar {
            filter: blur(4px);
            opacity: 0.5;
            pointer-events: none;
            transition: all 0.3s ease;
        }
        .form-success-container {
            text-align: center;
            padding: 2rem 0;
        }
        .form-success-container i {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        .form-success-container p {
            font-size: 1.125rem;
            color: var(--nord-sym-text-light);
        }

        /* --- GRATIS AGENT-MODAL --- */
        #free-agent-modal {
            transition: opacity 0.3s ease;
        }
        #free-agent-modal .modal-content-wrapper {
            transition: transform 0.3s cubic-bezier(0.25, 1, 0.5, 1);
        }
        #free-agent-modal.visible {
            opacity: 1;
            pointer-events: auto;
        }
        #free-agent-modal.visible .modal-content-wrapper {
            transform: scale(1);
        }

        /* --- SYSTEM (TJÄNSTER) LIGHT MODE FIXES --- */
        body.light-theme #system h3.text-white {
            color: var(--nord-sym-blueprint-ink) !important;
            font-weight: 700;
        }
        body.light-theme #system span.border-white {
            border-color: var(--nord-sym-blueprint-ink) !important;
            color: var(--nord-sym-blueprint-ink) !important;
            background: rgba(255, 255, 255, 0.8) !important;
        }

        /* FIX: Operativsystem-knapp (Ignite Package) synlighet */
        body.light-theme .pricing-card.ignite-package .btn-cta-revised {
            background-color: var(--nord-sym-blueprint-ink) !important;
            color: #ffffff !important;
            border-color: var(--nord-sym-blueprint-ink) !important;
            opacity: 1 !important;
        }
        body.light-theme .pricing-card.ignite-package .btn-cta-revised:hover {
            background-color: var(--nord-sym-blueprint-cyan) !important;
            border-color: var(--nord-sym-blueprint-cyan) !important;
        }

        /* FIX: "Gaming + AI + Three.js" Rubrik i R&D */
        body.light-theme #ritbordet-lobby h2 {
            color: var(--nord-sym-blueprint-ink) !important;
        }
        body.light-theme #ritbordet-lobby p.text-sky-100\/80 {
            color: var(--nord-sym-blueprint-text-secondary) !important;
            opacity: 1 !important;
        }

        /* FIX: "Micro-SaaS & Verktyg" Tagg - Uppdaterad till Ink Style (Matchar TJÄNSTER) */
        body.light-theme #om-oss .text-center > span.inline-block {
            color: var(--nord-sym-blueprint-ink) !important;
            border-color: var(--nord-sym-blueprint-ink) !important;
            background-color: rgba(255, 255, 255, 0.8) !important;
            box-shadow: none !important;
        }

        /* FIX: "R&D" Tagg - Uppdaterad till Ink Style */
        body.light-theme #ritbordet-lobby .text-center > span.inline-block {
            color: var(--nord-sym-blueprint-ink) !important;
            border-color: var(--nord-sym-blueprint-ink) !important;
            background-color: rgba(255, 255, 255, 0.8) !important;
            box-shadow: none !important;
        }

        /* FIX: "Frigör er potential" Tagg-rubrik */
        body.light-theme #home-diagram-section h2 {
            color: var(--nord-sym-blueprint-ink) !important;
            border-color: var(--nord-sym-blueprint-cyan) !important;
            background-color: #ffffff !important;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05) !important;
        }
        
        /* FIX: Textlänk "Utforska tjänster" i Light Mode */
        body.light-theme #home-diagram-section p a {
            color: var(--nord-sym-blueprint-cyan) !important;
            border-bottom-color: var(--nord-sym-blueprint-cyan) !important;
        }
        body.light-theme #home-diagram-section p a:hover {
            color: var(--nord-sym-blueprint-ink) !important;
            border-bottom-color: var(--nord-sym-blueprint-ink) !important;
        }

        /* FIX: Digital Integritet (Cookie Banner) */
        body.light-theme #cookie-consent span.font-bold {
            color: var(--nord-sym-blueprint-ink) !important;
        }

        /* --- FOUNDER BADGE LIGHT MODE FIXES --- */
        /* Target the founder button specifically */
        body.light-theme #om-oss button.border-white, 
        body.light-theme #system button.border-white {
            border-color: var(--nord-sym-blueprint-lines) !important;
            background: #ffffff !important;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05) !important;
        }
        body.light-theme #om-oss button .text-white,
        body.light-theme #system button .text-white {
            color: var(--nord-sym-blueprint-ink) !important;
        }
        body.light-theme #om-oss button .text-white\/80,
        body.light-theme #system button .text-white\/80 {
            color: var(--nord-sym-blueprint-text-secondary) !important;
        }
        body.light-theme #om-oss button .text-white\/70,
        body.light-theme #system button .text-white\/70 {
            color: var(--nord-sym-blueprint-lines) !important;
        }
        body.light-theme #om-oss button:hover,
        body.light-theme #system button:hover {
            border-color: var(--nord-sym-blueprint-cyan) !important;
            box-shadow: 0 4px 15px rgba(var(--nord-sym-blueprint-cyan-rgb), 0.15) !important;
        }

        /* --- CHAT WIDGET STYLES --- */
        #chat-widget-container {
            opacity: 0;
            transform: scale(0.8);
            transition: opacity 0.4s ease, transform 0.4s ease;
            pointer-events: none;
        }
        #chat-widget-container.visible {
            opacity: 1;
            transform: scale(1);
            pointer-events: auto;
        }
        #chat-bubble {
            /* UPPDATERAT: "FAKTISKT"-stil (Solid Cyan + Mörk Ikon + Krita-kant) */
            background: var(--nord-sym-cyan);
            color: var(--nord-sym-deep-space-blue);
            border: 1px solid rgba(255, 255, 255, 0.2); /* Subtil vit kant */
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5); /* Djup skugga istället för glow */
            animation: chat-bubble-pulse 3s infinite ease-in-out; /* Långsammare puls */
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        #chat-bubble:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 35px rgba(0, 212, 255, 0.3); /* Cyan skugga vid hover */
        }
        #chat-bubble.hidden {
            transform: scale(0);
            opacity: 0;
            pointer-events: none;
        }
        @keyframes chat-bubble-pulse {
            50% { transform: scale(1.03); }
        }

        #chat-window {
            /* PREMIUM OBSIDIAN REDESIGN: Matchar korten */
            background: linear-gradient(180deg, rgba(12, 14, 18, 0.95) 0%, rgba(0, 0, 0, 0.98) 100%);
            border: 1px solid rgba(255, 255, 255, 0.1); /* Vit krita-kant */
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            opacity: 0;
            transform: translateY(20px) scale(0.95);
            pointer-events: none;
            transition: opacity 0.3s ease, transform 0.3s ease;
            box-shadow: 0 30px 60px rgba(0,0,0,0.8); /* Massiv skugga */
            
            /* Dölj som standard i det nya flödet */
            display: none; 
        }
        
        /* ACTIVE STATE FÖR CHAT WINDOW (När konversationen är igång) */
        #chat-window.active-conversation {
            display: flex;
            opacity: 1;
            transform: translateY(0) scale(1);
            pointer-events: auto;
            position: relative;
            width: 100%;
            max-width: 500px;
            height: 500px;
            margin: 0 auto;
            border-radius: 20px;
            z-index: 20;
        }

        /* --- NYTT: HERO INPUT BAR (Clean Input) --- */
        #hero-input-wrapper {
            width: 100%;
            max-width: 500px;
            margin: 2rem auto 0 auto; /* Centrerad */
            position: relative;
            z-index: 20;
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }
        
        #hero-input-wrapper.hidden-input {
            opacity: 0;
            transform: translateY(-20px);
            pointer-events: none;
            display: none; /* Ta bort från flödet när chatten öppnas */
        }

        #hero-chat-input-field {
            width: 100%;
            /* KRITA-UPDATE: Mer transparent */
            background: rgba(12, 14, 18, 0.4); 
            /* KRITA-UPDATE: Vit krit-linje */
            border: 1px solid rgba(255, 255, 255, 0.25); 
            border-radius: 9999px; /* Pill shape */
            padding: 1rem 1.5rem;
            padding-right: 3.5rem; /* Plats för knapp */
            color: #ffffff;
            font-size: 1rem;
            backdrop-filter: blur(12px);
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px -10px rgba(0,0,0,0.5);
        }
        
        #hero-chat-input-field:focus {
            outline: none;
            /* KRITA-UPDATE: Vit border vid fokus */
            border-color: #ffffff; 
            background: rgba(12, 14, 18, 0.7);
            /* KRITA-UPDATE: Vit glow istället för cyan */
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.1); 
        }
        
        #hero-input-send {
            position: absolute;
            right: 0.5rem;
            top: 50%;
            transform: translateY(-50%);
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            /* KRITA-UPDATE v2: Levande och tydlig */
            background: rgba(255, 255, 255, 0.15); /* Tydligare fyllning direkt */
            color: #ffffff;
            border: 1px solid #ffffff; /* Krispig vit kant */
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 1, 0.5, 1);
            box-shadow: 0 4px 10px rgba(0,0,0,0.3); /* Djup */
        }
        #hero-input-send:hover {
            transform: translateY(-50%) scale(1.15); /* Lite mer pop */
            background: #ffffff; /* Solid vit (Krita) */
            color: var(--nord-sym-deep-space-blue); /* Inverterad ikonfärg för kontrast */
            box-shadow: 0 0 25px rgba(255, 255, 255, 0.5); /* Kraftig vit glöd */
        }

        /* Light Mode Override */
        body.light-theme #hero-chat-input-field {
            background: rgba(255, 255, 255, 0.8);
            border-color: var(--nord-sym-blueprint-lines);
            color: var(--nord-sym-blueprint-ink);
            box-shadow: 0 10px 30px -10px rgba(0,0,0,0.1);
        }
        body.light-theme #hero-chat-input-field:focus {
            border-color: var(--nord-sym-blueprint-cyan);
            background: #ffffff;
            box-shadow: 0 0 0 1px var(--nord-sym-blueprint-cyan), 0 20px 40px -10px rgba(var(--nord-sym-blueprint-cyan-rgb), 0.15);
        }
        body.light-theme #hero-input-send {
            background: var(--nord-sym-blueprint-cyan);
            color: white;
        }

        /* --- NYTT: NORDGPT FULLSCREEN INTERFACE (Ersätter Chat Window) --- */
        #fullscreen-chat-interface {
            position: fixed;
            inset: 0; /* Fullscreen */
            z-index: 10000; /* Över allt annat */
            /* CINEMA MODE (DARK): Maximal transparens (0.05) - nästan osynligt glas */
            background-color: rgba(5, 6, 8, 0.05); 
            /* UPPDATERAT: Mindre blur (5px) för att se geometrin tydligt */
            backdrop-filter: blur(5px); 
            -webkit-backdrop-filter: blur(5px);
            display: flex;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s cubic-bezier(0.25, 1, 0.5, 1);
        }
        
        /* CINEMA FOCUS: Total utradering av distraktioner (Blackout) */
        body.chat-active #header,
        body.chat-active main,
        body.chat-active #main-footer,
        body.chat-active #workshop-toolbar,
        body.chat-active #hero-input-wrapper,
        body.chat-active #form-name-display,
        body.chat-active #cookie-consent,
        body.chat-active #workshop-ghost-hints,      /* Scrolla/Dra hints */
        body.chat-active #mobile-enter-workshop-btn, /* Mobilknapp */
        body.chat-active #toolbar-toggle,            /* Verktygstoggle */
        body.chat-active .joystick-portal,           /* Joysticks */
        body.chat-active #coming-soon-modal,         /* Modals */
        body.chat-active #founder-modal,
        body.chat-active #free-agent-modal {
            opacity: 0 !important; /* Helt osynligt */
            filter: blur(20px); /* Diffusera bort det helt */
            transform: scale(0.95); /* Tryck bakåt */
            pointer-events: none !important;
            transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1); /* Mjuk, dramatisk exit */
        }

        #fullscreen-chat-interface.visible {
            opacity: 1;
            pointer-events: auto;
        }

        /* SIDEBAR (Historik) */
        .chat-sidebar {
            width: 260px;
            background: rgba(5, 6, 8, 0.4); /* Mer transparent */
            border-right: 1px solid rgba(255, 255, 255, 0.1); /* Kritstreck */
            display: flex;
            flex-direction: column;
            padding: 1.5rem;
            transform: translateX(-100%);
            transition: transform 0.4s ease;
        }
        #fullscreen-chat-interface.visible .chat-sidebar {
            transform: translateX(0);
        }
        
        .chat-history-item {
            padding: 0.75rem 1rem;
            margin-bottom: 0.5rem;
            border-radius: 0.5rem;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 0.9rem;
            border: 1px solid transparent;
        }
        .chat-history-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.2); /* Krit-outline vid hover */
            color: white;
        }
        .chat-history-item.active {
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            border-color: rgba(255, 255, 255, 0.4);
        }

        /* MAIN CHAT AREA */
        .chat-main-area {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            position: relative;
            background: transparent; /* Låt geometrin synas igenom! */
        }

        /* TOP BAR (Close & Options) */
        .chat-top-bar {
            padding: 1.5rem;
            display: flex;
            justify-content: flex-end;
            align-items: center;
        }
        .chat-close-btn {
            width: auto; height: 40px;
            padding: 0 1.5rem;
            border-radius: 9999px;
            display: flex; align-items: center; justify-content: center; gap: 0.5rem;
            color: rgba(255, 255, 255, 0.8);
            transition: all 0.2s ease;
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.2); /* Kritstreck */
            background: transparent;
        }
        .chat-close-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-color: white;
        }

        /* MESSAGES CONTAINER */
        .chat-scroll-container {
            flex-grow: 1;
            overflow-y: auto;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            align-items: center; /* Centrera kolumnen */
            scroll-behavior: smooth;
        }
        
        .chat-content-width {
            width: 100%;
            max-width: 700px; /* Lite smalare för läsbarhet */
            display: flex;
            flex-direction: column;
            gap: 2rem; /* Luftigare mellan meddelanden */
        }

        /* MESSAGE BUBBLES - ARCHITECT EDITION */
        .chat-message-row {
            display: flex;
            width: 100%;
            margin-bottom: 0; /* Styrs av gap i container */
        }
        .chat-message-row.user {
            justify-content: flex-end;
        }
        .chat-message-row.bot {
            justify-content: flex-start;
        }

        .chat-bubble-content {
            padding: 1rem 1.5rem;
            font-size: 1.05rem; /* Något större text */
            line-height: 1.7;
            position: relative;
            max-width: 90%;
        }

        /* USER: Krit-outline (Ingen fyllning) */
        .chat-message-row.user .chat-bubble-content {
            background-color: transparent;
            border: 1px solid rgba(255, 255, 255, 0.4); /* Tydligare kritstreck */
            color: #ffffff;
            border-radius: 1.5rem;
            border-bottom-right-radius: 0.25rem;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.05); /* Mycket svag glow */
        }

        /* BOT: Ren text på tavlan (Ingen bubbla) */
        .chat-message-row.bot .chat-bubble-content {
            background-color: transparent;
            border: none; /* Inga gränser */
            color: #E2E8F0; /* Off-white för läsbarhet */
            padding-left: 0; /* Justera mot vänsterkanten */
            border-left: 2px solid rgba(0, 212, 255, 0.5); /* NordSym Cyan accentlinje */
            border-radius: 0;
            padding-top: 0.25rem;
            padding-bottom: 0.25rem;
        }
        
        /* INPUT AREA (Sticky Bottom) - Floating Chalk Bar */
        .chat-input-wrapper {
            padding: 2rem;
            display: flex;
            justify-content: center;
            background: transparent; /* Ingen gradient, helt öppet */
        }
        
        .chat-main-input-container {
            width: 100%;
            max-width: 700px;
            position: relative;
            background: rgba(12, 14, 18, 0.4); /* Transparent */
            border: 1px solid rgba(255, 255, 255, 0.25); /* Kritstreck */
            border-radius: 1.5rem;
            padding: 0.75rem 1rem;
            display: flex;
            align-items: flex-end;
            transition: all 0.3s ease;
            backdrop-filter: blur(8px);
        }
        .chat-main-input-container:focus-within {
            background: rgba(12, 14, 18, 0.7);
            border-color: rgba(255, 255, 255, 0.6); /* Lyser upp vid fokus */
            box-shadow: 0 0 25px rgba(255, 255, 255, 0.1);
        }

        #chat-main-textarea {
            width: 100%;
            background: transparent;
            border: none;
            color: #ffffff;
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            resize: none;
            max-height: 200px;
            padding: 0.5rem;
            outline: none;
            line-height: 1.5;
        }
        
        #chat-main-send-btn {
            width: 40px; height: 40px;
            border-radius: 50%;
            background: transparent;
            color: #ffffff;
            border: 1px solid rgba(255, 255, 255, 0.3);
            display: flex; align-items: center; justify-content: center;
            margin-bottom: 2px;
            cursor: pointer;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }
        #chat-main-send-btn:hover {
            transform: scale(1.1);
            border-color: #ffffff;
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.2);
        }
        
        /* LIGHT THEME OVERRIDES FOR NORDGPT */
        body.light-theme #fullscreen-chat-interface {
            /* CINEMA MODE (LIGHT): Maximal transparens (0.05) */
            background-color: rgba(255, 255, 255, 0.05);
            /* UPPDATERAT: Mindre blur (5px) även här */
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }
        body.light-theme .chat-sidebar {
            background: rgba(243, 244, 246, 0.5); /* Mer transparent sidebar */
            border-right-color: rgba(0,0,0,0.05);
        }
        body.light-theme .chat-history-item {
            color: #4B5563;
        }
        body.light-theme .chat-history-item:hover {
            background: #E5E7EB;
            color: #111827;
        }
        body.light-theme .chat-close-btn {
            color: #4B5563;
        }
        body.light-theme .chat-close-btn:hover {
            background: #E5E7EB;
            color: #111827;
            border-color: #D1D5DB;
        }
        body.light-theme .chat-message-row.user .chat-bubble-content {
            background-color: #E0F2FE; /* Sky 100 */
            border-color: #BAE6FD;
            color: #0369A1; /* Sky 700 */
        }
        body.light-theme .chat-message-row.bot .chat-bubble-content {
            color: #374151; /* Gray 700 */
        }
        body.light-theme .chat-input-wrapper {
            background: linear-gradient(to top, #FDFDFD 80%, transparent);
        }
        body.light-theme .chat-main-input-container {
            background: #FFFFFF;
            border-color: #E5E7EB;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        body.light-theme #chat-main-textarea {
            color: #111827;
        }
        body.light-theme #chat-main-send-btn {
            background: var(--nord-sym-blueprint-cyan);
            color: white;
        }

        /* --- CHAT RESUME BUTTON (Liten notis under input) --- */
        #chat-resume-btn {
            margin-top: 12px;
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--nord-sym-text-medium);
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
            cursor: pointer;
            display: none; /* Dold som standard */
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            backdrop-filter: blur(4px);
        }
        #chat-resume-btn:hover {
            border-color: var(--nord-sym-cyan);
            color: var(--nord-sym-cyan);
            background: rgba(var(--nord-sym-cyan-rgb), 0.1);
            transform: translateY(-1px);
        }
        #chat-resume-btn.visible {
            display: flex;
            animation: fadeInUp 0.5s ease forwards;
        }
        .resume-pulse {
            width: 6px; height: 6px;
            background-color: #4ade80; /* Green */
            border-radius: 50%;
            box-shadow: 0 0 8px rgba(74, 222, 128, 0.6);
            animation: pulse-green 2s infinite;
        }
        @keyframes pulse-green {
            0% { transform: scale(0.95); opacity: 0.7; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(0.95); opacity: 0.7; }
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Light Theme Override för Resume Btn */
        body.light-theme #chat-resume-btn {
            background: rgba(255, 255, 255, 0.8);
            border-color: rgba(0,0,0,0.1);
            color: var(--nord-sym-blueprint-text-secondary);
        }
        body.light-theme #chat-resume-btn:hover {
            border-color: var(--nord-sym-blueprint-cyan);
            color: var(--nord-sym-blueprint-cyan);
        }

        /* --- MOBIL ANPASSNING --- */
        @media (max-width: 768px) {
            .chat-sidebar {
                position: absolute;
                z-index: 20;
                height: 100%;
                background: var(--nord-sym-deep-space-blue); /* Solidare bakgrund på mobil */
            }
            body.light-theme .chat-sidebar { background: #FDFDFD; }
            
            .chat-sidebar:not(.open) {
                transform: translateX(-100%);
            }
            /* Hamburger för sidebar på mobil? Kanske senare */
            .chat-sidebar { display: none; } /* Dölj sidebar på mobil för "Ultra Clean" första version */
            
            .chat-content-width {
                padding-bottom: 80px; /* Mer plats för input på mobil */
            }
        }

        /* --- NYTT: Embedded Chat (Hero Mode) --- */
        #chat-window.embedded-chat {
            position: relative !important;
            bottom: auto !important;
            right: auto !important;
            width: 100% !important;
            max-width: 480px !important;
            height: 420px !important;
            transform: none !important;
            opacity: 1 !important;
            pointer-events: auto !important;
            box-shadow: 0 20px 50px rgba(0,0,0,0.8), inset 0 0 0 1px rgba(255, 255, 255, 0.05) !important;
            background: rgba(12, 14, 18, 0.8) !important; /* Lite mer transparent för att smälta in */
            margin: 3rem auto 0 auto !important; /* Centrera och ge avstånd */
            border-radius: 16px !important;
            z-index: 10 !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
        }
        
        /* Light Mode Embedded */
        body.light-theme #chat-window.embedded-chat {
            background: rgba(255, 255, 255, 0.8) !important;
            box-shadow: 0 20px 50px rgba(0,0,0,0.1) !important;
            border-color: var(--nord-sym-blueprint-lines) !important;
        }

        /* Dölj stäng-knappen när den är inbäddad */
        #chat-window.embedded-chat #chat-close-btn {
            display: none !important;
        }

        #chat-header {
            background: rgba(255, 255, 255, 0.03); /* Mycket subtil separation */
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        #chat-messages {
            scrollbar-width: thin;
            scrollbar-color: var(--nord-sym-cyan) transparent;
        }
        #chat-messages::-webkit-scrollbar {
            width: 6px;
        }
        #chat-messages::-webkit-scrollbar-track {
            background: transparent;
        }
        #chat-messages::-webkit-scrollbar-thumb {
            background-color: var(--nord-sym-cyan);
            border-radius: 6px;
        }
        .message {
            max-width: 80%;
            margin-bottom: 1rem;
            display: flex;
            flex-direction: column;
        }
        .message p {
            padding: 0.75rem 1rem;
            border-radius: 1.25rem;
            line-height: 1.5;
            font-size: 0.9rem;
        }
        .bot-message {
            align-items: flex-start;
        }
        .bot-message p {
            /* UPPDATERAT: Mörkare och mer neutral bot-bubbla */
            background: rgba(255, 255, 255, 0.08);
            color: var(--nord-sym-text-light);
            border-bottom-left-radius: 0.25rem;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        .user-message {
            align-items: flex-end;
            margin-left: auto;
        }
        .user-message p {
            background: var(--nord-sym-cyan);
            color: var(--nord-sym-deep-space-blue);
            font-weight: 500;
            border-bottom-right-radius: 0.25rem;
        }
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        .typing-indicator span {
            width: 8px;
            height: 8px;
            /* NY ÄNDRING: Startar med cyan-färg, men nedtonad */
            background-color: rgba(var(--nord-sym-cyan-rgb), 0.3);
            border-radius: 50%;
            /* NY ÄNDRING: Byter till 'typing-glow' och justerar tiden */
            animation: typing-glow 1.5s infinite ease-in-out;
            /* NY ÄNDRING: Lägger till en matchande box-shadow och mjuk övergång */
            box-shadow: 0 0 4px rgba(var(--nord-sym-cyan-rgb), 0.3);
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }
        .typing-indicator span:nth-child(2) { animation-delay: 0.25s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.5s; }

        /* NY ÄNDRING: Ersätter 'typing-pulse' med 'typing-glow' */
        @keyframes typing-glow {
            0%, 100% {
                /* Start/slut-läge: svag */
                background-color: rgba(var(--nord-sym-cyan-rgb), 0.2);
                box-shadow: 0 0 4px rgba(var(--nord-sym-cyan-rgb), 0.2);
                transform: scale(0.9);
            }
            50% {
                /* Mitten-läge: stark */
                background-color: rgba(var(--nord-sym-cyan-rgb), 1);
                box-shadow: 0 0 8px rgba(var(--nord-sym-cyan-rgb), 0.7);
                transform: scale(1);
            }
        }

        #chat-input-area {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        #chat-input {
            background-color: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--nord-sym-text-light);
        }
        #chat-input:focus {
            outline: none;
            border-color: var(--nord-sym-cyan);
            box-shadow: 0 0 10px rgba(var(--nord-sym-cyan-rgb), 0.2);
        }
        
        #chat-send-btn {
            /* UPPDATERAT: Robust positionering och "solid" känsla */
            position: absolute;
            top: 50%;
            right: 0.5rem;
            transform: translateY(-50%); /* Lås vertikal centrering */
            width: 2.25rem; /* Lite större (36px) */
            height: 2.25rem;
            
            background-color: rgba(var(--nord-sym-cyan-rgb), 0.1); /* Svag fyllning istället för trådsmal border */
            color: var(--nord-sym-cyan);
            border: none; /* Ta bort "tråden" */
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s cubic-bezier(0.25, 1, 0.5, 1);
            cursor: pointer;
            z-index: 10;
        }
        #chat-send-btn:hover {
            background-color: var(--nord-sym-cyan);
            color: var(--nord-sym-deep-space-blue);
            transform: translateY(-50%) scale(1.1); /* Behåll exakt centrering vid scale */
            box-shadow: 0 0 15px rgba(var(--nord-sym-cyan-rgb), 0.4);
        }

        /* --- LIGHT THEME CHAT KNAPP --- */
        body.light-theme #chat-send-btn {
            background-color: rgba(var(--nord-sym-blueprint-cyan-rgb), 0.1);
            color: var(--nord-sym-blueprint-cyan);
        }
        body.light-theme #chat-send-btn:hover {
            background-color: var(--nord-sym-blueprint-cyan);
            color: #ffffff;
            box-shadow: 0 0 15px rgba(var(--nord-sym-blueprint-cyan-rgb), 0.25);
        }

        @media (max-width: 480px) {
            #chat-widget-container {
                bottom: 1rem;
                right: 1rem;
                width: calc(100% - 2rem);
            }
            #chat-bubble {
                position: absolute;
                bottom: 0;
                right: 0;
            }
            #chat-window {
                width: 100%;
                height: 70vh; /* Use viewport height for mobile */
                height: 70dvh;
                max-height: 600px;
            }
        }

        #chat-close-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--nord-sym-text-medium);
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        #chat-close-btn:hover {
            background-color: rgba(var(--nord-sym-cyan-rgb), 0.15);
            color: var(--nord-sym-cyan);
        }

        /* --- COOKIE CONSENT (HARMONISERAD - OBSIDIAN) --- */
        #cookie-consent {
            position: fixed;
            bottom: 2rem;
            left: 2rem; /* Desktop: Vänster hörn */
            width: calc(100% - 4rem);
            max-width: 320px;
            z-index: 2050; /* Över det mesta */
            
            /* PREMIUM OBSIDIAN REDESIGN - VIT KRITA */
            background: linear-gradient(180deg, rgba(12, 14, 18, 0.98) 0%, rgba(0, 0, 0, 1) 100%);
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.25); /* Tydlig vit kant */
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.9);
            
            /* Animation State */
            opacity: 0;
            pointer-events: none;
            transform: translateY(20px) scale(0.95);
            transition: all 0.5s cubic-bezier(0.22, 1, 0.36, 1);
        }
        
        #cookie-consent.visible {
            opacity: 1;
            pointer-events: auto;
            transform: translateY(0) scale(1);
        }

        #cookie-consent i {
            color: #ffffff !important; /* Vit ikon */
        }

        #cookie-consent p {
            font-size: 0.85rem;
            color: var(--nord-sym-text-medium);
            line-height: 1.5;
            margin-bottom: 1rem;
        }

        #cookie-consent a {
            color: #ffffff; /* Vit länk */
            text-decoration: underline;
            transition: color 0.2s;
        }
        #cookie-consent a:hover { color: var(--nord-sym-text-medium); }
        
        #cookie-accept-btn {
            border: 2px solid #ffffff !important;
            background: transparent !important;
            color: #ffffff !important;
            box-shadow: none !important;
        }
        #cookie-accept-btn:hover {
            background: #ffffff !important;
            color: var(--nord-sym-deep-space-blue) !important;
        }

        /* MOBIL ANPASSNING - Undvik krock med chattbubblan */
        @media (max-width: 768px) {
            #cookie-consent {
                left: 1rem;
                bottom: 6rem; /* Flytta upp den ovanför chattbubblan */
                width: calc(100% - 2rem);
                max-width: none; /* Full bredd minus marginal */
            }
        }

        /* Light Theme Overrides */
        body.light-theme #cookie-consent {
            background: rgba(253, 253, 253, 0.95);
            border: 1px solid var(--nord-sym-blueprint-lines);
            box-shadow: 0 8px 30px rgba(0,0,0,0.1);
        }
        body.light-theme #cookie-consent i { color: var(--nord-sym-blueprint-cyan) !important; }
        body.light-theme #cookie-consent p { color: var(--nord-sym-blueprint-text-secondary); }
        body.light-theme #cookie-consent a { color: var(--nord-sym-blueprint-cyan); }
        body.light-theme #cookie-consent a:hover { color: var(--nord-sym-blueprint-ink); }
        body.light-theme #cookie-accept-btn {
            border-color: var(--nord-sym-blueprint-ink) !important;
            color: var(--nord-sym-blueprint-ink) !important;
        }
        body.light-theme #cookie-accept-btn:hover {
            background: var(--nord-sym-blueprint-ink) !important;
            color: #ffffff !important;
        }
        
        .bento-card:hover {
            /* Ljusare vid hover för interaktiv känsla */
            background: linear-gradient(145deg, rgba(30, 48, 88, 0.95) 0%, rgba(15, 25, 50, 0.9) 100%);
            border-color: rgba(var(--nord-sym-cyan-rgb), 0.5);
            transform: translateY(-4px);
            box-shadow: 0 15px 45px rgba(0, 0, 0, 0.4), 0 0 20px rgba(var(--nord-sym-cyan-rgb), 0.1);
        }

        /* Light Theme Override */
        body.light-theme .bento-card {
            background: #ffffff;
            border: 1px solid var(--nord-sym-blueprint-lines);
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        body.light-theme .bento-card:hover {
            border-color: var(--nord-sym-blueprint-cyan);
            box-shadow: 0 8px 30px rgba(var(--nord-sym-blueprint-cyan-rgb), 0.15);
            background: #ffffff; /* Behåll vit bakgrund */
        }

        /* --- FAQ STYLES --- */
        details summary::-webkit-details-marker { display: none; }
        details summary { list-style: none; }
        details summary:focus { outline: none; }
        
        .faq-item {
            background: linear-gradient(155deg, rgba(var(--nord-sym-deep-space-blue-rgb), 0.4), rgba(var(--nord-sym-mid-space-blue-rgb), 0.1));
            border: 1px solid rgba(var(--nord-sym-cyan-rgb), 0.15);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
            overflow: hidden;
        }
        .faq-item:hover {
            border-color: var(--nord-sym-cyan);
            box-shadow: 0 0 15px rgba(var(--nord-sym-cyan-rgb), 0.1);
        }
        .faq-question {
            padding: 1.5rem;
            cursor: pointer;
            font-family: 'Comfortaa', sans-serif;
            font-weight: 700;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--nord-sym-text-light);
        }
        .faq-answer {
            padding: 0 1.5rem 1.5rem 1.5rem;
            color: var(--nord-sym-text-medium);
            line-height: 1.6;
            font-size: 0.95rem;
            border-top: 1px solid rgba(var(--nord-sym-cyan-rgb), 0.1);
            margin-top: 0;
            padding-top: 1rem;
        }
        details[open] .faq-icon { transform: rotate(180deg); }
        .faq-icon { transition: transform 0.3s ease; color: var(--nord-sym-cyan); }

        /* FAQ Light Theme */
        body.light-theme .faq-item {
            background: var(--nord-sym-blueprint-bg);
            border: 1px solid var(--nord-sym-blueprint-lines);
            box-shadow: 0 4px 6px rgba(0,0,0,0.04);
        }
        body.light-theme .faq-item:hover {
            border-color: var(--nord-sym-blueprint-cyan);
            box-shadow: 0 0 15px rgba(var(--nord-sym-blueprint-cyan-rgb), 0.1);
        }
        body.light-theme .faq-question { color: var(--nord-sym-blueprint-ink); }
        body.light-theme .faq-answer { 
            color: var(--nord-sym-blueprint-ink); 
            opacity: 0.8;
            border-top-color: var(--nord-sym-blueprint-lines-faint);
        }

        /* --- STARFALL BACKGROUND (NEW) --- */
        #starfall {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -10; /* Behind geometry (-5) and content */
            pointer-events: none;
            opacity: 1;
            transition: opacity 0.8s ease;
        }
        
        /* Dölj Starfall helt i ljust tema för att bevara Blåkopia-designen */
        body.light-theme #starfall {
            opacity: 0;
        }

        /* --- PITCH 1: DIGITAL CONTROL ROOM (NYA TILLÄGG) --- */
        
        /* Teknisk Bakgrundsgrid (Overlay på mörkt tema) */
        .tech-grid-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-image: 
                linear-gradient(rgba(0, 212, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 212, 255, 0.03) 1px, transparent 1px);
            background-size: 60px 60px;
            mask-image: radial-gradient(circle at center, black 30%, transparent 80%);
            -webkit-mask-image: radial-gradient(circle at center, black 30%, transparent 80%);
            pointer-events: none;
            z-index: -1;
        }

        /* KARUSELL FÖR MONITORER */
        .showcase-container {
            position: relative;
            max-width: 900px; /* Begränsad bredd för fokus */
            margin: 0 auto;
            perspective: 2000px;
            min-height: 500px; /* Reservera plats */
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .monitor-wrapper {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transform: rotateX(10deg) scale(0.9) translateY(20px);
            transition: all 0.6s cubic-bezier(0.25, 1, 0.5, 1);
            pointer-events: none;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .monitor-wrapper.active {
            opacity: 1;
            transform: rotateX(0deg) scale(1) translateY(0);
            pointer-events: auto;
            z-index: 10;
        }

        .glass-monitor {
            position: relative;
            width: 100%;
            background: rgba(12, 20, 39, 0.8);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 
                0 30px 60px rgba(0, 0, 0, 0.6), 
                inset 0 0 0 1px rgba(255, 255, 255, 0.05),
                0 0 30px rgba(0, 212, 255, 0.15);
            aspect-ratio: 16/10;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        
        .glass-monitor:hover {
            border-color: var(--nord-sym-cyan);
            box-shadow: 
                0 40px 80px rgba(0, 0, 0, 0.7), 
                0 0 50px rgba(var(--nord-sym-cyan-rgb), 0.25);
        }

        /* Reflektion */
        .glass-monitor::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, transparent 40%, transparent 100%);
            pointer-events: none;
            z-index: 2;
        }

        .monitor-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            /* Subtil inre glöd på själva bilden */
            filter: drop-shadow(0 0 10px rgba(0,0,0,0.5));
        }

        .monitor-info {
            margin-top: 2rem;
            text-align: center;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.4s ease 0.2s; /* Fördröjning */
        }
        .monitor-wrapper.active .monitor-info {
            opacity: 1;
            transform: translateY(0);
        }

        /* Navigationsknappar */
        .showcase-nav-btn {
            position: absolute;
            top: 40%; /* Justerad för att centrera mot monitorn, inte hela containern */
            transform: translateY(-50%);
            background: rgba(12, 20, 39, 0.6);
            border: 1px solid rgba(0, 212, 255, 0.3);
            color: var(--nord-sym-cyan);
            width: 56px;
            height: 56px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 20;
            backdrop-filter: blur(8px);
            transition: all 0.3s ease;
        }
        .showcase-nav-btn:hover {
            background: var(--nord-sym-cyan);
            color: var(--nord-sym-deep-space-blue);
            box-shadow: 0 0 20px rgba(var(--nord-sym-cyan-rgb), 0.4);
            transform: translateY(-50%) scale(1.1);
        }
        .showcase-prev { left: -3rem; }
        .showcase-next { right: -3rem; }
        @media (max-width: 768px) {
            .showcase-prev { left: -1rem; width: 44px; height: 44px; font-size: 1.2rem; }
            .showcase-next { right: -1rem; width: 44px; height: 44px; font-size: 1.2rem; }
        }

        /* Ljust tema anpassning */
        body.light-theme .glass-monitor {
            background: #ffffff;
            border-color: var(--nord-sym-blueprint-lines);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        body.light-theme .glass-monitor:hover {
            border-color: var(--nord-sym-blueprint-cyan);
            box-shadow: 0 30px 60px rgba(var(--nord-sym-blueprint-cyan-rgb), 0.15);
        }
        body.light-theme .showcase-nav-btn {
            background: rgba(255,255,255,0.8);
            border-color: var(--nord-sym-blueprint-lines);
            color: var(--nord-sym-blueprint-ink);
        }
        body.light-theme .showcase-nav-btn:hover {
            background: var(--nord-sym-blueprint-cyan);
            color: white;
        }

        /* --- MISSING STYLES RESTORATION (ARKITEKTONISK & GITHUB) --- */
        
        /* Product Grid Layout */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 4rem;
        }

        /* Product Card */
        .product-card {
            background: rgba(12, 20, 39, 0.85); /* HARMONI-FIX: Mjukare opacitet */
            /* MJUKARE KANT: Sänkt från 0.1 till 0.05 */
            border: 1px solid rgba(255, 255, 255, 0.05); 
            border-radius: 1rem;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: all 0.3s cubic-bezier(0.25, 1, 0.5, 1);
            position: relative;
            backdrop-filter: blur(25px); /* Mer blur för mjukare känsla */
        }
        
        /* STACK EFFECT: Visuell indikation på att det finns fler kort */
        /* UPPDATERAD VINKEL: Vertikal stapling istället för diagonal */
        .product-card.stacked-effect {
            box-shadow: 
                0 0 0 1px rgba(255, 255, 255, 0.03), /* Border */
                0 20px 50px -12px rgba(0, 0, 0, 0.5), /* Huvudskugga */
                
                /* Layer 1 (Under - Vertikal) */
                0 8px 0 -2px rgba(12, 20, 39, 0.6), 
                0 8px 0 -1px rgba(255, 255, 255, 0.05),
                
                /* Layer 2 (Längst under - Vertikal) */
                0 16px 0 -4px rgba(12, 20, 39, 0.4),
                0 16px 0 -3px rgba(255, 255, 255, 0.02);
        }
        
        .product-card:hover {
            transform: translateY(-4px);
            border-color: rgba(0, 212, 255, 0.3);
            /* Mjukare lyft vid hover - Behåll vertikal vinkel */
            box-shadow: 
                0 0 0 1px rgba(0, 212, 255, 0.1),
                0 25px 60px -12px rgba(0, 0, 0, 0.6),
                
                /* Layer 1 Hover */
                0 10px 0 -2px rgba(12, 20, 39, 0.6),
                0 10px 0 -1px rgba(0, 212, 255, 0.1),
                
                /* Layer 2 Hover */
                0 20px 0 -4px rgba(12, 20, 39, 0.4),
                0 20px 0 -3px rgba(0, 212, 255, 0.05);
        }

        /* Screenshot Area */
        .product-screenshot-container {
            position: relative;
            width: 100%;
            height: 70%; /* Balanserad bildyta */
            overflow: hidden;
            background: #080c14; /* Mjukare svart */
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            flex-shrink: 0;
            z-index: 1;
        }
        
        .product-screenshot {
            position: absolute !important;
            top: 0;
            left: 0;
            width: 100% !important;
            height: 100% !important;
            object-fit: cover;
            object-position: top center;
            z-index: 10;
            display: block !important;
            opacity: 1 !important;
        }

        /* Text Panel - Deep Void Glass (Alt 1) */
        .product-text-panel {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            padding: 1.75rem;
            justify-content: space-between;
            /* Deep Void Glass Style med Stjärnor */
            background-color: rgba(8, 12, 20, 0.9); /* Något solidare bas */
            /* Subtil stjärnhimmel via CSS-gradienter */
            background-image: 
                radial-gradient(1.5px 1.5px at 20px 30px, rgba(255, 255, 255, 0.4) 0%, transparent 100%),
                radial-gradient(1px 1px at 40px 70px, rgba(255, 255, 255, 0.3) 0%, transparent 100%),
                radial-gradient(1.5px 1.5px at 50px 160px, rgba(255, 255, 255, 0.3) 0%, transparent 100%),
                radial-gradient(1px 1px at 90px 40px, rgba(255, 255, 255, 0.4) 0%, transparent 100%),
                radial-gradient(1px 1px at 130px 80px, rgba(255, 255, 255, 0.3) 0%, transparent 100%);
            background-repeat: repeat;
            background-size: 200px 200px;
            
            border-top: 1px solid rgba(255, 255, 255, 0.08); /* Subtil kant */
            backdrop-filter: blur(40px); /* Extrem blur för obsidian-känsla */
            -webkit-backdrop-filter: blur(40px);
            box-shadow: inset 0 1px 0 0 rgba(255, 255, 255, 0.05); /* Inre highlight */
        }
        
        /* Premium Titel Design - UPPDATERAT: WHITE CHALK */
        .product-text-panel h3 {
            font-family: 'Comfortaa', sans-serif;
            font-weight: 800; /* Fetare */
            color: #ffffff; /* Solid Vit */
            background: none; /* Ingen gradient */
            -webkit-text-fill-color: initial;
            /* Subtil Vit Glöd */
            filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.3));
            letter-spacing: 0.02em;
        }
        
        /* UPPDATERAT: Vit text för kategorier (Ritning, Motor etc) */
        .product-text-panel span.font-mono {
            color: #ffffff !important;
            border-bottom-color: rgba(255, 255, 255, 0.5) !important;
        }
        
        /* UPPDATERAT: Vit brödtext */
        .product-text-panel p {
            color: #ffffff !important;
            opacity: 0.9;
        }

        /* Justering av kortet för att hantera flex korrekt */
        .arch-slide .product-card {
            height: 100%;
            display: flex;
            flex-direction: column;
            /* Reset borders to avoid conflicts with shadow */
            border: none; 
        }

        /* Light Theme Overrides */
        body.light-theme .product-card {
            background: #ffffff !important;
            border: 2px solid var(--nord-sym-blueprint-lines); /* 2px solid kant */
            border-radius: 12px; /* Matchar Tjänster */
            /* Ersätt Stack Effect med Hård Skugga */
            box-shadow: 8px 8px 0px rgba(148, 163, 184, 0.2) !important;
            opacity: 1 !important;
        }
        body.light-theme .product-card:hover {
            border-color: var(--nord-sym-blueprint-cyan);
            box-shadow: 12px 12px 0px rgba(2, 132, 199, 0.2) !important;
            transform: translate(-2px, -2px);
        }
        body.light-theme .product-screenshot-container {
            background: #f8fafc;
            border-bottom: 2px solid var(--nord-sym-blueprint-lines); /* Matchar yttre kant */
        }
        
        /* SPECIFIK FIX FÖR TEXTPANEL I LJUST LÄGE */
        body.light-theme .product-text-panel {
            background-color: #ffffff;
            background-image: none; /* Inga stjärnor i ljust läge */
            border-top: none; /* Rensa gammal border */
        }
        body.light-theme .product-text-panel h3 {
            background: none; /* Ingen gradient */
            -webkit-text-fill-color: initial; /* Återställ textfärg */
            color: #0f172a !important; /* Slate 900 */
            filter: none; /* Ingen glöd */
        }
        body.light-theme .product-text-panel p {
            color: #334155 !important; /* Slate 700 - Tvinga mörk brödtext */
        }
        /* UPPDATERAT: Tech Badge i Light Mode till "Ink Style" (Renare) */
        body.light-theme .product-text-panel .tech-badge {
            background-color: transparent !important;
            color: var(--nord-sym-blueprint-ink) !important;
            border-color: var(--nord-sym-blueprint-ink) !important;
            box-shadow: none !important;
        }
        body.light-theme .product-text-panel span.text-xs {
            color: #64748b !important; /* Slate 500 - Status text */
        }
        
        /* FIX: Product Card CTAs (Öppna Verktyg etc) i Light Mode */
        body.light-theme .product-text-panel a {
            color: var(--nord-sym-blueprint-cyan) !important;
        }
        body.light-theme .product-text-panel a:hover {
            color: var(--nord-sym-blueprint-ink) !important;
        }
        
        /* --- NYA NAVIGATIONSKNAPPAR (MED TYNGD & STABILITET) --- */
        .nav-btn-soft {
            width: 4.5rem; height: 4.5rem; /* Lite större för tyngd */
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            /* Justerad curve för "tung" känsla (ease-out expo) */
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1); 
            backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            cursor: pointer;
            z-index: 50;
            
            /* Dark Mode Default - TYNGD */
            background: #0f172a; 
            border: 2px solid rgba(0, 212, 255, 0.25); /* Tydligare, tjockare kant */
            color: var(--nord-sym-text-light);
            /* Djupare, massiv skugga */
            box-shadow: 0 20px 50px -12px rgba(0,0,0,0.95), 0 0 0 1px rgba(0,0,0,0.5);
        }
        
        .nav-btn-soft:hover {
            background: #1e293b;
            border-color: var(--nord-sym-cyan);
            color: var(--nord-sym-cyan);
            /* Stabilare lyft (mindre scale) */
            transform: translateY(-50%) scale(1.05); 
            box-shadow: 0 30px 70px -15px rgba(var(--nord-sym-cyan-rgb), 0.4);
        }

        .nav-btn-soft:active {
            /* Taktil press-effekt (trycks ned) */
            transform: translateY(-50%) scale(0.96);
            box-shadow: 0 5px 15px -5px rgba(0,0,0,0.8);
            transition-duration: 0.1s; /* Snabb respons */
        }

        /* Light Mode Override för knappar - TYNGD */
        body.light-theme .nav-btn-soft {
            background: #ffffff;
            border: 2px solid rgba(0, 0, 0, 0.1);
            color: var(--nord-sym-blueprint-text-secondary);
            box-shadow: 0 20px 50px -12px rgba(0,0,0,0.25);
        }
        
        body.light-theme .nav-btn-soft:hover {
            border-color: var(--nord-sym-blueprint-cyan);
            color: var(--nord-sym-blueprint-cyan);
            background: #ffffff;
            box-shadow: 0 25px 60px -15px rgba(var(--nord-sym-blueprint-cyan-rgb), 0.3);
        }
        
        body.light-theme .nav-btn-soft:active {
             box-shadow: 0 5px 15px -5px rgba(0,0,0,0.15);
        }

        /* Card Content */
        .product-card > .flex-col {
            padding: 1.5rem;
        }

        /* Tech Badge - UPPDATERAT: WHITE CHALK */
        .tech-badge {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 6px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            background: transparent; /* Ingen bakgrund */
            color: #ffffff; /* Vit text */
            border: 1px solid #ffffff; /* Vit border */
            margin-left: 0.25rem; /* Gap fix */
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.1); /* Subtil vit glöd */
        }

        /* CTA Link */
        .product-cta-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            color: var(--nord-sym-cyan);
            margin-top: auto; /* Push to bottom */
            transition: gap 0.2s ease;
        }
        .product-cta-link:hover {
            gap: 0.75rem;
            color: var(--nord-sym-light-accent);
        }

        /* GitHub Corner Icon */
        .github-corner-icon {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(0,0,0,0.6);
            color: white;
            width: 32px; height: 32px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem;
            z-index: 10;
            transition: all 0.2s ease;
            opacity: 0;
            transform: translateY(-10px);
        }
        .product-card:hover .github-corner-icon {
            opacity: 1;
            transform: translateY(0);
        }
        .github-corner-icon:hover {
            background: var(--nord-sym-cyan);
            color: var(--nord-sym-deep-space-blue);
        }

        /* --- GitHub Profile Card Styles (TOTALRENOVERING & TYNGD) --- */
        .gh-profile-card {
            display: flex;
            flex-direction: column;
            /* UPPDATERAT: Djupare, mer sofistikerad bakgrund */
            background: linear-gradient(160deg, rgba(22, 27, 34, 0.95) 0%, rgba(13, 17, 23, 0.98) 100%);
            /* MJUKARE KANT: Vit Krita - Tydligare vit kant */
            border: 1px solid rgba(255, 255, 255, 0.25);
            border-radius: 16px; /* Mer rundade hörn */
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            color: #ffffff; /* Vit text */
            /* MASSIV SKUGGA FÖR TYNGD (Stack Effect) */
            box-shadow: 
                0 0 0 1px rgba(255, 255, 255, 0.02),
                0 30px 60px -12px rgba(0, 0, 0, 0.9),
                0 10px 20px -5px rgba(0, 0, 0, 0.5);
            margin-bottom: 3rem; /* Lite mindre marginal */
            transition: transform 0.3s cubic-bezier(0.25, 1, 0.5, 1), box-shadow 0.3s ease, border-color 0.3s ease;
            position: relative;
            z-index: 10;
            max-width: 900px; /* Begränsa bredden för att hålla den kompakt */
            margin-left: auto;
            margin-right: auto;
            backdrop-filter: blur(10px); /* Glas-effekt */
        }
        .gh-profile-card:hover {
            transform: translateY(-4px);
            box-shadow: 
                0 0 0 1px rgba(255, 255, 255, 0.4), /* Vit border vid hover */
                0 40px 80px -12px rgba(0, 0, 0, 1),
                0 0 40px rgba(255, 255, 255, 0.15); /* Subtil vit glow */
            border-color: #ffffff;
        }
        
        /* Dekorativ topp-linje - Vit Krita */
        .gh-profile-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.5), transparent);
            opacity: 0.5;
        }
        
        .gh-profile-header {
            padding: 32px; /* Luftigare padding */
            display: flex;
            gap: 24px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1); /* Vitare separator */
            align-items: center; /* Centrerad vertikalt */
            flex-wrap: wrap;
            background: rgba(22, 27, 34, 0.4); /* Semitransparent */
        }
        
        .gh-avatar {
            width: 96px; height: 96px; /* Något större avatar */
            border-radius: 50%;
            border: 2px solid #ffffff; /* Vit kant */
            box-shadow: 0 8px 24px rgba(0,0,0,0.5);
            background-color: #0d1117;
            flex-shrink: 0;
            transition: border-color 0.3s ease, transform 0.3s ease;
        }
        
        /* Avatar Hover Effect */
        .gh-profile-header:hover .gh-avatar {
            border-color: #ffffff;
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }
        
        .gh-names { display: flex; flex-direction: column; margin-bottom: 4px; }
        .gh-name { font-size: 26px; font-weight: 800; color: #ffffff; line-height: 1.1; letter-spacing: -0.02em; } 
        .gh-username { font-size: 18px; font-weight: 300; color: rgba(255, 255, 255, 0.8); line-height: 1.4; }
        .gh-bio { font-size: 15px; margin: 12px 0 16px 0; color: #ffffff; line-height: 1.6; max-width: 680px; opacity: 0.9; }
        
        .gh-meta { display: flex; gap: 20px; font-size: 13px; color: #ffffff; flex-wrap: wrap; align-items: center; }
        .gh-meta-item { display: flex; align-items: center; gap: 8px; transition: color 0.2s; }
        .gh-meta-item i { font-size: 16px; color: #ffffff; transition: color 0.2s; }
        /* NYTT: SVG-hantering för Octicons - Vita */
        .gh-meta-item svg { fill: currentColor; color: #ffffff; transition: color 0.2s; }
        .gh-meta-item a { color: #ffffff; text-decoration: none; transition: color 0.2s; }
        .gh-meta-item:hover, .gh-meta-item:hover a, .gh-meta-item:hover i, .gh-meta-item:hover svg { color: #ffffff; text-shadow: 0 0 8px rgba(255,255,255,0.5); }
        .gh-meta-item a:hover { text-decoration: underline; }
        
        .gh-btn {
            background: transparent; color: #ffffff; border: 1px solid #ffffff; /* Vit Krita */
            padding: 8px 16px; border-radius: 6px; font-size: 13px; font-weight: 600;
            transition: all 0.2s ease; display: inline-block; text-decoration: none;
            box-shadow: none;
        }
        .gh-btn:hover { background: #ffffff; border-color: #ffffff; color: var(--nord-sym-deep-space-blue); transform: translateY(-1px); }

        .gh-pinned-title {
            padding: 24px 32px 16px 32px; /* Tightare */
            font-size: 13px; font-weight: 600; color: #ffffff; text-transform: uppercase; letter-spacing: 0.05em;
            display: flex; align-items: center; gap: 8px;
        }
        
        .gh-pinned-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); /* Något smalare kort */
            gap: 16px; /* Tätare gap */
            padding: 0 32px 32px 32px;
        }
        
        .gh-repo-card {
            background: rgba(13, 17, 23, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.15); /* Vitare kant */
            border-radius: 8px;
            padding: 20px; /* Mindre padding */
            display: flex; flex-direction: column; justify-content: space-between;
            height: 100%; min-height: 120px; /* Lägre min-height */
            text-decoration: none;
            transition: all 0.25s cubic-bezier(0.25, 1, 0.5, 1);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .gh-repo-card:hover {
            border-color: #ffffff;
            transform: translateY(-3px);
            box-shadow: 0 8px 24px rgba(255, 255, 255, 0.1);
            background: rgba(22, 27, 34, 0.8);
        }
        
        .gh-repo-name {
            font-weight: 700; font-size: 15px; color: #ffffff;
            display: flex; align-items: center; gap: 8px; margin-bottom: 10px;
            transition: color 0.2s;
        }
        .gh-repo-card:hover .gh-repo-name { color: #ffffff; text-shadow: 0 0 10px rgba(255,255,255,0.4); }
        
        .gh-repo-desc {
            font-size: 13px; color: #ffffff; margin-bottom: 16px; line-height: 1.5; flex-grow: 1; opacity: 0.9;
        }
        .gh-repo-meta {
            font-size: 12px; color: #ffffff; display: flex; align-items: center; gap: 16px; opacity: 0.8;
        }
        .gh-lang-color {
            width: 12px; height: 12px; border-radius: 50%; display: inline-block; margin-right: 6px;
            border: 1px solid #ffffff;
        }

        /* LIGHT THEME OVERRIDES FOR GITHUB CARD (Solid & Tung) */
        body.light-theme .gh-profile-card {
            background: #ffffff;
            border: 2px solid var(--nord-sym-blueprint-lines); /* 2px solid kant */
            color: var(--nord-sym-blueprint-ink); /* Bläck-svart text */
            border-radius: 12px; /* Matchar Tjänster */
            /* Ersätt mjuk skugga med Hård Skugga */
            box-shadow: 8px 8px 0px rgba(148, 163, 184, 0.2);
        }
        body.light-theme .gh-profile-card:hover {
            box-shadow: 12px 12px 0px rgba(2, 132, 199, 0.2);
            border-color: var(--nord-sym-blueprint-cyan);
            transform: translate(-2px, -2px);
        }
        body.light-theme .gh-profile-header {
            background: rgba(248, 250, 252, 0.5); /* Mycket lätt tint */
            border-bottom: 2px solid var(--nord-sym-blueprint-lines); /* Matcha yttre kant */
        }
        /* Uppdatera textfärger i GH-kortet för Light Mode */
        body.light-theme .gh-names .text-white { color: var(--nord-sym-blueprint-ink) !important; }
        body.light-theme .gh-bio strong.text-white { color: var(--nord-sym-blueprint-ink) !important; }
        
        body.light-theme .gh-avatar {
            background-color: #ffffff;
            border-color: var(--nord-sym-blueprint-lines);
            box-shadow: none;
        }
        body.light-theme .gh-name { color: var(--nord-sym-blueprint-ink); }
        body.light-theme .gh-username, 
        body.light-theme .gh-bio, 
        body.light-theme .gh-meta,
        body.light-theme .gh-pinned-title { color: var(--nord-sym-blueprint-text-secondary); }
        
        /* NYTT: Se till att SVG-ikoner får rätt färg i ljust läge */
        body.light-theme .gh-meta-item svg { color: var(--nord-sym-blueprint-text-secondary); }
        body.light-theme .gh-meta-item:hover svg, body.light-theme .gh-meta-item:hover { color: var(--nord-sym-blueprint-cyan); }
        
        body.light-theme .gh-btn {
            background: #ffffff; 
            border: 2px solid var(--nord-sym-blueprint-ink); /* Matchar sekundära knappar */
            color: var(--nord-sym-blueprint-ink);
            box-shadow: none;
            font-weight: 600;
        }
        body.light-theme .gh-btn:hover { 
            background: var(--nord-sym-blueprint-ink); 
            color: #ffffff;
            transform: translate(-1px, -1px);
            box-shadow: 4px 4px 0px rgba(148, 163, 184, 0.4);
        }
        body.light-theme .gh-repo-card {
            background: #ffffff; 
            border: 2px solid var(--nord-sym-blueprint-lines);
            box-shadow: none;
        }
        body.light-theme .gh-repo-card:hover {
            border-color: var(--nord-sym-blueprint-cyan);
            box-shadow: 4px 4px 0px rgba(2, 132, 199, 0.2);
            background: #ffffff;
            transform: translate(-1px, -1px);
        }
        /* --- VERKTYGSFÄLT (TOOLBAR) - JS STYRD --- */
        body.light-theme .gh-repo-desc { color: #57606a; }
        body.light-theme .gh-meta-item i { color: #57606a; }

        /* --- VERKTYGSFÄLT (TOOLBAR) - KORRIGERAD ID-MATCHNING --- */
        /* BULLETPROOF TOOLBAR CSS: "Hard Reset" Edition */
        #workshop-toolbar {
            /* Positionering */
            position: fixed;
            bottom: 30px; 
            bottom: calc(30px + env(safe-area-inset-bottom)); /* Safe area support */
            left: 50%;
            transform: translateX(-50%);
            z-index: 2147483647; /* Max z-index */
            
            /* Layout & Design */
            display: none; /* Dold som standard */
            flex-direction: row;
            align-items: center;
            gap: 16px;
            
            background-color: #0f172a; 
            border: 2px solid #00D4FF; 
            border-radius: 24px;
            padding: 12px 24px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.9), 0 0 0 1px rgba(255,255,255,0.1);
            
            width: auto;
            min-width: 320px; /* Bredden säkrad */
            max-width: 95vw;
            overflow-x: auto;
            
            /* Inga transitioner som kan strula till det */
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
        }

        /* ACTIVE STATE (När body har .labb-active) */
        body.labb-active #workshop-toolbar {
            display: flex !important; /* TVINGA FRAM DEN */
        }
        
        /* Knapp-wrapper */
        .geo-btn-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            width: 50px;
            flex-shrink: 0; /* Förhindra att de krymper */
        }

        /* Knapp */
        .geo-btn {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #ffffff;
            font-size: 1.25rem;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.2s ease;
        }

        .geo-btn-wrapper:hover .geo-btn {
            background: #ffffff;
            color: #000000;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .geo-btn.active {
            background: #00D4FF;
            color: #000000;
            border-color: #00D4FF;
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.4);
            transform: scale(1.05);
        }
        
        /* BORTTAGET: .geo-label och relaterade regler för en renare look */
        
        /* Separator */
        .geo-separator {
            width: 1px;
            height: 32px;
            background: rgba(255,255,255,0.2);
            margin: 0 4px;
        }

        /* Ljus Tema */
        body.light-theme #workshop-toolbar {
            background-color: #ffffff;
            border-color: #00D4FF;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
        }
        body.light-theme .geo-btn {
            background: #f1f5f9;
            color: #334155;
            border-color: #cbd5e1;
        }
        /* BORTTAGET: Light theme label colors */
        body.light-theme .geo-btn.active,
        body.light-theme .geo-btn-wrapper:hover .geo-btn {
            background: var(--nord-sym-blueprint-cyan);
            color: #ffffff;
            border-color: var(--nord-sym-blueprint-cyan);
        }
        
    </style>
</head>
<body class="antialiased light-theme">
    <!-- CRAWLER NAVIGATION (AEO BOOST) -->
    <nav id="crawler-nav" class="sr-only" aria-label="Sitemap för sökrobotar">
        <ul>
            <li><a href="#hero">Start</a></li>
            <li><a href="#om-oss">Vår Arkitektur och Filosofi</a></li>
            <li><a href="#system">Systempaket och Priser</a></li>
            <li><a href="#ritbordet">Ritbordet och Process</a></li>
            <li><a href="#atom-gallery-section">AI-Byggstenar och Produkter</a></li>
        </ul>
    </nav>

    <canvas id="starfall"></canvas>
    <!-- NYTT: Blueprint Grid för Light Mode -->
    <div class="blueprint-grid"></div>

    <header id="header" class="fixed w-full top-0 left-0 right-0 z-40 bg-nord-sym-deep-space-blue/95 transition-all duration-300" itemscope itemtype="https://schema.org/WPHeader">
        <div class="container mx-auto px-4 md:px-6 py-4 flex justify-between items-center"> 
            <a href="#" id="header-logo-link" onclick="window.nord.handleHeaderLogoClick(event); return false;" class="flex-shrink-0">
                <img src="https://raw.githubusercontent.com/GusHem/Logga-utan-text/refs/heads/main/Final%20logo%20no%20text.svg" alt="NordSym Logotyp" class="h-16 md:h-20 transition-all duration-300">
            </a>
            <nav aria-label="Huvudnavigation" class="hidden md:flex flex-grow justify-center space-x-5 items-center header-nav">
                <a href="#" onclick="window.nord.showPage('hero'); return false;" data-nav="hero" class="nav-link transition-colors font-medium">Hem</a>
                <a href="#" onclick="window.nord.showPage('om-oss'); return false;" data-nav="om-oss" class="nav-link transition-colors font-medium">Micro-SaaS</a>
                <!-- UPPDATERAT: System -> Tjänster -->
                <a href="#" onclick="window.nord.showPage('system'); return false;" data-nav="system" class="nav-link transition-colors font-medium">Tjänster</a>
                <!-- UPPDATERAT: Ritbordet -> R&D -->
                <a href="#" onclick="window.nord.showPage('ritbordet'); return false;" data-nav="ritbordet" class="nav-link transition-colors font-medium">R&D</a>
            </nav>
            <div class="hidden md:flex items-center gap-x-4 flex-shrink-0 header-cta"> 
                <a href="#" onclick="window.nord.showPage('boka-samtal-skraddarsydd'); return false;" class="btn-base btn-cta-revised text-sm">Framtidsförsäkra er verksamhet</a>
                
                <!-- NY TEMAKNAPP (SWITCH) -->
                <label class="theme-switch">
                    <input type="checkbox" class="theme-switch__checkbox" id="theme-switch-input" checked>
                    <div class="theme-switch__container">
                        <div class="theme-switch__clouds"></div>
                        <div class="theme-switch__stars-container">
                            <!-- SVG STAR ICON -->
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-full h-full">
                                <path fill-rule="evenodd" d="M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.007 5.404.433c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.433 2.082-5.006z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <div class="theme-switch__circle-container">
                            <div class="theme-switch__sun-moon-container">
                                <div class="theme-switch__moon">
                                    <div class="theme-switch__spot"></div>
                                    <div class="theme-switch__spot"></div>
                                    <div class="theme-switch__spot"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </label>
            </div>
            
            <!-- MOBIL TEMAKNAPP (BEHÅLLD TILLS VIDARE, MEN KAN UPPDATERAS TILL SWITCH) -->
            <button id="theme-toggle-btn-mobile" class="theme-toggle-btn md:hidden" aria-label="Växla ljus/mörkt tema">
                <i class="ph ph-sun"></i>
            </button>

            <!-- Form Name Display flyttad utanför grid-flödet för absolut centrering -->
            <div id="form-name-display"></div>
        </div>
        <div id="mobile-menu" class="md:hidden bg-nord-sym-deep-space-blue/95 backdrop-blur-sm shadow-lg rounded-b-xl absolute w-full left-0 top-full overflow-hidden transition-all duration-500 ease-in-out max-h-0">
            <a href="#" onclick="window.nord.showPage('hero'); return false;" data-nav="hero" class="block px-6 py-5 text-sky-100 hover:bg-sky-700/50 hover:nord-accent-text transition-colors">Hem</a>
            <a href="#" onclick="window.nord.showPage('om-oss'); return false;" data-nav="om-oss" class="block px-6 py-5 text-sky-100 hover:bg-sky-700/50 hover:nord-accent-text transition-colors">Micro-SaaS</a>
            <!-- UPPDATERAT: System -> Tjänster -->
            <a href="#" onclick="window.nord.showPage('system'); return false;" data-nav="system" class="block px-6 py-5 text-sky-100 hover:bg-sky-700/50 hover:nord-accent-text transition-colors">Tjänster</a>
            <!-- UPPDATERAT: Ritbordet -> R&D -->
            <a href="#" onclick="window.nord.showPage('ritbordet'); return false;" data-nav="ritbordet" class="block px-6 py-5 text-sky-100 hover:bg-sky-700/50 hover:nord-accent-text transition-colors">R&D</a>
            <div class="px-6 py-5 border-t border-sky-800/50 flex items-center gap-x-4">
                <a href="#" onclick="window.nord.showPage('boka-samtal-skraddarsydd'); return false;" data-nav="kontakt" class="btn-base btn-cta-revised w-full flex-grow">Framtidsförsäkra er verksamhet</a>
            </div>
        </div>
    </header>

    <main itemscope itemtype="https://schema.org/WebPage"> 
        <section id="hero" class="space-background-section">
            <div class="section-content-wrapper">
                <div class="flex flex-col items-center gap-y-6 md:gap-y-8"> <!-- Minskat gap på mobil -->
                    <div id="hero-logo-wrapper" onclick="window.nord.showPage('om-oss');">
                        <img src="https://raw.githubusercontent.com/GusHem/Logga-utan-text/refs/heads/main/Final%20logo%20no%20text.svg" alt="NordSym Logotyp" width="200" height="57">
                    </div>
                    
                    <!-- UPPDATERAT: "TIDNING/TIKTOK" RUBRIK -->
                    <div class="relative inline-block group my-8">
                        <!-- Dekorativ bakgrund (Subtil "Marker"-effekt) -->
                        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[110%] h-[60%] bg-nord-sym-cyan/20 blur-xl rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-700 light-theme:bg-sky-200/50"></div>
                        
                        <!-- UPPDATERAT: RAK, MINDRE OCH MOBILVÄNLIG -->
                        <h1 class="relative z-10 text-4xl sm:text-5xl md:text-7xl leading-tight tracking-tight
                                   text-white 
                                   light-theme:text-nord-sym-blueprint-ink
                                   cursor-default"
                            style="font-family: 'DM Serif Display', serif; text-shadow: 0 4px 30px rgba(0, 212, 255, 0.5);">
                            Bygg bort <br class="md:hidden"> begränsningar
                        </h1>
                        
                        <!-- Light Mode Shadow Override (Hårdare skugga för "Papper"-känsla) -->
                        <style>
                            body.light-theme h1 {
                                text-shadow: 4px 4px 0px rgba(0,0,0,0.1) !important;
                            }
                        </style>
                    </div>

                    <p class="text-lg md:text-xl text-sky-100 max-w-3xl mx-auto drop-shadow-sm text-center leading-loose md:leading-relaxed px-4">
                        NordSym designar intelligent mjukvara och bygger digitala verktyg som 
                        <span class="animate-emphasis relative inline-block px-2 py-0.5 mx-1 bg-nord-sym-cyan text-nord-sym-deep-space-blue font-bold text-sm md:text-base rounded shadow-[0_0_15px_rgba(0,212,255,0.5)] border border-white/20 align-middle my-1">FAKTISKT</span> 
                        gör skillnad.
                    </p>
                    
                    <div class="flex flex-col items-center gap-4 md:gap-6 w-full px-4 mb-8">
                        <div class="flex flex-col md:flex-row items-center gap-3 md:gap-6 w-full md:w-auto">
                            <a href="#" onclick="window.nord.showPage('boka-samtal-skraddarsydd'); return false;" class="btn-base btn-cta-revised w-full md:w-auto py-3 md:py-3.5">Framtidsförsäkra er verksamhet</a>
                            <a href="#" onclick="window.nord.showPage('ritbordet'); return false;" class="btn-base btn-secondary-on-dark w-full md:w-auto py-3 md:py-3.5">R&D</a>
                        </div>
                         <div class="flex flex-col sm:flex-row gap-2 sm:gap-8 mt-4 md:mt-2 text-xs md:text-sm text-sky-300/80 font-mono tracking-wide justify-center items-center">
                            <span>MICRO-SAAS</span>
                            <span class="hidden sm:block text-sky-500">•</span>
                            <span>INTELLIGENT ARKITEKTUR</span>
                            <span class="hidden sm:block text-sky-500">•</span>
                            <span>INTELLIGENT AUTOMATION</span>
                        </div>
                    </div>
                    
                    <!-- NYTT: HERO INPUT INTERFACE (Placerad under innehållet med marginal) -->
                    <div id="hero-chat-mount" class="w-full relative z-20 min-h-[60px] flex flex-col items-center mt-4">
                        
                        <!-- Initial State: Clean Input Bar -->
                        <div id="hero-input-wrapper">
                            <div class="relative">
                                <input type="text" id="hero-chat-input-field" placeholder="Fråga NordSym..." autocomplete="off">
                                <button id="hero-input-send" aria-label="Skicka">
                                    <i class="ph-paper-plane-right-fill text-lg"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- NYTT: RESUME BUTTON (Visas när historik finns) -->
                        <button id="chat-resume-btn" onclick="window.nord.resumeChat()">
                            <span class="resume-pulse"></span>
                            <span>Aktiv session</span>
                            <i class="ph-caret-up ml-1 text-xs opacity-70"></i>
                        </button>

                    </div>

                </div>
            </div>
        </section>

        <!-- NY SEKTION: DIGITAL CONTROL ROOM (PRODUKT-SHOWCASE) -->
        <section id="product-showcase" class="space-background-section py-20 relative">
            <!-- Grid Overlay för "Control Room" känsla -->
            <div class="tech-grid-overlay"></div>
            
            <div class="section-content-wrapper">
                <div class="text-center mb-12 max-w-4xl mx-auto">
                    <h2 class="section-title text-3xl md:text-4xl mb-4 light-theme:text-nord-sym-blueprint-ink">Operativsystemet i <span class="section-title-accent">Action</span></h2>
                    <p class="text-lg text-sky-200 mt-4 leading-relaxed light-theme:text-nord-sym-blueprint-text-secondary">
                        Inga rökridåer. Bara ren, funktionell intelligens.
                    </p>
                </div>

                <!-- CAROUSEL CONTAINER -->
                <div class="showcase-container">
                    
                    <!-- Navigation -->
                    <button class="showcase-nav-btn showcase-prev" aria-label="Föregående system"><i class="ph-caret-left-bold"></i></button>
                    <button class="showcase-nav-btn showcase-next" aria-label="Nästa system"><i class="ph-caret-right-bold"></i></button>

                    <!-- MONITOR 1: FlowVault -->
                    <div class="monitor-wrapper active" data-index="0">
                        <div class="glass-monitor group cursor-pointer" onclick="window.open('https://flowvault.se', '_blank')">
                            <!-- Använder absolut GitHub Pages URL för säkerhet -->
                            <img src="https://nordsym.github.io/NordSym-Hemsida/img/Skärmavbild 2026-01-10 kl. 13.18.13.png" 
                                 alt="FlowVault Interface" 
                                 class="monitor-image" 
                                 loading="lazy"
                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'">
                            
                            <!-- Fallback om bild saknas -->
                            <div class="monitor-content-placeholder hidden absolute inset-0 flex-col items-center justify-center bg-gray-900/90 text-white">
                                <i class="ph-stack text-5xl mb-4 text-nord-sym-cyan"></i>
                                <span class="font-mono">Bild saknas: FlowVault</span>
                            </div>
                        </div>
                        <div class="monitor-info">
                            <h3 class="text-2xl font-bold text-white mb-2 tracking-wide light-theme:text-nord-sym-blueprint-ink">FlowVault</h3>
                            <!-- UPPDATERAT: Pris-indikation -->
                            <p class="text-sky-300 text-sm uppercase tracking-wider font-semibold mb-4 light-theme:text-nord-sym-blueprint-text-secondary">n8n Marketplace | Starta Gratis</p>
                            <div class="flex gap-2 justify-center mb-6">
                                <span class="tech-badge">n8n</span>
                                <span class="tech-badge">Astra DB</span>
                                <span class="tech-badge">Stripe</span>
                            </div>
                            <!-- UPPDATERAT: "Öppna Live System" -> "Öppna Valvet" (Renare) -->
                            <a href="https://flowvault.se" target="_blank" class="btn-base btn-cta-revised text-sm px-8">Öppna Valvet</a>
                        </div>
                    </div>

                    <!-- MONITOR 2: GenPRD -->
                    <div class="monitor-wrapper" data-index="1">
                        <div class="glass-monitor group cursor-pointer" onclick="window.open('https://genprd.se', '_blank')">
                            <img src="https://nordsym.github.io/NordSym-Hemsida/img/Skärmavbild 2026-01-10 kl. 13.18.25.png" 
                                 alt="GenPRD Interface" 
                                 class="monitor-image" 
                                 loading="lazy"
                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'">
                             <div class="monitor-content-placeholder hidden absolute inset-0 flex-col items-center justify-center bg-gray-900/90 text-white">
                                <i class="ph-file-code text-5xl mb-4 text-purple-400"></i>
                                <span class="font-mono">Bild saknas: GenPRD</span>
                            </div>
                        </div>
                        <div class="monitor-info">
                            <!-- UPPDATERAT: Använder GenPRD branding HTML istället för plain text -->
                            <h3 class="text-2xl font-bold text-white mb-2 tracking-wide light-theme:text-nord-sym-blueprint-ink">
                                <span class="genprd-brand-text" style="font-size: 1.5rem;">Gen<span class="genprd-text-prd">PRD</span></span>
                            </h3>
                            <!-- UPPDATERAT: Pris-indikation -->
                            <p class="text-sky-300 text-sm uppercase tracking-wider font-semibold mb-4 light-theme:text-nord-sym-blueprint-text-secondary">Context Engine | Prova Gratis</p>
                            <div class="flex gap-2 justify-center mb-6">
                                <span class="tech-badge">Next.js</span>
                                <span class="tech-badge">OpenAI</span>
                                <span class="tech-badge">Supabase</span>
                            </div>
                            <a href="https://genprd.se" target="_blank" class="btn-base btn-cta-revised text-sm px-8">Skapa Specifikation</a>
                        </div>
                    </div>

                    <!-- MONITOR 3: AEO Platform -->
                    <div class="monitor-wrapper" data-index="2">
                        <div class="glass-monitor group cursor-pointer" onclick="window.open('https://nordsym.github.io/aeo-platform/', '_blank')">
                            <img src="https://nordsym.github.io/NordSym-Hemsida/img/Skärmavbild 2026-01-10 kl. 13.18.43.png" 
                                 alt="AEO Audit Interface" 
                                 class="monitor-image" 
                                 loading="lazy"
                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'">
                             <div class="monitor-content-placeholder hidden absolute inset-0 flex-col items-center justify-center bg-gray-900/90 text-white">
                                <i class="ph-globe-stand text-5xl mb-4 text-green-400"></i>
                                <span class="font-mono">Bild saknas: AEO Platform</span>
                            </div>
                        </div>
                        <div class="monitor-info">
                            <!-- UPPDATERAT: Namnbyte AEO Platform -> AEO & GEO -->
                            <h3 class="text-2xl font-bold text-white mb-2 tracking-wide light-theme:text-nord-sym-blueprint-ink">AEO & GEO</h3>
                            <!-- UPPDATERAT: Pris-indikation -->
                            <p class="text-sky-300 text-sm uppercase tracking-wider font-semibold mb-4 light-theme:text-nord-sym-blueprint-text-secondary">AI-Search Optimization | Från 1,999 kr/mån</p>
                            <div class="flex gap-2 justify-center mb-6">
                                <!-- UPPDATERAT: Tyngre, strategiska taggar istället för API-namn -->
                                <span class="tech-badge">Knowledge Graph</span>
                                <span class="tech-badge">Semantic Analysis</span>
                                <span class="tech-badge">Multi-Model</span>
                            </div>
                            <a href="https://nordsym.github.io/aeo-platform/" target="_blank" class="btn-base btn-cta-revised text-sm px-8">Analysera Nu</a>
                        </div>
                    </div>

                </div>
                
                <div class="text-center mt-8">
                    <div class="flex justify-center gap-2">
                        <button class="w-3 h-3 rounded-full bg-nord-sym-cyan opacity-100 transition-opacity showcase-dot" data-index="0"></button>
                        <button class="w-3 h-3 rounded-full bg-sky-700 opacity-50 transition-opacity showcase-dot" data-index="1"></button>
                        <button class="w-3 h-3 rounded-full bg-sky-700 opacity-50 transition-opacity showcase-dot" data-index="2"></button>
                    </div>
                    <p class="text-xs text-sky-300 font-mono opacity-60 mt-4 light-theme:text-nord-sym-blueprint-text-secondary">
                        // Systemstatus: LIVE <span class="animate-pulse text-green-400">●</span>
                    </p>
                </div>
            </div>
        </section>
        
        <section id="home-diagram-section" class="space-background-section py-16 lg:py-24">
            <div class="section-content-wrapper">
                <div class="text-center mb-16 max-w-4xl mx-auto">
                    <!-- UPPDATERAT: Rubrik designad som en stor tagg -->
                    <div class="inline-block">
                        <h2 class="section-title inline-block px-6 py-3 md:px-10 md:py-5 rounded-full border border-sky-500/30 bg-sky-900/20 backdrop-blur-md text-2xl md:text-4xl font-bold text-white mb-6 shadow-[0_0_30px_rgba(0,212,255,0.1)] light-theme:bg-white/80 light-theme:border-sky-200 light-theme:text-nord-sym-blueprint-ink light-theme:shadow-sm">
                            Frigör er potential
                        </h2>
                    </div>
                    
                    <!-- UPPDATERAT: Fixat dålig kontrast i Light Mode (text-gray-900 + font-medium) -->
                    <p class="text-lg text-sky-200 mt-2 leading-relaxed light-theme:text-gray-900 light-theme:font-medium">
                        <!-- UPPDATERAT: Fas 2.5 Copy - Jordnära, skräddarsydd mjukvara + länk -->
                        <!-- FIX: Rensat bort "Vi" och "Våra" för att passa Solo Founder -->
                        Manuella processer sätter ett tak för er tillväxt. NordSym bygger bort det genom att utveckla skräddarsydd mjukvara som automatiserar era unika flöden och frigör tid för expansion. 
                        <a href="#" onclick="window.nord.showPage('system'); return false;" class="text-nord-sym-cyan font-semibold hover:text-white transition-colors underline decoration-dotted underline-offset-4 ml-1 light-theme:text-nord-sym-blueprint-cyan light-theme:hover:text-nord-sym-blueprint-ink">Utforska tjänster →</a>
                    </p>
                </div>
                <div class="venn-diagram-container">
                    <div class="venn-diagram-wrapper">
                        <div class="venn-circle venn-circle-1">
                            <!-- UPPDATERAT: "Unika Flöden" - Mer konkret än Metodik -->
                            <span class="venn-circle-text">Unika<br>Flöden</span>
                        </div>
                        <div class="venn-circle venn-circle-2">
                             <!-- UPPDATERAT: "Intelligent Arkitektur" - Matchar nya pitchen -->
                             <span class="venn-circle-text">Intelligent<br>Arkitektur</span>
                        </div>
                        <!-- UPPDATERAT: Symbol för oändlighet + Sparade Timmar -->
                        <div class="venn-overlap-text flex flex-col items-center justify-center" onclick="window.nord.showPage('system'); return false;">
                            <i class="ph ph-infinity text-4xl mb-1 text-nord-sym-light-accent"></i>
                            <span class="text-sm md:text-base leading-tight">Sparade<br>Timmar</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="atom-gallery-section" class="space-background-section py-20 lg:py-28">
            <div class="section-content-wrapper">
                <div class="text-center mb-16">
                    <!-- NY: Pill switch-växlare (Omstrukturerad för slide) -->
                    <div id="gallery-switch-container" class="relative inline-flex items-stretch rounded-full bg-sky-900/70 p-1.5" style="font-family: 'Comfortaa', sans-serif;">
                        <!-- Det glidande pillret -->
                        <div id="gallery-switch-slider" class="absolute h-full rounded-full bg-nord-sym-cyan transition-all duration-300 ease-in-out" style="top: 0; left: 0;"></div>
                        
                        <!-- Knapparna (nu transparenta, ovanpå) -->
                        <button id="gallery-switch-byggstenar" 
                                class="gallery-switch-btn inactive relative z-10 text-sky-200 hover:text-white rounded-full px-6 py-2 text-lg md:text-xl uppercase tracking-wider transition-colors duration-300">
                            <!-- UPPDATERAT: Byggstenar -> STACK -->
                            STACK
                        </button>
                        <button id="gallery-switch-galleri" 
                                class="gallery-switch-btn active relative z-10 text-nord-sym-deep-space-blue rounded-full px-6 py-2 text-lg md:text-xl uppercase tracking-wider transition-colors duration-300">
                            <!-- UPPDATERAT: Verktyg -> SYSTEM -->
                            SYSTEM
                        </button>
                    </div>
                    
                    <!-- UPPDATERAT: Copy som täcker både verktyg (analys/flöden) och system -->
                    <p id="gallery-description-text" class="text-center text-sky-200 max-w-3xl mx-auto mt-8 mb-8">
                        <!-- UPPDATERAT: Tog bort 'Vi erbjuder' -->
                        Specialiserade verktyg och system. Från färdiga automationsflöden och analysverktyg till branschspecifika SaaS-lösningar.
                    </p>
                </div>
                
                <!-- ÅTERSTÄLLD: Galleriets viewport och kontroller -->
                <div class="gallery-container">
                    <div class="gallery-viewport">
                        <div id="galleryWrapper" class="gallery-wrapper">
                            <!-- Cards are dynamically injected by JS -->
                        </div>
                    </div>
                </div>
                <div class="flex items-center justify-center mt-16 gap-4 sm:gap-6">
                    <button id="galleryPrev" aria-label="Föregående byggsten" class="gallery-control-btn">
                        <i class="ph-arrow-left-bold"></i>
                    </button>
                    <span id="gallery-context-text" class="text-base sm:text-lg text-sky-300 select-none">Utforska produkterna</span>
                    <button id="galleryNext" aria-label="Nästa byggsten" class="gallery-control-btn">
                        <i class="ph-arrow-right-bold"></i>
                    </button>
                </div>
                <!-- ÅTERSTÄLLD: Paginering och stängningstaggar som saknades -->
                <div id="galleryPagination" class="flex justify-center mt-6 gap-3"></div>
            </div>
        </section>

        <!-- OMDESIGNAD: ARKITEKTUR (VISUAL SHOWCASE) -->
        <section id="om-oss" class="space-background-section page-content-padding" style="display: none;">
            <div class="section-content-wrapper">
                <!-- HERO SECTION -->
                <div class="max-w-4xl mx-auto text-center mb-12">
                    <!-- UPPDATERAT: Designkoncept "Vit Krita" (White Chalk) - Matchar R&D-knappen -->
                    <span class="inline-block px-4 py-1.5 mb-4 text-xs md:text-sm font-bold tracking-widest uppercase rounded-full border-2 border-white text-white bg-transparent shadow-[0_0_15px_rgba(255,255,255,0.1)] light-theme:bg-sky-100 light-theme:border-sky-300 light-theme:text-nord-sym-blueprint-cyan">Micro-SaaS & Verktyg</span>
                    <!-- BORTTAGET: Rubrik "NordSym R&D" raderad enligt önskemål -->
                    
                    <!-- NYTT: FOUNDER BADGE (Uppdaterad till knapp + BALANSERAD) -->
                    <!-- Ändringar: Mjukare border i dark mode, tydligare hover i light mode -->
                <!-- GITHUB PROFILE SECTION (MOVED TO TOP) -->
                <div class="max-w-5xl mx-auto mb-24">
                    <div class="gh-profile-card">
                        
                        <div class="gh-profile-header relative z-10" style="border-bottom: none;">
                            <!-- BORTTAGET: Avatar/Bild raderad för en renare text-baserad layout -->
                            
                            <div class="flex-grow min-w-[200px]">
                                <!-- UPPDATERAT: Renare copy för SaaS vs Tjänst + Gratis Analys CTA -->
                                <div class="gh-bio">
                                    <p class="mb-3"><strong class="text-white">Micro-SaaS</strong> är fokuserad mjukvara för specifika problem.</p>
                                    <p class="opacity-80 mb-2">
                                        <!-- UPPDATERAT: Tog bort "freemium", mjukare formulering -->
                                        <strong>GenPRD</strong> och <strong>FlowVault</strong> är våra Micro-SaaS. Ni kan börja använda dem direkt, helt utan kostnad.
                                    </p>
                                    <p class="opacity-80">
                                        <!-- UPPDATERAT: Namnbyte AEO-plattformen -> AEO & GEO -->
                                        <strong>AEO & GEO</strong> är ett gratis verktyg vi tagit fram för analys av ditt företags hemsida. Testa din synlighet i AI-sök direkt via knappen.
                                    </p>
                                </div>
                                <div class="gh-meta mt-4">
                                    <span class="gh-meta-item">
                                        <i class="ph ph-cube"></i>
                                        Micro-SaaS
                                    </span>
                                    <span class="gh-meta-item">
                                        <i class="ph ph-compass-tool"></i>
                                        Systemarkitektur
                                    </span>
                                    <span class="gh-meta-item">
                                        <i class="ph ph-scroll"></i>
                                        Ritningar
                                    </span>
                                </div>
                            </div>
                            <!-- UPPDATERAT: Knappar på rad (flex-row) + AEO-knapp tillagd -->
                            <div class="flex-shrink-0 w-full lg:w-auto mt-6 lg:mt-0 flex flex-row flex-wrap gap-3 justify-start lg:justify-end items-center">
                                <a href="https://github.com/nordsym" target="_blank" rel="noopener noreferrer" class="gh-btn inline-flex items-center justify-center gap-2 flex-grow lg:flex-grow-0">
                                    <i class="ph ph-github-logo"></i>
                                    <span>GitHub</span>
                                </a>
                                <a href="https://flowvault.se" target="_blank" rel="noopener noreferrer" class="gh-btn inline-flex items-center justify-center gap-2 flex-grow lg:flex-grow-0">
                                    <i class="ph ph-stack"></i>
                                    <span>FlowVault</span>
                                </a>
                                <a href="https://genprd.se" target="_blank" rel="noopener noreferrer" class="gh-btn inline-flex items-center justify-center gap-2 flex-grow lg:flex-grow-0">
                                    <i class="ph ph-lightning"></i>
                                    <span>GenPRD</span>
                                </a>
                                <!-- NYTT: AEO-knapp med uppdaterat namn -->
                                <a href="https://nordsym.github.io/aeo-platform/" target="_blank" rel="noopener noreferrer" class="gh-btn inline-flex items-center justify-center gap-2 flex-grow lg:flex-grow-0">
                                    <i class="ph ph-brain"></i>
                                    <span>AEO & GEO</span>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- NEW: INTERACTIVE ARCHITECTURE SLIDER (TECH-DECK) -->
                <!-- HARMONI-FIX: Ersatt h-[720px] med inline style för att garantera höjd -->
                <div class="relative max-w-4xl mx-auto mb-12" style="height: 720px;"> 
                    
                    <!-- Navigation Overlay (Soft Buttons) - Removed inner icon transitions for stability -->
                    <button id="arch-prev" class="nav-btn-soft absolute -left-6 md:-left-24 top-1/2 -translate-y-1/2" aria-label="Föregående">
                        <i class="ph ph-caret-left text-2xl"></i>
                    </button>
                    
                    <button id="arch-next" class="nav-btn-soft absolute -right-6 md:-right-24 top-1/2 -translate-y-1/2" aria-label="Nästa">
                        <i class="ph ph-caret-right text-2xl"></i>
                    </button>

                    <!-- Slides Track -->
                    <!-- HARMONI-FIX: Ersatt perspective-1000 med inline style -->
                    <div id="arch-slider-track" class="relative w-full h-full" style="perspective: 1000px;">
                        
                        <!-- SLIDE 1: GenPRD -->
                        <div class="arch-slide absolute top-0 left-0 w-full h-full transition-all duration-500 ease-out opacity-100 translate-x-0 scale-100 z-20 pointer-events-auto" data-index="0">
                            <!-- UPPDATERAD: Lade till klassen 'stacked-effect' -->
                            <div class="product-card stacked-effect group shadow-2xl">
                                <!-- BORTTAGEN: System 01 taggen härifrån -->
                                
                                <!-- BILD (HÅRDKODAD CSS FÖR SÄKERHET) -->
                                <div class="product-screenshot-container">
                                    <img src="https://firebasestorage.googleapis.com/v0/b/nordsym-funnel.firebasestorage.app/o/Ska%CC%88rmavbild%202026-01-10%20kl.%2013.18.43.png?alt=media&token=43b8aecb-ff77-4724-932e-9a3d3a0e835a" 
                                         alt="GenPRD Interface" 
                                         class="product-screenshot">
                                </div>
                                
                                <!-- TEXT (KOMPRIMERAD LAYOUT: 20-25% Yta) - UPPDATERAD KLASS: product-text-panel -->
                                <div class="product-text-panel">
                                    <div>
                                        <!-- NY PLACERING AV TAGG -->
                                        <div class="mb-2">
                                            <span class="text-[10px] font-mono uppercase tracking-widest text-sky-400 border-b border-sky-500/30 pb-1">Ritning</span>
                                        </div>
                                        <div class="flex justify-between items-start mb-3">
                                            <!-- UPPDATERAT: Använder GenPRD branding HTML -->
                                            <h3 class="text-2xl font-bold text-white tracking-wide">
                                                <span class="genprd-brand-text">Gen<span class="genprd-text-prd">PRD</span></span>
                                            </h3>
                                            <!-- UPPDATERAT: Rensat bland taggar (3 st max för renhet) -->
                                            <div class="flex gap-3 flex-wrap justify-end">
                                                <span class="tech-badge">n8n</span>
                                                <span class="tech-badge">Supabase</span>
                                                <span class="tech-badge">AI-Native</span>
                                            </div>
                                        </div>
                                        <!-- UPPDATERAT: Copy - GenPRD tar din idé... -->
                                        <p class="text-sm text-sky-100 leading-relaxed line-clamp-3 opacity-90">
                                            GenPRD tar din idé och genererar en komplett teknisk specifikation. Få databasscheman, user flows och arkitektur optimerad för att AI-agenter ska kunna bygga din produkt direkt.
                                        </p>
                                    </div>
                                    
                                    <div class="pt-4 border-t border-white/10 light-theme:border-gray-100 flex justify-end items-center mt-2">
                                        <!-- BORTTAGET: Status-text -->
                                        <a href="https://genprd.se" target="_blank" rel="noopener noreferrer" class="text-sm font-semibold text-nord-sym-cyan hover:text-white transition-colors flex items-center gap-1">
                                            Öppna Verktyg <i class="ph-arrow-right"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- SLIDE 2: FlowVault -->
                        <div class="arch-slide absolute top-0 left-0 w-full h-full transition-all duration-500 ease-out opacity-0 translate-x-[100px] scale-95 z-10 pointer-events-none" data-index="1">
                            <!-- UPPDATERAD: Lade till klassen 'stacked-effect' -->
                            <div class="product-card stacked-effect group shadow-2xl">
                                 <!-- BORTTAGEN: System 02 taggen härifrån -->
                                
                                <!-- BILD -->
                                <div class="product-screenshot-container">
                                    <img src="https://firebasestorage.googleapis.com/v0/b/nordsym-funnel.firebasestorage.app/o/Ska%CC%88rmavbild%202026-01-10%20kl.%2013.18.25.png?alt=media&token=a2556036-81de-4d96-837d-62754b4a0f90" 
                                         alt="FlowVault Interface" 
                                         class="product-screenshot">
                                </div>
                                
                                <!-- TEXT (KOMPRIMERAD LAYOUT) - UPPDATERAD KLASS: product-text-panel -->
                                <div class="product-text-panel">
                                    <div>
                                        <!-- NY PLACERING AV TAGG -->
                                        <div class="mb-2">
                                            <span class="text-[10px] font-mono uppercase tracking-widest text-sky-400 border-b border-sky-500/30 pb-1">Motor</span>
                                        </div>
                                        <div class="flex justify-between items-start mb-3">
                                            <h3 class="text-2xl font-bold text-white tracking-wide">FlowVault</h3>
                                            <!-- UPPDATERAT: Rensat bland taggar (3 st max för renhet) -->
                                            <div class="flex gap-3 flex-wrap justify-end">
                                                <span class="tech-badge">n8n</span>
                                                <span class="tech-badge">180+ Flows</span>
                                                <span class="tech-badge">Multi-API</span>
                                            </div>
                                        </div>
                                        <!-- UPPDATERAT: Pris-info i texten -->
                                        <p class="text-sm text-sky-100 leading-relaxed line-clamp-3 opacity-90">
                                            Ett massivt bibliotek för alla scenarion. Från komplexa agent-svärmar till enkel CRM-synk. Här finns färdiga lösningar för varje tänkbar situation. (Fri tillgång för community-flöden).
                                        </p>
                                    </div>
                                    
                                    <div class="pt-4 border-t border-white/10 light-theme:border-gray-100 flex justify-end items-center mt-2">
                                        <!-- BORTTAGET: Status-text -->
                                        <!-- UPPDATERAT: "Öppna Live" -> "Öppna Valvet" -->
                                        <a href="https://flowvault.se" target="_blank" rel="noopener noreferrer" class="text-sm font-semibold text-nord-sym-cyan hover:text-white transition-colors flex items-center gap-1">
                                            Öppna Valvet <i class="ph-arrow-right"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- SLIDE 3: AEO Audit -->
                        <div class="arch-slide absolute top-0 left-0 w-full h-full transition-all duration-500 ease-out opacity-0 translate-x-[100px] scale-95 z-10 pointer-events-none" data-index="2">
                            <!-- UPPDATERAD: Lade till klassen 'stacked-effect' -->
                            <div class="product-card stacked-effect group shadow-2xl">
                                 <!-- BORTTAGEN: System 03 taggen härifrån -->
                                
                                <!-- BILD (UPPDATERAD TILL KORREKT FIREBASE URL) -->
                                <div class="product-screenshot-container">
                                    <img src="https://firebasestorage.googleapis.com/v0/b/nordsym-funnel.firebasestorage.app/o/Ska%CC%88rmavbild%202026-01-10%20kl.%2013.18.13.png?alt=media&token=4c664812-a77f-4592-b2a1-a31010c4dfb1" 
                                         alt="AEO Audit Tool" 
                                         class="product-screenshot">
                                </div>
                                
                                <!-- TEXT (KOMPRIMERAD LAYOUT) - UPPDATERAD KLASS: product-text-panel -->
                                <div class="product-text-panel">
                                    <div>
                                        <!-- NY PLACERING AV TAGG -->
                                        <div class="mb-2">
                                            <span class="text-[10px] font-mono uppercase tracking-widest text-sky-400 border-b border-sky-500/30 pb-1">Radar</span>
                                        </div>
                                        <div class="flex justify-between items-start mb-3">
                                            <!-- UPPDATERAT: Namnbyte AEO Platform -> AEO & GEO -->
                                            <h3 class="text-2xl font-bold text-white tracking-wide">AEO & GEO</h3>
                                            <!-- UPPDATERAT: Tyngre taggar här också för konsekvens -->
                                            <div class="flex gap-3 flex-wrap justify-end">
                                                <span class="tech-badge">Knowledge Graph</span>
                                                <span class="tech-badge">Semantic Analysis</span>
                                                <span class="tech-badge">Multi-Model</span>
                                            </div>
                                        </div>
                                        <!-- UPPDATERAT: Pris-info i texten -->
                                        <p class="text-sm text-sky-100 leading-relaxed line-clamp-3 opacity-90">
                                            Framtidssäkra er synlighet. En helhetsstrategi för Answer Engine Optimization (AEO), GEO och klassisk SEO. No-brainer strategi. (Paket från 1,999 kr/mån).
                                        </p>
                                    </div>
                                    
                                    <div class="pt-4 border-t border-white/10 light-theme:border-gray-100 flex justify-end items-center mt-2">
                                        <!-- BORTTAGET: Status-text -->
                                        <a href="https://nordsym.github.io/aeo-platform/" target="_blank" rel="noopener noreferrer" class="text-sm font-semibold text-nord-sym-cyan hover:text-white transition-colors flex items-center gap-1">
                                            Analysera Nu <i class="ph-arrow-right"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                    <!-- Slide Indicators -->
                    <div class="flex justify-center gap-3 mt-8">
                        <button class="arch-dot w-12 h-1 rounded-full bg-nord-sym-cyan transition-all duration-300" data-index="0"></button>
                        <button class="arch-dot w-12 h-1 rounded-full bg-sky-800 hover:bg-sky-600 transition-all duration-300" data-index="1"></button>
                        <button class="arch-dot w-12 h-1 rounded-full bg-sky-800 hover:bg-sky-600 transition-all duration-300" data-index="2"></button>
                    </div>
                </div>
            </div>
        </section>

        <!-- REPARERAD SEKTION: SYSTEM (Nu korrekt stängd ovanför) -->
        <section id="system" class="space-background-section page-content-padding" style="display: none;">
            <div class="section-content-wrapper flex-grow">
                <div class="text-center mb-20">
                     <!-- UPPDATERAT: Designkoncept "Vit Krita" & Textändring till Tjänster -->
                     <span class="inline-block px-4 py-1.5 mb-4 text-xs md:text-sm font-bold tracking-widest uppercase rounded-full border-2 border-white text-white bg-transparent shadow-[0_0_15px_rgba(255,255,255,0.1)] light-theme:bg-sky-100 light-theme:border-sky-300 light-theme:text-nord-sym-blueprint-cyan">TJÄNSTER</span>
                    
                    <!-- UPPDATERAT: Nertonad huvudrubrik (Mindre storlek, tunnare vikt) -->
                    <h3 class="text-2xl md:text-3xl font-medium text-white mt-4 light-theme:text-nord-sym-blueprint-ink max-w-3xl mx-auto leading-relaxed">Intelligent mjukvara anpassad efter er verksamhet</h3>
                </div>
                
                <!-- Pricing Grid - ÅTERSTÄLLD: 3 Kolumner -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-6xl mx-auto items-stretch">
                    
                    <!-- PAKET 1: MLP (Tidigare MIKRO-SAAS) -->
                    <div class="pricing-card card-base">
                        <div class="pricing-card-header text-center mb-4">
                            <!-- UPPDATERAT: Fullständig titel, ingen sub -->
                            <h3>MINIMUM LOVABLE PRODUCT</h3>
                        </div>
                        <div class="price-display text-center">75k <span class="price-period">SEK</span></div>
                        
                        <!-- PITCH: Bredare scope - Vi bygger det ni behöver -->
                        <p class="text-center text-sky-200 text-sm leading-relaxed mb-8 px-2">
                            Slipp standardlösningar som inte passar. Skräddarsydda verktyg som löser era specifika problem exakt så som ni vill ha det. (<a href="https://nordsym.github.io/NordSym-Scheduler/" target="_blank" rel="noopener noreferrer" class="text-nord-sym-cyan hover:text-white transition-colors underline decoration-dotted underline-offset-4">se exempel</a>)
                        </p>

                        <!-- VISUELLA FEATURES (Signaturer) -->
                        <div class="tech-signature-container justify-center mb-8 gap-6">
                            <div class="tech-signature-item">
                                <!-- Ikon: Kod -->
                                <i class="ph ph-code"></i>
                                <span>Custom Kod</span>
                            </div>
                            <div class="tech-signature-item">
                                <!-- Ikon: Måltavla/Precision -->
                                <i class="ph ph-target"></i>
                                <span>Exakt Lösning</span>
                            </div>
                        </div>

                        <div class="mt-auto flex flex-col items-center gap-4">
                            <a href="#" onclick="window.nord.showPage('boka-samtal-skraddarsydd'); return false;" class="btn-base btn-secondary-on-dark w-full">Starta Pilot</a>
                            <!-- UPPDATERAT: Disclaimer -->
                            <span class="text-[10px] text-sky-300/50 italic text-center">Exakt arkitektur definieras tillsammans med kund</span>
                        </div>
                    </div>

                    <!-- PAKET 2: OPERATIVSYSTEM (Tidigare Central Intelligens) -->
                    <div class="pricing-card card-base ignite-package">
                         <div class="pricing-card-header text-center mb-4">
                            <!-- UPPDATERAT: Enkel titel -->
                            <h3>OPERATIVSYSTEM</h3>
                        </div>
                        <div class="price-display text-center">250k <span class="price-period">SEK</span></div>
                        
                        <!-- PITCH: Fokus på "Hjärnan" och en egen plattform -->
                        <p class="text-center text-sky-200 text-sm leading-relaxed mb-8 px-2">
                            En skräddarsydd mjukvaruplattform som blir bolagets hjärna. Den samlar er data, kopplar ihop systemen och låter AI agera autonomt – men ger er full kontroll där mänskligt omdöme krävs.
                        </p>

                        <!-- VISUELLA FEATURES -->
                        <div class="tech-signature-container justify-center mb-6 gap-6">
                            <div class="tech-signature-item">
                                <!-- Ikon: Nätverk/Hub -->
                                <i class="ph ph-circles-three-plus"></i>
                                <span>Data-Hub</span>
                            </div>
                            <div class="tech-signature-item">
                                <!-- Ikon: Hjärna/Blixt -->
                                <i class="ph ph-brain"></i>
                                <span>AI-Beslut</span>
                            </div>
                            <div class="tech-signature-item">
                                <!-- Ikon: Reglage/Kontroll -->
                                <i class="ph ph-sliders"></i>
                                <span>Kontroll</span>
                            </div>
                        </div>
                        
                        <!-- NYTT: GenPRD länk kvar -->
                        <div class="mb-6 flex flex-col gap-1.5 text-center">
                            <p class="text-xs text-sky-300/70">
                                Behöver ni en ritning? <a href="https://genprd.se" target="_blank" rel="noopener noreferrer" class="text-nord-sym-cyan hover:text-white transition-colors underline decoration-dotted underline-offset-4">Testa GenPRD</a>
                            </p>
                        </div>

                         <div class="mt-auto flex flex-col items-center gap-4">
                            <!-- UPPDATERAT: "Starta Transformation" -> "Diskutera Behov" -->
                            <a href="#" onclick="window.nord.showPage('boka-samtal-skraddarsydd'); return false;" class="btn-base btn-cta-revised w-full">Diskutera Behov</a>
                            <!-- UPPDATERAT: Disclaimer -->
                            <span class="text-[10px] text-sky-300/50 italic text-center">Exakt arkitektur definieras tillsammans med kund</span>
                        </div>
                    </div>

                    <!-- PAKET 3: STÖRRE PROJEKT (Tidigare AI-FIRST) -->
                    <div class="pricing-card card-base">
                         <div class="pricing-card-header text-center mb-4">
                            <!-- UPPDATERAT: Enkel titel -->
                            <h3>STÖRRE PROJEKT</h3>
                        </div>
                        <div class="price-display text-center">500k+ <span class="price-period">SEK</span></div>
                        
                        <!-- PITCH: Fokus på scope och diskussion -->
                        <p class="text-center text-sky-200 text-sm leading-relaxed mb-8 px-2">
                            För komplexa behov där standardlösningar inte räcker. Vi går in som teknisk partner och definierar leverans och omfattning helt baserat på ert unika scope och era affärsmål.
                        </p>

                        <!-- VISUELLA FEATURES -->
                        <div class="tech-signature-container justify-center mb-8 gap-6">
                            <div class="tech-signature-item">
                                <!-- Ikon: Strategi/Schackpjäs -->
                                <i class="ph ph-strategy"></i>
                                <span>Strategi</span>
                            </div>
                            <div class="tech-signature-item">
                                <!-- Ikon: Kompass/Arkitektur (Ersätter Dedikerat Team) -->
                                <i class="ph ph-compass-tool"></i>
                                <span>Arkitektur</span>
                            </div>
                            <div class="tech-signature-item">
                                <!-- Ikon: Nätverk/Distribution (AI-Orkestrering) -->
                                <i class="ph ph-share-network"></i>
                                <span>AI-Orkestrering</span>
                            </div>
                        </div>

                         <div class="mt-auto flex flex-col items-center gap-4">
                            <a href="#" onclick="window.nord.showPage('boka-samtal-skraddarsydd'); return false;" class="btn-base btn-secondary-on-dark w-full">Diskutera Behov</a>
                            <!-- UPPDATERAT: Disclaimer -->
                            <span class="text-[10px] text-sky-300/50 italic text-center">Exakt arkitektur definieras tillsammans med kund</span>
                        </div>
                    </div>
                </div>

                <!-- BORTTAGET: KOMPAKT AGENT-MODUL (Designa en gratis agent) -->
                
                <!-- Support Text -->
                <div class="text-center mt-16 max-w-3xl mx-auto">
                    <p class="text-lg text-sky-200"><strong>Drift & Förvaltning:</strong> 15k SEK/mån.</p>
                    <!-- UPPDATERAT: Partnerskaps-fokus -->
                    <p class="text-md text-sky-300 mt-2">Det är här partnerskapet börjar. NordSym garanterar driften, utvecklar nya features och växer med er verksamhet.</p>
                </div>

                <!-- NY PLACERING: FOUNDER BADGE (Ovanför FAQ) -->
                <div class="text-center mt-20 mb-8">
                    <!-- UPPDATERAT: Designkoncept "Vit Krita" (White Chalk) -->
                    <button onclick="window.nord.openFounderModal()" class="inline-flex items-center gap-3 bg-transparent border border-white rounded-full pr-6 pl-2 py-2 backdrop-blur-md transition-all duration-300 hover:scale-105 hover:bg-white/10 hover:shadow-[0_0_20px_rgba(255,255,255,0.2)] cursor-pointer light-theme:bg-white light-theme:border-gray-200 light-theme:shadow-md light-theme:hover:shadow-xl group">
                        <img src="https://firebasestorage.googleapis.com/v0/b/nordsym-funnel.firebasestorage.app/o/T2ZJ4JKR_400x400.jpg?alt=media&token=b0449d0a-bedc-462d-98f9-1258890f2391" alt="Gustav Hemmingsson" class="w-10 h-10 rounded-full object-cover shadow-sm group-hover:shadow-md transition-shadow">
                        <div class="text-left">
                            <div class="text-white text-sm font-bold leading-none light-theme:text-gray-900">Gustav Hemmingsson</div>
                            <div class="text-white/80 text-[10px] uppercase tracking-wider font-mono mt-0.5 light-theme:text-sky-600 group-hover:text-white light-theme:group-hover:text-sky-700 transition-colors">Grundare</div>
                        </div>
                        <i class="ph-info text-white/70 group-hover:text-white ml-1 text-lg light-theme:text-gray-400 light-theme:group-hover:text-sky-500 transition-colors"></i>
                    </button>
                </div>

                <!-- FAQ Section -->
                <!-- UPPDATERAT: Lade till ID för att kunna länka från footern -->
                <div id="faq-section" class="max-w-4xl mx-auto mt-8">
                    <h3 class="text-3xl font-bold text-white text-center mb-10 light-theme:text-nord-sym-blueprint-ink" style="font-family: 'Comfortaa', sans-serif;">Vanliga frågor</h3>
                    <div class="space-y-4">
                        <details class="faq-item group">
                            <summary class="faq-question">
                                <!-- UPPDATERAT: Rakt på sak - Vad får man för pengarna? -->
                                <span>Vad får vi för investeringen?</span>
                                <i class="ph-caret-down faq-icon"></i>
                            </summary>
                            <div class="faq-answer">
                                <!-- UPPDATERAT: Svarar på både VAD och NÄR -->
                                Konkreta resultat i produktion, ofta inom 4-8 veckor. Vi fokuserar på snabb 'time-to-value' så att ni ser mätbar avkastning direkt, istället för långdragna förstudier.
                            </div>
                        </details>
                        <details class="faq-item group">
                            <summary class="faq-question">
                                <span>Äger vi koden?</span>
                                <i class="ph-caret-down faq-icon"></i>
                            </summary>
                            <div class="faq-answer">
                                <!-- UPPDATERAT: Nyanserat svar om äganderätt -->
                                Det beror på uppdraget. Skräddarsydd affärslogik äger ni oftast, medan generella plattformskomponenter licensieras. Vi anpassar äganderätten helt efter era önskemål.
                            </div>
                        </details>
                        <details class="faq-item group">
                            <summary class="faq-question">
                                <span>Kan ni integrera med våra gamla system?</span>
                                <i class="ph-caret-down faq-icon"></i>
                            </summary>
                            <div class="faq-answer">
                                Absolut. Bryggor byggs mellan moderna AI-modeller och era befintliga affärssystem (ERP, CRM), oavsett ålder.
                            </div>
                        </details>
                        <details class="faq-item group">
                            <summary class="faq-question">
                                <span>Vad händer efter leverans?</span>
                                <i class="ph-caret-down faq-icon"></i>
                            </summary>
                            <div class="faq-answer">
                                <!-- UPPDATERAT: Bättre formulering om uppdateringar -->
                                NordSym erbjuder avtal för drift och förvaltning. Systemet övervakas proaktivt, säkerhetsuppdateringar hanteras och era AI-modeller hålls alltid uppdaterade.
                            </div>
                        </details>
                    </div>
                </div>
            </div>
        </section>

        <!-- UPPSTÄDAD: RITBORDET LOBBY (Enklare, mindre rörig) -->
        <section id="ritbordet" class="space-background-section" style="display: none;">
            <div id="ritbordet-lobby" class="section-content-wrapper">
                <div class="text-center mb-16">
                    <!-- UPPDATERAT: Designkoncept "Vit Krita" -->
                    <span class="inline-block px-4 py-1.5 mb-4 text-xs md:text-sm font-bold tracking-widest uppercase rounded-full border-2 border-white text-white bg-transparent shadow-[0_0_15px_rgba(255,255,255,0.1)] light-theme:bg-sky-100 light-theme:border-sky-300 light-theme:text-nord-sym-blueprint-cyan">R&D</span>
                    <h2 class="text-3xl md:text-4xl font-bold text-white mb-6 light-theme:text-nord-sym-blueprint-ink" style="font-family: 'Comfortaa', sans-serif;">Gaming + AI + Three.js</h2>
                    <p class="text-sky-100/80 max-w-3xl mx-auto text-lg leading-relaxed light-theme:text-nord-sym-blueprint-text-secondary">
                        <!-- UPPDATERAT: Nertonad, saklig copy -->
                        Här experimenterar vi med WebGL och AI. Vi testar gränserna för vad som är möjligt att köra direkt i en webbläsare, med fokus på spelmekanik och interaktiva gränssnitt.
                    </p>
                </div>
                
                <div class="max-w-5xl mx-auto w-full">
                    <!-- Förenklad Grid för både Desktop & Mobil -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        
                        <!-- Kort 1: Tekniken (Varför?) -->
                        <!-- UPPDATERAT: Lade till onmouseenter för geometriner -->
                        <div class="ritbordet-card card-base group hover:-translate-y-2 transition-all duration-300 cursor-default" onmouseenter="if(window.UnifiedGeometryManager) window.UnifiedGeometryManager.nudgeGeometry()">
                            <i class="ph-code-block text-4xl mb-4"></i>
                            <!-- UPPDATERAT: Fokus på teknisk nytta -->
                            <h4 class="text-xl font-bold mb-2">Varför Three.js?</h4>
                            <!-- UPPDATERAT: Saklig förklaring -->
                            <p>Traditionell 3D kräver tunga nedladdningar. Med Three.js och AI kan vi generera innehåll direkt i webbläsaren ("procedurellt"). Det ger snabba, lättviktiga upplevelser tillgängliga överallt.</p>
                            <!-- Ingen CTA här, ren info -->
                        </div>

                        <!-- Mitt: Verktyget (Prova själv) -->
                        <!-- UPPDATERAT: Lade till onmouseenter för geometriner -->
                        <div class="ritbordet-card card-base group border-sky-500 hover:shadow-[0_0_40px_rgba(0,212,255,0.3)] transition-all duration-300 cursor-pointer text-center py-10" onclick="window.UnifiedGeometryManager.enterBuilderMode()" onmouseenter="if(window.UnifiedGeometryManager) window.UnifiedGeometryManager.nudgeGeometry()">
                            <div class="w-20 h-20 bg-sky-900/50 rounded-full flex items-center justify-center mx-auto mb-6 border border-sky-400/30 group-hover:scale-110 transition-transform">
                                <i class="ph ph-cube text-4xl text-nord-sym-cyan"></i>
                            </div>
                            <!-- UPPDATERAT: Tydlig uppmaning -->
                            <h4 class="text-2xl font-bold mb-2 text-white">Prova Tekniken</h4>
                            <!-- UPPDATERAT: Förklara att det är live -->
                            <p>Detta är en live-demonstration. Gå in i verkstaden för att rotera objektet, byta visuella teman och testa fysikmotorn i realtid.</p>
                            <!-- UPPDATERAT: "Gå till Verkstaden" -> "Starta" (Mindre cringe) -->
                            <button class="mt-6 btn-base btn-cta-revised px-6">Starta</button>
                        </div>

                        <!-- Kort 3: Gaming R&D -->
                        <!-- UPPDATERAT: Länkar tillbaka till modal (väntelista) istället för X + onmouseenter -->
                        <div class="ritbordet-card card-base group hover:-translate-y-2 transition-all duration-300 cursor-pointer" onclick="window.nord.openDynamicWaitlist('gaming')" onmouseenter="if(window.UnifiedGeometryManager) window.UnifiedGeometryManager.nudgeGeometry()">
                            <i class="ph-game-controller text-4xl mb-4"></i>
                            <!-- UPPDATERAT: Saklig titel -->
                            <h4 class="text-xl font-bold mb-2">Gaming R&D</h4>
                            <!-- UPPDATERAT: Rensat bort den långa meningen om prototyper -->
                            <p>AI-genererade spel är en sektor som växer snabbt.</p>
                            <!-- UPPDATERAT: Enkel text för intresselista -->
                            <span class="text-sky-300 text-sm mt-4 inline-block group-hover:text-white font-semibold">Följ projektet →</span>
                        </div>

                    </div>
                </div>
            </div>
        </section>

        <section id="boka-samtal-skraddarsydd" class="space-background-section page-content-padding" style="display: none;">
            <div class="section-content-wrapper text-center">
                <!-- UPPDATERAT: Från "Starta er systemresa" till något konkret -->
                <h2 class="text-4xl md:text-5xl font-extrabold text-white mb-8">Diskutera ert Case</h2>
                <!-- UPPDATERAT: Från "självgående ekosystem/vision" till problemlösning -->
                <p class="text-lg text-content-dark-bg max-w-xl mx-auto mb-10">Beskriv utmaningen ni står inför. NordSym återkommer med ett konkret förslag på hur vi kan bygga bort problemet.</p>
                <div id="formSkraddarsyddContainer" class="form-container p-8 md:p-12 mt-10 max-w-lg mx-auto text-left">
                    <h3 class="text-2xl font-semibold text-white mb-2 text-center">Kontaktinformation</h3>
                    <div class="form-progress-bar">
                        <div class="form-progress-bar-inner"></div>
                    </div>
                    <form id="formSkraddarsydd">
                        <input type="hidden" name="_subject" value="Ny förfrågan: Systemdiskussion från NordSym">
                        <div class="form-step active" data-step="1">
                            <div class="space-y-6">
                                <div><label for="skraddarsydd-name" class="form-label">Ditt Namn</label><input type="text" name="name" id="skraddarsydd-name" required class="form-input"></div>
                                <div><label for="skraddarsydd-company" class="form-label">Företagsnamn</label><input type="text" name="company" id="skraddarsydd-company" required class="form-input"></div>
                                <div><label for="skraddarsydd-email" class="form-label">E-post</label><input type="email" name="email" id="skraddarsydd-email" required class="form-input"></div>
                            </div>
                             <div class="form-navigation">
                                <span></span>
                                <button type="button" class="btn-base btn-cta-revised">Nästa <i class="ph-arrow-right"></i></button>
                            </div>
                        </div>
                        <div class="form-step" data-step="2">
                            <div class="space-y-6">
                                <!-- UPPDATERAT: Renare etikett -->
                                <div><label for="skraddarsydd-phone" class="form-label">Telefon</label><input type="tel" name="phone" id="skraddarsydd-phone" class="form-input"></div>
                                <!-- UPPDATERAT: Rakare fråga + guidande placeholder -->
                                <div>
                                    <label for="skraddarsydd-main-goal" class="form-label">Beskriv utmaningen</label>
                                    <textarea name="main-goal" id="skraddarsydd-main-goal" rows="3" class="form-textarea" required placeholder="Vad hindrar er från att växa? Manuella flöden, datakaos eller saknade integrationer?"></textarea>
                                </div>
                            </div>
                            <div class="form-navigation">
                                <button type="button" class="btn-base btn-secondary-on-dark"><i class="ph-arrow-left"></i> Föregående</button>
                                <!-- UPPDATERAT: Mer korrekt knapptext för ett formulär -->
                                <button type="submit" class="btn-base btn-cta-revised">Skicka förfrågan</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </section>
        
        <section id="privacy-policy-en" class="space-background-section page-content-padding" style="display: none;">
            <div class="section-content-wrapper">
                <div class="legal-content-container max-w-4xl mx-auto text-left">
                    <h2 class="section-title text-4xl md:text-5xl mb-8 text-center">Privacy Policy</h2>
                    <div class="legal-content-card">
                        <p><strong>Last Updated: July 3, 2025</strong></p>
                        <!-- UPPDATERAT: contact@nordsym.com för företagsinfo -->
                        <h4><i class="ph-info"></i>About This Policy</h4><p>NordSym AB (Swedish Org. No. 559535-5768) values your trust and privacy. This Privacy Policy describes how we collect, use, and protect your personal data when you visit our website or use our services.</p>
                        <h4><i class="ph-user-circle"></i>Who We Are</h4><p>NordSym AB<br>Organization Number: 559535-5768<br>Email: <a href="mailto:contact@nordsym.com">contact@nordsym.com</a><br>Website: nordsym.com</p><p>We are the data controller for the processing of personal data described in this policy.</p>
                        <h4><i class="ph-database"></i>What Personal Data We Collect</h4><ul><li><strong>Contact Forms and Inquiries:</strong> Name and contact details (email, phone), company information, job title, and a description of your needs.</li><li><strong>Job Applications:</strong> Name, contact details, CV, professional background, relevant links (LinkedIn, etc.), and a motivational description.</li><li><strong>Website Usage:</strong> Anonymized IP address, browser information, and user interaction via cookies.</li><li><strong>Client and Project Data:</strong> Business processes, technical requirements, and communication history necessary for project delivery.</li></ul>
                        <h4><i class="ph-arrows-clockwise"></i>Why We Process Your Personal Data</h4><p>We process your data to fulfill our commitments (Art. 6.1.b GDPR), such as responding to inquiries and delivering services. We also have a legitimate interest (Art. 6.1.f GDPR) in developing our services and communicating with potential clients. For certain marketing activities, we obtain your consent (Art. 6.1.a GDPR).</p>
                        <h4><i class="ph-share-network"></i>Data Sharing and Third Parties</h4><p>We use trusted service providers such as Formspree, Google Analytics, Microsoft 365, Notion, Airtable, GitHub, and leading AI platforms (Anthropic, OpenAI) as well as automation tools (Make, n8n) to conduct our business. All providers are selected to comply with GDPR requirements. We ensure an adequate level of protection for any transfers of data outside the EU/EEA.</p>
                        <!-- UPPDATERAT: support@nordsym.com för ärenden -->
                        <h4><i class="ph-shield-check"></i>Your Rights</h4><p>You have the right to access, rectify, erase, restrict, and port your personal data, and to object to its processing. You can also withdraw your consent at any time. Contact <a href="mailto:support@nordsym.com">support@nordsym.com</a> to exercise your rights.</p>
                        <h4><i class="ph-chats-circle"></i>Contact and Complaints</h4><p>For questions, contact us at <a href="mailto:support@nordsym.com">support@nordsym.com</a>. Complaints can be filed with the Swedish Authority for Privacy Protection (IMY).</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="terms-of-service-en" class="space-background-section page-content-padding" style="display: none;">
            <div class="section-content-wrapper">
                <div class="legal-content-container max-w-4xl mx-auto text-left">
                    <h2 class="section-title text-4xl md:text-5xl mb-8 text-center">Terms of Service</h2>
                    <div class="legal-content-card">
                        <p><strong>Last Updated: July 3, 2025</strong></p>
                        <h4><i class="ph-file-text"></i>General</h4><p>These Terms of Service govern your use of the NordSym AB ("we", "us", "NordSym") website (nordsym.com) and services. By using our services, you accept these terms.</p>
                        <h4><i class="ph-user-gear"></i>User Responsibilities</h4><p>You are responsible for providing accurate information and for not using our services for illegal purposes. You may not reverse engineer our systems or resell our services without written approval.</p>
                        <h4><i class="ph-detective"></i>Intellectual Property and Data Ownership</h4><p>NordSym äger våra algoritmer, metoder och ramverk. Du som kund behåller full äganderätt till dina affärsdata och de specifika resultat som genereras av dina data. För skräddarsydda AI-agenter utvecklade specifikt för dig, tillhör äganderätten dig, medan den underliggande tekniska plattformen förblir vår egendom.</p>
                        <h4><i class="ph-scales"></i>Limitation of Liability</h4><p>We are not liable for indirect damages such as lost profits or data. Our total liability is limited to the amount paid for the specific service. We do not guarantee specific business results or ROI, although that is our goal.</p>
                        <h4><i class="ph-gavel"></i>Governing Law and Disputes</h4><p>These terms are governed by Swedish law. Disputes shall primarily be resolved through negotiation. If an agreement cannot be reached, the dispute shall be settled by a Swedish court.</p>
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <div id="coming-soon-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-nord-sym-deep-space-blue/80 backdrop-blur-sm opacity-0 pointer-events-none">
        <div class="modal-content-wrapper form-container p-8 md:p-12 max-w-lg w-full m-4 relative scale-95 text-center">
            <button onclick="window.nord.closeComingSoonModal()" class="absolute top-4 right-4 text-sky-300 hover:text-nord-sym-cyan transition-colors text-2xl" aria-label="Stäng modal">
                <i class="ph-x"></i>
            </button>
            <i id="modal-waitlist-icon" class="ph-rocket-launch text-4xl text-nord-sym-cyan mb-4"></i>
            <h3 id="modal-waitlist-title" class="text-2xl font-semibold text-white mb-2">Demonstration under utveckling</h3>
            <p id="modal-waitlist-desc" class="text-sky-300 mb-4">Vi håller på att färdigställa den interaktiva demon. Skriv upp dig så meddelar vi när den är redo.</p>
            
            <!-- DYNAMISK LÄNK (Tjuvkika) -->
            <a id="modal-waitlist-link" href="#" target="_blank" rel="noopener noreferrer" class="inline-block text-nord-sym-cyan hover:text-white transition-colors text-sm mb-6 font-medium underline decoration-dotted underline-offset-4 hidden">
                <!-- Text injiceras via JS -->
            </a>
            
            <!-- VÄNTELISTA FORMULÄR -->
            <form id="waitlistForm" class="text-left mt-0">
                <input type="hidden" id="modal-waitlist-subject" name="_subject" value="Ny anmälan: Väntelista">
                <div class="space-y-4">
                    <div>
                        <label for="waitlist-email" class="form-label sr-only">E-post</label>
                        <input type="email" name="email" id="waitlist-email" required class="form-input text-center" placeholder="Din e-postadress">
                    </div>
                    <button type="submit" class="btn-base btn-cta-revised w-full">Bevaka lansering</button>
                </div>
                <div class="form-success-container hidden mt-4">
                    <p class="text-nord-sym-cyan"><i class="ph-check-circle"></i> Du är uppskriven!</p>
                </div>
            </form>
        </div>
    </div>

    <!-- NYTT: FOUNDER MODAL -->
    <div id="founder-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-nord-sym-deep-space-blue/80 backdrop-blur-sm opacity-0 pointer-events-none">
        <!-- UPPDATERAT: Tog bort 'light-theme:border-gray-200' och lade till 'shadow-2xl' för mjukare look utan vassa kanter -->
        <div class="modal-content-wrapper form-container p-8 md:p-10 max-w-md w-full m-4 relative scale-95 flex flex-col items-center text-center light-theme:bg-white light-theme:shadow-2xl border-none">
            <button onclick="window.nord.closeFounderModal()" class="absolute top-4 right-4 text-sky-300 hover:text-nord-sym-cyan transition-colors text-2xl light-theme:text-gray-400 light-theme:hover:text-sky-600" aria-label="Stäng modal">
                <i class="ph-x"></i>
            </button>
            
            <div class="relative mb-6">
                <div class="absolute inset-0 bg-nord-sym-cyan blur-2xl opacity-20 rounded-full light-theme:opacity-10"></div>
                <img src="https://firebasestorage.googleapis.com/v0/b/nordsym-funnel.firebasestorage.app/o/T2ZJ4JKR_400x400.jpg?alt=media&token=b0449d0a-bedc-462d-98f9-1258890f2391" alt="Gustav Hemmingsson" class="w-32 h-32 rounded-full object-cover border-2 border-nord-sym-cyan shadow-2xl relative z-10 light-theme:border-sky-500 light-theme:shadow-xl">
            </div>
            
            <h3 class="text-3xl font-bold text-white mb-1 light-theme:text-gray-900" style="font-family: 'Comfortaa', sans-serif;">Gustav Hemmingsson</h3>
            <p class="text-nord-sym-cyan font-mono text-xs uppercase tracking-widest mb-6 light-theme:text-sky-600">Grundare</p>
            
            <!-- UPPDATERAT: Skarpare grundar-pitch (Bytt 'Suveränitet' mot 'Försprång') -->
            <p class="text-sky-200 leading-relaxed mb-8 light-theme:text-gray-600 text-sm md:text-base">
                Vi bygger intelligens, ni skördar resultaten. NordSym säkerställer att ni har marknadens vassaste infrastruktur, utan att ni behöver bli experter på koden under huven. Ett partnerskap för teknologiskt försprång.
            </p>
            
            <!-- NYTT: Direktlänk till Scheduler -->
            <a href="https://nordsym.github.io/NordSym-Scheduler/" target="_blank" rel="noopener noreferrer" class="btn-base btn-cta-revised w-full mb-6 flex items-center justify-center gap-2">
                <span>Boka Intro</span>
                <i class="ph-calendar-check text-lg"></i>
            </a>
            
            <div class="grid grid-cols-4 gap-3 w-full">
                <!-- BALANSERADE KNAPPAR FÖR LIGHT/DARK (Tillagd 'ph' klass för säker rendering) -->
                <a href="https://www.linkedin.com/company/nordsym-ab/" target="_blank" rel="noopener noreferrer" class="btn-base text-sm py-3 flex items-center justify-center transition-all" aria-label="LinkedIn">
                    <i class="ph ph-linkedin-logo text-2xl"></i>
                </a>
                <a href="https://github.com/nordsym" target="_blank" rel="noopener noreferrer" class="btn-base text-sm py-3 flex items-center justify-center transition-all" aria-label="GitHub">
                    <i class="ph ph-github-logo text-2xl"></i>
                </a>
                <a href="https://x.com/NordSym" target="_blank" rel="noopener noreferrer" class="btn-base text-sm py-3 flex items-center justify-center transition-all" aria-label="X (Twitter)">
                    <i class="ph ph-twitter-logo text-2xl"></i>
                </a>
                <a href="https://www.instagram.com/nordsym_ab/" target="_blank" rel="noopener noreferrer" class="btn-base text-sm py-3 flex items-center justify-center transition-all" aria-label="Instagram">
                    <i class="ph ph-instagram-logo text-2xl"></i>
                </a>
            </div>
        </div>
    </div>

    <!-- BORTTAGET: FREE AGENT MODAL -->
    
    <footer id="main-footer" class="relative bg-nord-sym-deep-space-blue">
        <!-- BORTTAGEN DUBBLETT AV FOOTER-TAGG HÄR -->
        <div class="section-content-wrapper py-10 relative z-10">
            <div class="grid md:grid-cols-3 gap-8 text-sm">
                <div class="md:col-span-1 flex flex-col items-center md:items-start text-center md:text-left">
                    <a href="#" onclick="window.nord.showPage('hero'); return false;" class="inline-block mb-4">
                        <img src="https://raw.githubusercontent.com/GusHem/Logga-utan-text/refs/heads/main/Final%20logo%20no%20text.svg" alt="NordSym Logotyp" class="h-16" loading="lazy" decoding="async">
                    </a>
                    
                    <p class="text-sm font-bold text-white mb-1">Framtidsförsäkra eran verksamhet</p>
                    <p class="text-xs text-sky-200 mb-4" style="color: rgba(255,255,255,0.7);">NordSym hjälper er att bli ett AI-First företag.</p>
                    <a href="#" onclick="window.nord.showPage('boka-samtal-skraddarsydd'); return false;" class="btn-base btn-service-cta text-xs px-6 py-2 mb-6">Boka Strategisamtal</a>

                </div>
                <div class="md:col-span-1 text-center md:text-left">
                    <p class="font-semibold text-nord-sym-text-light mb-2" style="color: #ffffff;">Snabblänkar</p>
                    <div class="footer-quicklinks">
                        <a href="#" onclick="window.nord.showPage('om-oss'); return false;" class="footer-link">Micro-SaaS</a>
                        <!-- UPPDATERAT: System -> Tjänster -->
                        <a href="#" onclick="window.nord.showPage('system'); return false;" class="footer-link">Tjänster</a>
                        <!-- UPPDATERAT: Ritbordet -> R&D -->
                        <a href="#" onclick="window.nord.showPage('ritbordet'); return false;" class="footer-link">R&D</a>
                        <!-- NYTT: Länk till FAQ -->
                        <a href="#" onclick="window.nord.showPage('system'); setTimeout(() => window.nord.smoothScrollTo('#faq-section'), 600); return false;" class="footer-link">Vanliga frågor</a>
                    </div>
                </div>
                <div class="md:col-span-1 text-center md:text-left">
                     <!-- UPPDATERAT: Följ Oss -> Följ NordSym -->
                     <p class="font-semibold text-nord-sym-text-light mb-4" style="color: #ffffff;">Följ NordSym</p>
                     
                     <!-- UPPDATERAT: Endast ikoner, horisontell layout, större storlek (2xl) -->
                     <div class="flex gap-5 justify-center md:justify-start items-center">
                        <a href="https://www.linkedin.com/company/nordsym-ab/" target="_blank" rel="noopener noreferrer" class="footer-link group" aria-label="LinkedIn">
                            <i class="ph ph-linkedin-logo text-2xl group-hover:scale-110 transition-transform duration-200"></i>
                        </a>
                        <a href="https://github.com/nordsym" target="_blank" rel="noopener noreferrer" class="footer-link group" aria-label="GitHub">
                            <i class="ph ph-github-logo text-2xl group-hover:scale-110 transition-transform duration-200"></i>
                        </a>
                        <a href="https://x.com/NordSym" target="_blank" rel="noopener noreferrer" class="footer-link group" aria-label="X (Twitter)">
                            <i class="ph ph-twitter-logo text-2xl group-hover:scale-110 transition-transform duration-200"></i>
                        </a>
                        <a href="https://www.instagram.com/nordsym_ab/" target="_blank" rel="noopener noreferrer" class="footer-link group" aria-label="Instagram">
                            <i class="ph ph-instagram-logo text-2xl group-hover:scale-110 transition-transform duration-200"></i>
                        </a>
                    </div>

                    <!-- GDPR LOGO (Solid, Smaller & Clean) -->
                    <div class="mt-8 flex flex-col items-center md:items-start opacity-60 hover:opacity-100 transition-opacity duration-300 select-none cursor-help" title="Dataskydd och Integritet">
                        <svg width="100" height="32" viewBox="0 0 140 45" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-nord-sym-text-light">
                            <!-- Huvudtext "GDPR" (Solid - Inget mask-hål) -->
                            <text x="0" y="28" font-family="'Inter', sans-serif" font-weight="900" font-size="32" fill="currentColor" letter-spacing="-1">GDPR</text>
                            
                            <!-- Undertitel "COMPLIANT" -->
                            <text x="2" y="42" font-family="'Inter', sans-serif" font-weight="700" font-size="10" fill="currentColor" letter-spacing="4.5">COMPLIANT</text>
                        </svg>
                    </div>

                </div>
            </div>
            <div class="mt-8 border-t border-sky-700/50 pt-6 text-center text-xs text-content-dark-bg space-x-4" style="border-color: rgba(255,255,255,0.15);">
                <span style="color: rgba(255,255,255,0.5);">© <span id="currentYear"></span> NordSym.</span>
                <a href="#privacy-policy-en" onclick="window.nord.showPage('privacy-policy-en'); return false;" class="footer-link hover:underline ml-4">Privacy Policy</a>
                <a href="#terms-of-service-en" onclick="window.nord.showPage('terms-of-service-en'); return false;" class="footer-link hover:underline">Terms of Service</a>
            </div>
        </div>
    </footer>
    
    <!-- CHAT WIDGET CONTAINER RENSAD - Bubblan är borta -->
    
    <!-- COOKIE CONSENT BANNER -->
    <div id="cookie-consent">
        <div class="flex flex-col">
            <div class="flex items-center gap-3 mb-3">
                <i class="ph-cookie text-2xl text-nord-sym-cyan"></i>
                <span class="font-bold text-white text-sm light-theme:text-nord-sym-blueprint-ink" style="font-family: 'Comfortaa', sans-serif;">Digital Integritet</span>
            </div>
            <p>
                Vi använder cookies för att optimera systemets prestanda. Genom att fortsätta godkänner du vår <a href="#" onclick="window.nord.showPage('privacy-policy-en'); return false;">Integritetspolicy</a>.
            </p>
            <button id="cookie-accept-btn" class="btn-base btn-cta-revised w-full py-2 text-sm">
                OK, jag förstår
            </button>
        </div>
    </div>

    <!-- NORDGPT FULLSCREEN INTERFACE (Ligger utanför allt annat) -->
    <div id="fullscreen-chat-interface">
        <!-- Sidebar (Historik) -->
        <div class="chat-sidebar">
            <div class="flex items-center gap-2 mb-6 opacity-70">
                <i class="ph-clock-counter-clockwise text-lg"></i>
                <span class="text-xs font-bold uppercase tracking-widest">Tidigare Sessioner</span>
            </div>
            <div id="chat-history-list" class="flex flex-col overflow-y-auto flex-grow">
                <!-- Dynamisk lista -->
            </div>
            <div class="mt-auto pt-4 border-t border-white/10">
                <button onclick="window.nord.clearChatHistory()" class="text-xs text-red-400 hover:text-red-300 flex items-center gap-2 transition-colors">
                    <i class="ph-trash"></i> Rensa historik
                </button>
            </div>
        </div>

        <!-- Main Area -->
        <div class="chat-main-area">
            <!-- Top Bar -->
            <div class="chat-top-bar">
                <!-- NYTT: Tema-växlare inne i chatten -->
                <button class="theme-toggle-btn mr-4" aria-label="Växla ljus/mörkt tema">
                    <i class="ph ph-sun"></i>
                </button>

                <!-- UPPDATERAT: Tydligare Stäng-knapp med text -->
                <button class="chat-close-btn flex items-center gap-2 px-4 w-auto rounded-full border border-white/10 hover:bg-white/10 transition-colors" onclick="window.nord.closeFullscreenChat()" aria-label="Stäng chatt">
                    <span class="text-sm font-medium">Stäng</span>
                    <i class="ph-x text-lg"></i>
                </button>
            </div>

            <!-- Scroll Container -->
            <div class="chat-scroll-container" id="chat-scroll-container">
                <div class="chat-content-width" id="fullscreen-chat-messages">
                    <!-- Meddelanden renderas här -->
                </div>
            </div>

            <!-- Sticky Input -->
            <div class="chat-input-wrapper">
                <div class="chat-main-input-container">
                    <textarea id="chat-main-textarea" rows="1" placeholder="Skriv ett meddelande..." oninput="this.style.height = ''; this.style.height = this.scrollHeight + 'px'"></textarea>
                    <button id="chat-main-send-btn">
                        <i class="ph-paper-plane-right-fill text-lg"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- === UI OVERLAYS & FIXED CONTROLS (ARKITEKTONISK SEPARATION) === -->
    
    <!-- GHOST HINTS (Ersätter den gamla modala rutan) -->
    <div id="workshop-ghost-hints">
        <div class="ghost-hint-text">Scrolla för att Transformera</div>
        <div class="ghost-hint-sub">Dra för att Rotera</div>
    </div>

    <!-- BORTTAGET: Gammal #workshop-onboarding kod -->

    <button id="mobile-enter-workshop-btn" onclick="window.UnifiedGeometryManager.enterBuilderMode()">
        <i class="ph ph-cube"></i>
    </button>
    <button id="toolbar-toggle" class="glass-btn" title="Visa verktyg">
        <i class="ph ph-list"></i>
    </button>
    <button id="joystick-portal-left" class="joystick-portal" title="Rotationskontroll">
        <i class="ph ph-arrows-out-cardinal"></i>
    </button>
    <button id="joystick-portal-right" class="joystick-portal" title="Gå in/ut ur verkstad">
        <div class="portal-ring portal-ring-outer"></div>
        <div class="portal-ring portal-ring-inner"></div>
        <i class="ph-atom portal-icon-enter"></i>
        <i class="ph-x portal-icon-exit"></i>
    </button>

    <!-- NYTT KORREKT ID: #workshop-toolbar -->
    <div id="workshop-toolbar">
        
        <div class="geo-btn-wrapper" onclick="window.nord.unifiedGeometry.handleThemeClick('fundamental')" title="Bas">
            <div class="geo-btn" data-theme="fundamental">◎</div>
        </div>

        <div class="geo-btn-wrapper" onclick="window.nord.unifiedGeometry.handleThemeClick('struktur')" title="Geometri">
            <div class="geo-btn" data-theme="struktur">◉</div>
        </div>

        <div class="geo-btn-wrapper" onclick="window.nord.unifiedGeometry.handleThemeClick('flode')" title="Nätverk">
            <div class="geo-btn" data-theme="flode">◊</div>
        </div>

        <div class="geo-btn-wrapper" onclick="window.nord.unifiedGeometry.handleThemeClick('precision')" title="Kristall">
            <div class="geo-btn" data-theme="precision">Ψ</div>
        </div>

        <div class="geo-btn-wrapper" onclick="window.nord.unifiedGeometry.handleThemeClick('paradigm')" title="Abstrakt">
            <div class="geo-btn" data-theme="paradigm">∞</div >
        </div>

        <div class="geo-btn-wrapper" onclick="window.nord.unifiedGeometry.handleThemeClick('ekosystem')" title="Rymd">
            <div class="geo-btn" data-theme="ekosystem">⟠</div>
        </div>
        
        <div class="geo-separator"></div>
        
        <div class="geo-btn-wrapper" onclick="window.nord.unifiedGeometry.handleParticleClick()" title="Partiklar">
            <div class="geo-btn" id="fractal-mode-toggle">
                <!-- Phosphor Icon: Sparkle -->
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 256 256"><path d="M239.36,134.64l-29.12,29.12a8,8,0,0,1-11.31,0L176,140.85V184a8,8,0,0,1-8,8H132l-15.66,15.66a8,8,0,0,1-11.31,0l-16-16a8,8,0,0,1,0-11.31L104.69,164.69l-22.35-22.35a8,8,0,0,1,0-11.31L111.46,101.91l-15.66-15.66a8,8,0,0,1,0-11.31l16-16a8,8,0,0,1,11.31,0L138.77,74.59l22.35,22.35a8,8,0,0,1,0,11.31L138.11,131.25l22.35,22.35,22.35-22.35a8,8,0,0,1,11.31,0l22.91,22.91,22.91-22.91a8,8,0,0,1,11.32,11.32Z"></path></svg>
            </div>
        </div>

    </div>
    
    <script id="simplex-noise-glsl" type="x-shader/x-fragment">
        // Simplex Noise GLSL implementation
        vec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
        vec4 mod289(vec4 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
        vec4 permute(vec4 x) { return mod289(((x*34.0)+1.0)*x); }
        vec4 taylorInvSqrt(vec4 r) { return 1.79284291400159 - 0.85373472095314 * r; }

        float snoise(vec3 v) {
            const vec2 C = vec2(1.0/6.0, 1.0/3.0);
            const vec4 D = vec4(0.0, 0.5, 1.0, 2.0);
            vec3 i  = floor(v + dot(v, C.yyy));
            vec3 x0 = v - i + dot(i, C.xxx);
            vec3 g = step(x0.yzx, x0.xyz);
            vec3 l = 1.0 - g;
            vec3 i1 = min(g.xyz, l.zxy);
            vec3 i2 = max(g.xyz, l.zxy);
            vec3 x1 = x0 - i1 + C.xxx;
            vec3 x2 = x0 - i2 + C.yyy;
            vec3 x3 = x0 - D.yyy;
            i = mod289(i);
            vec4 p = permute(permute(permute(i.z + vec4(0.0, i1.z, i2.z, 1.0)) + i.y + vec4(0.0, i1.y, i2.y, 1.0)) + i.x + vec4(0.0, i1.x, i2.x, 1.0));
            float n_ = 0.142857142857; // 1.0/7.0
            vec3 ns = n_ * D.wyz - D.xzx;
            vec4 j = p - 49.0 * floor(p * ns.z * ns.z);
            vec4 x_ = floor(j * ns.z);
            vec4 y_ = floor(j - 7.0 * x_);
            vec4 x = x_ * ns.x + ns.yyyy;
            vec4 y = y_ * ns.x + ns.yyyy;
            vec4 h = 1.0 - abs(x) - abs(y);
            vec4 b0 = vec4(x.xy, y.xy);
            vec4 b1 = vec4(x.zw, y.zw);
            vec4 s0 = floor(b0)*2.0 + 1.0;
            vec4 s1 = floor(b1)*2.0 + 1.0;
            vec4 sh = -step(h, vec4(0.0));
            vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy;
            vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww;
            vec3 p0 = vec3(a0.xy,h.x);
            vec3 p1 = vec3(a0.zw,h.y);
            vec3 p2 = vec3(a1.xy,h.z);
            vec3 p3 = vec3(a1.zw,h.w);
            vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2,p2), dot(p3,p3)));
            p0 *= norm.x; p1 *= norm.y; p2 *= norm.z; p3 *= norm.w;
            vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
            m = m * m;
            return 42.0 * dot(m*m, vec4(dot(p0,x0), dot(p1,x1), dot(p2,x2), dot(p3,x3)));
        }
    </script>

    <script>
    /**
     * ATOMSMED vFINAL: SYSTEM CORE (Architecture & Visualization)
     * "Från komplexitet till klarhet. Robust ingenjörskonst."
     * SYSTEM PROTOCOL: Systemet har uppnått optimal driftstatus. Alla moduler är synkroniserade.
     */

    // --- GLOBAL NAMESPACE & STATE MANAGEMENT ---
    window.nord = {};
    window.nord.currentPage = 'hero'; // NYTT: Steg 1 (Återställning) - Sätt en standard
    window.UnifiedGeometryManager = null;

    const VISUAL_ASSET_LIBRARY = {
        fundamental: {
            material: 'neural', // Harmoni-fix: Återställer den solida grundformen.
            forms: [
                // Harmoni-fix: En språklig makeover för en mer kraftfull berättelse.
                { name: 'synergy', displayName: 'Integration' },
                { name: 'structure', displayName: 'Arkitektur' },
                { name: 'relation', displayName: 'Nodstruktur' },
                { name: 'adaptation', displayName: 'Topologi' },
                { name: 'potential', displayName: 'Kärna' }
            ],
            currentIndex: 0
        },
        struktur: { 
            material: 'neural', 
            forms: [
                { name: 'tetrahedron', displayName: 'Tetrahedron' }, 
                { name: 'cube', displayName: 'Kub' }, 
                { name: 'octahedron', displayName: 'Oktahedron' }, 
                { name: 'dodecahedron', displayName: 'Dodekahedron' }, 
                { name: 'icosahedron', displayName: 'Ikosahedron' }
            ], 
            currentIndex: 0 
        },
        flode: { 
            material: 'organic', 
            forms: [
                { name: 'seed_of_life', displayName: 'Bastopologi' }, 
                { name: 'flower_of_life', displayName: 'Grid-nätverk' }, 
                { name: 'metatrons_cube', displayName: 'Komplexitet' }, 
                { name: 'torus', displayName: 'Torus' }, 
                { name: 'trinity_knot', displayName: 'Processloop' }
            ], 
            currentIndex: 0 
        },
        precision: { 
            material: 'crystal', 
            forms: [
                { name: 'diamond_brilliant', displayName: 'Briljant' }, 
                { name: 'quartz_point', displayName: 'Bergkristall' }, 
                { name: 'bismuth_spiral', displayName: 'Vismutkristall' }, 
                { name: 'geode', displayName: 'Geod' }, 
                { name: 'prism_triangular', displayName: 'Prisma' }
            ], 
            currentIndex: 0 
        },
        paradigm: { 
            material: 'quantum', 
            forms: [
                { name: 'tesseract', displayName: 'Tesserakt' }, 
                { name: 'klein_bottle', displayName: 'Kleinflaska' }, 
                { name: 'mobius_strip', displayName: 'Möbiusband' }, 
                { name: 'hopf_fibration', displayName: 'Hopf-fibrering' }, 
                { name: 'calabi_yau', displayName: 'Calabi-Yau' }
            ], 
            currentIndex: 0 
        },
        ekosystem: { 
            material: 'nebula',
            forms: [
                { name: 'fibonacci_spiral', displayName: 'Fibonaccispiral' },
                { name: 'galaxy_spiral', displayName: 'Galaxspiral' }, 
                { name: 'galactic_arm', displayName: 'Galaktisk Arm' }, 
                { name: 'cosmic_web', displayName: 'Nätverk' }, 
                { name: 'supernova_remnant', displayName: 'Expansion' }, 
                { name: 'accretion_disk', displayName: 'Ackretionsskiva' }, 
                { name: 'stellated_dodecahedron', displayName: 'Stjärndodekaeder' }, 
                { name: 'merkaba', displayName: 'Stjärnpolyeder' }, 
                { name: 'atomic_orbitals', displayName: 'Atomorbitaler' }, 
                { name: 'fibonacci_sphere', displayName: 'Fibonacci-sfär' }, 
                { name: 'fibonacci_spiral', displayName: 'Fibonaccispiral' },
                { name: 'tetrahedron_grid_64', displayName: 'Grid-struktur' }, 
                { name: 'nebula_cloud', displayName: 'Nebulosa' }
            ], 
            currentIndex: 0 
        }
    };

    // --- ANTI-FRAGILE CORE ---
    function logToExternalService(error, context) {
        // I en verklig applikation skulle detta skicka data till en tjänst som Sentry, LogRocket, etc.
        console.warn(`[EXTERNAL LOG] Disharmoni observerad i ${context}:`, error);
    }

    // --- CORE PAGE ROUTING LOGIC ---
    document.addEventListener('DOMContentLoaded', () => {
        // KALIBRERING: Neutralisera webbläsarens scroll-återställning för att säkerställa harmonisk start.
        if ('scrollRestoration' in history) {
            history.scrollRestoration = 'manual';
        }
        window.scrollTo(0, 0);

        const pageConfig = {
            'hero': { isMultiPart: true, parts: ['hero', 'home-diagram-section', 'atom-gallery-section', 'home-contact-section'], display: 'flex', hasFooter: true, navAlias: 'hero' },
            'om-oss': { display: 'flex', hasFooter: true, navAlias: 'om-oss' },
            'system': { display: 'flex', hasFooter: true, navAlias: 'system' },
            'ritbordet': { display: 'flex', hasFooter: true, navAlias: 'ritbordet' },
            'boka-samtal-skraddarsydd': { display: 'flex', hasFooter: true, navAlias: 'system' },
            'privacy-policy-en': { display: 'flex', hasFooter: true, navAlias: 'hero' },
            'terms-of-service-en': { display: 'flex', hasFooter: true, navAlias: 'hero' },
        };

        // NYTT: Funktion för att hantera chattens position
        window.nord.updateChatPosition = function(pageId) {
            // STÄNGD EMBEDDING: Chatten ska alltid vara en bubbla (minimerad)
            // Vi ignorerar hero-mount logiken helt för att uppfylla önskemålet om "minimerad som default".
            
            /*
            const chatWindow = document.getElementById('chat-window');
            const heroMount = document.getElementById('hero-chat-mount');
            // ... (Gammal logik bortkommenterad/inaktiverad)
            */
           
           // Se till att chatten alltid ligger i sin widget-container om den råkat flyttas
           const chatWindow = document.getElementById('chat-window');
           const widgetContainer = document.getElementById('chat-widget-container');
           const chatBubble = document.getElementById('chat-bubble');
           
           if (widgetContainer && chatWindow && chatWindow.parentElement !== widgetContainer) {
                widgetContainer.appendChild(chatWindow);
                chatWindow.classList.remove('embedded-chat', 'visible');
                if (chatBubble) chatBubble.classList.remove('hidden');
                if (widgetContainer) widgetContainer.classList.remove('pointer-events-none');
           }
        };

        window.nord.showPage = function(pageId, isPoppingState = false) {
            // --- NYTT: Steg 3 (Återställning) ---
            // Logik för att återställa "Arkitektur-Invasion" om vi lämnar den sidan
            if (window.nord.currentPage === 'om-oss' && 
                pageId !== 'om-oss' && 
                window.aiFirstGameManager && 
                window.aiFirstGameManager.isActive) 
            {
                window.aiFirstGameManager.endGame();
            }
            // Uppdatera nuvarande sida
            window.nord.currentPage = pageId;
            // --- SLUT PÅ Steg 3 ---
            
            // New chat visibility logic (Nu hanterad av updateChatPosition)
            window.nord.updateChatPosition(pageId);

            // Harmoni-fix: URL-hantering med History API
            if (!isPoppingState) {
                const currentHash = window.location.hash.substring(1);
                if (currentHash !== pageId) {
                    history.pushState({ page: pageId }, '', '#' + pageId);
                }
            }
            
            // Harmoni-fix: Geometrin svarar på varje interaktion.
            if (window.UnifiedGeometryManager && !isPoppingState) {
                window.UnifiedGeometryManager.nudgeGeometry();
            }

            const config = pageConfig[pageId];
            if (!config) return;
            
            // Harmoni-fix: Säkerställ att verkstaden och dess kontroller stängs när man navigerar bort.
            if (pageId !== 'ritbordet' && document.body.classList.contains('labb-active')) {
                if (window.UnifiedGeometryManager) {
                    window.UnifiedGeometryManager.exitBuilderMode();
                }
            } else if (pageId === 'ritbordet') {
                // Harmoni-fix: Tvinga systemet att återställa till lobbyn om den redan är i verkstadsläge.
                if (document.body.classList.contains('labb-active') && window.UnifiedGeometryManager) {
                    window.UnifiedGeometryManager.exitBuilderMode();
                }
            }

            document.body.classList.toggle('ritbordet-visible', pageId === 'ritbordet');

            const targetState = pageId === 'ritbordet' ? 'WORKSHOP' : (pageId === 'hero' ? 'HERO' : 'PAGE');
            
            const main = document.querySelector('main');
            gsap.to(main, { opacity: 0, duration: 0.4, ease: 'power2.in', onComplete: () => {
                document.querySelectorAll('main > section').forEach(s => s.style.display = 'none');
                const footer = document.getElementById('main-footer');
                if (footer) footer.style.display = config.hasFooter ? 'block' : 'none';
                
                if (config.isMultiPart) {
                    config.parts.forEach(partId => document.getElementById(partId)?.style.setProperty('display', config.display, 'important'));
                } else {
                    document.getElementById(pageId)?.style.setProperty('display', config.display, 'important');
                }

                if (config.initFn) config.initFn();
                window.nord.updateActiveLink(config.navAlias || pageId);
                
                // KALIBRERING: Säkerställ att vyn är vid toppen vid sidbyte, förutom vid återgång från ritbordet.
                if (window.UnifiedGeometryManager && window.UnifiedGeometryManager.lastState !== 'WORKSHOP') {
                    window.scrollTo({ top: 0, left: 0, behavior: 'instant' });
                }

                requestAnimationFrame(() => {
                    gsap.to(main, { opacity: 1, duration: 0.6, ease: 'power2.out' });
                });
            }});
            
            if (window.UnifiedGeometryManager && !window.UnifiedGeometryManager.initializationFailed) {
                window.UnifiedGeometryManager.transitionTo(targetState);
            }
            
            window.nord.closeMobileMenu();
        };

        // Harmoni-fix: En dedikerad, GSAP-driven funktion för all mjuk scrollning på sidan.
        window.nord.smoothScrollTo = function(selector) {
            // Harmoni-fix: Geometrin svarar på varje interaktion.
            if (window.UnifiedGeometryManager) {
                window.UnifiedGeometryManager.nudgeGeometry();
            }
            // Fallback om ScrollTo-plugin inte laddats
            if (typeof gsap.to === 'function' && typeof gsap.plugins.ScrollToPlugin !== 'undefined') {
                gsap.to(window, { duration: 1.5, scrollTo: selector, ease: 'power2.inOut' });
            } else {
                // Nativ JavaScript fallback
                const targetElement = document.querySelector(selector);
                if (targetElement) {
                    targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }
        };

        /* --- GLOBAL STARFIELD REMOVED --- */
        /* Den gamla Three.js-stjärnhimlen har avvecklats till förmån för StarfallManager (Canvas) */

        class UnifiedGeometryManager {
            constructor() {
                this.isInitialized = false;
                this.initializationFailed = false;
                this.composer = null;
                this.states = {
                // TÄMJD GEOMETRI: Lägre zoom, lägre opacitet, långsammare rotation
                HERO: { zoom: 15, y: 0, opacity: 0.3, rotSpeed: 0.05 }, 
                PAGE: { zoom: 40, y: 5, opacity: 0.15, rotSpeed: 0.02 }, // Mycket svagare på undersidor
                WORKSHOP: { zoom: 22, y: 0, opacity: 1.0, rotSpeed: 0.2 },
                // CINEMA MODE: Geometrin på MAX (1.0) styrka för att synas genom glaset
                CHAT: { zoom: 18, y: 0, opacity: 1.0, rotSpeed: 0.1 }, 
                HIDDEN: { zoom: 60, y: 0, opacity: 0.0, rotSpeed: 0.0 }
            };
            this.currentState = 'HIDDEN';
            this.lastState = 'HIDDEN';
            this.targetState = this.states.HIDDEN;
            
            // State Management Refactor
            // LÅST TEMA: Vi startar med en lugn, stabil form istället för partikel-kaos
            /* UPPDATERAT: Standardtema ändrat från 'struktur' (◉) till 'ekosystem' (⟠) */
            this.activeThemeKey = 'ekosystem'; 
            this.isParticleModeActive = false; // Stäng av partiklar som default (men Ekosystem tvingar fram dem ändå)
            this.attractorParams = { a: 10, b: 28, c: 8.0 / 3.0, dt: 0.01 };
            
            this.isMorphing = false;
            this.currentMorphProgress = 0;
            this.isWorkshopBuilderActive = false;
            
            this.morphVelocity = 0;
                this.dampingFactor = 0.94;
                this.forceFactor = 0.0015;
                this.MAX_INPUT_FORCE = 0.035;
            this.onboardingTimeout = null;
            this.animationId = null; // Antifragile: Track animation loop
            this.activeParticleMorph = { from: null, to: null };
                this.themeSwitchCooldown = 500; // Harmoni-fix: En "andningspaus" för temaväxling.
                this.lastThemeSwitchTime = 0;

                this.interaction = {
                    targetRotationX: 0.5, targetRotationY: 0,
                    actualRotationX: 0.5, actualRotationY: 0,
                    targetZoom: this.states.HIDDEN.zoom, 
                    actualZoom: this.states.HIDDEN.zoom,
                    targetY: this.states.HIDDEN.y, 
                    actualY: this.states.HIDDEN.y // Harmoni-fix: Återställer startanimationen till en ren zoom för en mer kontrollerad ingång på alla enheter.
                };
                
                this.joystick = {
                    left: { active: false, id: null, startX: 0, startY: 0, currentX: 0, currentY: 0 },
                    right: { active: false, id: null, startX: 0, startY: 0, currentX: 0, currentY: 0 },
                    creatorMode: false,
                    rightTapTimeout: null
                };
            
            // NYTT: State för Thinking Mode
            this.thinkingState = { active: false, originalShape: null, pulseTween: null };

                this.boundWheelHandler = this.handleWheel.bind(this);
            this.boundJoystickTouchStart = this.handleJoystickTouchStart.bind(this);
            this.boundJoystickTouchMove = this.handleJoystickTouchMove.bind(this);
            this.boundJoystickTouchEnd = this.handleJoystickTouchEnd.bind(this);
            // this.boundHideOnboarding = null; // Ej längre nödvändig
            this.clock = new THREE.Clock();

            // NYA BINDNINGAR FÖR MUS-ROTATION
            this.boundMouseDown = this.handleMouseDown.bind(this);
            this.boundMouseMove = this.handleMouseMove.bind(this);
            this.boundMouseUp = this.handleMouseUp.bind(this);
            this.isDragging = false;
            this.lastMouseX = 0;
            this.lastMouseY = 0;
        }

        setTheme(themeKey) {
                this.activeThemeKey = themeKey;
                if (this.elasticGeometry) {
                    const theme = VISUAL_ASSET_LIBRARY[this.activeThemeKey];
                    this.elasticGeometry.setMaterial(theme?.material || 'organic');
                }
            }

            get activeTheme() {
                return this.activeThemeKey || 'cosmic';
            }

            handleResize() {
                this.camera.aspect = window.innerWidth / window.innerHeight;
                this.camera.updateProjectionMatrix();
                this.renderer.setSize(window.innerWidth, window.innerHeight);
                if (this.composer) {
                    this.composer.setSize(window.innerWidth, window.innerHeight);
                }
            }

            init() {
                try {
                    if (this.isInitialized) return;
                    this.initRenderer();
                    
                    // REMOVED: this.stars = new GlobalStarfield(this.scene);

                    this.elasticGeometry = new ElasticGeometry(this.renderer);
                    this.scene.add(this.elasticGeometry.mesh);
                    
                    this.setTheme(this.activeTheme);

                    this.setupInteractionListeners();
                    window.addEventListener('resize', () => this.handleResize(), false);

                    this.animate = this.animate.bind(this);
                    this.animate();

                    // Harmoni-fix: Anropa updateViewState() vid initiering
                    // för att ställa in den korrekta standardgeometrin (BUG 1).
                    this.updateViewState();

                    this.isInitialized = true;
                } catch (error) {
                    this.initializationFailed = true;
                    console.error("Total disharmoni i UnifiedGeometryManager:", error);
                    logToExternalService(error, "UnifiedGeometryManager.init");
                }
            }

            setGlobalTheme(theme) {
                if (!this.isInitialized) return;
                
                const isLight = theme === 'light';
                
                if (this.elasticGeometry) {
                    this.elasticGeometry.updateMaterialsForTheme(isLight);
                }

                // REMOVED: Star visibility logic (Handled by CSS on #starfall now)
    
                // Uppdatera dimma och bloom
                const fogTargetColor = isLight ? new THREE.Color(0xFDFDFD) : new THREE.Color(0x0c1427);
                const fogTargetDensity = isLight ? 0.005 : 0.015; 
                if (this.scene.fog) {
                    gsap.to(this.scene.fog, { color: fogTargetColor, density: fogTargetDensity, duration: 1.5 });
                }
    
                if (this.composer) {
                    const bloomPass = this.composer.passes[1];
                    if (bloomPass) {
                        const bloomTarget = isLight ? { strength: 0.6, radius: 0.5 } : { strength: 1.3, radius: 0.4 };
                        gsap.to(bloomPass, { ...bloomTarget, duration: 1.5 });
                    }
                }
            }

            initRenderer() {
                this.canvas = document.createElement('canvas');
                this.canvas.id = 'unified-geometry-canvas';
                document.body.appendChild(this.canvas);
                this.renderer = new THREE.WebGLRenderer({ canvas: this.canvas, alpha: true, antialias: true, powerPreference: 'high-performance' });
                this.scene = new THREE.Scene();
                
                // NYTT: Kontrollera initialt tema för korrekt dimma direkt vid start
                const isLight = document.body.classList.contains('light-theme');
                const fogColor = isLight ? 0xFDFDFD : 0x0c1427;
                const fogDensity = isLight ? 0.005 : 0.015;
                this.scene.fog = new THREE.FogExp2(fogColor, fogDensity);

                this.camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
                
                if (typeof THREE.EffectComposer !== 'undefined' && typeof THREE.UnrealBloomPass !== 'undefined') {
                    this.composer = new THREE.EffectComposer(this.renderer);
                    this.composer.addPass(new THREE.RenderPass(this.scene, this.camera));
                    const bloomPass = new THREE.UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 1.3, 0.4, 0.8);
                    this.composer.addPass(bloomPass);
                } else {
                    this.composer = null;
                }
                this.handleResize();
            }

            setupInteractionListeners() {
                const isTouchDevice = window.matchMedia('(pointer: coarse)').matches;
                const joystickLeft = document.getElementById('joystick-portal-left');
                const joystickRight = document.getElementById('joystick-portal-right');

                // Harmoni-fix: Separerar logiken för touch-enheter och desktop för att säkerställa att rätt kontroller alltid laddas.
                if (isTouchDevice && joystickLeft && joystickRight) {
                    // Specifika listeners för mobil (touch)
                    joystickLeft.addEventListener('touchstart', (e) => this.boundJoystickTouchStart(e, 'left'), { passive: false });
                    joystickRight.addEventListener('touchstart', (e) => this.boundJoystickTouchStart(e, 'right'), { passive: false });
                    
                    window.addEventListener('touchmove', this.boundJoystickTouchMove, { passive: false });
                    window.addEventListener('touchend', this.boundJoystickTouchEnd, { passive: false });
                    window.addEventListener('touchcancel', this.boundJoystickTouchEnd, { passive: false });
                } else {
                    // Specifika listeners för desktop (mus & hjul)
                    window.addEventListener('wheel', this.boundWheelHandler, { passive: false });
                    
                    // NYA LISTENERS FÖR MUS-ROTATION
                    this.canvas.addEventListener('mousedown', this.boundMouseDown);
                    window.addEventListener('mousemove', this.boundMouseMove);
                    window.addEventListener('mouseup', this.boundMouseUp);
                    
                    if (joystickRight) {
                        joystickRight.addEventListener('click', () => {
                         if (document.body.classList.contains('labb-active')) { this.exitBuilderMode(); }
                         else { this.enterBuilderMode(); }
                    });
                }
                }
                
                // Gemensamma listeners för både mobil och desktop
                document.querySelectorAll('.glass-btn[data-theme]').forEach(btn => {
                    btn.addEventListener('click', () => {
                        // AUTO-ENTER: Om användaren klickar på en form i lobbyn, starta verkstaden direkt.
                        if (!this.isWorkshopBuilderActive && document.body.classList.contains('ritbordet-visible')) {
                            this.enterBuilderMode();
                        }
                        this.handleThemeClick(btn.dataset.theme);
                    });
                });

                document.getElementById('fractal-mode-toggle').addEventListener('click', () => {
                     if (!this.isWorkshopBuilderActive && document.body.classList.contains('ritbordet-visible')) {
                        this.enterBuilderMode();
                    }
                    this.handleParticleClick();
                });

                window.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && this.isWorkshopBuilderActive) this.exitBuilderMode();
                });

                // Harmoni-fix: Dedikerad logik för det nya, hopfällbara verktygsfältet på mobil.
                const toolbarToggle = document.getElementById('toolbar-toggle');
                const body = document.body;

                if (toolbarToggle) {
                    toolbarToggle.addEventListener('click', () => {
                        body.classList.toggle('toolbar-open');
                        const icon = toolbarToggle.querySelector('i');
                        if (body.classList.contains('toolbar-open')) {
                            icon.className = 'ph ph-x';
                            toolbarToggle.title = 'Dölj verktyg';
                        } else {
                            icon.className = 'ph ph-list';
                            toolbarToggle.title = 'Visa verktyg';
                        }
                    });
                }
            }

            // NYA HANDLERS FÖR MUS-ROTATION
            handleMouseDown(e) {
                if (!this.isWorkshopBuilderActive) return;
                e.preventDefault();
                this.isDragging = true;
                this.lastMouseX = e.clientX;
                this.lastMouseY = e.clientY;
            }

            handleMouseMove(e) {
                if (!this.isDragging || !this.isWorkshopBuilderActive) return;
                e.preventDefault();
                const deltaX = e.clientX - this.lastMouseX;
                const deltaY = e.clientY - this.lastMouseY;
                
                this.interaction.targetRotationY += deltaX * 0.005;
                this.interaction.targetRotationX -= deltaY * 0.005;
                this.interaction.targetRotationX = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, this.interaction.targetRotationX));
                
                this.lastMouseX = e.clientX;
                this.lastMouseY = e.clientY;
            }

            handleMouseUp() {
                this.isDragging = false;
            }
            // SLUT PÅ NYA HANDLERS

            handleWheel(e) {
                if (!this.isWorkshopBuilderActive) return;
                e.preventDefault();

                // Harmoni-fix: Ny hierarki av interaktion med Shift och Option/Alt.
                if (e.altKey) { // Skulptering (Option på Mac)
                    this.elasticGeometry.sculpt(e.deltaY);
                    return;
                }

                if (e.shiftKey) { // Temaväxling
                    // Harmoni-fix: "Den Stora Resan" är nu mer intelligent och behaglig.
                    if (this.isParticleModeActive) return; 
                    const now = Date.now();
                    if (now - this.lastThemeSwitchTime < this.themeSwitchCooldown) return;

                    const themeKeys = Object.keys(VISUAL_ASSET_LIBRARY);
                    const currentIndex = themeKeys.indexOf(this.activeThemeKey || 'struktur');
                    let nextIndex;
                    if (e.deltaY > 0) { // Scrolla ner
                        nextIndex = (currentIndex + 1) % themeKeys.length;
                    } else { // Scrolla upp
                        nextIndex = (currentIndex - 1 + themeKeys.length) % themeKeys.length;
                    }
                    this.handleThemeClick(themeKeys[nextIndex]);
                    this.lastThemeSwitchTime = now; // Notera tidpunkten för växlingen.
                    return;
                }
                
                // Ordinarie interaktion (Dansen)
                if (this.isParticleModeActive && !this.activeThemeKey) {
                    this.attractorParams.b += e.deltaY * 0.01;
                    this.elasticGeometry.regenerateAttractor(this.attractorParams);
                    this.displayFormName({ displayName: `Attraktor [b=${this.attractorParams.b.toFixed(2)}]` });
                    return;
                }

                const rawForce = e.deltaY * this.forceFactor;
                const force = Math.max(-this.MAX_INPUT_FORCE, Math.min(this.MAX_INPUT_FORCE, rawForce));
                this.morphVelocity += force;
                this.isMorphing = true;
            }

            handleJoystickTouchStart(e, side) {
                // Harmoni-fix: Återinför preventDefault för att garantera att joysticken "greppar" direkt
                // och förhindrar att sidan scrollar när man försöker styra.
                if(e.cancelable) e.preventDefault();
                
                const touch = e.changedTouches[0];
                this.joystick[side].active = true;
                this.joystick[side].id = touch.identifier;
                this.joystick[side].startX = touch.clientX;
                this.joystick[side].startY = touch.clientY;
                this.joystick[side].currentX = touch.clientX;
                this.joystick[side].currentY = touch.clientY;
                e.currentTarget.classList.add('active');

                if (side === 'right') {
                    clearTimeout(this.joystick.rightTapTimeout);
                    this.joystick.rightTapTimeout = setTimeout(() => {
                        this.joystick.rightTapTimeout = null;
                    }, 200);
                }
            }

            handleJoystickTouchMove(e) {
                // Harmoni-fix: En "skyddsvakt" säkerställer att joystick-logiken ENDAST körs
                // när verkstaden är aktiv. Detta frigör scroll-funktionen på alla andra sidor.
                if (!this.isWorkshopBuilderActive) return;

                // e.preventDefault() anropas nu endast villkorligt, inuti logiken
                // för varje aktiv joystick. Detta säkerställer att vi bara blockerar scrollning
                // när användaren aktivt manipulerar en kontroll, inte annars.
                for (let i = 0; i < e.changedTouches.length; i++) {
                    const touch = e.changedTouches[i];
                    if (touch.identifier === this.joystick.left.id && this.joystick.left.active) {
                        e.preventDefault(); 
                        const deltaX = touch.clientX - this.joystick.left.currentX;
                        const deltaY = touch.clientY - this.joystick.left.currentY;
                        this.interaction.targetRotationY += deltaX * 0.008;
                        this.interaction.targetRotationX -= deltaY * 0.008;
                        this.interaction.targetRotationX = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, this.interaction.targetRotationX));
                        this.joystick.left.currentX = touch.clientX;
                        this.joystick.left.currentY = touch.clientY;
                    } else if (touch.identifier === this.joystick.right.id && this.joystick.right.active) {
                        e.preventDefault();
                        const deltaY = touch.clientY - this.joystick.right.currentY;
                        if (this.isParticleModeActive && !this.activeThemeKey) {
                           // Harmoni-fix: Återställer den stabila, direkta interaktionen för Attraktorn.
                           this.attractorParams.b -= deltaY * 0.05;
                           this.elasticGeometry.regenerateAttractor(this.attractorParams);
                           this.displayFormName({ displayName: `Attraktor [b=${this.attractorParams.b.toFixed(2)}]` });
                        } else if (this.activeThemeKey) {
                            const rawForce = deltaY * this.forceFactor * 2;
                            const force = Math.max(-this.MAX_INPUT_FORCE, Math.min(this.MAX_INPUT_FORCE, rawForce));
                            this.morphVelocity -= force;
                            this.isMorphing = true;
                        }
                        this.joystick.right.currentX = touch.clientX;
                        this.joystick.right.currentY = touch.clientY;
                    }
                }
            }
            
            handleJoystickTouchEnd(e) {
                for (let i = 0; i < e.changedTouches.length; i++) {
                    const touch = e.changedTouches[i];
                    if (touch.identifier === this.joystick.left.id) {
                        this.joystick.left.active = false;
                        const joyLeft = document.getElementById('joystick-portal-left');
                        joyLeft.classList.remove('active');
                    } else if (touch.identifier === this.joystick.right.id) {
                        if (this.joystick.rightTapTimeout) {
                            clearTimeout(this.joystick.rightTapTimeout);
                            if (document.body.classList.contains('labb-active')) this.exitBuilderMode();
                            else this.enterBuilderMode();
                        }
                        this.joystick.right.active = false;
                        // Harmoni-fix: Borttagen för att höger joystick ska förbli visuellt aktiv i verkstadsläget.
                        // const joyRight = document.getElementById('joystick-portal-right');
                        // joyRight.classList.remove('active');
                    }
                }
            }
            
            transitionTo(targetStateKey) {
                const baseState = this.states[targetStateKey];
                if (!baseState) return;
                this.lastState = this.currentState;
                this.currentState = targetStateKey;
                
                let finalState = { ...baseState }; 
                if (window.innerWidth < 768) {
                    if (targetStateKey === 'PAGE') {
                        finalState.zoom = 60; 
                    } else if (targetStateKey === 'HERO') {
                        finalState.zoom = 18; // Lite tightare zoom på mobil
                        /* UPPDATERAT: Lyft upp geometrin rejält från 6.5 till -1.5 */
                        /* Detta placerar den visuellt mellan topp-loggan och rubriken */
                        finalState.y = -1.5; 
                    } else if (targetStateKey === 'WORKSHOP') {
                        finalState.y = 0; // Harmoni-fix: Perfekt vertikal centrering på mobil.
                        finalState.zoom = 24; // Harmoni-fix: Anpassad zoom för optimal visning på mobil.
                    }
                }
                
                this.targetState = finalState;
                gsap.to(this.interaction, { targetZoom: finalState.zoom, targetY: finalState.y, duration: 2.5, ease: 'power3.inOut' });
                const mat = this.elasticGeometry.mesh.material;
                const uniforms = mat.uniforms;
                gsap.to(uniforms?.opacity || mat, { value: finalState.opacity, duration: 1.5, ease: 'power2.inOut' });
                
                // REMOVED: const starMat = this.stars.material.uniforms.opacity;
                // REMOVED: gsap.to(starMat, { value: finalState.opacity > 0 ? 1 : 0, duration: 1.5, ease: 'power2.inOut' });

                // --- BORTTAGEN ÅTERSTÄLLNINGSKOD ---
                // Den tvingande koden som låg här är nu borttagen
                // för att tillåta geometrin att "minnas" sitt tillstånd.
            }

            handleThemeClick(themeKey) {
                if (this.activeThemeKey === themeKey) {
                    this.activeThemeKey = null; // Deselect
                } else {
                    this.activeThemeKey = themeKey;
                    // Harmoni-fix: Nollställ form-index BARA när ett nytt tema väljs (BUG 2)
                    if (VISUAL_ASSET_LIBRARY[this.activeThemeKey]) {
                        VISUAL_ASSET_LIBRARY[this.activeThemeKey].currentIndex = 0;
                    }
                }
                this.updateViewState();
            }
            
            handleParticleClick() {
                this.isParticleModeActive = !this.isParticleModeActive;
                this.updateViewState();
            }
            
            // Harmoni-fix: updateViewState är nu uppdelad.
            // updateButtonUI() synkroniserar BARA knapparna med det aktiva läget.
            // updateViewState() gör allt (knappar OCH geometri-ändring).
            updateButtonUI() {
                // UPPDATERAD SELEKTOR för nya #final-toolbar
                document.querySelectorAll('.geo-btn[data-theme]').forEach(btn => {
                    // Check parent wrapper or button itself
                    btn.classList.toggle('active', btn.dataset.theme === this.activeThemeKey);
                });
                const fractalBtn = document.getElementById('fractal-mode-toggle');
                if (fractalBtn) {
                    fractalBtn.classList.toggle('active', this.isParticleModeActive);
                }
            }

            updateViewState() {
                // Steg 1: Synkronisera knapparna
                this.updateButtonUI();

                // Steg 2: Uppdatera geometrin (detta är logiken som återställde)
                this.elasticGeometry.setParticleMode(this.isParticleModeActive, this.activeThemeKey);
                this.isMorphing = false;
                this.currentMorphProgress = 0;
                this.morphVelocity = 0;

                if (this.isParticleModeActive || (VISUAL_ASSET_LIBRARY[this.activeThemeKey]?.material === 'nebula')) {
                    if (this.activeThemeKey) {
                        const theme = VISUAL_ASSET_LIBRARY[this.activeThemeKey];
                        // theme.currentIndex = 0; // Harmoni-fix: Borttagen för att bevara minne (BUG 2)
                        this.activeShape = theme.forms[theme.currentIndex];
                        this.elasticGeometry.morphToShape(this.activeShape.name);
                        this.displayFormName(this.activeShape);
                    } else {
                        // Pure fractal mode: Ursprunglig Attraktor
                        this.activeShape = { name: 'lorenz_attractor', displayName: 'Ursprunglig Attraktor' };
                        this.elasticGeometry.morphToShape(this.activeShape.name);
                        this.displayFormName(this.activeShape);
                    }
                } else {
                    if (this.activeThemeKey) {
                        const theme = VISUAL_ASSET_LIBRARY[this.activeThemeKey];
                        // theme.currentIndex = 0; // Harmoni-fix: Borttagen för att bevara minne (BUG 2)
                        this.activeShape = theme.forms[theme.currentIndex];
                        this.elasticGeometry.morphToShape(this.activeShape.name);
                        this.displayFormName(this.activeShape);
                    } else {
                        // No theme, no fractal -> Fade out
                        gsap.to(this.elasticGeometry.mesh.material.uniforms?.opacity || this.elasticGeometry.mesh.material, { value: 0.1, duration: 0.5 });
                        this.hideFormName();
                    }
                }
            }

            enterBuilderMode() {
                this.isWorkshopBuilderActive = true;
                document.body.classList.add('labb-active');
                this.transitionTo('WORKSHOP');
                document.getElementById('joystick-portal-right')?.classList.add('active');
                
                // --- JS SÄKERHET ---
                // Se till att vi inte har några inline styles som blockerar
                const toolbar = document.getElementById('workshop-toolbar');
                if (toolbar) {
                    toolbar.style.display = ''; // Rensa inline style, låt CSS ta över
                    toolbar.style.opacity = '';
                    toolbar.style.visibility = '';
                }
                
                // Gör canvasen interaktiv för musen på desktop
                if (!window.matchMedia('(pointer: coarse)').matches) {
                    this.canvas.classList.add('interactive');
                }

                // --- NYTT: Hantera Ghost Hints istället för Modal ---
                const ghostHints = document.getElementById('workshop-ghost-hints');
                if (ghostHints) {
                    // Visa hints
                    ghostHints.classList.add('visible');
                    
                    // Tona ut dem automatiskt efter 4.5 sekunder
                    clearTimeout(this.onboardingTimeout);
                    this.onboardingTimeout = setTimeout(() => {
                        ghostHints.classList.remove('visible');
                    }, 4500);
                }

                // Harmoni-fix: Aktivera bara de globala touch-lyssnarna när verkstaden är aktiv.
                if (window.matchMedia('(pointer: coarse)').matches) {
                    window.addEventListener('touchmove', this.boundJoystickTouchMove, { passive: false });
                    window.addEventListener('touchend', this.boundJoystickTouchEnd, { passive: false });
                    window.addEventListener('touchcancel', this.boundJoystickTouchEnd, { passive: false });
                } 

                // Harmoni-fix: Anropa BARA UI-synken.
                this.updateButtonUI();
            }
            
            exitBuilderMode() {
                clearTimeout(this.onboardingTimeout);
                this.isWorkshopBuilderActive = false;
                document.body.classList.remove('labb-active');
                document.body.classList.remove('toolbar-open'); 
                this.transitionTo(this.lastState === 'HIDDEN' ? 'HERO' : this.lastState);
                
                // --- CSS-STYRD DÖLJNING ---
                // Borttagning av klassen på body triggar transitionen tillbaka till dolt läge.

                // Nollställ mus-interaktion
                this.isDragging = false;
                this.canvas.classList.remove('interactive');
                
                // Dölj hints direkt vid exit
                document.getElementById('workshop-ghost-hints')?.classList.remove('visible');
                
                // this.hideOnboarding(); // Behövs ej då modalen är borta
                this.hideFormName();
                document.getElementById('joystick-portal-right')?.classList.remove('active');
                
                // Harmoni-fix: Utrotar scroll-konflikten...
                if (window.matchMedia('(pointer: coarse)').matches) {
                    window.removeEventListener('touchmove', this.boundJoystickTouchMove);
                    window.removeEventListener('touchend', this.boundJoystickTouchEnd);
                    window.removeEventListener('touchcancel', this.boundJoystickTouchEnd);
                }
            }

            // Harmoni-fix: Exponerar en global funktion för att "knuffa" geometrin,
            // vilket skapar en levande känsla vid interaktion.
            nudgeGeometry() {
                if (this.elasticGeometry) {
                    this.elasticGeometry.nudge();
                }
            }
            
            displayFormName(shape) {
                if (!this.isWorkshopBuilderActive || !shape) return;
                const el = document.getElementById('form-name-display'); if (!el) return;
                const name = shape.displayName || shape.name.replace(/_/g, ' ');
                el.textContent = name; 
                el.classList.add('visible');
            }
            
            hideFormName() { document.getElementById('form-name-display')?.classList.remove('visible'); }

            // --- NYA METODER: AI THINKING MODE ---
            startThinkingMode() {
                if (this.thinkingState.active) return;
                this.thinkingState.active = true;
                
                // Spara nuvarande form för att kunna återgå
                const theme = VISUAL_ASSET_LIBRARY[this.activeThemeKey || 'ekosystem'];
                this.thinkingState.originalShape = this.activeShape || theme.forms[theme.currentIndex];

                // KNUFFEN: Geometrin rycker till för att signalera "Tanke startad"
                this.interaction.actualRotationY += 0.5; // Direkt impuls
                
                // HARMONISK MEN KRAFTFULL: Snabbare, djupare andning
                if (this.elasticGeometry.isParticleSystem) {
                    this.elasticGeometry.setMorph(this.thinkingState.originalShape.name, 'fibonacci_sphere', 0);
                    
                    // Yoyo-loop med mer "svung" (Power3)
                    this.thinkingState.morphTween = gsap.to(this.elasticGeometry.mesh.material.uniforms.morphProgress, {
                        value: 1,
                        duration: 1.5, // Snabbare tempo (1.5s)
                        ease: "power3.inOut", // Skarpare kurva (tydligare rörelse)
                        yoyo: true,
                        repeat: -1
                    });
                } else {
                    this.elasticGeometry.morphToShape('fibonacci_sphere'); 
                }
                
                // Puls med hög energi
                const mat = this.elasticGeometry.mesh.material;
                if(mat.uniforms?.pulseIntensity) {
                    this.thinkingState.pulseTween = gsap.to(mat.uniforms.pulseIntensity, { 
                        value: 2.2, // Mycket ljusare
                        duration: 1.5, // Synkad med morf
                        yoyo: true, 
                        repeat: -1,
                        ease: "power3.inOut" 
                    });
                }
            }

            stopThinkingMode() {
                if (!this.thinkingState.active) return;
                this.thinkingState.active = false;

                // Stoppa puls mjukt
                if (this.thinkingState.pulseTween) {
                    this.thinkingState.pulseTween.kill();
                    const mat = this.elasticGeometry.mesh.material;
                    if(mat.uniforms?.pulseIntensity) {
                        gsap.to(mat.uniforms.pulseIntensity, { value: 1.0, duration: 1.5 });
                    }
                }

                // EVOLUTION: Välj en helt NY form att landa i
                const theme = VISUAL_ASSET_LIBRARY[this.activeThemeKey || 'ekosystem'];
                let nextIndex;
                
                // Slumpa fram en ny form (undvik samma som vi kom ifrån för att garantera förändring)
                do {
                    nextIndex = Math.floor(Math.random() * theme.forms.length);
                } while (nextIndex === theme.currentIndex && theme.forms.length > 1);
                
                theme.currentIndex = nextIndex;
                this.activeShape = theme.forms[nextIndex];

                // Återgå mjukt till den NYA formen (inte ursprunget)
                if (this.elasticGeometry.isParticleSystem) {
                    if (this.thinkingState.morphTween) this.thinkingState.morphTween.kill();
                    
                    // SMART MORFNING: "Landning"
                    // Vi befinner oss visuellt vid 'fibonacci_sphere' (progress ~1).
                    // Vi vill landa i den NYA formen (this.activeShape).
                    // 1. Vi sätter den NYA formen som bas (position 0).
                    // 2. Vi sätter 'fibonacci_sphere' som mål (position 1).
                    // 3. Vi tvingar progress till 1 direkt (så vi stannar kvar visuellt vid sfären).
                    // 4. Vi animerar progress från 1 till 0 -> Vi "glider hem" till den nya formen.
                    
                    this.elasticGeometry.setMorph(this.activeShape.name, 'fibonacci_sphere', 1);
                    
                    gsap.to(this.elasticGeometry.mesh.material.uniforms.morphProgress, {
                        value: 0,
                        duration: 2.5, // Mjuk, tydlig evolution
                        ease: "power2.inOut",
                        onComplete: () => {
                            this.activeParticleMorph = { from: null, to: null };
                        }
                    });
                } else {
                    // För solida former
                    this.elasticGeometry.morphToShape(this.activeShape.name);
                }
            }

            animate() {
                this.animationId = requestAnimationFrame(this.animate);
                const time = this.clock.getElapsedTime();
                
                // Hantera rotation: Snabbare rotation under tankeprocessen
                if (this.thinkingState.active) {
                    this.interaction.actualRotationY += 0.03; // Betydligt snabbare spinn
                    this.interaction.actualRotationX += 0.01; // Mer liv i X-led
                } else {
                    // Normal inbromsning/kontroll
                    this.interaction.actualRotationX += (this.interaction.targetRotationX - this.interaction.actualRotationX) * 0.1;
                    this.interaction.actualRotationY += (this.interaction.targetRotationY - this.interaction.actualRotationY) * 0.1;
                }
                
                this.interaction.actualZoom += (this.interaction.targetZoom - this.interaction.actualZoom) * 0.05;
                this.interaction.actualY += (this.interaction.targetY - this.interaction.actualY) * 0.05;
                
                if (this.isWorkshopBuilderActive && this.activeThemeKey) {
                    this.currentMorphProgress += this.morphVelocity; this.morphVelocity *= this.dampingFactor;
                    if (Math.abs(this.morphVelocity) < 0.0001) { this.morphVelocity = 0; if(this.isMorphing) this.isMorphing = false; }
                    const theme = VISUAL_ASSET_LIBRARY[this.activeThemeKey];
                    if (this.currentMorphProgress >= 1) { theme.currentIndex = (theme.currentIndex + 1) % theme.forms.length; this.activeShape = theme.forms[theme.currentIndex]; this.currentMorphProgress -= 1.0; if ('vibrate' in navigator) navigator.vibrate(30); } 
                    else if (this.currentMorphProgress < 0) { theme.currentIndex = (theme.currentIndex - 1 + theme.forms.length) % theme.forms.length; this.activeShape = theme.forms[theme.currentIndex]; this.currentMorphProgress += 1.0; if ('vibrate' in navigator) navigator.vibrate(30); }
                    const fromShape = theme.forms[theme.currentIndex], toShape = theme.forms[(theme.currentIndex + 1) % theme.forms.length];
                    
                    // Harmoni-fix: Optimerad animationslogik för partiklar.
                    if (this.elasticGeometry.isParticleSystem) {
                        // Om formen vi morfar mellan har ändrats, uppdaterar vi geometri-buffrarna en enda gång.
                        if (this.activeParticleMorph.from !== fromShape.name || this.activeParticleMorph.to !== toShape.name) {
                            this.elasticGeometry.setMorph(fromShape.name, toShape.name, this.currentMorphProgress);
                            this.activeParticleMorph.from = fromShape.name;
                            this.activeParticleMorph.to = toShape.name;
                        }
                        // I varje frame uppdaterar vi endast progress-värdet i grafikprocessorn, vilket ger en helt mjuk animation.
                        this.elasticGeometry.mesh.material.uniforms.morphProgress.value = this.currentMorphProgress;
                    } else {
                        // Solida geometrier använder en annan fysikbaserad morfning.
                        this.elasticGeometry.setMorph(fromShape.name, toShape.name, this.currentMorphProgress);
                    }
                    
                    const fromName = fromShape.displayName || fromShape.name.replace(/_/g, ' ');
                    const toName = toShape.displayName || toShape.name.replace(/_/g, ' ');

                    this.displayFormName(this.isMorphing ? { displayName: `${fromName} → ${toName}` } : this.activeShape);
                }
                
                const cameraX = Math.sin(this.interaction.actualRotationY) * Math.cos(this.interaction.actualRotationX) * this.interaction.actualZoom;
                const cameraZ = Math.cos(this.interaction.actualRotationY) * Math.cos(this.interaction.actualRotationX) * this.interaction.actualZoom;
                const cameraY = Math.sin(this.interaction.actualRotationX) * this.interaction.actualZoom + this.interaction.actualY;

                this.camera.position.set(cameraX, cameraY, cameraZ);
                this.camera.lookAt(0, this.interaction.actualY, 0);
                
                // REMOVED: this.stars.material.uniforms.time.value = time;
                this.elasticGeometry.update(time);
                
                if (this.composer) {
                    this.composer.render();
                } else {
                    this.renderer.render(this.scene, this.camera);
                }
            }
        }

        class ElasticGeometry {
            constructor(renderer) {
                this.renderer = renderer; this.SPRING_STRENGTH = 0.04; this.DAMPING = 0.88; this.velocityThreshold = 0.0001; this.isParticleSystem = false; this.activeMorph = null;
               this.initGeometry(); this.initPhysics(); this.initMaterials(); this.initVisuals();
            }

            _addColorAttribute(geometry) {
                if (geometry.attributes.color) return;
                const count = geometry.attributes.position.count;
                const colors = new Float32Array(count * 3);
                const life = new Float32Array(count); // Harmoni-fix: Partiklarna får ett individuellt liv.
                const color1 = new THREE.Color(0x00D4FF); // NordSym Cyan
                const color2 = new THREE.Color(0x9370DB); // NordSym Purple
                const tempColor = new THREE.Color();
                for (let i = 0; i < count; i++) {
                    tempColor.copy(color1).lerp(color2, Math.random());
                    colors[i * 3] = tempColor.r;
                    colors[i * 3 + 1] = tempColor.g;
                    colors[i * 3 + 2] = tempColor.b;
                    life[i] = Math.random() * 10.0; // Ett unikt startvärde för varje partikel.
                }
                geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
                geometry.setAttribute('life', new THREE.BufferAttribute(life, 1));
            }

            initGeometry() {
                this.geometries = {
                    tetrahedron: new THREE.TetrahedronGeometry(5, 1), cube: new THREE.BoxGeometry(7, 7, 7),
                    octahedron: new THREE.OctahedronGeometry(5, 1), dodecahedron: new THREE.DodecahedronGeometry(5, 1),
                    icosahedron: new THREE.IcosahedronGeometry(5, 2), seed_of_life: new THREE.SphereGeometry(4.5, 64, 64),
                    flower_of_life: new THREE.TorusGeometry(4, 1.5, 8, 50), metatrons_cube: new THREE.IcosahedronGeometry(5, 1),
                    torus: new THREE.TorusGeometry(4, 1.5, 16, 100), trinity_knot: new THREE.TorusKnotGeometry(3.5, 0.8, 128, 16, 2, 3),
                    diamond_brilliant: new THREE.OctahedronGeometry(5, 0), quartz_point: new THREE.CylinderGeometry(0, 3, 8, 6),
                    bismuth_spiral: new THREE.BoxGeometry(6,6,6), geode: new THREE.SphereGeometry(4.5, 32, 32),
                    prism_triangular: new THREE.CylinderGeometry(4, 4, 6, 3), tesseract: new THREE.BoxGeometry(7, 7, 7),
                    klein_bottle: new THREE.TorusKnotGeometry(3.5, 1, 64, 8, 1, 3), mobius_strip: new THREE.TorusGeometry(4, 0.5, 8, 50),
                    hopf_fibration: new THREE.TorusKnotGeometry(3.5, 0.8, 128, 16, 2, 3), calabi_yau: new THREE.TorusKnotGeometry(3.5, 1.2, 128, 16, 3, 7),
                    fibonacci_spiral: new THREE.TorusGeometry(4, 0.2, 16, 100), galaxy_spiral: new THREE.SphereGeometry(5, 64, 64),
                    merkaba: new THREE.TetrahedronGeometry(5, 0), tetrahedron_grid_64: new THREE.IcosahedronGeometry(5, 2),
                    nebula_cloud: new THREE.SphereGeometry(5, 64, 64), 
                    fractal_fibonacci: this.createFractalGeometry(),
                    fibonacci_sphere: this.createFibonacciSphereGeometry(),
                    galactic_arm: this.createGalacticArmGeometry(),
                    accretion_disk: this.createAccretionDiskGeometry(),
                    cosmic_web: this.createCosmicWebGeometry(),
                    stellated_dodecahedron: this.createStellatedDodecahedronGeometry(),
                    atomic_orbitals: this.createAtomicOrbitalsGeometry(),
                    supernova_remnant: this.createSupernovaRemnantGeometry(),
                    lorenz_attractor: this.createLorenzAttractorGeometry(),
                     // Formerna för det nya "Grundläggande" temat
                    potential: this.createPotentialGeometry(),
                    relation: this.createRelationGeometry(),
                    structure: this.createStructureGeometry(),
                    adaptation: this.createAdaptationGeometry(),
                    synergy: this.createSynergyGeometry()
                };
                
                Object.values(this.geometries).forEach(geo => this._addColorAttribute(geo));

                this.geometry = this.geometries.seed_of_life.clone(); this.geometry.computeVertexNormals();
            }
            createFractalGeometry(count = 10000) {
                const points = []; let x = 0.1, y = 0, z = 0; const a = 10, b = 28, c = 8.0 / 3.0; const dt = 0.01;
                for (let i = 0; i < count; i++) { const dx = a * (y - x) * dt; const dy = (x * (b - z) - y) * dt; const dz = (x * y - c * z) * dt; x += dx; y += dy; z += dz; if (i > 100) points.push(x * 0.2, y * 0.2, z * 0.2); }
                const geometry = new THREE.BufferGeometry(); geometry.setAttribute('position', new THREE.Float32BufferAttribute(points, 3)); return geometry;
            }
             createPotentialGeometry(count = 8000, radius = 5) { 
                // Harmoni-fix: "Ursprung" är nu en Lorenz-attraktor. 
                // Detta transformerar den från en "trasslig boll" till en vacker representation 
                // av hur ordning och struktur uppstår ur kaotiska system.
                const points = [];
                let x = 0.1, y = 0, z = 0;
                const a = 10, b = 28, c = 8.0 / 3.0, dt = 0.01;

                for (let i = 0; i < count; i++) {
                    const dx = a * (y - x) * dt;
                    const dy = (x * (b - z) - y) * dt;
                    const dz = (x * y - c * z) * dt;
                    x += dx; y += dy; z += dz;
                    if (i > 100) { // Låt systemet "värmas upp" för att hitta attraktorn
                        points.push(x * 0.25, y * 0.25, (z * 0.25) - 8);
                    }
                }
                const geometry = new THREE.BufferGeometry(); 
                geometry.setAttribute('position', new THREE.Float32BufferAttribute(points, 3)); 
                return geometry;
            }
            createRelationGeometry(nodes = 50, connectionsPerNode = 1, radius = 8) { // Harmoni-fix: Minskat antalet kopplingar för en tydligare, mindre trasslig struktur.
                const geometry = new THREE.BufferGeometry();
                const nodePoints = [];
                for(let i = 0; i < nodes; i++) { 
                    nodePoints.push(new THREE.Vector3((Math.random() - 0.5) * radius * 2, (Math.random() - 0.5) * radius * 2, (Math.random() - 0.5) * radius * 2)); 
                }
                const vertices = [];
                const connected = new Set();
                nodePoints.forEach((p1, i) => {
                    const distances = nodePoints.map((p2, j) => ({ index: j, dist: p1.distanceTo(p2) }))
                        .sort((a, b) => a.dist - b.dist)
                        .slice(1, connectionsPerNode + 1);

                    distances.forEach(d => {
                        const j = d.index;
                        const key1 = `${i}-${j}`, key2 = `${j}-${i}`;
                        if (!connected.has(key1) && !connected.has(key2)) {
                            const p2 = nodePoints[j];
                            vertices.push(p1.x, p1.y, p1.z);
                            vertices.push(p2.x, p2.y, p2.z);
                            connected.add(key1);
                        }
                    });
                });

                geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
                return geometry;
            }
            createStructureGeometry(size = 8, divisions = 5) {
                const geometry = new THREE.BufferGeometry();
                const vertices = [];
                const step = size / divisions;
                const halfSize = size / 2;

                for (let i = 0; i <= divisions; i++) {
                    const x = -halfSize + i * step;
                    const y = -halfSize + i * step;
                    const z = -halfSize + i * step;

                    // Lines along X
                    vertices.push(-halfSize, y, z, halfSize, y, z);
                    // Lines along Y
                    vertices.push(x, -halfSize, z, x, halfSize, z);
                    // Lines along Z
                    vertices.push(x, y, -halfSize, x, y, halfSize);
                }

                geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
                return geometry;
            }
            createAdaptationGeometry(size = 8, divisions = 5) { // Harmoni-fix: Minskat antalet "trådar" för en luftigare, mer genomskinlig känsla.
                 const geometry = new THREE.PlaneGeometry(size, size, divisions, divisions);
                 // Deform it into a sphere-like shape
                 const vertices = geometry.attributes.position;
                 for (let i = 0; i < vertices.count; i++) {
                     const vertex = new THREE.Vector3().fromBufferAttribute(vertices, i);
                     vertex.normalize().multiplyScalar(size / 2);
                     vertices.setXYZ(i, vertex.x, vertex.y, vertex.z);
                 }
                 geometry.computeVertexNormals();
                 return geometry;
            }
            createSynergyGeometry(radius = 5, detail = 5) {
                return new THREE.IcosahedronGeometry(radius, detail);
            }
            createLorenzAttractorGeometry(params = { a: 10, b: 28, c: 8.0 / 3.0, dt: 0.01 }, count = 15000) {
                const points = [];
                let x = 0.1, y = 0, z = 0;
                const { a, b, c, dt } = params;
                for (let i = 0; i < count; i++) {
                    const dx = a * (y - x) * dt;
                    const dy = (x * (b - z) - y) * dt;
                    const dz = (x * y - c * z) * dt;
                    x += dx; y += dy; z += dz;
                    if (i > 100) points.push(x * 0.3, y * 0.3, (z * 0.3) - 10);
                }
                const geometry = new THREE.BufferGeometry();
                geometry.setAttribute('position', new THREE.Float32BufferAttribute(points, 3));
                return geometry;
            }
            regenerateAttractor(params) {
                const newGeo = this.createLorenzAttractorGeometry(params);
                this.geometries['lorenz_attractor'] = newGeo;
                this._addColorAttribute(newGeo);
                // Harmoni-fix: Återgår till den direkta, stabila metoden för att uppdatera Attraktorn.
                this.morphToShape('lorenz_attractor');
            }
            createFibonacciSphereGeometry(count = 2000, radius = 5) {
                const points = []; const phi = Math.PI * (3. - Math.sqrt(5.)); 
                for (let i = 0; i < count; i++) { const y = 1 - (i / (count - 1)) * 2; const r = Math.sqrt(1 - y * y); const theta = phi * i; const x = Math.cos(theta) * r; const z = Math.sin(theta) * r; points.push(x * radius, y * radius, z * radius); }
                const geometry = new THREE.BufferGeometry(); geometry.setAttribute('position', new THREE.Float32BufferAttribute(points, 3)); return geometry;
            }
            createGalacticArmGeometry(count = 3000, radius = 6) {
                const points = []; const armCount = 2; const spread = 1.5;
                for (let i = 0; i < count; i++) {
                    const r = Math.sqrt(Math.random()) * radius;
                    const angle = Math.random() * 2 * Math.PI + (r / radius) * 5;
                    const arm = Math.floor(Math.random() * armCount);
                    const armAngle = (2 * Math.PI / armCount) * arm;
                    const x = Math.cos(angle + armAngle) * r + (Math.random() - 0.5) * spread;
                    const y = (Math.random() - 0.5) * (spread / 2) * (1 - r / radius);
                    const z = Math.sin(angle + armAngle) * r + (Math.random() - 0.5) * spread;
                    points.push(x, y, z);
                }
                const geometry = new THREE.BufferGeometry(); geometry.setAttribute('position', new THREE.Float32BufferAttribute(points, 3)); return geometry;
            }
            createAccretionDiskGeometry(count = 15000) {
                const points = [];
                for (let i = 0; i < count; i++) {
                    const r = Math.pow(Math.random(), 2) * 8;
                    const angle = Math.random() * Math.PI * 10;
                    const x = Math.cos(angle) * r;
                    const z = Math.sin(angle) * r;
                    const y = (Math.random() - 0.5) * 0.2 * (1 - r/8);
                    points.push(x, y, z);
                }
                const geometry = new THREE.BufferGeometry(); geometry.setAttribute('position', new THREE.Float32BufferAttribute(points, 3)); return geometry;
            }
            createCosmicWebGeometry(count = 15000) {
                const points = [];
                const nodes = [];
                for(let i = 0; i < 20; i++) { nodes.push(new THREE.Vector3((Math.random() - 0.5) * 30, (Math.random() - 0.5) * 30, (Math.random() - 0.5) * 30)); }
                for (let i = 0; i < count; i++) {
                    const p1 = nodes[Math.floor(Math.random() * nodes.length)];
                    const p2 = nodes[Math.floor(Math.random() * nodes.length)];
                    const point = new THREE.Vector3().lerpVectors(p1, p2, Math.random());
                    point.x += (Math.random() - 0.5) * 0.5;
                    point.y += (Math.random() - 0.5) * 0.5;
                    point.z += (Math.random() - 0.5) * 0.5;
                    points.push(point.x, point.y, point.z);
                }
                const geometry = new THREE.BufferGeometry(); geometry.setAttribute('position', new THREE.Float32BufferAttribute(points, 3)); return geometry;
            }
            createStellatedDodecahedronGeometry() {
                const baseGeo = new THREE.DodecahedronGeometry(5, 0);
                const vertices = [];
                const basePositions = baseGeo.attributes.position;
                for (let i = 0; i < basePositions.count; i += 3) {
                    const v1 = new THREE.Vector3().fromBufferAttribute(basePositions, i);
                    const v2 = new THREE.Vector3().fromBufferAttribute(basePositions, i + 1);
                    const v3 = new THREE.Vector3().fromBufferAttribute(basePositions, i + 2);
                    const center = new THREE.Vector3().add(v1).add(v2).add(v3).divideScalar(3);
                    const stellatedPoint = center.clone().normalize().multiplyScalar(8);
                    vertices.push(v1.x, v1.y, v1.z, v2.x, v2.y, v2.z, stellatedPoint.x, stellatedPoint.y, stellatedPoint.z);
                    vertices.push(v2.x, v2.y, v2.z, v3.x, v3.y, v3.z, stellatedPoint.x, stellatedPoint.y, stellatedPoint.z);
                    vertices.push(v3.x, v3.y, v3.z, v1.x, v1.y, v1.z, stellatedPoint.x, stellatedPoint.y, stellatedPoint.z);
                }
                const geometry = new THREE.BufferGeometry(); geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3)); return geometry;
            }
            createAtomicOrbitalsGeometry(count = 15000) {
                const points = [];
                const radii = [3, 6, 9];
                for (let i = 0; i < count; i++) {
                    const r = radii[Math.floor(Math.random() * radii.length)];
                    const u = Math.random();
                    const v = Math.random();
                    const theta = 2 * Math.PI * u;
                    const phi = Math.acos(2 * v - 1);
                    const x = r * Math.sin(phi) * Math.cos(theta);
                    const y = r * Math.sin(phi) * Math.sin(theta);
                    const z = r * Math.cos(phi);
                    points.push(x, y, z);
                }
                const geometry = new THREE.BufferGeometry();
                geometry.setAttribute('position', new THREE.Float32BufferAttribute(points, 3));
                return geometry;
            }
            createSupernovaRemnantGeometry(count = 20000, radius = 10) {
                const points = [];
                for (let i = 0; i < count; i++) {
                    const u = Math.random();
                    const v = Math.random();
                    const r = radius * Math.sqrt(u);
                    const theta = 2 * Math.PI * v;
                    const shell_thickness = 0.5 * Math.random();
                    const R = r * (1.0 - shell_thickness * shell_thickness);

                    const phi = Math.acos(2 * Math.random() - 1);
                    const x = R * Math.sin(phi) * Math.cos(theta);
                    const y = R * Math.sin(phi) * Math.sin(theta);
                    const z = R * Math.cos(phi);
                    points.push(x, y, z);
                }
                const geometry = new THREE.BufferGeometry();
                geometry.setAttribute('position', new THREE.Float32BufferAttribute(points, 3));
                return geometry;
            }
            initMaterials() {
                const nebulaShader = {
                    uniforms: { time: { value: 0 }, rotation: { value: 0}, opacity: { value: 1.0 }, pointSize: { value: 2.5 }, morphProgress: { value: 0.0 }, pulseIntensity: { value: 1.0 }, u_isLightTheme: { value: 0.0 } },
                    vertexShader: `attribute vec3 color; attribute float life; attribute vec3 morphTarget; uniform float time; uniform float rotation; uniform float pointSize; uniform float morphProgress; varying vec3 vColor; varying float vLife; void main() { vColor = color; vLife = life; vec3 p = mix(position, morphTarget, morphProgress); mat2 rot = mat2(cos(rotation), -sin(rotation), sin(rotation), cos(rotation)); p.xz = rot * p.xz; vec4 mvPosition = modelViewMatrix * vec4(p, 1.0); gl_PointSize = pointSize * (20.0 / -mvPosition.z); gl_Position = projectionMatrix * mvPosition; }`,
                    fragmentShader: `
                        uniform float time;
                        uniform float opacity;
                        uniform float pulseIntensity;
                        uniform float u_isLightTheme;
                        varying vec3 vColor;
                        varying float vLife;
                        
                        // Blueprint Ink Color (RGB: 10, 37, 64)
                        const vec3 inkColor = vec3(10.0/255.0, 37.0/255.0, 64.0/255.0);
                        
                        void main() {
                            float dist = length(gl_PointCoord - vec2(0.5));
                            if (dist > 0.45) discard;
                            
                            vec3 finalColor;
                            float pulse;
            
                            if (u_isLightTheme > 0.5) {
                                // LIGHT THEME: Use Normal Blending (set in JS) and Ink Color
                                pulse = 0.5 + 0.5 * sin(time * 3.0 + vLife);
                                finalColor = inkColor;
                            } else {
                                // DARK THEME: Use Additive Blending (set in JS) and vColor
                                pulse = 0.8 + 0.2 * sin(time * 3.0 + vLife);
                                finalColor = vColor;
                            }
                            
                            gl_FragColor = vec4(finalColor * pulse * pulseIntensity, smoothstep(0.45, 0.1, dist) * opacity);
                        }
                    `,
                    transparent: true, blending: THREE.AdditiveBlending, depthWrite: false
                };
                this.materials = {
                    neural: new THREE.ShaderMaterial({ uniforms: { time: { value: 0 }, rotation: { value: 0 }, opacity: { value: 1.0 }, thickness: { value: 0.1 } }, vertexShader: `uniform float rotation; void main() { vec3 p = position; mat2 rot = mat2(cos(rotation), -sin(rotation), sin(rotation), cos(rotation)); p.xz = rot * p.xz; gl_Position = projectionMatrix * modelViewMatrix * vec4(p, 1.0); }`, fragmentShader: `uniform float opacity; uniform float thickness; void main() { gl_FragColor = vec4(0.0, 0.83, 1.0, 0.5 * opacity); }`, wireframe: true, transparent: true }),
                    organic: new THREE.ShaderMaterial({ uniforms: { time: { value: 0 }, rotation: { value: 0}, opacity: { value: 1.0 }, displacement: { value: 0.0 } }, vertexShader: `uniform float time; uniform float rotation; uniform float displacement; varying vec3 vNormal; void main() { vNormal = normal; float d = sin(position.y * 2.0 + time * 3.0) * displacement + cos(position.x * 2.0 + time * 2.0) * displacement; vec3 newPosition = position + normal * d; mat2 rot = mat2(cos(rotation), -sin(rotation), sin(rotation), cos(rotation)); newPosition.xz = rot * newPosition.xz; gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0); }`, fragmentShader: `varying vec3 vNormal; uniform float opacity; void main() { float intensity = pow(0.7 - dot(vNormal, vec3(0.0, 0.0, 1.0)), 2.0); gl_FragColor = vec4(vec3(0.5, 0.8, 1.0) * intensity, opacity); }`, wireframe: true, transparent: true }),
                    crystal: new THREE.ShaderMaterial({ uniforms: { time: { value: 0 }, rotation: { value: 0}, opacity: { value: 1.0 }, fresnelPower: { value: 2.0 } }, vertexShader: `uniform float rotation; varying vec3 vNormal; varying vec3 vViewPosition; void main() { vNormal = normalize(normalMatrix * normal); vec3 p = position; mat2 rot = mat2(cos(rotation), -sin(rotation), sin(rotation), cos(rotation)); p.xz = rot * p.xz; vec4 mvPosition = modelViewMatrix * vec4(p, 1.0); vViewPosition = -mvPosition.xyz; gl_Position = projectionMatrix * mvPosition; }`, fragmentShader: `uniform float fresnelPower; varying vec3 vNormal; varying vec3 vViewPosition; uniform float opacity; void main() { vec3 viewDir = normalize(vViewPosition); float fresnel = 1.0 - dot(viewDir, vNormal); fresnel = pow(fresnel, fresnelPower); vec3 iceColor = vec3(0.9, 0.95, 1.0); vec3 shadowColor = vec3(0.7, 0.85, 1.0); vec3 color = mix(shadowColor, iceColor, fresnel); float frost = sin(vNormal.y * 10.0) * 0.05 + 0.95; gl_FragColor = vec4(color * frost, (0.9 + fresnel * 0.1) * opacity); }`, transparent: true, side: THREE.DoubleSide }),
                    quantum: new THREE.ShaderMaterial({ uniforms: { time: { value: 0 }, rotation: { value: 0}, opacity: { value: 1.0 }, flickerIntensity: { value: 0.2 } }, vertexShader: `uniform float rotation; varying vec3 vNormal; varying vec3 vViewPosition; void main() { vNormal = normalize(normalMatrix * normal); vec3 p = position; mat2 rot = mat2(cos(rotation), -sin(rotation), sin(rotation), cos(rotation)); p.xz = rot * p.xz; vec4 mvPosition = modelViewMatrix * vec4(p, 1.0); vViewPosition = -mvPosition.xyz; gl_Position = projectionMatrix * mvPosition; }`, fragmentShader: `uniform float time; uniform float flickerIntensity; varying vec3 vNormal; varying vec3 vViewPosition; uniform float opacity; void main() { vec3 viewDir = normalize(vViewPosition); float fresnel = 1.0 - dot(viewDir, vNormal); fresnel = pow(fresnel, 4.0); float flicker = 0.8 + sin(vNormal.x * 10.0 + time * 2.0) * flickerIntensity; vec3 baseColor = vec3(0.1, 0.15, 0.3) * flicker; vec3 rimColor = vec3(0.6, 0.8, 1.0); vec3 color = mix(baseColor, rimColor, fresnel); gl_FragColor = vec4(color, (fresnel * 0.5 + 0.3) * opacity); }`, transparent: true, blending: THREE.AdditiveBlending }),
                    nebula: new THREE.ShaderMaterial(nebulaShader)
                };
            }
            initPhysics() { const vertexCount = this.geometry.attributes.position.count; this.originalPositions = new Float32Array(this.geometry.attributes.position.array); this.velocities = new Array(vertexCount).fill(0).map(() => new THREE.Vector3()); }
            initVisuals() { this.mesh = new THREE.Mesh(this.geometry, this.materials.organic); this.mesh.renderOrder = 0; }
            
            setMaterial(materialKey) {
                const newMat = this.materials[materialKey]; if (!newMat) return;
                const currentOpacity = this.mesh.material.uniforms?.opacity?.value ?? this.mesh.material.opacity;
                if (newMat.uniforms?.opacity) newMat.uniforms.opacity.value = currentOpacity; else newMat.opacity = currentOpacity;
                Object.values(this.materials).forEach(mat => { if(mat.wireframe) mat.wireframe = false; });
                if (newMat.wireframe !== undefined) newMat.wireframe = true;
                
                const isNebulaType = (materialKey === 'nebula');
                const needsMeshTypeChange = (isNebulaType && this.mesh.type !== 'Points') || (!isNebulaType && this.mesh.type !== 'Mesh');

                if (needsMeshTypeChange) {
                    const currentScene = this.mesh.parent;
                    if (currentScene) currentScene.remove(this.mesh);

                    if (isNebulaType) {
                        this.mesh = new THREE.Points(this.geometry, newMat);
                        // Harmoni-fix: Detta är den kritiska pusselbiten. När en solid form blir partiklar,
                        // måste den få ett 'morphTarget'-attribut så att partikel-shadern vet hur den ska kunna
                        // transformera sig i framtiden. Utan detta kraschar shadern och ingenting syns.
                        if (!this.geometry.attributes.morphTarget) {
                            this.geometry.setAttribute('morphTarget', new THREE.BufferAttribute(new Float32Array(this.geometry.attributes.position.array), 3));
                        }
                    } else {
                        this.mesh = new THREE.Mesh(this.geometry, newMat);
                    }
                    
                    if (currentScene) currentScene.add(this.mesh);
                } else {
                    this.mesh.material = newMat;
                }
            }

            updateMaterialsForTheme(isLight) {
                const nebulaMat = this.materials.nebula;
                if (!nebulaMat) return;
    
                if (isLight) {
                    nebulaMat.blending = THREE.NormalBlending;
                    nebulaMat.uniforms.u_isLightTheme.value = 1.0;
                } else {
                    nebulaMat.blending = THREE.AdditiveBlending;
                    nebulaMat.uniforms.u_isLightTheme.value = 0.0;
                }
            }

            update(time) {
                if (this.mesh.material.uniforms && this.mesh.material.uniforms.time) { this.mesh.material.uniforms.time.value = time; }
                if (this.mesh.material.uniforms && this.mesh.material.uniforms.rotation) { this.mesh.material.uniforms.rotation.value = time * 0.1; }
                
                if (this.mesh.type === 'Points') return; // Don't run physics on particle systems
                const positions = this.geometry.attributes.position.array; const restPos = new THREE.Vector3(); const currentPos = new THREE.Vector3();
                for (let i = 0; i < this.velocities.length; i++) {
                    restPos.fromArray(this.originalPositions, i * 3); currentPos.fromArray(positions, i * 3);
                    if (this.velocities[i].lengthSq() < this.velocityThreshold * this.velocityThreshold && currentPos.distanceToSquared(restPos) < 0.001) { this.velocities[i].set(0, 0, 0); currentPos.copy(restPos); } else { const springForce = restPos.clone().sub(currentPos).multiplyScalar(this.SPRING_STRENGTH); this.velocities[i].add(springForce); this.velocities[i].multiplyScalar(this.DAMPING); currentPos.add(this.velocities[i]); }
                    currentPos.toArray(positions, i * 3);
                }
                this.geometry.attributes.position.needsUpdate = true; this.geometry.computeVertexNormals();
            }
            nudge() { 
                if (this.mesh.type === 'Points') { 
                    gsap.to(this.mesh.material.uniforms.pulseIntensity, { value: 2.5, duration: 0.3, yoyo: true, repeat: 1, ease: 'power2.inOut' });
                } else {
                    for (let i = 0; i < this.velocities.length; i++) { this.velocities[i].add(new THREE.Vector3(Math.random()-0.5, Math.random()-0.5, Math.random()-0.5).multiplyScalar(0.1)); }
                }
            }
             sculpt(delta) {
                const material = this.mesh.material;
                if (!material.uniforms) return;

                if (this.isParticleSystem) {
                    const size = material.uniforms.pointSize;
                    if (size) size.value = Math.max(0.5, Math.min(5.0, size.value - delta * 0.01));
                } else {
                    const themeKey = window.UnifiedGeometryManager.activeTheme;
                    switch(themeKey) {
                        case 'organic':
                            const displacement = material.uniforms.displacement;
                            if (displacement) displacement.value = Math.max(0, Math.min(1.0, displacement.value - delta * 0.001));
                            break;
                        case 'crystal':
                             const fresnelPower = material.uniforms.fresnelPower;
                             if (fresnelPower) fresnelPower.value = Math.max(0.1, Math.min(8.0, fresnelPower.value - delta * 0.01));
                            break;
                        case 'quantum':
                            const flicker = material.uniforms.flickerIntensity;
                            if (flicker) flicker.value = Math.max(0, Math.min(1.0, flicker.value - delta * 0.001));
                            break;
                        default:
                            break;
                    }
                }
            }
            morphToShape(shapeKey, scale = 1.0) {
                const targetGeo = this.geometries[shapeKey.toLowerCase()]; if (!targetGeo || !targetGeo.attributes.position) return; if (this.activeMorph) this.activeMorph.kill();
                
                const vertexCount = this.originalPositions.length / 3;
                const targetPositions = new Float32Array(vertexCount * 3);
                const targetColors = new Float32Array(vertexCount * 3);
                const targetLifes = new Float32Array(vertexCount);

                const targetPosAttr = targetGeo.attributes.position;
                const targetColorAttr = targetGeo.attributes.color;
                const targetLifeAttr = targetGeo.attributes.life;

                for (let i = 0; i < vertexCount; i++) { 
                    const targetIndex = i % targetPosAttr.count;
                    
                    targetPositions[i*3] = targetPosAttr.array[targetIndex*3] * scale; 
                    targetPositions[i*3+1] = targetPosAttr.array[targetIndex*3+1] * scale; 
                    targetPositions[i*3+2] = targetPosAttr.array[targetIndex*3+2] * scale;
                    
                    if(targetColorAttr) {
                        targetColors[i*3] = targetColorAttr.array[targetIndex*3];
                        targetColors[i*3+1] = targetColorAttr.array[targetIndex*3+1];
                        targetColors[i*3+2] = targetColorAttr.array[targetIndex*3+2];
                    }
                    
                    if(targetLifeAttr) {
                        targetLifes[i] = targetLifeAttr.array[targetIndex];
                    }
                }
                
                if (this.mesh.type === 'Points') { 
                    this.geometry.setAttribute('position', new THREE.BufferAttribute(targetPositions, 3)); 
                    this.geometry.setAttribute('color', new THREE.BufferAttribute(targetColors, 3));
                    this.geometry.setAttribute('life', new THREE.BufferAttribute(targetLifes, 1));
                    this.geometry.attributes.position.needsUpdate = true; 
                    this.geometry.attributes.color.needsUpdate = true;
                    this.geometry.attributes.life.needsUpdate = true;
                } else { 
                    this.activeMorph = gsap.to(this.originalPositions, { endArray: targetPositions, duration: 2.0, ease: "power3.inOut" }); 
                }
            }

            setParticleMode(asParticles, activeTheme) {
                const themeMaterial = VISUAL_ASSET_LIBRARY[activeTheme]?.material || 'neural';
                const shouldUseParticles = asParticles || themeMaterial === 'nebula';

                // Harmoni-fix: Omstrukturerad och förenklad logik för att garantera att alla teman kan bli partiklar.
                if (shouldUseParticles) {
                    this.isParticleSystem = true;
                    this.setMaterial('nebula');
                } else {
                    this.isParticleSystem = false;
                    this.setMaterial(themeMaterial);
                }
            }

            setMorph(fromKey, toKey, progress) {
                const fromGeo = this.geometries[fromKey.toLowerCase()];
                const toGeo = this.geometries[toKey.toLowerCase()];
                if (!fromGeo || !toGeo) return;

                const vertexCount = this.originalPositions.length / 3;

                if (this.isParticleSystem) {
                    // Particle system morphing logic
                    if (!this.geometry.attributes.morphTarget) {
                        this.geometry.setAttribute('morphTarget', new THREE.BufferAttribute(new Float32Array(vertexCount * 3), 3));
                    }

                    const startArray = this.geometry.attributes.position.array;
                    const targetArray = this.geometry.attributes.morphTarget.array;
                    const colorArray = this.geometry.attributes.color.array;
                    const fromColors = fromGeo.attributes.color.array;

                    for (let i = 0; i < vertexCount; i++) {
                        const fromIndex = (i % fromGeo.attributes.position.count) * 3;
                        const toIndex = (i % toGeo.attributes.position.count) * 3;
                        
                        startArray[i * 3]     = fromGeo.attributes.position.array[fromIndex];
                        startArray[i * 3 + 1] = fromGeo.attributes.position.array[fromIndex + 1];
                        startArray[i * 3 + 2] = fromGeo.attributes.position.array[fromIndex + 2];

                        targetArray[i * 3]     = toGeo.attributes.position.array[toIndex];
                        targetArray[i * 3 + 1] = toGeo.attributes.position.array[toIndex + 1];
                        targetArray[i * 3 + 2] = toGeo.attributes.position.array[toIndex + 2];

                        const fromColorIndex = (i % fromGeo.attributes.color.count) * 3;
                        colorArray[i * 3]     = fromColors[fromColorIndex];
                        colorArray[i * 3 + 1] = fromColors[fromColorIndex + 1];
                        colorArray[i * 3 + 2] = fromColors[fromColorIndex + 2];
                    }

                    this.geometry.attributes.position.needsUpdate = true;
                    this.geometry.attributes.morphTarget.needsUpdate = true;
                    this.geometry.attributes.color.needsUpdate = true;
                    this.mesh.material.uniforms.morphProgress.value = progress;
                } else {
                    // Solid geometry morphing logic (physics-based)
                    const fromPos = fromGeo.attributes.position.array;
                    const toPos = toGeo.attributes.position.array;
                    
                    for (let i = 0; i < vertexCount; i++) {
                        const fromIndex = (i % fromGeo.attributes.position.count) * 3;
                        const toIndex = (i % toGeo.attributes.position.count) * 3;

                        const x = fromPos[fromIndex] * (1 - progress) + toPos[toIndex] * progress;
                        const y = fromPos[fromIndex + 1] * (1 - progress) + toPos[toIndex + 1] * progress;
                        const z = fromPos[fromIndex + 2] * (1 - progress) + toPos[toIndex + 2] * progress;
                        
                        this.originalPositions[i * 3] = x;
                        this.originalPositions[i * 3 + 1] = y;
                        this.originalPositions[i * 3 + 2] = z;
                    }
                }
            }
        }
    
    // Anti-Fragile Initialization Sequence
        try {
            window.nord.unifiedGeometry = new UnifiedGeometryManager();
            window.UnifiedGeometryManager = window.nord.unifiedGeometry; // Alias för bakåtkompatibilitet med HTML-handlers
            window.nord.unifiedGeometry.init();

            if (!window.nord.unifiedGeometry.initializationFailed) {
                new RitbordetManager().init();
                new GalleryManager().init();
                
                // NEW: Initialize Starfall Manager
                window.StarfallManager = new StarfallManager();
            } else {
                throw new Error("Kritisk visuell komponent (UnifiedGeometryManager) misslyckades att initiera. Faller tillbaka till grundläggande funktionalitet.");
            }
        } catch (error) {
            console.error("Total systemharmoni kunde inte uppnås:", error);
            logToExternalService(error, "GlobalInitialization");
        }

        window.nord.handleHeaderLogoClick = (event) => {
            event.preventDefault();

            // Använd Tailwind md breakpoint (768px)
            if (window.innerWidth < 768) {
                const mobileMenu = document.getElementById('mobile-menu');
                const logoLink = document.getElementById('header-logo-link');
                if (!mobileMenu || !logoLink) return;

                mobileMenu.classList.toggle('open');
                logoLink.classList.toggle('menu-open', mobileMenu.classList.contains('open'));
                
                if (mobileMenu.classList.contains('open')) {
                    mobileMenu.style.maxHeight = mobileMenu.scrollHeight + "px";
                } else {
                    mobileMenu.style.maxHeight = '0px';
                }
            } else {
                window.nord.showPage('hero');
            }
        };

        window.nord.closeMobileMenu = () => {
             const mobileMenu = document.getElementById('mobile-menu');
             const logoLink = document.getElementById('header-logo-link');
             if(mobileMenu && logoLink) {
                mobileMenu.classList.remove('open');
                logoLink.classList.remove('menu-open');
                mobileMenu.style.maxHeight = '0px';
             }
        };
        window.nord.updateActiveLink = function(navId) {
            document.querySelectorAll('header nav a.nav-link, #mobile-menu a').forEach(link => {
                link.classList.remove('active');
                if (link.closest('#mobile-menu')) { link.classList.remove('bg-sky-700/50', 'nord-accent-text', 'font-semibold'); }
            });
            const activeLinks = document.querySelectorAll(`a[data-nav="${navId}"]`);
            activeLinks.forEach(link => {
                link.classList.add('active');
                if (link.closest('#mobile-menu')) { link.classList.add('bg-sky-700/50', 'nord-accent-text', 'font-semibold'); }
            });
        };
        
        // Uppdaterad sidladdning och popstate-hantering
        window.addEventListener('popstate', (event) => {
            const page = (event.state && event.state.page) ? event.state.page : 'hero';
            window.nord.showPage(page, true);
        });

        window.addEventListener('load', () => { 
            // SCROLL LOCK: Aggressiv lösning för "stympad" logga på mobil
            if ('scrollRestoration' in history) { history.scrollRestoration = 'manual'; }
            
            // Funktion för att tvinga toppen
            const forceTop = () => window.scrollTo(0, 0);
            
            // Kör direkt
            forceTop();

            const hash = window.location.hash.substring(1); 
            const initialPage = pageConfig[hash] ? hash : 'hero';

            // Sätt initial historik-status korrekt
            history.replaceState({ page: initialPage }, '', '#' + initialPage);

            // Visa sidan utan att skapa en ny historik-post
            window.nord.showPage(initialPage, true);
            
            // KASKAD: Tvinga scrollen upprepade gånger under laddningen för att besegra UI-animationer (adressfält etc)
            requestAnimationFrame(forceTop);
            setTimeout(forceTop, 50);
            setTimeout(forceTop, 100);
            setTimeout(forceTop, 300);
        });
        
        // NYTT: Hantera "Back/Forward"-cache (bfcache) på iOS/Safari
        window.addEventListener('pageshow', (event) => {
            if (event.persisted) {
                window.scrollTo(0, 0);
            }
        });
        
        // --- DYNAMIC WAITLIST SYSTEM ---
        const productWaitlistConfig = {
            beaver: {
                icon: 'ph-person-arms-spread', // Construction/Worker metaphor
                title: 'Beaver - Byggbranschens Verktyg',
                desc: 'Beaver är vårt system för byggbranschen. Vi håller på att färdigställa den interaktiva demon.',
                subject: 'Intresseanmälan: Beaver'
            },
            flownode: {
                icon: 'ph-arrows-split', // Workflow/Orchestration metaphor
                title: 'FlowNode - AI Agent Orchestration',
                desc: 'Vi utvecklar en visuell workflow-builder för att orkestrera AI-agenter. Målet är att förenkla skapandet av komplexa flöden mellan modeller och API:er.',
                subject: 'Intresseanmälan: FlowNode'
            },
            genprd: {
                icon: 'ph-file-code',
                title: 'GenPRD - AI Specifikationer',
                desc: 'Generera tekniska kravspecifikationer optimerade för AI-agenter. Få databasscheman och user flows direkt.',
                subject: 'Intresseanmälan: GenPRD'
            },
            // NYTT: Konfiguration för Gaming (Uppdaterad text för att matcha kortet)
            gaming: {
                icon: 'ph-game-controller',
                title: 'R&D: AI-Gaming',
                desc: 'AI-genererade spel är framtiden. Vi bygger prototyper i skärningspunkten mellan Three.js och LLM:er. Skriv upp dig för beta-access.',
                subject: 'Intresseanmälan: AI-Gaming'
            },
            seo: {
                icon: 'ph-globe-hemisphere-east', // Bytt ikon till global/geo
                title: 'GEO/AEO Hälsovakt - Kampanj', // UPPDATERAT: SEO -> GEO/AEO
                desc: 'Vi bjuder på tekniska analyser fram till 1:a januari. Skriv upp dig nu så kör vi en fullständig scan av er webbplats manuellt (med fokus på Generative Engine Optimization) och skickar rapporten.',
                subject: 'Beställning: Gratis GEO/AEO-Analys', // UPPDATERAT
                linkText: 'Tjuvkika på verktyget (Live Demo) →',
                linkUrl: 'https://nordsym.github.io/Nordsym-Seo-Halsovakt/'
            }
        };

        window.nord.openDynamicWaitlist = function(productKey) {
            const config = productWaitlistConfig[productKey];
            if (!config) {
                console.warn(`[NordSym] Okänd produktnyckel för väntelista: ${productKey}`);
                return;
            }

            // Uppdatera innehåll
            const iconEl = document.getElementById('modal-waitlist-icon');
            const titleEl = document.getElementById('modal-waitlist-title');
            const descEl = document.getElementById('modal-waitlist-desc');
            const subjectEl = document.getElementById('modal-waitlist-subject');
            const linkEl = document.getElementById('modal-waitlist-link');

            if (iconEl) iconEl.className = `${config.icon} text-4xl text-nord-sym-cyan mb-4`;
            if (titleEl) titleEl.textContent = config.title;
            if (descEl) descEl.textContent = config.desc;
            if (subjectEl) subjectEl.value = config.subject;

            // Hantera extern länk (Tjuvkika)
            if (linkEl) {
                if (config.linkUrl && config.linkText) {
                    linkEl.href = config.linkUrl;
                    linkEl.textContent = config.linkText;
                    linkEl.classList.remove('hidden');
                } else {
                    linkEl.classList.add('hidden');
                }
            }

            // Öppna modalen (återanvänder befintlig logik)
            window.nord.openComingSoonModal();
        };

        // --- MODAL-LOGIK FÖR KOMMER SNART ---
        window.nord.openComingSoonModal = function() {
            const modal = document.getElementById('coming-soon-modal');
            if (modal) {
                document.body.style.overflow = 'hidden';
                modal.classList.add('visible');
            }
        };

        window.nord.closeComingSoonModal = function() {
            const modal = document.getElementById('coming-soon-modal');
            if (modal) {
                document.body.style.overflow = '';
                modal.classList.remove('visible');
            }
        };

        const comingSoonModal = document.getElementById('coming-soon-modal');
        if (comingSoonModal) {
            comingSoonModal.addEventListener('click', function(event) {
                // Om klicket sker på den halvtransparenta bakgrunden, stäng rutan.
                if (event.target === comingSoonModal) {
                    window.nord.closeComingSoonModal();
                }
            });
        }
        
        // --- MODAL-LOGIK FÖR FOUNDER INFO (NY) ---
        window.nord.openFounderModal = function() {
            const modal = document.getElementById('founder-modal');
            if (modal) {
                document.body.style.overflow = 'hidden';
                modal.classList.add('visible');
            }
        };

        window.nord.closeFounderModal = function() {
            const modal = document.getElementById('founder-modal');
            if (modal) {
                document.body.style.overflow = '';
                modal.classList.remove('visible');
            }
        };

        const founderModal = document.getElementById('founder-modal');
        if (founderModal) {
            founderModal.addEventListener('click', function(event) {
                if (event.target === founderModal) {
                    window.nord.closeFounderModal();
                }
            });
        }

        // --- BORTTAGET: MODAL-LOGIK FÖR GRATIS AGENT ---
        
        new FormManager('formSkraddarsydd', 'xqabggao');
        // NY: Koppla vänteliste-formuläret (Återanvänder kontakt-ID tills vidare)
        new FormManager('waitlistForm', 'xqabggao'); 
        
        new ChatManager(); // Instantiate the new chat manager
        new ThemeManager(); // <-- NY TEMAHANTERARE
        new CookieManager(); // <-- NY COOKIE MANAGER
        new ShowcaseManager(); // <-- NY SHOWCASE MANAGER
        
        // NY: Initiera Arkitektur-slidern
        new ArchitectureShowcaseManager();

        // --- NYTT: GLASS BOX ENGINE ---
        // Exponerar spel-managern globalt - BORTTAGEN.
        // window.aiFirstGameManager = new AIFirstGameManager();
        // window.aiFirstGameManager.init();
        
        // Starta Nya Architecture Managern - BORTTAGEN (Vi kör statiskt nu)
        // window.architectureManager = new ArchitectureDemoManager();
        // window.architectureManager.init();
        
        document.getElementById('currentYear').textContent = new Date().getFullYear();
    });

    // --- BORTTAGET: ARCHITECTURE DEMO MANAGER & SYSTEM LOG MANAGER ---
    // Vi rensar bort all "cool" kod för terminaler och karuseller.
    // Bondförnuft kräver ingen JavaScript-loop.

    class ThemeManager {
        constructor() {
            // UPPDATERAT: Lyssna på Checkboxen (Desktop) och Knappen (Mobil)
            this.themeCheckbox = document.getElementById('theme-switch-input');
            this.themeBtnMobile = document.getElementById('theme-toggle-btn-mobile');
            this.body = document.body;
            
            // Standard: Light Mode (Om inget sparats)
            this.currentTheme = localStorage.getItem('theme') || 'light';
            
            this.init();
        }

        init() {
            this.setTheme(this.currentTheme);

            // Desktop Switch Handler
            if (this.themeCheckbox) {
                this.themeCheckbox.addEventListener('change', () => {
                    const newTheme = this.themeCheckbox.checked ? 'dark' : 'light';
                    this.setTheme(newTheme);
                });
            }

            // Mobile Button Handler
            if (this.themeBtnMobile) {
                this.themeBtnMobile.addEventListener('click', () => {
                    const newTheme = this.body.classList.contains('light-theme') ? 'dark' : 'light';
                    this.setTheme(newTheme);
                });
            }
            
            setTimeout(() => {
                window.nord?.unifiedGeometry?.setGlobalTheme?.(this.currentTheme);
            }, 100);
        }

        setTheme(theme) {
            this.body.classList.remove('light-theme', 'dark-theme');
            this.body.classList.add(`${theme}-theme`);
            
            localStorage.setItem('theme', theme);
            this.currentTheme = theme;

            // Synka UI (Checkbox & Mobilknapp)
            if (this.themeCheckbox) {
                // Dark = Checked, Light = Unchecked
                this.themeCheckbox.checked = (theme === 'dark');
            }
            
            if (this.themeBtnMobile) {
                this.themeBtnMobile.innerHTML = theme === 'light' ? '<i class="ph ph-moon"></i>' : '<i class="ph ph-sun"></i>';
            }

            window.nord?.unifiedGeometry?.setGlobalTheme?.(theme);
        }
    }

    class CookieManager {
        constructor() {
            this.banner = document.getElementById('cookie-consent');
            this.acceptBtn = document.getElementById('cookie-accept-btn');
            this.storageKey = 'nordsym_cookie_consent'; // Unik nyckel för NordSym
            
            if (this.banner && this.acceptBtn) {
                this.init();
            }
        }

        init() {
            try {
                // 1. Kolla om nyckeln saknas i localStorage (Säkerhet för Incognito)
                const hasConsent = localStorage.getItem(this.storageKey);
                
                if (!hasConsent) {
                    // 2. Visa bannern efter en liten fördröjning
                    setTimeout(() => {
                        this.banner.classList.add('visible');
                    }, 2000); 
                }
            } catch (e) {
                // Om localStorage är avstängt (strikt privacy), visa bannern ändå (fallback)
                setTimeout(() => {
                    this.banner.classList.add('visible');
                }, 2000);
            }

            // 3. Lyssna på klick
            this.acceptBtn.addEventListener('click', () => {
                this.acceptCookies();
            });
        }

        acceptCookies() {
            // Animera ut bannern
            this.banner.classList.remove('visible');
            
            try {
                // Spara godkännandet
                localStorage.setItem(this.storageKey, 'true');
            } catch (e) {
                console.warn('Kunde inte spara cookie-val (Incognito/Private mode?)');
            }
        }
    }

    /* --- NY: SHOWCASE MANAGER (KONTROLLRUMSKARUSELL) --- */
    class ShowcaseManager {
        constructor() {
            this.currentIndex = 0;
            this.slides = document.querySelectorAll('.monitor-wrapper');
            this.dots = document.querySelectorAll('.showcase-dot');
            this.prevBtn = document.querySelector('.showcase-prev');
            this.nextBtn = document.querySelector('.showcase-next');
            
            if (!this.slides.length) return;
            
            this.init();
        }

        init() {
            this.prevBtn?.addEventListener('click', () => this.prev());
            this.nextBtn?.addEventListener('click', () => this.next());
            
            this.dots.forEach(dot => {
                dot.addEventListener('click', (e) => {
                    const index = parseInt(e.target.dataset.index);
                    this.goTo(index);
                });
            });
        }

        update() {
            // Update Slides
            this.slides.forEach((slide, index) => {
                if (index === this.currentIndex) {
                    slide.classList.add('active');
                } else {
                    slide.classList.remove('active');
                }
            });

            // Update Dots
            this.dots.forEach((dot, index) => {
                if (index === this.currentIndex) {
                    dot.classList.remove('bg-sky-700', 'opacity-50');
                    dot.classList.add('bg-nord-sym-cyan', 'opacity-100');
                } else {
                    dot.classList.add('bg-sky-700', 'opacity-50');
                    dot.classList.remove('bg-nord-sym-cyan', 'opacity-100');
                }
            });
        }

        next() {
            this.currentIndex = (this.currentIndex + 1) % this.slides.length;
            this.update();
        }

        prev() {
            this.currentIndex = (this.currentIndex - 1 + this.slides.length) % this.slides.length;
            this.update();
        }

        goTo(index) {
            this.currentIndex = index;
            this.update();
        }
    }

    /* --- NY KLASS: ArchitectureShowcaseManager (För Arkitektur-sidan) --- */
    class ArchitectureShowcaseManager {
        constructor() {
            this.currentIndex = 0;
            this.slides = document.querySelectorAll('.arch-slide');
            this.dots = document.querySelectorAll('.arch-dot');
            this.prevBtn = document.getElementById('arch-prev');
            this.nextBtn = document.getElementById('arch-next');
            
            if (!this.slides.length) return;
            
            this.init();
        }

        init() {
            this.prevBtn?.addEventListener('click', () => this.prev());
            this.nextBtn?.addEventListener('click', () => this.next());
            
            this.dots.forEach(dot => {
                dot.addEventListener('click', (e) => {
                    const index = parseInt(e.target.dataset.index);
                    this.goTo(index);
                });
            });

            // HARMONI-FIX: Kör update direkt för att säkerställa korrekt visibilitet vid start
            this.update();
        }

        update(direction = 'next') {
            this.slides.forEach((slide, index) => {
                // Ta bort alla positioneringsklasser först
                slide.style.opacity = '0';
                slide.style.pointerEvents = 'none';
                slide.style.zIndex = '0';
                
                if (index === this.currentIndex) {
                    // ACTIVE SLIDE
                    slide.style.opacity = '1';
                    slide.style.transform = 'translateX(0) scale(1)';
                    slide.style.pointerEvents = 'auto';
                    slide.style.zIndex = '10';
                } else if (index < this.currentIndex) {
                    // PREVIOUS SLIDE (Exit Left)
                    slide.style.transform = 'translateX(-100px) scale(0.9)';
                } else {
                    // NEXT SLIDE (Wait Right)
                    slide.style.transform = 'translateX(100px) scale(0.9)';
                }
            });

            // Update Dots
            this.dots.forEach((dot, index) => {
                if (index === this.currentIndex) {
                    dot.classList.remove('bg-sky-800');
                    dot.classList.add('bg-nord-sym-cyan');
                } else {
                    dot.classList.add('bg-sky-800');
                    dot.classList.remove('bg-nord-sym-cyan');
                }
            });
        }

        next() {
            this.currentIndex = (this.currentIndex + 1) % this.slides.length;
            this.update('next');
        }

        prev() {
            this.currentIndex = (this.currentIndex - 1 + this.slides.length) % this.slides.length;
            this.update('prev');
        }

        goTo(index) {
            const direction = index > this.currentIndex ? 'next' : 'prev';
            this.currentIndex = index;
            this.update(direction);
        }
    }

    class RitbordetManager {
        constructor() {
            this.processCardsData = [
                { 
                    icon: 'ph-map-trifold', 
                    title: 'KARTLÄGGNING', 
                    description: 'Vi avkodar era värdeflöden och identifierar möjligheter för intelligent förstärkning.', 
                    isFlippable: true,
                    backside: {
                        title: 'Leveranser',
                        items: [
                            { icon: 'ph-graph', text: 'Värdeflödesanalys' },
                            { icon: 'ph-map-trifold', text: 'Systemkarta' },
                            { icon: 'ph-check-square', text: 'Roadmap för Transformation' }
                        ]
                    }
                },
                { 
                    icon: 'ph-compass-tool', 
                    title: 'ARKITEKTUR', 
                    description: 'Vi designar intelligenta system kalibrerade för era unika processer och affärslogik.', 
                    isFlippable: true,
                    backside: {
                        title: 'Kärnkomponenter',
                        items: [
                            { icon: 'ph-brain', text: 'AI-Agent Design' },
                            { icon: 'ph-database', text: 'Datamodellering' },
                            { icon: 'ph-shield-check', text: 'Säkerhet & Skalbarhet' }
                        ]
                    }
                },
                { 
                    icon: 'ph-rocket-launch', 
                    title: 'AKTIVERING', 
                    description: 'Systemet integreras. Era processer förvandlas till lärande intelligens.', 
                    isFlippable: true,
                    backside: {
                        title: 'Resultat',
                        items: [
                            { icon: 'ph-rocket-launch', text: 'Driftsatt Ekosystem' },
                            { icon: 'ph-chart-line', text: 'Realtids-Dashboard' },
                            { icon: 'ph-arrows-clockwise', text: 'Kontinuerlig Evolution' }
                        ]
                    }
                }
            ];
            this.valueCardsData = [
                 { type: 'default', icon: 'ph-graph', title: 'TRANSFORMATION', description: 'Intelligenta system som växer med er verksamhet och möjliggör obegränsad skalning.', buttonText: 'Läs Caset →', externalLink: 'https://gushem.github.io/Landningsida-Nordsym-Klara-agent/' },
                 { type: 'default', icon: 'ph-atom', title: 'KÄRNKOMPONENTER', description: 'Distribuerad intelligens byggd på era affärsregler - system som förstår er branschlogik och utvecklas med den.', buttonText: 'Utforska Arkitekturen', page: 'system', tooltip: 'Vår motor för sömlös synkronisering av intelligens.' },
                 { type: 'pricing-preview', title: 'INVESTERING', price: '75k - 500k+', description: 'Från investering till intelligent evolution. Er framtidsförsäkring börjar här.', buttonText: 'Se Paket →', page: 'system' }
            ];
        }

        init() {
            // Harmoni-fix: Förenklad och robust logik. Skapa alltid innehållet för både desktop och mobil.
            // Låt CSS sköta synligheten via @media queries. Detta eliminerar komplex och felbenägen JS-logik.
            this.populateDesktopCards();
            this.renderMobileLayout();
        }

        populateDesktopCards() {
            const topContainer = document.getElementById('ritbordet-grid-top');
            const bottomContainer = document.getElementById('ritbordet-grid-bottom');
            if(!topContainer || !bottomContainer) return;
            
            topContainer.innerHTML = this.processCardsData.map(card => this.createCardHTML(card)).join('');
            bottomContainer.innerHTML = this.valueCardsData.map(card => this.createCardHTML(card)).join('');
        }
        
        createCardHTML(card) {
            // Harmoni-fix: Länken "Läs Caset" pekar nu mot den externa landningssidan.
            // Logiken har anpassats för att hantera både interna och externa länkar.
            let buttonHTML = '';
            if (card.buttonText) {
                if (card.externalLink) {
                    buttonHTML = `<a href="${card.externalLink}" target="_blank" rel="noopener noreferrer" class="btn-base btn-secondary-on-dark text-sm">${card.buttonText}</a>`;
                } else {
                    const clickHandler = `window.nord.showPage('hero'); setTimeout(() => document.getElementById('${card.page}').scrollIntoView({ behavior: 'smooth' }), 500);`;
                    buttonHTML = `<button onclick="${card.page === 'atom-gallery-section' ? clickHandler : `window.nord.showPage('${card.page}')`}" class="btn-base btn-secondary-on-dark text-sm">${card.buttonText}</button>`;
                }
            }
            
            // NYTT: Lägg till "vänd"-ikon om kortet är markerat som vändbart
            const flipIconHTML = card.isFlippable 
                ? `<i class="ph ph-arrows-clockwise absolute top-4 right-4 text-sky-600/70 text-xl transition-all group-hover:text-sky-400" aria-hidden="true"></i>`
                : '';

            if(card.type === 'pricing-preview') {
                return `<div class="ritbordet-card pricing-preview card-base group">
                            <i class="ph ph-tag"></i>
                            <h4>${card.title}</h4>
                            <div class="price-range">${card.price}</div>
                            <p>${card.description}</p>
                            ${buttonHTML}
                        </div>`;
            }

            // --- NYTT: Logik för vändbara kort ---
            if (card.isFlippable) {
                const backsideHTML = `
                    <div class="flip-card-back">
                        <h5>${card.backside.title}</h5>
                        <ul>
                            ${card.backside.items.map(item => `
                                <li><i class="ph ${item.icon}"></i> ${item.text}</li>
                            `).join('')}
                        </ul>
                        <!-- Ikon för att vända tillbaka, placerad på baksidan -->
                        <i class="ph ph-arrow-u-left-top absolute top-4 right-4 text-sky-600/70 text-xl transition-all group-hover:text-sky-400" aria-hidden="true"></i>
                    </div>
                `;

                const frontsideHTML = `
                    <div class="flip-card-front group"> <!-- 'group' flyttad hit för hover-effekt på ikon -->
                        ${flipIconHTML} <!-- Ikon för att vända -->
                        <i class="ph ${card.icon}"></i>
                        <h4>${card.title}</h4>
                        <p>${card.description}</p>
                        ${buttonHTML}
                    </div>
                `;

                return `<div class="ritbordet-card card-base flippable" onclick="this.classList.toggle('is-flipped')">
                            <div class="flip-card-inner">
                                ${frontsideHTML}
                                ${backsideHTML}
                            </div>
                        </div>`;
            }
            // --- Slut på vändbar logik ---

            return `<div class="ritbordet-card card-base group" ${card.tooltip ? `title="${card.tooltip}"` : ''}>
                        ${flipIconHTML} <!-- Här läggs ikonen till -->
                        <i class="ph ${card.icon}"></i>
                        <h4>${card.title}</h4>
                        <p>${card.description}</p>
                        ${buttonHTML}
                    </div>`;
        }

        renderMobileLayout() {
            const mobileContent = document.getElementById('mobile-lobby-content');
            if (!mobileContent) return;

            const allCards = [...this.processCardsData, ...this.valueCardsData];
            const mobileHTML = `<div class="ritbordet-grid">${allCards.map(c => this.createCardHTML(c)).join('')}</div>`;
            
            mobileContent.innerHTML = mobileHTML;
        }
    }

    /* --- NYTT: STARFALL MANAGER (CANVAS ENGINE) - CLEAN VERSION --- */
    class StarfallManager {
        constructor() {
            this.canvas = document.getElementById('starfall');
            if (!this.canvas) return;
            
            this.ctx = this.canvas.getContext('2d');
            this.stars = [];
            this.meteors = [];
            this.width = window.innerWidth;
            this.height = window.innerHeight;
            this.isMobile = window.innerWidth < 768;
            
            // Konfiguration
            this.config = {
                starCount: this.isMobile ? 150 : 400,
                meteorChance: 0.008, // Tillbaka till original-frekvens
                colors: {
                    star: '255, 255, 255',
                    meteorHead: '#00BFFF', // NordSym Cyan
                    meteorTrailEnd: 'rgba(0, 191, 255, 0)'
                }
            };

            this.init();
        }

        init() {
            this.handleResize();
            window.addEventListener('resize', () => this.handleResize());
            this.createStars();
            this.animate();
        }

        handleResize() {
            this.width = window.innerWidth;
            this.height = window.innerHeight;
            this.canvas.width = this.width;
            this.canvas.height = this.height;
            this.isMobile = this.width < 768;
            
            const targetCount = this.isMobile ? 150 : 400;
            if (this.stars.length < targetCount) {
                for (let i = this.stars.length; i < targetCount; i++) this.stars.push(this.createStar());
            } else if (this.stars.length > targetCount) {
                this.stars.length = targetCount;
            }
        }

        createStar() {
            return {
                x: Math.random() * this.width,
                y: Math.random() * this.height,
                size: Math.random() * 1.5 + 0.5,
                baseOpacity: Math.random() * 0.5 + 0.1,
                pulseSpeed: Math.random() * 0.02 + 0.005,
                pulseOffset: Math.random() * Math.PI * 2
            };
        }

        createStars() {
            this.stars = [];
            for (let i = 0; i < this.config.starCount; i++) {
                this.stars.push(this.createStar());
            }
        }

        createMeteor() {
            const startX = Math.random() * this.width * 1.5; 
            const startY = -150;
            return {
                x: startX, y: startY,
                length: Math.random() * 80 + 40,
                speed: Math.random() * 10 + 6,
                thickness: Math.random() * 1.5 + 0.5,
                angle: Math.PI / 4 + (Math.random() * 0.1 - 0.05),
                type: 'meteor'
            };
        }

        drawStars() {
            const time = Date.now();
            for (let i = 0; i < this.stars.length; i++) {
                const star = this.stars[i];
                const pulse = Math.sin(time * 0.002 * star.pulseSpeed + star.pulseOffset);
                const currentOpacity = star.baseOpacity + (pulse * 0.2);
                this.ctx.fillStyle = `rgba(${this.config.colors.star}, ${Math.max(0, Math.min(1, currentOpacity))})`;
                this.ctx.fillRect(star.x, star.y, star.size, star.size);
            }
        }

        updateAndDrawMeteors() {
            if (Math.random() < this.config.meteorChance && this.meteors.length < 5) {
                this.meteors.push(this.createMeteor());
            }
            for (let i = this.meteors.length - 1; i >= 0; i--) {
                const m = this.meteors[i];
                m.x -= m.speed * Math.cos(m.angle); 
                m.y += m.speed * Math.sin(m.angle);
                const tailX = m.x + m.length * Math.cos(m.angle);
                const tailY = m.y - m.length * Math.sin(m.angle);
                const gradient = this.ctx.createLinearGradient(m.x, m.y, tailX, tailY);
                gradient.addColorStop(0, this.config.colors.meteorHead); 
                gradient.addColorStop(1, this.config.colors.meteorTrailEnd);
                this.ctx.strokeStyle = gradient;
                this.ctx.lineWidth = m.thickness;
                this.ctx.lineCap = 'round';
                this.ctx.beginPath();
                this.ctx.moveTo(m.x, m.y);
                this.ctx.lineTo(tailX, tailY);
                this.ctx.stroke();
                if (m.y > this.height + 200 || m.x < -200) this.meteors.splice(i, 1);
            }
        }

        animate() {
            // OPTIMERING: Pausa rendering i Light Mode för att spara prestanda och dölja stjärnorna
            if (document.body.classList.contains('light-theme')) {
                this.ctx.clearRect(0, 0, this.width, this.height);
                requestAnimationFrame(() => this.animate());
                return;
            }

            this.ctx.clearRect(0, 0, this.width, this.height);
            this.drawStars();
            this.updateAndDrawMeteors();
            requestAnimationFrame(() => this.animate());
        }
    }

    class GalleryManager {
        constructor() {
            this.isInitialMobileLoad = true; // HARMONI-FIX: Flagga för att förhindra initial scroll.
            this.paginationContainer = document.getElementById('galleryPagination');
            this.lastCardsPerPage = 0; // To track resize changes
            
            // --- DATAHARMONISERING START ---
            // BORTTAGEN: Den gamla monolitiska galleryData
            
            // NYTT: Data uppdelad i två källor
            this.komponenterData = [
                {
                    icon: 'ph-cpu',
                    title: 'Core Intelligence',
                    description: 'NordSym bygger inte på gårdagens teknik. Systemen orkestrerar dynamiskt marknadens vassaste modeller för varje unik uppgift. Gemini för kontext, Claude för kod, Sonnet för nyans.',
                    signatures: [
                        { icon: 'ph-lightning', text: 'Gemini 3.0' },
                        { icon: 'ph-terminal-window', text: 'Claude Code' },
                        { icon: 'ph-brain', text: 'Sonnet 4.5' }
                    ],
                    indicator: 'Multi-Model Orkestrering. Alltid State-of-the-Art.',
                    indicatorColor: 'text-nord-sym-cyan'
                },
                {
                    icon: 'ph-stack',
                    title: 'Arkitektur & Setup',
                    description: 'En modern, händelsestyrd setup utan legacy. Modeller kopplas samman via n8n workflows och minnet säkras i vektordatabaser. Skalbart, serverlöst och blixtsnabbt.',
                    signatures: [
                        { icon: 'ph-arrows-split', text: 'n8n Flows' },
                        { icon: 'ph-database', text: 'Supabase' },
                        { icon: 'ph-globe', text: 'Vercel' }
                    ],
                    indicator: 'Infrastruktur designad för autonoma agenter.'
                },
                {
                    icon: 'ph-code',
                    title: 'Kod & Integration',
                    description: 'NordSym är teknik-agnostiska. Vi levererar produktionskod i det språk er miljö kräver. Oavsett om ni kör React, Next.js, Node.js eller C#, så anpassar sig våra system efter er infrastruktur, inte tvärtom.',
                    signatures: [
                        { icon: 'ph-atom', text: 'React / Next.js' },
                        { icon: 'ph-file-code', text: 'Node.js / TS' },
                        { icon: 'ph-brackets-curly', text: 'C# / .NET' }
                    ],
                    indicator: '100% kompatibilitet med er tech-stack.'
                },
                {
                    icon: 'ph-robot',
                    title: 'AI-Agenter',
                    description: 'Design och implementation av autonoma digitala medarbetare för allt från research till kunddialog. De kan integreras i ett större ekosystem eller driftsättas som kraftfulla, fristående lösningar.',
                    description: 'Intern arkitektur för att hantera och \'streama\' kontext mellan AI-modeller. NordSym bygger och driftar egna MCP-servrar som säkerställer att agenter har delat, persistent minne oavsett vilken AI-modell som anropas.', // <-- Behållen
                    signatures: [ // <-- ÄNDRAD
                        { icon: 'ph-database', text: 'Persistent Minne' },
                        { icon: 'ph-arrows-split', text: 'Kontext-flöde' },
                        { icon: 'ph-check-circle', text: 'Modell-oberoende' } // <-- ÄNDRAD (Bytt från 'ph-pluggable')
                    ],
                    indicator: 'Kärnprotokoll' // <-- Behållen
                },
                {
                    icon: 'ph-layout',
                    title: 'Intelligenta Gränssnitt',
                    description: 'Utveckling av skräddarsydda webbapplikationer och intelligenta dashboards som ger era team och kunder full kontroll över era nya AI-system.',
                     signatures: [
                        { icon: 'ph-palette', text: 'Design' },
                        { icon: 'ph-chart-line', text: 'Data' },
                        { icon: 'ph-user-focus', text: 'Upplevelse' }
                    ],
                    indicator: 'Från interaktiva dashboards till fullskaliga SaaS-plattformar.'
                },
                {
                    icon: 'ph-arrows-clockwise',
                    title: 'Intelligent Automation',
                    description: 'Kartläggning och transformation av era kärnprocesser. Genom att koppla samman era befintliga system med AI-agenter skapar vi självgående flöden som eliminerar manuellt arbete.',
                     signatures: [
                        { icon: 'ph-map-trifold', text: 'Kartläggning' },
                        { icon: 'ph-plugs-connected', text: 'Integration' },
                        { icon: 'ph-timer', text: 'Effektivitet' }
                    ],
                    indicator: 'Optimerar allt från säljstöd (CRM) till intern administration.'
                },
                {
                    icon: 'ph-database',
                    title: 'Data & Insikter',
                    description: 'System som inte bara samlar in, utan också förstår och agerar på er data. Från automatiserad research till att omvandla rådata till strategiska, prediktiva insikter.',
                    signatures: [
                        { icon: 'ph-magnifying-glass', text: 'Analys' },
                        { icon: 'ph-chart-line-up', text: 'Prediktion' },
                        { icon: 'ph-presentation-chart', text: 'Rapportering' }
                    ],
                    indicator: 'Levererar sammansatt intelligens från ledande AI-modeller för dataanalys.' // UPPDATERAT: Säkrare claim
                },
                {
                    icon: 'ph-books',
                    title: 'Dynamiska Kunskapsbaser',
                    description: 'System som inte bara utför uppgifter, utan som aktivt samlar in, strukturerar och förädlar er interna kunskap. Vi skapar ett levande företagsminne som gör hela organisationen smartare.',
                    signatures: [
                        { icon: 'ph-download-simple', text: 'Insamling' },
                        { icon: 'ph-list-dashes', text: 'Strukturering' },
                        { icon: 'ph-brain', text: 'Resonemang' }
                    ],
                    indicator: 'Från spridd data till ett centraliserat, intelligent \'företagsminne\'.'
                },
                {
                    icon: 'ph-shield-check',
                    title: 'Evolution & Säkerhet',
                    description: 'Ett intelligent system måste vara säkert. Vi bygger självreparerande och säkra arkitekturer med proaktiv övervakning, åtkomstkontroll och en plan för kontinuerlig evolution.',
                    signatures: [
                        { icon: 'ph-lock', text: 'Säkerhet' },
                        { icon: 'ph-binoculars', text: 'Övervakning' },
                        { icon: 'ph-graph', text: 'Skalbarhet' }
                    ],
                    indicator: 'Byggt för hög tillgänglighet och proaktivt hotförsvar.' // UPPDATERAT: Säkrare claim
                }
                // BORTTAGNA: De två sista teaser-korten flyttas till 'arketyperData'
            ];

            this.arketyperData = [
                {
                    imageUrl: 'https://raw.githubusercontent.com/GusHem/Logga-utan-text/refs/heads/main/Final%20logo%20no%20text.svg',
                    title: 'FlowVault', 
                    description: 'Ett kurerat bibliotek av produktionsfärdiga n8n-flöden. Från komplexa svenska integrationer (t.ex. Fortnox) till avancerade AI-svärmar. Hämta verifierade blåkopior och accelerera er utvecklingstakt drastiskt.',
                    signatures: [
                        { icon: 'ph-stack', text: 'Svenska API:er' },
                        { icon: 'ph-robot', text: 'AI-Svärmar' },
                        { icon: 'ph-lock-open', text: 'Open Source' }
                    ],
                    // UPPDATERAT: Pris-indikation
                    indicator: 'Automatisera snabbare. Starta gratis.',
                    ctaText: 'Öppna Valvet', 
                    ctaIcon: 'ph-arrow-square-out',
                    ctaLink: 'https://nordsym.github.io/flowvault/'
                },
                {
                    imageUrl: 'https://raw.githubusercontent.com/GusHem/Logga-utan-text/refs/heads/main/Final%20logo%20no%20text.svg',
                    title: 'Syns du i AI-Sök?',
                    description: 'Från traditionellt sök till GEO och AEO. Optimera din digitala närvaro för AI-sökmotorer som ChatGPT, Claude och Perplexity. Vi transformerar din webbplats från en statisk sida till en källa som AI-motorer litar på och citerar.',
                    signatures: [
                        { icon: 'ph-brain', text: 'AEO' },
                        { icon: 'ph-sparkle', text: 'GEO' },
                        { icon: 'ph-magnifying-glass', text: 'SEO' }
                    ],
                    // UPPDATERAT: Pris-indikation
                    indicator: 'Är ditt varumärke redo? Från 1,999 kr/mån.',
                    ctaText: 'Gör Gratis Analys',
                    ctaIcon: 'ph-sparkle',
                    /* UPPDATERAT: Länken pekar nu korrekt mot AEO Platform */
                    ctaLink: 'https://nordsym.github.io/aeo-platform/'
                },
                {
                    // UPPDATERAD: GenPRD med anpassad design (Kawaii/Tech)
                    customLogo: `
                        <div class="genprd-logo-wrapper">
                            <div class="genprd-logo-inner">
                                <img src="https://firebasestorage.googleapis.com/v0/b/nordsym-funnel.firebasestorage.app/o/foxPRDthink.svg?alt=media&token=f22ea0fe-8edd-41de-84e0-b87e706ea07d" alt="GenPRD Räv" class="genprd-logo-img">
                            </div>
                        </div>
                    `,
                    // UPPDATERAT: Förenklad struktur enligt specifikation (Container > Text + Span)
                    title: '<span class="genprd-brand-text">Gen<span class="genprd-text-prd">PRD</span></span>',
                    description: 'Sluta gissa, börja bygga. GenPRD omvandlar din produktidé till en detaljerad teknisk kravspecifikation (PRD) optimerad för AI-agenter. Få databasscheman, user flows och tech stacks på sekunder.',
                    signatures: [
                        { icon: 'ph-file-code', text: 'PRD-Generator' },
                        { icon: 'ph-database', text: 'SQL-Schema' },
                        { icon: 'ph-magic-wand', text: 'AI-Kontext' }
                    ],
                    // UPPDATERAT: Pris-indikation
                    indicator: 'Context-as-a-Service. Testa gratis.',
                    ctaText: 'Testa GenPRD',
                    ctaIcon: 'ph-lightning',
                    ctaLink: 'https://genprd.se'
                },
                // BORTTAGET: Beaver, Klara och FlowNode (Inaktiva projekt städades bort för att fokusera på kärnprodukterna)
                
                // NYA TILLAGDA KORT (Flyttade från Byggstenar)
                {
                    teaser: true,
                    icon: 'ph-lock-simple',
                    title: 'Nästa Generations AI-Kärna',
                    description: 'En ny nivå av autonomi och proaktiv intelligens, designad för att förutse och agera på framtida behov.',
                    indicator: 'Lansering Q2 2026'
                },
                {
                    teaser: true,
                    icon: 'ph-puzzle-piece',
                    title: 'Adaptiva Gränssnitt',
                    description: 'Revolutionerande UI som anpassar sig i realtid efter användarens unika kontext, mål och arbetsflöde.',
                    indicator: 'Lansering Q3 2026'
                }
            ];

            this.dataSources = {
                'byggstenar': this.komponenterData,
                'galleri': this.arketyperData
            };
            
            // ÄNDRING: Refaktorisera textSources till objekt
            this.textSources = {
                'byggstenar': {
                    // UPPDATERAT: Fas 2 Copy - Stack & Ekosystem
                    description: 'Tekniken under huven. Arkitekturen baseras på ett ekosystem av Claude, Gemini och OpenAI, orkestrerat av n8n och moderna vektordatabaser. Rätt verktyg för rätt kognitiv uppgift.',
                    context: 'Utforska stacken'
                },
                'galleri': {
                    // UPPDATERAT: Fas 2 Copy - Verktyg
                    description: 'Färdiga produkter och Micro-SaaS lösningar. Från AEO-analys till automatiserade PRD-flöden. Specialiserad mjukvara som löser specifika problem direkt.',
                    context: 'Utforska systemen'
                }
            };
            
            this.currentView = 'galleri'; // Startvy
            // --- DATAHARMONISERING SLUT ---
            
            // BORTTAGEN: Den buggiga state-variabeln
            // this.lastPageCount = 0;
        }
        init() {
            this.populateGallery();
            this.setupGalleryControls(); // <-- Måste köras efter populate
            this.initGallerySwitch(); // <-- NYTT ANROP
        }
        populateGallery() {
            const wrapper = document.getElementById('galleryWrapper');
            if (!wrapper) return;
            
            // NY LOGIK: Hämta data från den aktiva källan
            const currentData = this.dataSources[this.currentView];
            wrapper.innerHTML = currentData.map(cardData => this.createCardHTML(cardData)).join('');

            // BORTTAGEN: Den gamla, buggiga "hack"-logiken
            // this.lastCardsPerPage = 0; 
            
            // ERSÄTTNING: Återställ status och uppdatera UI manuellt
            this.isInitialMobileLoad = true; // Förhindra mobil auto-scroll
            this.currentIndex = 0; // Återställ index till SIDA 0
            // this.lastCardsPerPage = 0; // BORTTAGEN
            this.updatePagination(); // Bygger om prickarna
            this.updateGallery(); // Uppdaterar position och knappstatus
        }
        createCardHTML(data) {
             const isTeaser = data.teaser || false;
             const cardClasses = `archetype-card card-base ${isTeaser ? 'teaser' : ''}`;

             let ctaButton = '';
             if (data.ctaText) {
                const isExternal = data.ctaLink && data.ctaLink.startsWith('http');
                const pageId = data.ctaLink && data.ctaLink.startsWith('#') ? data.ctaLink.substring(1) : data.ctaLink;
                const action = data.ctaAction;

                const iconHTML = `<i class="ph ${data.ctaIcon || 'ph-arrow-square-out'}"></i>`;
                const textHTML = `<span>${data.ctaText}</span>`;
                
                if (action) {
                     // DYNAMIC ACTION HANDLER: Support for parameters
                     const param = data.ctaActionParam ? `'${data.ctaActionParam}'` : '';
                     ctaButton = `<a href="#" onclick="event.preventDefault(); window.nord['${action}'](${param});" class="archetype-cta btn-base">${iconHTML}${textHTML}</a>`;
                } else if (isExternal) {
                    ctaButton = `<a href="${data.ctaLink}" target="_blank" rel="noopener noreferrer" class="archetype-cta btn-base">${iconHTML}${textHTML}</a>`;
                } else if (pageId) {
                    ctaButton = `<a href="${data.ctaLink}" onclick="event.preventDefault(); window.nord.showPage('${pageId}');" class="archetype-cta btn-base">${iconHTML}${textHTML}</a>`;
                }
             }
            
            const signaturesHTML = data.signatures ? `
                <div class="tech-signature-container">
                    ${data.signatures.map(sig => `
                        <div class="tech-signature-item">
                            <i class="ph ${sig.icon}"></i>
                            <span>${sig.text}</span>
                        </div>
                    `).join('')}
                </div>
            ` : '';

            // UPPDATERAD: Stöd för customLogo (HTML)
            let imageOrIconHTML;
            if (data.customLogo) {
                imageOrIconHTML = data.customLogo;
            } else {
                imageOrIconHTML = data.imageUrl 
                    ? `<img src="${data.imageUrl}" alt="${data.title} Avatar" class="avatar-image">`
                    : `<i class="ph ${data.icon}"></i>`;
            }

             return `
                <div class="${cardClasses}">
                    ${imageOrIconHTML}
                    <h4>${data.title}</h4>
                    <p class="description">${data.description}</p>
                    ${signaturesHTML}
                    ${ctaButton}
                    <p class="indicator ${data.indicatorColor || ''}">${data.indicator}</p>
                </div>
            `;
        }

        // --- NY FUNKTION START ---
        initGallerySwitch() {
            const btnByggstenar = document.getElementById('gallery-switch-byggstenar');
            const btnGalleri = document.getElementById('gallery-switch-galleri');
            const slider = document.getElementById('gallery-switch-slider');

            if (!btnByggstenar || !btnGalleri || !slider) return;

            const updateSwitchUI = (activeBtn, inactiveBtn) => {
                // Flytta slidern - Nu med exakt positionering (Height + Top)
                slider.style.width = `${activeBtn.offsetWidth}px`;
                slider.style.left = `${activeBtn.offsetLeft}px`;
                slider.style.height = `${activeBtn.offsetHeight}px`;
                slider.style.top = `${activeBtn.offsetTop}px`;

                // Uppdatera klasser - Enkelt: Active eller ej. CSS sköter färgerna.
                activeBtn.classList.add('active');
                activeBtn.classList.remove('inactive');
                
                inactiveBtn.classList.remove('active');
                inactiveBtn.classList.add('inactive');
                
                // Rensa bort gamla manuella färgklasser som kan störa
                activeBtn.classList.remove('text-sky-200', 'text-nord-sym-deep-space-blue', 'text-white');
                inactiveBtn.classList.remove('text-sky-200', 'text-nord-sym-deep-space-blue', 'text-white');
            };

            // Sätt initialt läge (körs efter en kort fördröjning för att låta DOM renderas)
            setTimeout(() => {
                const activeBtn = document.querySelector('.gallery-switch-btn.active') || btnByggstenar;
                const inactiveBtn = activeBtn === btnByggstenar ? btnGalleri : btnByggstenar;
                updateSwitchUI(activeBtn, inactiveBtn);
            }, 100);
            
            // Lyssna även på window resize för att justera pillret om texten bryts om
            window.addEventListener('resize', () => {
                 const activeBtn = document.querySelector('.gallery-switch-btn.active') || btnByggstenar;
                 if(activeBtn) {
                    slider.style.width = `${activeBtn.offsetWidth}px`;
                    slider.style.left = `${activeBtn.offsetLeft}px`;
                    slider.style.height = `${activeBtn.offsetHeight}px`;
                    slider.style.top = `${activeBtn.offsetTop}px`;
                 }
            });

            // Lägg till klick-lyssnare
            btnByggstenar.addEventListener('click', () => {
                if (btnByggstenar.classList.contains('active')) return;
                updateSwitchUI(btnByggstenar, btnGalleri);
                // NYTT: Anropa logik för att byta vy
                this.switchView('byggstenar');
            });

            btnGalleri.addEventListener('click', () => {
                if (btnGalleri.classList.contains('active')) return;
                updateSwitchUI(btnGalleri, btnByggstenar); // KORRIGERAD: Rätt ordning
                // NYTT: Anropa logik för att byta vy
                this.switchView('galleri');
            });
        }
        // --- NY FUNKTION SLUT ---

        // --- ÅTERSTÄLLD FUNKTION: switchView (Fixar TypeError) ---
        switchView(viewName) {
            if (this.currentView === viewName || !gsap) return;
            this.currentView = viewName;
            
            const wrapper = document.getElementById('galleryWrapper');
            const descriptionText = document.getElementById('gallery-description-text');
            const contextText = document.getElementById('gallery-context-text');
            
            const oldCards = gsap.utils.toArray('#galleryWrapper .archetype-card');
            const newTexts = this.textSources[viewName];

            // 1. Animera ut texter
            gsap.to([descriptionText, contextText], {
                opacity: 0,
                duration: 0.3,
                ease: 'power2.in',
                onComplete: () => {
                    // 2. Uppdatera texter när de är dolda
                    descriptionText.textContent = newTexts.description;
                    contextText.textContent = newTexts.context;
                    
                    // 3. Animera in texter
                    gsap.to([descriptionText, contextText], {
                        opacity: 1,
                        duration: 0.4,
                        delay: 0.5, // Vänta tills korten börjar vända in
                        ease: 'power2.out'
                    });
                }
            });

            // 4. Animera ut gamla kort med stagger
            gsap.to(oldCards, {
                rotateY: -90,
                opacity: 0,
                duration: 0.35,
                stagger: 0.07, // Liten fördröjning mellan varje kort
                ease: 'power2.in',
                onComplete: () => {
                    // 5. Byt innehåll
                    this.isInitialMobileLoad = true; // Förhindra mobil auto-scroll
                    this.currentIndex = 0; // Återställ index
                    this.lastCardsPerPage = 0; // Tvinga paginering att ritas om
                    this.populateGallery(); // Bygger om HTML med ny data
                    
                    const newCards = gsap.utils.toArray('#galleryWrapper .archetype-card');
                    
                    // 6. Sätt starttillstånd för nya kort (vända 90 grader)
                    gsap.set(newCards, { rotateY: 90, opacity: 0 });
                    
                    // 7. Animera in nya kort med stagger
                    gsap.to(newCards, {
                        rotateY: 0,
                        opacity: 1,
                        duration: 0.45,
                        stagger: 0.07,
                        delay: 0.2, // Liten paus innan de vänds in
                        ease: 'power2.out'
                    });
                }
            });
        }

        // ÄNDRING: Helt omstrukturerad för att hantera "stale closures"
        // Logiken är utbruten till klassmetoder, setup körs bara en gång.
        setupGalleryControls() {
            const galleryWrapper = document.getElementById('galleryWrapper'),
                nextBtn = document.getElementById('galleryNext'),
                prevBtn = document.getElementById('galleryPrev');
            
            if (!galleryWrapper || !nextBtn || !prevBtn) return;

            // Lyssnare binds EN GÅNG till klassmetoderna
            nextBtn.addEventListener('click', () => this.next());
            prevBtn.addEventListener('click', () => this.prev());
            
            // Mobil scroll-hantering
            if (window.innerWidth <= 768) {
                let scrollTimeout;
                galleryWrapper.addEventListener('scroll', () => {
                    clearTimeout(scrollTimeout);
                    scrollTimeout = setTimeout(() => {
                        const cardWidth = galleryWrapper.children[0].offsetWidth;
                        const gap = 24;
                        this.currentIndex = Math.round(galleryWrapper.scrollLeft / (cardWidth + gap));
                        this.updateGallery();
                    }, 150);
                });
            }

            // Global resize-lyssnare
            window.addEventListener('resize', () => {
                this.isInitialMobileLoad = true;
                this.updatePagination(); // Bygg om paginering om antalet sidor ändras
                this.updateGallery(); // Uppdatera position och knappstatus
            });
        } // <-- FIX: DEN SAKNADE MÅSVINGEN FÖR setupGalleryControls()

        // NY KLASSMETOD: Logik för nästa kort (uppdaterad)
        next() {
            const cardsPerPage = this.getCardsPerPage();
            const currentTotalCards = this.dataSources[this.currentView].length;
            // KORRIGERAD: Logik baserad på pageCount
            const pageCount = Math.ceil(currentTotalCards / cardsPerPage);
            const maxPageIndex = pageCount - 1;
            
            if (this.currentIndex < maxPageIndex) {
                this.currentIndex++;
                this.updateGallery();
            }
        }

        // NY KLASSMETOD: Logik för föregående kort
        prev() {
            if (this.currentIndex > 0) {
                this.currentIndex--;
                this.updateGallery();
            }
        }
        // NY KLASSMETOD: Hämtar kort per sida (KORRIGERAD)
        getCardsPerPage() {
            if (window.innerWidth > 1024) return 3; // KORRIGERAD: 1280 -> 1024
            if (window.innerWidth > 768) return 2;
            return 1;
        }

        // NY KLASSMETOD: Bygger om pagineringsprickarna (KORRIGERAD)
        // BORTTAGEN: Den felaktiga, duplicerade 'updatePagination() {'-raden som orsakade SyntaxError har tagits bort härifrån.
        // NY KLASSMETOD: Bygger om pagineringsprickarna (KORRIGERAD OCH FÖRENKLAD)
        updatePagination() {
            if (!this.paginationContainer) return;
            const cardsPerPage = this.getCardsPerPage();
            const currentTotalCards = this.dataSources[this.currentView].length;
            const pageCount = Math.ceil(currentTotalCards / cardsPerPage);

            // KORRIGERAD: Den 'smarta' if-satsen är borttagen.
            // Vi ritar ALLTID om punkterna när denna funktion anropas
            // (vilket bara är vid 'switchView' eller 'resize').
            this.paginationContainer.innerHTML = '';
            
            if (pageCount <= 1) {
                return; // Inga prickar behövs för en sida
            }

            for (let i = 0; i < pageCount; i++) {
                const dot = document.createElement('button');
                    dot.classList.add('gallery-pagination-dot');
                    dot.setAttribute('aria-label', `Gå till sida ${i + 1}`);
                    dot.addEventListener('click', () => {
                        this.currentIndex = i; // Sätt nuvarande SIDA
                        this.updateGallery();
                    });
                this.paginationContainer.appendChild(dot);
            }
            
            // BORTTAGEN: `this.lastPageCount = pageCount;`
            
            // BORTTAGEN: Den redundanta "active dot"-logiken.
            // `updateGallery` anropas alltid efter `updatePagination`
            // och hanterar detta.
        }

        // NY KLASSMETOD: Uppdaterar galleriets position och knappstatus (KORRIGERAD)
        updateGallery() {
            const galleryWrapper = document.getElementById('galleryWrapper');
            const nextBtn = document.getElementById('galleryNext');
            const prevBtn = document.getElementById('galleryPrev');
            if (!galleryWrapper || !nextBtn || !prevBtn || !galleryWrapper.children.length) return;

            const cardsPerPage = this.getCardsPerPage();
            const currentTotalCards = this.dataSources[this.currentView].length;
            // KORRIGERAD: Logik baserad på pageCount
            const pageCount = Math.ceil(currentTotalCards / cardsPerPage);
            const maxPageIndex = pageCount - 1;
            
            if (this.currentIndex > maxPageIndex) this.currentIndex = maxPageIndex;
            if (this.currentIndex < 0) this.currentIndex = 0;

            const cardWidth = galleryWrapper.children[0]?.offsetWidth || 0;
            if (cardWidth === 0) return;
            
            const gap = window.innerWidth > 768 ? 32 : 24;

            if (window.innerWidth > 768) {
                // KORRIGERAD: Beräkna flytt baserat på SIDA (currentIndex)
                // istället för kort-index.
                const cardIndexToMoveTo = this.currentIndex * cardsPerPage;
                const totalMove = (cardWidth + gap) * cardIndexToMoveTo;
                
                // Vi måste begränsa sista sidans scroll
                const totalWidth = (cardWidth + gap) * currentTotalCards - gap;
                const viewportWidth = galleryWrapper.parentElement.offsetWidth;
                const maxScroll = Math.max(0, totalWidth - viewportWidth);
                
                // Om vi är på sista sidan, scrolla till max
                if (this.currentIndex === maxPageIndex) {
                     galleryWrapper.style.transform = `translateX(-${maxScroll}px)`;
                } else {
                     galleryWrapper.style.transform = `translateX(-${totalMove}px)`;
                }
                
            } else {
                if (!this.isInitialMobileLoad) {
                    const card = galleryWrapper.children[this.currentIndex];
                    if (card) {
                        const scrollTarget = card.offsetLeft;
                        galleryWrapper.scrollTo({ left: scrollTarget, behavior: 'smooth' });
                    }
                }
                this.isInitialMobileLoad = false;
            }

            prevBtn.classList.toggle('disabled', this.currentIndex === 0);
            nextBtn.classList.toggle('disabled', this.currentIndex >= maxPageIndex); // KORRIGERAD
            
            // Uppdatera pagineringsprickarnas status (SÄKERHETSKOLL TILLAGD)
            if (this.paginationContainer) {
                const dots = this.paginationContainer.querySelectorAll('.gallery-pagination-dot');
                dots.forEach((dot, index) => {
                    dot.classList.toggle('active', index === this.currentIndex);
                });
            }
        }
    }

    class ChatManager {
        constructor() {
            // Referenser för NordGPT UI
            this.elements = {
                heroInputWrapper: document.getElementById('hero-input-wrapper'),
                heroInput: document.getElementById('hero-chat-input-field'),
                heroSendBtn: document.getElementById('hero-input-send'),
                resumeBtn: document.getElementById('chat-resume-btn'), // NY
                
                fullscreenInterface: document.getElementById('fullscreen-chat-interface'),
                messagesContainer: document.getElementById('fullscreen-chat-messages'),
                mainTextarea: document.getElementById('chat-main-textarea'),
                mainSendBtn: document.getElementById('chat-main-send-btn'),
                historyList: document.getElementById('chat-history-list')
            };
            
            // Session & Storage
            this.sessionId = localStorage.getItem('nordsym_chat_session_id') || this.generateUUID();
            localStorage.setItem('nordsym_chat_session_id', this.sessionId);
            
            // Hämta sparad historik från localStorage
            this.chatHistory = JSON.parse(localStorage.getItem('nordsym_chat_history') || '[]');
            
            this.hasSentMessage = false;

            this.initEventListeners();
            this.initTypewriter(); 
            this.renderHistorySidebar(); // Rendera historik vid start
            this.checkResumeStatus(); // NY: Kolla om resume-knappen ska visas direkt
            
            // Globala funktioner
            window.nord.closeFullscreenChat = () => this.closeChat();
            window.nord.clearChatHistory = () => this.clearHistory();
            window.nord.resumeChat = () => this.resumeChat(); // NY
        }

        initTypewriter() {
            const input = this.elements.heroInput;
            if (!input) return;

            const phrases = [
                "Fråga NordSym...",
                "Hur kan vi effektivisera admin?",
                "Vad kostar en AI-pilot?",
                "Kan ni integrera med Fortnox?",
                "Hur fungerar AEO-analys?",
                "Bygger ni anpassade agenter?"
            ];

            let loopNum = 0;
            let isDeleting = false;
            let txt = '';
            let timer = null;

            const tick = () => {
                if (this.hasSentMessage) {
                    input.setAttribute('placeholder', 'Fråga NordSym...');
                    return;
                }

                if (document.activeElement === input && input.value !== "") {
                    timer = setTimeout(tick, 2000);
                    return;
                }

                const i = loopNum % phrases.length;
                const fullTxt = phrases[i];

                if (isDeleting) {
                    txt = fullTxt.substring(0, txt.length - 1);
                } else {
                    txt = fullTxt.substring(0, txt.length + 1);
                }

                input.setAttribute('placeholder', txt);

                let delta = 100 - Math.random() * 50; 

                if (isDeleting) { delta /= 2; }

                if (!isDeleting && txt === fullTxt) {
                    delta = 2000; 
                    isDeleting = true;
                } else if (isDeleting && txt === '') {
                    isDeleting = false;
                    loopNum++;
                    delta = 500; 
                }

                timer = setTimeout(tick, delta);
            };

            tick();
        }

        initEventListeners() {
            // HERO INPUT
            if (this.elements.heroSendBtn) {
                this.elements.heroSendBtn.addEventListener('click', () => this.handleHeroSubmit());
            }
            if (this.elements.heroInput) {
                this.elements.heroInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        this.handleHeroSubmit();
                    }
                });
            }

            // MAIN CHAT AREA (NordGPT)
            if (this.elements.mainSendBtn) {
                this.elements.mainSendBtn.addEventListener('click', () => this.handleMainSubmit());
            }
            if (this.elements.mainTextarea) {
                this.elements.mainTextarea.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.handleMainSubmit();
                    }
                });
            }
        }

        handleHeroSubmit() {
            const text = this.elements.heroInput.value.trim();
            if (!text) return;

            this.hasSentMessage = true;
            this.openChat(); // Öppna fullskärmsläget
            
            // Simulera att meddelandet skickas från main chat
            this.processUserMessage(text);
            
            // Rensa hero input
            this.elements.heroInput.value = '';
        }

        handleMainSubmit() {
            const text = this.elements.mainTextarea.value.trim();
            if (!text) return;
            
            this.processUserMessage(text);
            
            // Återställ textarea
            this.elements.mainTextarea.value = '';
            this.elements.mainTextarea.style.height = 'auto'; // Reset height
        }

        processUserMessage(text) {
            // 1. Lägg till i UI
            this.addMessageToUI(text, 'user');
            
            // 2. Spara i historik
            this.saveMessage(text, 'user');
            
            // 3. Visa laddindikator
            this.showTypingIndicator();
            
            // 4. Kognitiv Visualisering: Starta "Hjärnan"
            if (window.UnifiedGeometryManager) {
                window.UnifiedGeometryManager.startThinkingMode();
            }
            
            // 5. Hämta svar
            this.getBotResponse(text);
        }

        openChat() {
            this.elements.fullscreenInterface.classList.add('visible');
            document.body.classList.add('chat-active'); // Trigga Cinema Mode (tonar ner bakgrunden)
            document.body.style.overflow = 'hidden'; // Lås scroll på bakgrunden
            
            // Trigga Geometry Cinema State
            if (window.UnifiedGeometryManager) {
                window.UnifiedGeometryManager.transitionTo('CHAT');
            }
            
            // Dölj resume-knappen när chatten är öppen
            if (this.elements.resumeBtn) this.elements.resumeBtn.classList.remove('visible');
            
            this.renderMessagesFromHistory();
        }

        closeChat() {
            this.elements.fullscreenInterface.classList.remove('visible');
            document.body.classList.remove('chat-active'); // Avsluta Cinema Mode
            document.body.style.overflow = ''; // Lås upp scroll
            
            // Återställ Geometry State (till HERO eller PAGE beroende på var vi är)
            if (window.UnifiedGeometryManager) {
                // Enkel logik: Om vi är på startsidan -> HERO, annars -> PAGE
                const targetState = window.nord.currentPage === 'hero' ? 'HERO' : 'PAGE';
                window.UnifiedGeometryManager.transitionTo(targetState);
            }
            
            // UPPDATERAT: Visa input-baren på hemsidan igen när chatten stängs
            if (this.elements.heroInputWrapper) {
                this.elements.heroInputWrapper.classList.remove('hidden-input');
                // Valfritt: Rensa input-fältet eller återställ placeholder
                this.elements.heroInput.value = '';
                this.hasSentMessage = false; 
            }
            
            // NYTT: Visa resume-knappen om det finns historik
            this.checkResumeStatus();
        }
        
        // NY FUNKTION: Återuppta chatt utan att skicka meddelande
        resumeChat() {
            // Dölj hero input (snyggare transition)
            if (this.elements.heroInputWrapper) {
                this.elements.heroInputWrapper.classList.add('hidden-input');
            }
            this.openChat();
        }
        
        // NY FUNKTION: Kolla om Resume-knappen ska synas
        checkResumeStatus() {
            if (!this.elements.resumeBtn) return;
            
            if (this.chatHistory.length > 0) {
                this.elements.resumeBtn.classList.add('visible');
                // Uppdatera texten valfritt, t.ex. "3 meddelanden"
            } else {
                this.elements.resumeBtn.classList.remove('visible');
            }
        }

        saveMessage(text, sender) {
            const messageObj = {
                text: text,
                sender: sender,
                timestamp: new Date().toISOString()
            };
            this.chatHistory.push(messageObj);
            localStorage.setItem('nordsym_chat_history', JSON.stringify(this.chatHistory));
            this.renderHistorySidebar(); 
            // Resume-status kollas vid stängning, behöver ej köras här
        }
        
        clearHistory() {
            this.chatHistory = [];
            localStorage.removeItem('nordsym_chat_history');
            this.elements.messagesContainer.innerHTML = '';
            this.renderHistorySidebar();
            this.checkResumeStatus(); // Uppdatera knapp (dölj den)
        }

        renderHistorySidebar() {
            if (!this.elements.historyList) return;
            this.elements.historyList.innerHTML = '';
            
            // Visa bara de senaste 5 "startmeddelandena" eller sessionerna
            // För enkelhetens skull visar vi bara ett dummy-objekt "Nuvarande session"
            // I en fullskalig app skulle vi gruppera meddelanden per sessionID
            
            if (this.chatHistory.length > 0) {
                const sessionEl = document.createElement('div');
                sessionEl.className = 'chat-history-item active';
                sessionEl.textContent = 'Pågående konversation';
                this.elements.historyList.appendChild(sessionEl);
            } else {
                const emptyEl = document.createElement('div');
                emptyEl.className = 'text-xs text-gray-500 p-4 italic';
                emptyEl.textContent = 'Ingen historik än...';
                this.elements.historyList.appendChild(emptyEl);
            }
        }
        
        renderMessagesFromHistory() {
            // Rensa UI först för att inte dubblera
            this.elements.messagesContainer.innerHTML = '';
            
            // Rendera allt från minnet
            this.chatHistory.forEach(msg => {
                this.addMessageToUI(msg.text, msg.sender);
            });
            
            this.scrollToBottom();
        }

        generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        addMessageToUI(text, sender) {
            const row = document.createElement('div');
            row.classList.add('chat-message-row', sender);
            
            // Formatera texten (enkel radbrytning)
            // Här skulle vi kunna lägga in Markdown-stöd i framtiden
            const formattedText = text.replace(/\n/g, '<br>');
            
            row.innerHTML = `
                <div class="chat-bubble-content">
                    ${formattedText}
                </div>
            `;
            
            this.elements.messagesContainer.appendChild(row);
            this.scrollToBottom();
        }

        showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.id = 'chat-typing-indicator';
            typingDiv.classList.add('chat-message-row', 'bot');
            typingDiv.innerHTML = `
                <div class="chat-bubble-content">
                    <span class="inline-block w-2 h-2 bg-gray-400 rounded-full animate-bounce mr-1"></span>
                    <span class="inline-block w-2 h-2 bg-gray-400 rounded-full animate-bounce mr-1" style="animation-delay: 0.2s"></span>
                    <span class="inline-block w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.4s"></span>
                </div>
            `;
            this.elements.messagesContainer.appendChild(typingDiv);
            this.scrollToBottom();
        }

        removeTypingIndicator() {
            const indicator = document.getElementById('chat-typing-indicator');
            if (indicator) indicator.remove();
        }

        async getBotResponse(userInput) { 
            const webhookUrl = "https://nordsym.app.n8n.cloud/webhook/399ddc2e-9a3c-4b72-9757-079b730a782c/chat";

            try {
                const response = await fetch(webhookUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        message: userInput,
                        sessionId: this.sessionId 
                    })
                });

                this.removeTypingIndicator(); 

                if (!response.ok) throw new Error(`Webhook error: ${response.statusText}`);

                const data = await response.json();
                const responseText = data?.output;

                if (responseText) {
                    this.addMessageToUI(responseText, 'bot');
                    this.saveMessage(responseText, 'bot');
                } else {
                    const errMsg = "Kunde inte tolka svaret. Försök igen.";
                    this.addMessageToUI(errMsg, 'bot');
                    this.saveMessage(errMsg, 'bot');
                }

            } catch (error) {
                this.removeTypingIndicator();
                console.error("Chat Error:", error);
                const netErrMsg = "Anslutningsproblem. Kontrollera nätverket.";
                this.addMessageToUI(netErrMsg, 'bot');
                this.saveMessage(netErrMsg, 'bot');
            } finally {
                // 6. Kognitiv Visualisering: Återgå till viloläge
                if (window.UnifiedGeometryManager) {
                    window.UnifiedGeometryManager.stopThinkingMode();
                }
            }
        }

        scrollToBottom() {
            const container = document.getElementById('chat-scroll-container');
            if(container) {
                // Smooth scroll to bottom
                setTimeout(() => {
                    container.scrollTop = container.scrollHeight;
                }, 100);
            }
        }
    }

    class FormManager {
        constructor(formId, formspreeId) {
            this.formId = formId;
            this.formspreeId = formspreeId;
            this.formElement = document.getElementById(this.formId);
            if (!this.formElement) return;

            this.container = this.formElement.closest('.form-container');
            
            // HARMONI-FIX: Auto-detektering av formulärtyp (Wizard vs. Enkel)
            // Om inga .form-step hittas, behandla hela formuläret som ett enda steg.
            const detectedSteps = this.formElement.querySelectorAll('.form-step');
            this.steps = detectedSteps.length > 0 ? detectedSteps : [this.formElement];
            
            this.progressBar = this.container ? this.container.querySelector('.form-progress-bar-inner') : null;
            this.currentStep = 0;
            this.totalSteps = this.steps.length;

            this.init();
        }

        init() {
            this.setupEventListeners();
            this.updateProgress();
            // Säkerställ att första steget är aktivt (säkrad åtkomst)
            if (this.steps[0]) {
                this.steps[0].classList.add('active');
            }
        }

        setupEventListeners() {
            this.formElement.addEventListener('submit', this.handleSubmit.bind(this));
            
            this.formElement.querySelectorAll('.form-navigation button').forEach(button => {
                button.addEventListener('click', (e) => {
                    if (e.currentTarget.type === 'button') {
                        const isNext = e.currentTarget.textContent.includes('Nästa');
                        if (isNext) this.nextStep();
                        else this.prevStep();
                    }
                });
            });
        }

        changeStep(stepIndex) {
            const currentStepElement = this.steps[this.currentStep];
            const nextStepElement = this.steps[stepIndex];

            gsap.to(currentStepElement, {
                opacity: 0, 
                y: -10, 
                duration: 0.3, 
                ease: 'power2.in', 
                onComplete: () => {
                    currentStepElement.classList.remove('active');
                    nextStepElement.classList.add('active');
                    this.currentStep = stepIndex;
                    this.updateProgress();
                    gsap.fromTo(nextStepElement, 
                        { opacity: 0, y: 10 }, 
                        { opacity: 1, y: 0, duration: 0.3, ease: 'power2.out' }
                    );
                }
            });
        }

        validateStep() {
            const currentStepElement = this.steps[this.currentStep];
            const inputs = currentStepElement.querySelectorAll('input[required], textarea[required]');
            for (const input of inputs) {
                if (!input.value.trim()) {
                    input.focus();
                    gsap.fromTo(input, { x: -5 }, { x: 5, duration: 0.05, repeat: 5, yoyo: true, clearProps: 'x' });
                    return false;
                }
            }
            return true;
        }

        nextStep() {
            if (this.validateStep() && this.currentStep < this.totalSteps - 1) {
                this.changeStep(this.currentStep + 1);
            }
        }

        prevStep() {
            if (this.currentStep > 0) {
                this.changeStep(this.currentStep - 1);
            }
        }

        updateProgress() {
            const progress = ((this.currentStep + 1) / this.totalSteps) * 100;
            if (this.progressBar) {
                this.progressBar.style.width = `${progress}%`;
            }
        }

        handleSubmit(e) {
            e.preventDefault();
            if (!this.validateStep()) return;

            this.container.classList.add('form-loading');
            
            fetch(`https://formspree.io/f/${this.formspreeId}`, {
                method: 'POST',
                body: new FormData(this.formElement),
                headers: { 'Accept': 'application/json' }
            }).then(response => {
                this.container.classList.remove('form-loading');
                if (response.ok) {
                    this.showSuccess();
                } else {
                    throw new Error('Form submission failed');
                }
            }).catch(() => {
                this.container.classList.remove('form-loading');
                this.showError();
            });
        }

        showSuccess() {
            const successHTML = `
                <div class="form-success-container">
                    <i class="ph-star-four nordsym-logo-star"></i>
                    <p>Tack! Ditt meddelande har skickats. Vi återkommer snart.</p>
                </div>`;
            
            gsap.to(this.container.children, {
                opacity: 0,
                duration: 0.5,
                ease: 'power2.in',
                onComplete: () => {
                    this.container.innerHTML = successHTML;
                    gsap.fromTo(this.container.children, 
                        { opacity: 0, scale: 0.9 },
                        { opacity: 1, scale: 1, duration: 0.5, ease: 'power2.out' }
                    );
                }
            });
        }

        showError() {
            const errorHTML = `<div class="form-message form-error-message" style="display:block;">Ett fel uppstod. Försök igen eller kontakta oss direkt.</div>`;
            this.formElement.innerHTML = errorHTML;
        }
    }

    // --- NYTT: STEG 1.1 (Stomme för AI-First Spelet) ---
    // HELA KLASSEN AIFirstGameManager ÄR RADERAD HÄR FÖR ATT RENSA KODEN
    // --- SLUT PÅ STEG 1.1 ---
    
    </script>
</body>
</html>
