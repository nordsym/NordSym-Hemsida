<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="NordSym AB är en byrå för systemautomation och AI-arkitektur. Vi optimerar er verksamhet för AEO (Answer Engine Optimization) och bygger intelligenta ekosystem.">
    <meta name="keywords" content="Systemautomation Sverige, intelligenta system, AEO, GEO, AI-arkitektur, digital transformation, NordSym">
    <meta name="author" content="NordSym AB">
    <link rel="canonical" href="https://nordsym.com">
    <title>NordSym AB - System som växer med framtiden</title>
    
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="NordSym AB">
    <meta property="og:locale" content="sv_SE">
    <meta property="og:title" content="NordSym AB - System som tänker med er.">
    <meta property="og:description" content="System som tänker med er. Vi bygger er framtidssäkra, intelligenta AI-arkitektur.">
    <meta property="og:image" content="https://raw.githubusercontent.com/GusHem/Logga-utan-text/refs/heads/main/Final%20logo%20no%20text.svg">
    <meta property="og:url" content="https://nordsym.com">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@NordSym">
    <meta name="twitter:creator" content="@NordSym">
    <meta name="twitter:title" content="NordSym AB - System som tänker med er.">
    <meta name="twitter:description" content="System som tänker med er. Vi bygger er framtidssäkra, intelligenta AI-arkitektur.">
    
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-KRLNF7DHVJ"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-KRLNF7DHVJ', { page_title: document.title, page_location: window.location.href });
    </script>
    
    <script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "s6ismr0411");
    </script>

    <!-- FORENSISK ÅTGÄRD: Ersatt script-baserad Tailwind med stabil CSS-version -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollToPlugin.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/examples/js/postprocessing/EffectComposer.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/examples/js/postprocessing/RenderPass.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/examples/js/postprocessing/UnrealBloomPass.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/examples/js/shaders/LuminosityHighPassShader.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/examples/js/shaders/CopyShader.js"></script>


    <!-- NORDSYM TRUTHLAYER (JSON-LD STRUCTURED DATA) -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@graph": [
        {
          "@type": "Organization",
          "@id": "https://nordsym.com/#organization",
          "name": "NordSym AB",
          "url": "https://nordsym.com",
          "logo": {
            "@type": "ImageObject",
            "url": "https://raw.githubusercontent.com/GusHem/Logga-utan-text/refs/heads/main/Final%20logo%20no%20text.svg",
            "width": 512,
            "height": 512
          },
          "sameAs": [
            "https://www.linkedin.com/company/nordsym-ab/",
            "https://x.com/NordSym",
            "https://www.instagram.com/nordsym_ab/"
          ],
          "address": {
            "@type": "PostalAddress",
            "streetAddress": "Rörläggarvägen 39",
            "addressLocality": "Bromma",
            "postalCode": "168 33",
            "addressRegion": "Stockholm",
            "addressCountry": "SE"
          },
          "geo": {
            "@type": "GeoCoordinates",
            "latitude": 59.3390,
            "longitude": 17.9380
          },
          "hasMap": "https://www.google.com/maps/search/?api=1&query=Rörläggarvägen+39,+168+33+Bromma",
          "contactPoint": {
            "@type": "ContactPoint",
            "email": "gustav@nordsym.com",
            "contactType": "customer support"
          },
          "knowsAbout": [
            "Systemautomation",
            "AI-arkitektur",
            "AEO (Answer Engine Optimization)",
            "GEO (Generative Engine Optimization)",
            "Intelligent Process Automation",
            "Micro-SaaS Development"
          ]
        },
        {
          "@type": "Service",
          "@id": "https://nordsym.com/#service-ai-agenter",
          "name": "AI-Agenter",
          "description": "Design och implementering av autonoma digitala medarbetare för kundtjänst, research och administration.",
          "provider": { "@id": "https://nordsym.com/#organization" },
          "areaServed": [
            { "@type": "Country", "name": "Sverige" },
            { "@type": "AdministrativeArea", "name": "Stockholms län" }
          ],
          "serviceType": "Artificial Intelligence"
        },
        {
          "@type": "Service",
          "@id": "https://nordsym.com/#service-ai-first",
          "name": "AI-First Arkitektur",
          "description": "Strategisk systemdesign där AI utgör kärnan i verksamhetens operativsystem för maximal skalbarhet.",
          "provider": { "@id": "https://nordsym.com/#organization" },
          "areaServed": [
            { "@type": "Country", "name": "Sverige" },
            { "@type": "AdministrativeArea", "name": "Stockholms län" }
          ],
          "serviceType": "Software Architecture"
        },
        {
          "@type": "Service",
          "@id": "https://nordsym.com/#service-mcp",
          "name": "Model Context Protocol",
          "description": "Implementation av MCP för att säkerställa delad kontext och minne mellan olika AI-modeller och system.",
          "provider": { "@id": "https://nordsym.com/#organization" },
          "areaServed": [
            { "@type": "Country", "name": "Sverige" },
            { "@type": "AdministrativeArea", "name": "Stockholms län" }
          ],
          "serviceType": "System Integration"
        },
        {
          "@type": "Service",
          "@id": "https://nordsym.com/#service-ui",
          "name": "Intelligenta Gränssnitt",
          "description": "Utveckling av adaptiva gränssnitt och dashboards som anpassar sig efter användarens kontext i realtid.",
          "provider": { "@id": "https://nordsym.com/#organization" },
          "areaServed": [
            { "@type": "Country", "name": "Sverige" },
            { "@type": "AdministrativeArea", "name": "Stockholms län" }
          ],
          "serviceType": "Web Development"
        },
        {
          "@type": "Service",
          "@id": "https://nordsym.com/#service-automation",
          "name": "Intelligent Automation",
          "description": "End-to-end automation av affärsprocesser genom att koppla samman legacy-system med moderna AI-flöden.",
          "provider": { "@id": "https://nordsym.com/#organization" },
          "areaServed": [
            { "@type": "Country", "name": "Sverige" },
            { "@type": "AdministrativeArea", "name": "Stockholms län" }
          ],
          "serviceType": "Process Automation"
        },
        {
          "@type": "Service",
          "@id": "https://nordsym.com/#service-data",
          "name": "Data & Insikter",
          "description": "Avancerad dataanalys och prediktiva insikter drivna av AI för att stödja strategiska beslut.",
          "provider": { "@id": "https://nordsym.com/#organization" },
          "areaServed": [
            { "@type": "Country", "name": "Sverige" },
            { "@type": "AdministrativeArea", "name": "Stockholms län" }
          ],
          "serviceType": "Data Analytics"
        },
        {
          "@type": "BreadcrumbList",
          "@id": "https://nordsym.com/#breadcrumb",
          "itemListElement": [
            { "@type": "ListItem", "position": 1, "name": "Hem", "item": "https://nordsym.com" },
            { "@type": "ListItem", "position": 2, "name": "Arkitektur", "item": "https://nordsym.com/#om-oss" },
            { "@type": "ListItem", "position": 3, "name": "System", "item": "https://nordsym.com/#system" },
            { "@type": "ListItem", "position": 4, "name": "Ritbordet", "item": "https://nordsym.com/#ritbordet" }
          ]
        },
        {
          "@type": "FAQPage",
          "@id": "https://nordsym.com/#faq",
          "mainEntity": [
            {
              "@type": "Question",
              "name": "Vad menar ni med 'AI som operativsystem'?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "För oss är AI inte bara ett verktyg man lägger ovanpå gamla processer. Vi bygger om arkitekturen så att intelligens blir kärnan som driver flödena. Systemet förstår er affärslogik och agerar autonomt, snarare än att bara vänta på input."
              }
            },
            {
              "@type": "Question",
              "name": "Hur säkert är det? Äger vi vår egen data?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "Absolut. Vi bygger systemen så att ni behåller fullt ägandeskap och kontroll över er data. Vi designar 'vallgravar' runt er kärnverksamhet och säkerställer att ingen känslig data tränar publika modeller utan ert medgivande."
              }
            },
            {
              "@type": "Question",
              "name": "Kan ni integrera med våra gamla system (Legacy)?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "Ja. En stor del av vår arkitektur handlar om att bygga bryggor mellan beprövade legacy-system (som affärssystem och databaser) och moderna AI-agenter. Vi moderniserar utan att ni behöver byta ut hela er infrastruktur dag ett."
              }
            },
            {
              "@type": "Question",
              "name": "Vad händer om AI-modellerna förändras?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "Vi bygger modulärt och modell-agnostiskt. Det betyder att vi snabbt kan byta ut 'hjärnan' (t.ex. från GPT-4 till Claude 3.5 eller en lokal modell) utan att behöva bygga om hela systemet. Er arkitektur är framtidssäkrad."
              }
            },
            {
              "@type": "Question",
              "name": "Hur snabbt ser vi ROI?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "Vårt mål är alltid snabb 'time-to-value'. Genom att börja med att automatisera tydliga flaskhalsar (t.ex. administration, kundtjänst eller dataanalys) ser våra kunder ofta en mätbar ROI inom 4-8 veckor efter driftsättning."
              }
            }
          ]
        },
        {
          "@type": "ProfessionalService",
          "@id": "https://nordsym.com/#service",
          "name": "NordSym - Intelligent Systemarkitektur",
          "url": "https://nordsym.com",
          "parentOrganization": {
            "@id": "https://nordsym.com/#organization"
          },
          "description": "Vi bygger framtidssäkra, intelligenta AI-arkitekturer och system som tänker med er.",
          "priceRange": "75000 SEK - 500000+ SEK"
        },
        {
          "@type": "WebSite",
          "@id": "https://nordsym.com/#website",
          "url": "https://nordsym.com",
          "name": "NordSym AB",
          "description": "System som tänker med er. Vi bygger er framtidssäkra, intelligenta AI-arkitektur.",
          "publisher": {
            "@id": "https://nordsym.com/#organization"
          }
        }
      ]
    }
    </script>

    <link rel="preconnect" href="https://www.google-analytics.com">
    <link rel="dns-prefetch" href="//fonts.gstatic.com">
    <link rel="dns-prefetch" href="//formspree.io">
    <link rel="preload" href="https://raw.githubusercontent.com/GusHem/Logga-utan-text/refs/heads/main/Final%20logo%20no%20text.svg" as="image">
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@700&display=swap" as="style">
    <link rel="preload" href="https://unpkg.com/@phosphor-icons/web" as="script">

    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@700&family=Inter:wght@300;400;500;600;700;800&family=Source+Code+Pro:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link rel="icon" href="https://raw.githubusercontent.com/GusHem/Logga-utan-text/refs/heads/main/Final%20logo%20no%20text.svg">
    <style>
        /* --- TAILWIND V3 COMPATIBILITY PATCH (FORENSISK ÅTGÄRD) --- */
        /* Eftersom vi bytte till CSS-versionen (v2) måste vi manuellt definiera v3-specifika färger */
        .text-sky-100 { color: #e0f2fe !important; }
        .text-sky-200 { color: #bae6fd !important; }
        .text-sky-300 { color: #7dd3fc !important; }
        .text-sky-400 { color: #38bdf8 !important; }
        .bg-sky-700\/50 { background-color: rgba(3, 105, 161, 0.5) !important; }
        .bg-sky-800\/50 { background-color: rgba(7, 89, 133, 0.5) !important; }
        .bg-sky-900\/70 { background-color: rgba(12, 74, 110, 0.7) !important; }
        .border-sky-700\/50 { border-color: rgba(3, 105, 161, 0.5) !important; }
        .border-sky-800\/50 { border-color: rgba(7, 89, 133, 0.5) !important; }
        
        /* NÖD-FÄRGER (Mörkt läge som standard) */
        .bg-nord-sym-deep-space-blue { background-color: #0c1427 !important; }
        .bg-nord-sym-deep-space-blue\/95 { background-color: rgba(12, 20, 39, 0.95) !important; }
        .bg-nord-sym-deep-space-blue\/80 { background-color: rgba(12, 20, 39, 0.8) !important; }
        .bg-nord-sym-deep-space-blue\/50 { background-color: rgba(12, 20, 39, 0.5) !important; }
        
        .backdrop-blur-sm { backdrop-filter: blur(4px); -webkit-backdrop-filter: blur(4px); }
        .backdrop-blur-md { backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); }
        
        /* --- OPERATION BALANS: LAYOUT-SÄKRING --- */
        /* Dessa regler ser till att dölja/visa element korrekt även om Tailwind v2 laddas långsamt eller blockeras */
        .hidden { display: none !important; }
        .flex { display: flex !important; }
        .block { display: block !important; }
        
        @media (min-width: 768px) {
            .md\:flex { display: flex !important; }
            .md\:hidden { display: none !important; }
            .md\:block { display: block !important; }
        }
        /* --- SLUT PÅ PATCH --- */

        html {
            /* scroll-behavior: smooth; */ /* BORTTAGEN FÖR ATT LÖSA MOBIL SCROLL-KONFLIKT */
        }
        html, body {
            height: 100%; margin: 0; padding: 0;
            /* Harmoni-fix: Utrotar scroll-konflikten genom att ta bort den globala 'scroll-behavior',
               vilket ger GSAP och JS full, oinskränkt kontroll över alla animationer. */
        }
        body {
            font-family: 'Inter', sans-serif; color: #E2E8F0; 
            padding-top: 80px; display: flex; flex-direction: column;
            background-color: #0c1427;
            min-height: 100vh;
            overflow-y: auto; /* Harmoni-fix: Säkerställer vertikal scrollning på alla enheter. */
        }
        body.labb-active { 
            overflow: hidden;
        }
        @media (min-width: 1024px) { 
            body { padding-top: 116px; } 
        }
        main { flex-grow: 1; background: transparent; }
        :root {
            --nord-sym-cyan: #00D4FF;
            --nord-sym-orange: #FF8C00;
            --nord-sym-purple: #9370DB;
            --nord-sym-deep-space-blue: #0c1427; 
            --nord-sym-mid-space-blue: #1e3a8a; 
            --nord-sym-light-accent: #7dd3fc; 
            --nord-sym-text-light: #F0F4F8; 
            --nord-sym-text-medium: #CBD5E0; 
            --nord-sym-cyan-rgb: 0, 212, 255;
            --nord-sym-light-accent-rgb: 125, 211, 252;
            --nord-sym-deep-space-blue-rgb: 12, 20, 39;
            --nord-sym-mid-space-blue-rgb: 30, 58, 138;
            
            /* NYA FÄRGER: Blåkopia Tema */
            --nord-sym-blueprint-bg: #FDFDFD; /* Pappersvit */
            --nord-sym-blueprint-ink: #0A2540; /* Mörk teknisk bläckblå */
            --nord-sym-blueprint-lines: #D2D6DC; /* Ljusgrå för linjer */
            --nord-sym-blueprint-lines-faint: #E5E7EB; /* Svagare linjer för rutnät */
            --nord-sym-blueprint-cyan: #00BFFF; /* En djupare, skarpare cyan */
            --nord-sym-blueprint-cyan-rgb: 0, 191, 255;
            --nord-sym-blueprint-bg-rgb: 253, 253, 253; /* Pappersvit (RGB) */
            --nord-sym-blueprint-ink-rgb: 10, 37, 64; /* Bläckblå (RGB) */
        }
        .nord-accent-text { color: var(--nord-sym-cyan); }
        h1, h2, .section-title { font-family: 'Comfortaa', sans-serif; }
        .page-content-padding { padding-top: 4rem; padding-bottom: 4rem; }
        .space-background-section {
            background: transparent !important;
            position: relative; overflow: hidden; width: 100%; 
            display: flex; flex-direction: column; align-items: center;
        }
        #hero {
             min-height: calc(100vh - 80px); min-height: calc(100dvh - 80px); /* MODERNISERING FÖR IOS */
             justify-content: center; padding-top: 4rem; padding-bottom: 4rem;
             position: relative; /* For canvas positioning */
        }
        @media (min-width: 1024px) { 
            #hero { min-height: calc(100vh - 116px); min-height: calc(100dvh - 116px); /* MODERNISERING FÖR IOS */ } 
        }
        .section-content-wrapper { 
            position: relative; z-index: 1; width: 100%; max-width: 1280px; 
            padding-left: 1.5rem; padding-right: 1.5rem; margin-left: auto; margin-right: auto;
        }
        .nav-link.active { color: var(--nord-sym-cyan); font-weight: 700; } 
        .btn-base {
            font-weight: 600; border-radius: 9999px; transition: all 0.3s ease;
            box-shadow: 0px 6px 12px rgba(0, 0, 0, 0.25), 0px 2px 4px rgba(0,0,0,0.2), 
                        inset 0px -2px 1px rgba(255,255,255,0.05), inset 0px 1px 1px rgba(0,0,0,0.1); 
            display: inline-flex; align-items: center; justify-content: center;
            gap: 0.5rem; text-align: center;
        }
        .btn-cta-revised {
            padding: 0.85rem 2.25rem;
            background: rgba(0, 31, 63, 0.8);
            border: 2px solid var(--nord-sym-cyan);
            color: var(--nord-sym-cyan);
            backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
            font-weight: 600;
        }
        .btn-cta-revised:hover {
            background: rgba(var(--nord-sym-cyan-rgb), 0.1);
            box-shadow: 0 0 25px rgba(var(--nord-sym-cyan-rgb), 0.5);
            transform: translateY(-3px) scale(1.03);
        }
        .btn-secondary-on-dark {
            padding: 0.85rem 2.25rem; color: var(--nord-sym-text-light);
            border: 2px solid var(--nord-sym-text-light);
        }
        .btn-secondary-on-dark:hover {
            background-color: var(--nord-sym-text-light); color: var(--nord-sym-deep-space-blue);
            transform: translateY(-3px) scale(1.03);
             box-shadow: 0px 10px 20px rgba(240, 244, 248, 0.25), 0px 5px 10px rgba(0,0,0,0.2),
                        inset 0px -2px 2px rgba(255,255,255,0.03);
        }
        .btn-service-cta { 
            padding: 0.6rem 1.5rem; font-size: 0.875rem; background-color: transparent;
            color: var(--nord-sym-cyan); border: 2px solid var(--nord-sym-cyan);
        }
        .btn-service-cta:hover {
            background-color: var(--nord-sym-cyan); color: var(--nord-sym-deep-space-blue);
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0px 8px 18px rgba(var(--nord-sym-cyan-rgb), 0.35), 0px 4px 7px rgba(0,0,0,0.2),
                        inset 0px -1px 2px rgba(255,255,255,0.08);
        }
        
        /* --- KNAPP FÖR LJUS/MÖRKT TEMA --- */
        .theme-toggle-btn {
            width: 44px; height: 44px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            color: var(--nord-sym-text-medium);
            background-color: transparent;
            font-size: 1.5rem; /* 24px */
            transition: all 0.3s ease;
            cursor: pointer;
            flex-shrink: 0; /* Förhindra att knappen krymper */
        }
        .theme-toggle-btn:hover {
            color: var(--nord-sym-cyan);
            background-color: rgba(var(--nord-sym-mid-space-blue-rgb), 0.5);
            transform: scale(1.1) rotate(15deg);
        }
        .theme-toggle-btn i {
             transition: transform 0.3s ease-out;
        }
        .theme-toggle-btn:hover i {
            transform: scale(1.1);
        }

        /* --- STILAR FÖR LIGHT THEME (BLÅKOPIA) --- */
        /* Här kommer vi att lägga till alla våra ljusa temastilar sen */
        body.light-theme {
            background-color: var(--nord-sym-blueprint-bg);
            color: var(--nord-sym-blueprint-ink);
            
            /* Det svaga rutnätet från vår vision */
            background-image: 
                linear-gradient(var(--nord-sym-blueprint-lines-faint) 1px, transparent 1px),
                linear-gradient(to right, var(--nord-sym-blueprint-lines-faint) 1px, transparent 1px);
            background-size: 40px 40px;
            background-position: center center;
        }
        
        /* Header */
        body.light-theme #header {
            background-color: var(--nord-sym-blueprint-bg) !important; /* VIKTIGT: Tvinga vit bakgrund */
            backdrop-filter: none;
            -webkit-backdrop-filter: none;
            border-bottom: 1px solid var(--nord-sym-blueprint-lines);
            box-shadow: 0 2px 4px rgba(0,0,0,0.02); /* Mycket subtil skugga */
        }
        
        /* Nav-länkar */
        body.light-theme .nav-link {
            color: var(--nord-sym-blueprint-ink) !important; /* VIKTIGT: Tvinga mörk text */
            opacity: 0.8;
        }
        body.light-theme .nav-link:hover {
            color: var(--nord-sym-blueprint-cyan) !important;
            opacity: 1;
        }
        body.light-theme .nav-link.active {
            color: var(--nord-sym-blueprint-cyan) !important;
            font-weight: 700;
            opacity: 1;
        }
        
        /* Temaknapp (Ljust läge) */
        body.light-theme .theme-toggle-btn {
            color: var(--nord-sym-blueprint-ink) !important; /* VIKTIGT: Synlig ikon */
            opacity: 0.7;
        }
        body.light-theme .theme-toggle-btn:hover {
            color: var(--nord-sym-blueprint-cyan) !important;
            background-color: rgba(var(--nord-sym-blueprint-cyan-rgb), 0.1);
            transform: scale(1.1) rotate(-15deg); /* Roterar åt andra hållet */
            opacity: 1;
        }
        
        /* Header CTA-knapp */
        body.light-theme .btn-cta-revised {
            background: transparent;
            border: 2px solid var(--nord-sym-blueprint-ink);
            color: var(--nord-sym-blueprint-ink) !important;
            backdrop-filter: none;
            -webkit-backdrop-filter: none;
            box-shadow: none;
        }
        body.light-theme .btn-cta-revised:hover {
            background: rgba(var(--nord-sym-blueprint-cyan-rgb), 0.1);
            border-color: var(--nord-sym-blueprint-cyan);
            color: var(--nord-sym-blueprint-cyan) !important;
            box-shadow: 0 0 15px rgba(var(--nord-sym-blueprint-cyan-rgb), 0.3);
            transform: translateY(-3px) scale(1.03); /* Behåll hover-effekt */
        }
        
        /* Mobilmeny-bakgrund */
        body.light-theme #mobile-menu {
            background-color: var(--nord-sym-blueprint-bg) !important;
            backdrop-filter: none;
        }
        body.light-theme #mobile-menu a {
            color: var(--nord-sym-blueprint-ink) !important;
            opacity: 0.8;
            border-color: var(--nord-sym-blueprint-lines-faint);
        }
         body.light-theme #mobile-menu a:hover {
            background-color: rgba(var(--nord-sym-blueprint-cyan-rgb), 0.05) !important;
            color: var(--nord-sym-blueprint-cyan) !important;
            opacity: 1;
        }

        /* Allmänna sektionsstilar (Blåkopia) */
        body.light-theme .section-title {
            color: var(--nord-sym-blueprint-ink);
        }
        body.light-theme .section-title-accent {
            color: var(--nord-sym-blueprint-cyan);
            text-shadow: none; /* Ta bort glöd */
        }
        body.light-theme p,
        body.light-theme span {
            color: var(--nord-sym-blueprint-ink);
            opacity: 0.9;
        }
        body.light-theme .text-sky-100,
        body.light-theme .text-sky-200,
        body.light-theme .text-sky-300,
        body.light-theme .text-white {
            /* Använder !important för att säkert skriva över Tailwind utility-klasser */
            color: var(--nord-sym-blueprint-ink) !important;
            opacity: 0.9;
        }
        body.light-theme .text-lg,
        body.light-theme .text-xl {
             color: var(--nord-sym-blueprint-ink);
        }
        body.light-theme .hero-headline-glow {
            color: var(--nord-sym-blueprint-ink); /* Huvudrubrik */
            animation: none; /* Ta bort glöd */
        }
        body.light-theme .btn-secondary-on-dark {
            background: transparent;
            border: 2px solid var(--nord-sym-blueprint-ink);
            color: var(--nord-sym-blueprint-ink);
            box-shadow: none;
        }
        body.light-theme .btn-secondary-on-dark:hover {
            background: rgba(var(--nord-sym-blueprint-cyan-rgb), 0.1);
            border-color: var(--nord-sym-blueprint-cyan);
            color: var(--nord-sym-blueprint-cyan);
            box-shadow: 0 0 15px rgba(var(--nord-sym-blueprint-cyan-rgb), 0.3);
            transform: translateY(-3px) scale(1.03);
        }
        body.light-theme .inline-block.bg-sky-800\/50 { /* "Vår Arkitektur" / "System" badge */
             background-color: rgba(var(--nord-sym-blueprint-cyan-rgb), 0.1) !important;
             color: var(--nord-sym-blueprint-cyan) !important;
        }

        /* Venn Diagram (Blåkopia) */
        body.light-theme .venn-circle {
            background: transparent;
            border: 2px solid var(--nord-sym-blueprint-ink);
            box-shadow: none;
            animation: none; /* Ta bort puls */
        }
        body.light-theme .venn-circle-text {
            color: var(--nord-sym-blueprint-ink);
            opacity: 0.8;
        }
        body.light-theme .venn-overlap-text {
            color: var(--nord-sym-blueprint-cyan);
            text-shadow: none;
        }
        body.light-theme .venn-overlap-text:hover {
            color: var(--nord-sym-blueprint-cyan);
            filter: none;
            transform: translate(-50%, -50%) scale(1.05);
        }

        /* Atom Gallery (Blåkopia) */
        body.light-theme .archetype-card {
            background: var(--nord-sym-blueprint-bg);
            border: 1px solid var(--nord-sym-blueprint-lines);
            backdrop-filter: none;
            box-shadow: 0 4px 6px rgba(0,0,0,0.04);
        }
        body.light-theme .archetype-card::before { /* Ta bort glöd */
            background: none;
            opacity: 0;
        }
        body.light-theme .archetype-card:hover {
            border-color: var(--nord-sym-blueprint-cyan);
            box-shadow: 0 0 20px rgba(var(--nord-sym-blueprint-cyan-rgb), 0.2);
            transform: translateY(-8px) scale(1.02);
        }
        body.light-theme .archetype-card > i {
            color: var(--nord-sym-blueprint-cyan);
        }
        body.light-theme .archetype-card h4 {
            color: var(--nord-sym-blueprint-ink);
        }
        body.light-theme .archetype-card .description,
        body.light-theme .archetype-card .indicator,
        body.light-theme .tech-signature-item i,
        body.light-theme .tech-signature-item span {
            color: var(--nord-sym-blueprint-ink);
            opacity: 0.8;
        }
        body.light-theme .archetype-card .avatar-image {
             filter: drop-shadow(0 0 3px rgba(var(--nord-sym-blueprint-ink), 0.2));
        }
        body.light-theme .archetype-card:hover > i,
        body.light-theme .archetype-card:hover > .avatar-image {
            filter: drop-shadow(0 0 10px rgba(var(--nord-sym-blueprint-cyan-rgb), 0.7));
        }
        body.light-theme .archetype-card .indicator {
            border-top-color: var(--nord-sym-blueprint-lines-faint);
        }
        body.light-theme .archetype-cta {
            border-color: var(--nord-sym-blueprint-lines);
            color: var(--nord-sym-blueprint-ink);
            box-shadow: none;
        }
        body.light-theme .archetype-cta:hover {
            border-color: var(--nord-sym-blueprint-cyan);
            color: var(--nord-sym-blueprint-cyan);
            background: rgba(var(--nord-sym-blueprint-cyan-rgb), 0.1);
            box-shadow: 0 0 15px rgba(var(--nord-sym-blueprint-cyan-rgb), 0.3);
        }
        body.light-theme .archetype-card.teaser > * {
            filter: blur(4px);
            opacity: 0.3;
        }
        body.light-theme .archetype-card.teaser::after { /* "Under utveckling" text */
            color: rgba(var(--nord-sym-blueprint-ink-rgb), 0.05);
            text-shadow: none;
        }

        /* NYTT: Stilar för Galleri-växlare (Blåkopia) */
        body.light-theme #gallery-switch-container {
            background-color: var(--nord-sym-blueprint-lines-faint);
            border: 1px solid var(--nord-sym-blueprint-lines);
        }
        /* UPPDATERAD: Slider-elementet (Ljust läge) */
        body.light-theme #gallery-switch-slider {
            background-color: var(--nord-sym-blueprint-cyan);
            box-shadow: 0 0 15px rgba(var(--nord-sym-blueprint-cyan-rgb), 0.3);
        }
        /* UPPDATERAD: Knappstilar (Ljust läge) */
        body.light-theme .gallery-switch-btn {
            background-color: transparent;
            color: var(--nord-sym-blueprint-ink);
            opacity: 0.7;
        }
        body.light-theme .gallery-switch-btn.active {
            color: var(--nord-sym-blueprint-ink);
            opacity: 1;
        }
        body.light-theme .gallery-switch-btn:hover {
            opacity: 1;
        }
        body.light-theme #gallery-description-text {
            color: var(--nord-sym-blueprint-ink) !important; /* Tailwind override */
            opacity: 0.9;
        }

        /* Galleri-kontroller (Blåkopia) */
        body.light-theme .gallery-control-btn {
            background: transparent;
            border: 1px solid var(--nord-sym-blueprint-lines);
            color: var(--nord-sym-blueprint-ink);
            opacity: 0.7;
        }
        body.light-theme .gallery-control-btn:hover:not(.disabled) {
            background: rgba(var(--nord-sym-blueprint-cyan-rgb), 0.1);
            border-color: var(--nord-sym-blueprint-cyan);
            color: var(--nord-sym-blueprint-cyan);
            opacity: 1;
        }
        body.light-theme .gallery-control-btn.disabled {
            background: transparent;
            opacity: 0.3;
        }
        body.light-theme .gallery-pagination-dot {
            background-color: var(--nord-sym-blueprint-lines-faint);
            border-color: var(--nord-sym-blueprint-lines);
        }
        body.light-theme .gallery-pagination-dot:hover {
            background-color: var(--nord-sym-blueprint-lines);
        }
        body.light-theme .gallery-pagination-dot.active {
            background-color: var(--nord-sym-blueprint-cyan);
            border-color: var(--nord-sym-blueprint-cyan);
            box-shadow: 0 0 10px rgba(var(--nord-sym-blueprint-cyan-rgb), 0.5);
        }

        /* Om Oss / Arkitektur-sida (Blåkopia) */
        body.light-theme #om-oss .arkitektur-grid .arkitektur-card {
             /* Tailwind .content-card-transparent ersätts */
            background: var(--nord-sym-blueprint-bg);
            border: 1px solid var(--nord-sym-blueprint-lines);
            box-shadow: 0 4px 6px rgba(0,0,0,0.04);
        }
        body.light-theme .arkitektur-card {
            background: var(--nord-sym-blueprint-bg);
            border: 1px solid var(--nord-sym-blueprint-lines);
            box-shadow: 0 4px 6px rgba(0,0,0,0.04);
            backdrop-filter: none;
        }
        body.light-theme .arkitektur-card:hover {
            border-color: var(--nord-sym-blueprint-cyan);
            box-shadow: 0 0 20px rgba(var(--nord-sym-blueprint-cyan-rgb), 0.2);
            transform: translateY(-5px) scale(1.01); /* Subtilare än galleriet */
        }
        body.light-theme .arkitektur-card h3 {
            color: var(--nord-sym-blueprint-ink);
        }
        body.light-theme .arkitektur-card i,
        body.light-theme #om-oss .arkitektur-list i {
            color: var(--nord-sym-blueprint-cyan);
        }
        body.light-theme .arkitektur-card p,
        body.light-theme #om-oss .arkitektur-list li {
            color: var(--nord-sym-blueprint-ink);
            opacity: 0.8;
        }

        /* System / Pris-sida (Blåkopia) */
        body.light-theme .pricing-card {
            background: var(--nord-sym-blueprint-bg);
            border: 1px solid var(--nord-sym-blueprint-lines);
            backdrop-filter: none;
            box-shadow: 0 4px 6px rgba(0,0,0,0.04);
        }
        body.light-theme .pricing-card:hover {
            border-color: var(--nord-sym-blueprint-cyan);
            box-shadow: 0 0 20px rgba(var(--nord-sym-blueprint-cyan-rgb), 0.2);
        }
        body.light-theme .pricing-card.ignite-package { /* "Struktur"-paketet */
            border-color: var(--nord-sym-blueprint-cyan);
            box-shadow: 0 0 20px rgba(var(--nord-sym-blueprint-cyan-rgb), 0.2);
            transform: scale(1.05);
        }
        body.light-theme .pricing-card.ignite-package:hover {
            transform: scale(1.08) translateY(-8px);
        }
        body.light-theme .pricing-card-header h3,
        body.light-theme .price-display {
            color: var(--nord-sym-blueprint-ink);
        }
        body.light-theme .price-period,
        body.light-theme .pricing-card li,
        body.light-theme .pricing-card .text-sky-300 {
            color: var(--nord-sym-blueprint-ink) !important; /* Tailwind override */
            opacity: 0.8;
        }
        body.light-theme .pricing-card li i {
            color: var(--nord-sym-blueprint-cyan);
            opacity: 1;
        }

        /* Juridiska sidor (Blåkopia) */
        body.light-theme .legal-content-card {
            background: var(--nord-sym-blueprint-bg);
            border: 1px solid var(--nord-sym-blueprint-lines);
            backdrop-filter: none;
            box-shadow: 0 4px 6px rgba(0,0,0,0.04);
        }
        body.light-theme .legal-content-container h4 {
            color: var(--nord-sym-blueprint-ink);
        }
        body.light-theme .legal-content-container p,
        body.light-theme .legal-content-container ul,
        body.light-theme .legal-content-container a {
            color: var(--nord-sym-blueprint-ink);
            opacity: 0.8;
        }
        body.light-theme .legal-content-container a:hover {
            color: var(--nord-sym-blueprint-cyan);
            opacity: 1;
        }

        /* Footer (Blåkopia) */
        body.light-theme #main-footer {
            background-color: var(--nord-sym-blueprint-bg) !important; /* VIKTIGT: Tvinga vit bakgrund */
            border: 1px solid var(--nord-sym-blueprint-lines);
            border-top: 1px solid var(--nord-sym-blueprint-lines); /* Dubbel spec. för säkerhet */
            box-shadow: none;
        }
        body.light-theme .footer-quicklinks .font-semibold,
        body.light-theme .nordsym-logo-star {
            color: var(--nord-sym-blueprint-ink) !important;
            animation: none; /* Ta bort stjärn-glöd */
        }
        body.light-theme .footer-link,
        body.light-theme #main-footer .text-xs,
        body.light-theme #main-footer p,
        body.light-theme #main-footer span {
            color: var(--nord-sym-blueprint-ink) !important; /* VIKTIGT: Tailwind override */
            opacity: 0.8;
        }
        body.light-theme .footer-link:hover {
            color: var(--nord-sym-blueprint-cyan) !important;
            opacity: 1;
        }
        body.light-theme #main-footer .border-sky-700\/50 {
            border-color: var(--nord-sym-blueprint-lines-faint) !important;
        }

        /* --- FORMULÄR & MODALS (Blåkopia) --- */
        body.light-theme .form-container {
            background: var(--nord-sym-blueprint-bg);
            border: 1px solid var(--nord-sym-blueprint-lines);
            backdrop-filter: none;
            box-shadow: 0 4px 6px rgba(0,0,0,0.04);
        }
        body.light-theme .form-container:hover {
            box-shadow: 0 0 20px rgba(var(--nord-sym-blueprint-cyan-rgb), 0.2);
            border-color: var(--nord-sym-blueprint-cyan);
        }
        body.light-theme .form-label {
            color: var(--nord-sym-blueprint-ink);
        }
        body.light-theme .form-input, 
        body.light-theme .form-textarea {
            background-color: var(--nord-sym-blueprint-bg);
            border: 1px solid var(--nord-sym-blueprint-lines);
            color: var(--nord-sym-blueprint-ink);
        }
        body.light-theme .form-input::placeholder, 
        body.light-theme .form-textarea::placeholder {
            color: var(--nord-sym-blueprint-ink);
            opacity: 0.5;
        }
        body.light-theme .form-input:focus, 
        body.light-theme .form-textarea:focus {
            border-color: var(--nord-sym-blueprint-cyan);
            box-shadow: 0 0 15px rgba(var(--nord-sym-blueprint-cyan-rgb), 0.3);
            background-color: var(--nord-sym-blueprint-bg); /* Säkerställ vit bakgrund */
        }
        body.light-theme .form-progress-bar {
            background-color: var(--nord-sym-blueprint-lines-faint);
        }
        body.light-theme .form-progress-bar-inner {
            background: var(--nord-sym-blueprint-cyan);
            box-shadow: 0 0 10px rgba(var(--nord-sym-blueprint-cyan-rgb), 0.5);
        }
        body.light-theme .form-success-container i {
            color: var(--nord-sym-blueprint-cyan);
            animation: none; /* Ta bort stjärn-glöd */
        }
        body.light-theme .form-success-container p {
            color: var(--nord-sym-blueprint-ink);
        }

        /* Modal-specifika stilar (Blåkopia) */
        body.light-theme #coming-soon-modal,
        body.light-theme #free-agent-modal {
            background: rgba(var(--nord-sym-blueprint-bg-rgb), 0.8);
            backdrop-filter: blur(5px);
        }
        body.light-theme #coming-soon-modal .modal-content-wrapper,
        body.light-theme #free-agent-modal .modal-content-wrapper {
             /* .form-container-stilarna appliceras redan */
             border-color: var(--nord-sym-blueprint-cyan); /* Gör att modalen poppar lite */
             box-shadow: 0 0 30px rgba(var(--nord-sym-blueprint-cyan-rgb), 0.3);
        }
        
        /* DYNAMIC WAITLIST VISUALS */
        #coming-soon-modal.visible .modal-content-wrapper {
            transform: scale(1) rotate(-1deg);
        }
        @media (prefers-reduced-motion: reduce) {
            #coming-soon-modal.visible .modal-content-wrapper {
                transform: scale(1);
            }
        }
        
        /* Utility class för textfärg om den saknas i Tailwind-bygget */
        .text-nord-sym-cyan { color: var(--nord-sym-cyan) !important; }

        body.light-theme #coming-soon-modal button,
        body.light-theme #free-agent-modal button {
             opacity: 0.7; /* Tona ner texten i stäng-knappen */
        }
        body.light-theme #coming-soon-modal button:hover,
        body.light-theme #free-agent-modal button:hover {
             opacity: 1;
        }


        /* --- CHATTWIDGET (Blåkopia) --- */
        body.light-theme #chat-bubble {
            background: var(--nord-sym-blueprint-ink);
            color: var(--nord-sym-blueprint-cyan);
            box-shadow: 0 0 25px rgba(var(--nord-sym-blueprint-ink-rgb), 0.4);
            animation: none; /* Stänger av den gamla pulsen */
        }
        body.light-theme #chat-bubble:hover {
            box-shadow: 0 0 35px rgba(var(--nord-sym-blueprint-cyan-rgb), 0.7);
        }
        
        body.light-theme #chat-window {
            background: var(--nord-sym-blueprint-bg);
            border: 1px solid var(--nord-sym-blueprint-lines);
            backdrop-filter: none;
            box-shadow: 0 10px 20px rgba(0,0,0,0.05);
        }
        
        body.light-theme #chat-header {
            background: var(--nord-sym-blueprint-bg);
            border-bottom: 1px solid var(--nord-sym-blueprint-lines-faint);
        }
        body.light-theme #chat-header h3 {
            color: var(--nord-sym-blueprint-ink);
        }
        body.light-theme #chat-header p {
            color: var(--nord-sym-blueprint-cyan); /* Använd cyan för "Online" */
        }
        body.light-theme #chat-close-btn {
            color: var(--nord-sym-blueprint-ink);
            opacity: 0.7;
        }
        body.light-theme #chat-close-btn:hover {
            background-color: rgba(var(--nord-sym-blueprint-cyan-rgb), 0.1);
            color: var(--nord-sym-blueprint-cyan);
            opacity: 1;
        }

        body.light-theme #chat-messages {
            /* Bakgrunden (rutnätet) ärvs från body */
            scrollbar-color: var(--nord-sym-blueprint-cyan) var(--nord-sym-blueprint-lines-faint);
        }
        body.light-theme #chat-messages::-webkit-scrollbar-thumb {
            background-color: var(--nord-sym-blueprint-cyan);
        }
        body.light-theme #chat-messages::-webkit-scrollbar-track {
            background: var(--nord-sym-blueprint-lines-faint);
        }

        body.light-theme .bot-message p {
            background: rgba(var(--nord-sym-blueprint-cyan-rgb), 0.1);
            color: var(--nord-sym-blueprint-ink);
            opacity: 0.9;
        }
        body.light-theme .user-message p {
            background: var(--nord-sym-blueprint-ink);
            color: var(--nord-sym-blueprint-bg);
        }
        body.light-theme .typing-indicator span {
            background-color: rgba(var(--nord-sym-blueprint-ink-rgb), 0.3);
            box-shadow: 0 0 4px rgba(var(--nord-sym-blueprint-ink-rgb), 0.3);
            animation-name: blueprint-typing-glow; /* Byt till en ny animation */
        }

        /* Ny glow-animation för blåkopia */
        @keyframes blueprint-typing-glow {
            0%, 100% {
                background-color: rgba(var(--nord-sym-blueprint-ink-rgb), 0.2);
                box-shadow: 0 0 4px rgba(var(--nord-sym-blueprint-ink-rgb), 0.2);
            }
            50% {
                background-color: rgba(var(--nord-sym-blueprint-ink-rgb), 1);
                box-shadow: 0 0 8px rgba(var(--nord-sym-blueprint-ink-rgb), 0.7);
            }
        }
        
        body.light-theme #chat-input-area {
            border-top: 1px solid var(--nord-sym-blueprint-lines-faint);
        }
        body.light-theme #chat-input {
            /* Återanvänd formulärstilar */
            background-color: var(--nord-sym-blueprint-bg);
            border: 1px solid var(--nord-sym-blueprint-lines);
            color: var(--nord-sym-blueprint-ink);
        }
        body.light-theme #chat-input::placeholder {
            color: var(--nord-sym-blueprint-ink);
            opacity: 0.5;
        }
        body.light-theme #chat-input:focus {
            border-color: var(--nord-sym-blueprint-cyan);
            box-shadow: 0 0 15px rgba(var(--nord-sym-blueprint-cyan-rgb), 0.3);
        }
        
        body.light-theme #chat-send-btn {
            background-color: var(--nord-sym-blueprint-ink);
            color: var(--nord-sym-blueprint-bg);
        }
        body.light-theme #chat-send-btn:hover {
            background-color: var(--nord-sym-blueprint-cyan);
            color: var(--nord-sym-blueprint-ink);
        }


        /* --- RITBORDET LOBBY (Blåkopia) --- */
        body.light-theme .ritbordet-card {
            background: var(--nord-sym-blueprint-bg);
            border: 1px solid var(--nord-sym-blueprint-lines);
            backdrop-filter: none;
            -webkit-backdrop-filter: none;
            box-shadow: 0 4px 6px rgba(0,0,0,0.04);
        }
        body.light-theme .ritbordet-card:not(.flippable):hover {
            border-color: var(--nord-sym-blueprint-cyan);
            box-shadow: 0 0 20px rgba(var(--nord-sym-blueprint-cyan-rgb), 0.2);
        }
        body.light-theme .ritbordet-card.flippable:hover .flip-card-front {
             border-color: var(--nord-sym-blueprint-cyan);
             box-shadow: 0 0 20px rgba(var(--nord-sym-blueprint-cyan-rgb), 0.2);
        }

        /* --- NYTT: Flip Card Mekanik (LJUST TEMA) --- */
        body.light-theme .flip-card-front {
            background: var(--nord-sym-blueprint-bg);
            border: 1px solid var(--nord-sym-blueprint-lines);
            backdrop-filter: none;
        }
        body.light-theme .flip-card-back {
            background: rgba(var(--nord-sym-blueprint-cyan-rgb), 0.05);
            border: 1px solid var(--nord-sym-blueprint-cyan);
            backdrop-filter: none;
            transform: rotateY(180deg);
        }
        body.light-theme .flip-card-back h5 {
            color: var(--nord-sym-blueprint-cyan);
            border-bottom-color: rgba(var(--nord-sym-blueprint-cyan-rgb), 0.3);
        }
        body.light-theme .flip-card-back li {
            color: var(--nord-sym-blueprint-ink);
            opacity: 0.8;
        }
        body.light-theme .flip-card-back li i {
            color: var(--nord-sym-blueprint-cyan);
        }
        /* --- Slut på Flip Card (LJUST TEMA) --- */

        body.light-theme .ritbordet-card i {
            color: var(--nord-sym-blueprint-cyan);
        }
        body.light-theme .ritbordet-card h4 {
            color: var(--nord-sym-blueprint-ink);
        }
        body.light-theme .ritbordet-card p {
            color: var(--nord-sym-blueprint-ink);
            opacity: 0.8;
        }
        /* Pris-preview-kortet i lobbyn */
        body.light-theme .ritbordet-card.pricing-preview .price-range {
            color: var(--nord-sym-blueprint-ink);
            border-color: var(--nord-sym-blueprint-lines-faint);
        }

        /* Centrala CTA-knappen (Blåkopia) */
        body.light-theme #geometry-cta {
            background: transparent;
            border: 2px solid var(--nord-sym-blueprint-ink);
        }
        body.light-theme #geometry-cta:hover {
            background: rgba(var(--nord-sym-blueprint-cyan-rgb), 0.1);
            border-color: var(--nord-sym-blueprint-cyan);
            box-shadow: 0 0 30px rgba(var(--nord-sym-blueprint-cyan-rgb), 0.3);
        }
        body.light-theme #geometry-cta i {
            color: var(--nord-sym-blueprint-ink);
            transition: all 0.3s ease; /* Säkerställ transition */
        }
        body.light-theme #geometry-cta .cta-text {
            color: var(--nord-sym-blueprint-ink);
            transition: all 0.3s ease;
        }
        body.light-theme #geometry-cta:hover i {
            color: var(--nord-sym-blueprint-cyan);
            /* transform: rotate(45deg) scale(1.1); *//* Behåll rotation från dark mode */
        }
        body.light-theme #geometry-cta:hover .cta-text {
            color: var(--nord-sym-blueprint-cyan);
        }

        /* Mobil "Enter Workshop"-knapp (Blåkopia) */
        body.light-theme #mobile-enter-workshop-btn {
            background: rgba(var(--nord-sym-blueprint-bg-rgb), 0.8);
            backdrop-filter: blur(5px);
            border: 2px solid var(--nord-sym-blueprint-cyan);
            color: var(--nord-sym-blueprint-cyan);
            box-shadow: 0 0 20px rgba(var(--nord-sym-blueprint-cyan-rgb), 0.3);
        }

        /* Onboarding Modal (Blåkopia) */
        /* BORTTAGEN: Gamla onboarding-stilar rensas eller ignoreras då vi byter till Ghost Hints */
        
        /* --- NYTT: Ghost Hints (Ersätter Onboarding Modal) --- */
        #workshop-ghost-hints {
            position: fixed;
            bottom: 15%;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            pointer-events: none; /* Klick går rakt igenom */
            z-index: 2000;
            opacity: 0;
            transition: opacity 1s ease;
            width: 100%;
            max-width: 600px;
            padding: 0 1rem;
        }
        #workshop-ghost-hints.visible {
            opacity: 1;
        }
        .ghost-hint-text {
            font-family: 'Comfortaa', sans-serif;
            font-size: 1.1rem;
            color: var(--nord-sym-cyan);
            text-shadow: 0 0 15px rgba(var(--nord-sym-cyan-rgb), 0.5);
            margin-bottom: 0.5rem;
            letter-spacing: 0.05em;
        }
        .ghost-hint-sub {
            font-family: 'Inter', sans-serif;
            font-size: 0.85rem;
            color: var(--nord-sym-text-medium);
            opacity: 0.8;
        }
        
        /* Mobil-justering för hints */
        @media (max-width: 768px) {
            #workshop-ghost-hints {
                bottom: 25%; /* Högre upp på mobil för att inte krocka med joysticks */
            }
        }

        /* --- NYTT: AI-First Spel (Easter Egg) --- */
        body.light-theme #ai-first-ship-icon {
            border-bottom-color: var(--nord-sym-blueprint-cyan);
        }
        /* --- Slut på AI-First Spel --- */


        /* --- VENNDIAGRAM-HARMONISERING --- */
        .venn-diagram-container {
            display: flex; justify-content: center; align-items: center;
            min-height: 350px;
        }
        .venn-diagram-wrapper {
            position: relative; width: 440px; height: 280px;
            transition: all 0.3s ease-in-out;
        }
        .venn-circle {
            position: absolute;
            width: 280px; height: 280px;
            border-radius: 50%;
            background: radial-gradient(circle at 50% 50%, rgba(var(--nord-sym-cyan-rgb), 0.05) 0%, rgba(var(--nord-sym-cyan-rgb), 0.15) 100%);
            border: 1px solid rgba(var(--nord-sym-cyan-rgb), 0.3);
            display: flex; 
            align-items: center;
            box-shadow: inset 0 0 20px rgba(var(--nord-sym-cyan-rgb), 0.1), 0 0 15px rgba(var(--nord-sym-deep-space-blue), 0.5);
            animation: venn-pulse 8s infinite ease-in-out;
            transition: all 0.3s ease-in-out;
        }
        .venn-circle-1 { top: 0; left: 0; animation-delay: 0s; justify-content: flex-start; }
        .venn-circle-2 { top: 0; right: 0; animation-delay: -4s; justify-content: flex-end; }
        .venn-circle-text {
            font-family: 'Comfortaa', sans-serif;
            font-weight: 700;
            color: var(--nord-sym-text-light);
            text-align: center;
            font-size: 1.1rem;
            max-width: 140px;
            padding: 0 2rem;
        }
        .venn-overlap-text {
            position: absolute;
            top: 50%; 
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Comfortaa', sans-serif;
            font-weight: 700;
            font-size: 1.25rem; /* Desktop baseline */
            color: var(--nord-sym-light-accent);
            cursor: pointer;
            transition: all 0.3s ease;
            text-shadow: 0 0 10px rgba(var(--nord-sym-light-accent-rgb), 0.3);
            width: 120px;
            text-align: center;
            line-height: 1.1; /* Harmoni-fix: Bättre line-height för multi-word text */
        }
        .venn-overlap-text:hover {
            color: var(--nord-sym-cyan);
            filter: drop-shadow(0 0 20px rgba(var(--nord-sym-cyan-rgb), 0.9));
            transform: translate(-50%, -50%) scale(1.05);
        }
        @keyframes venn-pulse {
            50% { transform: scale(1.02); border-color: rgba(var(--nord-sym-cyan-rgb), 0.5); }
        }
        
        /* Harmoni-fix: Responsiv typografi för Venn-diagrammet */
        @media (max-width: 768px) {
            .venn-diagram-wrapper { width: 320px; height: 200px; }
            .venn-circle { width: 200px; height: 200px; }
            .venn-circle-text { font-size: 0.9rem; max-width: 100px; padding: 0 1.5rem; }
            .venn-overlap-text { 
                font-size: 0.8rem !important; /* Kraftigare minskning */
                width: 85px; 
                line-height: 1.0; 
                word-wrap: break-word;
                overflow-wrap: break-word; /* Extra säkerhet */
                hyphens: auto; /* Automatisk orddelning */
            }
        }
        @media (max-width: 480px) {
            .venn-diagram-wrapper { width: 280px; height: 180px; }
            .venn-circle { width: 180px; height: 180px; }
            .venn-circle-text { font-size: 0.8rem; max-width: 80px; padding: 0 1rem; }
            .venn-overlap-text { 
                font-size: 0.65rem !important;
                width: 70px; 
                line-height: 0.95; 
                word-wrap: break-word;
                overflow-wrap: break-word;
                text-align: center;
                hyphens: auto;
            }
        }
        @media (max-width: 360px) {
            .venn-overlap-text { 
                font-size: 0.55rem !important;
                width: 60px;
                line-height: 0.9;
            }
        }
        @media (hover: none) and (pointer: coarse) {
            .venn-overlap-text:hover {
                transform: translate(-50%, -50%); /* Ingen scale på touch devices */
            }
        }
        
        /* --- ATOM GALLERY 2.0: THE SYNERGY UPGRADE --- */
        .gallery-container {
            position: relative;
        }
        .gallery-viewport {
            overflow: hidden;
            /* NYTT: Perspektiv för 3D-flip */
            perspective: 1000px;
        }
        .gallery-wrapper {
            display: flex;
            gap: 2rem;
            transition: transform 0.7s cubic-bezier(0.25, 1, 0.5, 1);
        }
        .archetype-card {
            background: linear-gradient(145deg, rgba(var(--nord-sym-deep-space-blue-rgb), 0.5), rgba(var(--nord-sym-mid-space-blue-rgb), 0.15));
            border: 1px solid rgba(var(--nord-sym-cyan-rgb), 0.2);
            backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
            border-radius: 1.5rem;
            padding: 2.5rem 2rem;
            display: flex;
            flex-direction: column;
            text-align: center;
            align-items: center;
            min-height: 460px; /* Bigger */
            flex-shrink: 0;
            width: calc(100% / 3 - (4rem / 3));
            transition: all 0.4s cubic-bezier(0.25, 1, 0.5, 1);
            position: relative;
            overflow: hidden;
        }
        .archetype-card::before { /* Glow effect on hover */
            content: '';
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: radial-gradient(circle at 50% 0%, rgba(var(--nord-sym-cyan-rgb), 0.2), transparent 70%);
            opacity: 0;
            transition: opacity 0.4s ease;
            z-index: 0;
        }
        .archetype-card:hover {
            box-shadow: 0 0 35px rgba(var(--nord-sym-cyan-rgb), 0.3), 0 8px 25px rgba(0,0,0,0.3);
            border-color: var(--nord-sym-cyan);
            transform: translateY(-8px) scale(1.02); /* Better */
        }
        .archetype-card:hover::before {
            opacity: 1;
        }
        /* Ensure card content is above the glow */
        .archetype-card > * {
            position: relative;
            z-index: 1;
        }
        .archetype-card > i {
            font-size: 3rem; /* Bigger icon */
            color: var(--nord-sym-cyan);
            margin-bottom: 1.5rem;
            transition: transform 0.4s ease, filter 0.4s ease;
        }
        .archetype-card > .avatar-image {
            width: 80px;
            height: 80px;
            margin-bottom: 1rem;
            border-radius: 50%;
            object-fit: cover;
            transition: transform 0.4s ease, filter 0.4s ease;
            filter: drop-shadow(0 0 5px rgba(var(--nord-sym-cyan-rgb), 0.3));
        }
        .archetype-card:hover > i,
        .archetype-card:hover > .avatar-image {
            transform: scale(1.1);
            filter: drop-shadow(0 0 15px rgba(var(--nord-sym-cyan-rgb), 0.8));
        }
        .archetype-card h4 {
            font-family: 'Comfortaa', sans-serif;
            color: var(--nord-sym-light-accent);
            font-size: 1.375rem; /* Bigger title */
            margin-bottom: 1rem;
        }
        .archetype-card .description {
            color: var(--nord-sym-text-medium);
            line-height: 1.65;
            font-size: 0.95rem; /* Slightly larger text */
            flex-grow: 1;
            margin-bottom: 1.5rem;
        }
        .tech-signature-container {
            display: flex;
            justify-content: center;
            gap: 1.75rem;
            margin-bottom: 1.5rem;
            width: 100%;
        }
        .tech-signature-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.3rem;
        }
        .tech-signature-item i {
            font-size: 1.6rem;
            color: var(--nord-sym-text-medium);
        }
        .tech-signature-item span {
            font-size: 0.75rem;
            color: var(--nord-sym-text-medium);
            font-weight: 500;
        }
        .archetype-cta {
            margin-bottom: 1.5rem;
            padding: 0.6rem 1.5rem;
            font-size: 0.875rem;
            background: transparent;
            border: 1px solid var(--nord-sym-text-medium);
            color: var(--nord-sym-text-medium);
            box-shadow: none;
        }
        .archetype-cta:hover {
            background: rgba(var(--nord-sym-cyan-rgb), 0.1);
            border-color: var(--nord-sym-cyan);
            color: var(--nord-sym-cyan);
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(var(--nord-sym-cyan-rgb), 0.3);
        }
        .archetype-card .indicator {
            font-size: 0.8rem;
            color: var(--nord-sym-text-medium);
            border-top: 1px solid rgba(var(--nord-sym-cyan-rgb), 0.2);
            padding-top: 1rem;
            width: 100%;
            margin-top: auto;
            font-style: italic;
        }
        .archetype-card.teaser {
            position: relative;
            overflow: hidden;
            cursor: not-allowed;
            pointer-events: none;
        }
        .archetype-card.teaser > * {
            filter: blur(4px);
            opacity: 0.5;
        }
        .archetype-card.teaser::after {
            content: 'UNDER UTVECKLING';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-15deg);
            font-size: 2.5rem;
            font-weight: 700;
            font-family: 'Comfortaa', sans-serif;
            color: rgba(var(--nord-sym-light-accent-rgb), 0.15);
            z-index: 1;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            text-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        @media (max-width: 1024px) {
            .archetype-card { width: calc(50% - 1rem); }
        }
        @media (max-width: 768px) {
            .gallery-wrapper { 
                scroll-snap-type: x mandatory; 
                overflow-x: auto; 
                gap: 1.5rem; /* A bit more space */
            }
            .archetype-card { 
                scroll-snap-align: start; 
                width: 85%; /* A bit wider on mobile */
                min-height: 440px;
            }
        }

        .gallery-pagination-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: rgba(var(--nord-sym-text-light), 0.2);
            border: 1px solid rgba(var(--nord-sym-text-light), 0.3);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .gallery-pagination-dot:hover {
            background-color: rgba(var(--nord-sym-cyan-rgb), 0.5);
        }
        .gallery-pagination-dot.active {
            background-color: var(--nord-sym-cyan);
            border-color: var(--nord-sym-cyan);
            transform: scale(1.2);
            box-shadow: 0 0 10px rgba(var(--nord-sym-cyan-rgb), 0.5);
        }
        
        .gallery-control-btn {
            background: rgba(var(--nord-sym-cyan-rgb), 0.1);
            border: 1px solid rgba(var(--nord-sym-cyan-rgb), 0.3);
            border-radius: 50%;
            width: 52px;
            height: 52px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--nord-sym-cyan);
            font-size: 1.75rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .gallery-control-btn:hover:not(.disabled) {
            background: rgba(var(--nord-sym-cyan-rgb), 0.2);
            box-shadow: 0 0 15px rgba(var(--nord-sym-cyan-rgb), 0.4);
            transform: scale(1.05);
        }
        .gallery-control-btn.disabled {
            opacity: 0.3;
            cursor: not-allowed;
            transform: scale(1);
            background: rgba(var(--nord-sym-cyan-rgb), 0.1);
            box-shadow: none;
        }

        /* --- SYSTEM/PRICING CARD REJUVENATION --- */
        .pricing-card {
            background: linear-gradient(155deg, rgba(var(--nord-sym-deep-space-blue-rgb), 0.4), rgba(var(--nord-sym-mid-space-blue-rgb), 0.1));
            border: 1px solid rgba(var(--nord-sym-cyan-rgb), 0.15);
            backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
            border-radius: 1.5rem;
            padding: 2.5rem 2rem;
            display: flex;
            flex-direction: column;
            height: 100%;
            transition: all 0.4s cubic-bezier(0.25, 1, 0.5, 1);
            position: relative; /* <-- NY: För ::before */
            overflow: hidden; /* <-- NY: För ::before */
        }
        .pricing-card::before { /* <-- NY: Glow effect (från archetype-card) */
            content: '';
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: radial-gradient(circle at 50% 0%, rgba(var(--nord-sym-cyan-rgb), 0.2), transparent 70%);
            opacity: 0;
            transition: opacity 0.4s ease;
            z-index: 0; /* Bakom innehållet */
        }
        /* NY: Säkerställ att innehållet är ovanför glöden */
        .pricing-card > * {
            position: relative;
            z-index: 1;
        }
        .pricing-card:hover {
            transform: translateY(-8px);
            /* UPPDATERAD: Starkare skugga, matchar archetype-card */
            box-shadow: 0 0 35px rgba(var(--nord-sym-cyan-rgb), 0.3), 0 8px 25px rgba(0,0,0,0.3);
            border-color: var(--nord-sym-cyan); /* UPPDATERAD: Starkare border-färg */
        }
        .pricing-card:hover::before { /* <-- NY: Visa glöd vid hover */
            opacity: 1;
        }
        .pricing-card.ignite-package {
            border-color: var(--nord-sym-cyan);
            /* UPPDATERAD: Ännu starkare skugga för att poppa */
            box-shadow: 0 0 45px rgba(var(--nord-sym-cyan-rgb), 0.35), 0 10px 30px rgba(0,0,0,0.3);
            transform: scale(1.05); /* Make it stand out */
        }
        .pricing-card.ignite-package::before { /* <-- NY: Permanent, starkare glöd för ignite */
            opacity: 1;
            background: radial-gradient(circle at 50% 0%, rgba(var(--nord-sym-cyan-rgb), 0.3), transparent 70%);
        }
        .pricing-card.ignite-package:hover {
            transform: scale(1.08) translateY(-8px); /* Enhance hover effect */
        }
        .pricing-card.ignite-package:hover::before { /* <-- NY: Extra stark glöd vid hover */
            background: radial-gradient(circle at 50% 0%, rgba(var(--nord-sym-cyan-rgb), 0.4), transparent 70%);
        }
        .pricing-card-header h3 {
            font-family: 'Comfortaa', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--nord-sym-text-light);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }
        .price-display {
            font-family: 'Comfortaa', sans-serif;
            font-size: 3.5rem;
            font-weight: 700;
            color: var(--nord-sym-text-light);
            margin: 1.5rem 0;
        }
        .price-period {
            font-size: 1rem;
            color: var(--nord-sym-text-medium);
            font-weight: 400;
        }
        .pricing-card ul {
            list-style: none;
            padding: 0;
            margin: 0 0 2rem 0;
            flex-grow: 1;
        }
        .pricing-card li {
            display: flex;
            align-items: flex-start; /* ÄNDRAD: Från center till flex-start för toppjustering */
            gap: 1rem; /* ÄNDRAD: Ökad gap för luftighet */
            margin-bottom: 1.5rem; /* ÄNDRAD: Mer avstånd mellan punkter */
            color: var(--nord-sym-text-medium);
            line-height: 1.6; /* Bättre läsbarhet */
        }
        .pricing-card li i {
            color: var(--nord-sym-cyan);
            font-size: 1.5rem; /* Lite större ikoner */
            margin-top: 0.15rem; /* Finjustering för att linjera med textrubriken */
            flex-shrink: 0; /* Förhindra att ikonen krymper */
        }
        /* NYTT: Tvinga rubriken i listan till egen rad */
        .pricing-card li strong {
            display: block;
            color: var(--nord-sym-text-light);
            margin-bottom: 0.25rem;
            font-size: 1.05rem;
        }
        /* Light theme support för den nya strong-regeln */
        body.light-theme .pricing-card li strong {
            color: var(--nord-sym-blueprint-ink) !important;
        }

        #main-footer {
            border: 1px solid rgba(0, 191, 255, 0.3);
            box-shadow: 0 0 10px rgba(0, 191, 255, 0.1);
        }
        body.labb-active #main-footer {
            display: none !important; /* Total immersion i verkstaden. */
        }
        .footer-quicklinks { display: flex; flex-direction: column; gap: 0.25rem; align-items: center; }
        @media (min-width: 768px) { .footer-quicklinks { align-items: flex-start; } }
        .footer-link { color: var(--nord-sym-text-medium); transition: color 0.3s ease; padding: 0.1rem 0; }
        .footer-link:hover { color: var(--nord-sym-cyan); }
        .nordsym-logo-star {
            color: var(--nord-sym-light-accent);
            animation: nordsym-logo-star-glow 3s infinite ease-in-out;
        }
        @keyframes nordsym-logo-star-glow { 50% { filter: drop-shadow(0 0 12px rgba(var(--nord-sym-light-accent-rgb), 0.8)); } }
        .sr-only {
            position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px;
            overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border: 0;
        }
        .legal-content-container { color: var(--nord-sym-text-medium); }
        .legal-content-container h3 {
            font-family: 'Comfortaa', sans-serif; font-size: 1.5rem; font-weight: 700;
            color: var(--nord-sym-text-light); margin-top: 2rem; margin-bottom: 1rem;
            border-bottom: 1px solid rgba(var(--nord-sym-cyan-rgb), 0.2); padding-bottom: 0.5rem;
         }
         .legal-content-container a:hover { color: var(--nord-sym-light-accent); }
        .hero-headline-glow { animation: hero-glow-animation 5s ease-in-out infinite; }
        
        /* -- NYTT: Interaktiv trigger för AI-First -- */
        .interactive-ai-first-text {
            cursor: pointer;
            transition: all 0.3s ease;
            /* Subtil glöd som standard för att antyda interaktivitet */
            text-shadow: 0 0 8px rgba(var(--nord-sym-cyan-rgb), 0.3);
            white-space: nowrap; /* Förhindrar att "AI-First" delas upp */
        }
        .interactive-ai-first-text:hover {
            color: var(--nord-sym-cyan);
            text-shadow: 0 0 20px rgba(var(--nord-sym-cyan-rgb), 0.7);
        }
        
        /* Harmoni-fix: Återställer stilen för den accentuerade texten i rubriker. */
        .section-title-accent {
            color: var(--nord-sym-cyan);
            text-shadow: 0 0 10px rgba(var(--nord-sym-cyan-rgb), 0.5);
        }
        
        #header-logo-link.menu-open img {
            filter: drop-shadow(0 0 15px rgba(var(--nord-sym-cyan-rgb), 0.6));
        }
        
        #hero-logo-wrapper {
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.22, 1, 0.36, 1);
        }
        #hero-logo-wrapper:hover {
            transform: scale(1.04);
            filter: drop-shadow(0 0 25px rgba(var(--nord-sym-cyan-rgb), 0.5));
        }

        /* --- RITBORDET LOBBY & WORKSHOP RE-ARCHITECTING --- */
        #ritbordet {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: calc(100vh - 116px - 100px); /* Full height minus header/footer estimate */
            padding-top: 4rem;
            padding-bottom: 4rem;
        }

        #ritbordet-lobby {
            transition: opacity 0.4s ease, transform 0.4s ease;
            transform: scale(1);
        }
        body.labb-active #ritbordet-lobby {
            opacity: 0;
            pointer-events: none;
            transform: scale(0.95);
        }

        #ritbordet-lobby .desktop-layout { display: none; }
        @media (min-width: 1024px) {
            #ritbordet-lobby .desktop-layout {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 2.5rem;
                max-width: 1200px;
                width: 100%;
            }
        }
        #ritbordet-lobby .mobile-layout { display: block; }
        @media (min-width: 1024px) { #ritbordet-lobby .mobile-layout { display: none; } }

        .ritbordet-grid {
            display: grid;
            gap: 1.5rem;
            width: 100%;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        }
        @media (min-width: 1024px) {
            .ritbordet-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        .ritbordet-card {
            background: rgba(var(--nord-sym-deep-space-blue-rgb), 0.6);
            border: 1px solid rgba(var(--nord-sym-cyan-rgb), 0.2);
            padding: 1.5rem; /* Behålls för icke-flippbara */
            text-align: left;
            display: flex;
            flex-direction: column;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 1rem;
            transition: all 0.3s ease;
            position: relative; /* <-- Redan här */
            perspective: 1000px; /* <-- NYTT */
        }
        .ritbordet-card.flippable {
            padding: 0; /* <-- NYTT: Nollställ padding för flippbara */
            cursor: pointer;
            background: transparent; /* Ta bort bakgrund från container */
            border: none; /* Ta bort border från container */
        }
        .ritbordet-card:not(.flippable):hover { /* <-- NYTT: Begränsa hover-effekt */
            transform: translateY(-5px);
            box-shadow: 0 0 25px rgba(var(--nord-sym-cyan-rgb), 0.25);
            border-color: var(--nord-sym-cyan);
        }
        .ritbordet-card.flippable:hover .flip-card-front { /* <-- NYTT: Hover-effekt för framsidan */
             box-shadow: 0 0 25px rgba(var(--nord-sym-cyan-rgb), 0.25);
             border-color: var(--nord-sym-cyan);
        }

        /* --- NYTT: Flip Card Mekanik --- */
        .flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            min-height: 250px; /* Säkerställ minsta höjd */
            transition: transform 0.6s cubic-bezier(0.25, 1, 0.5, 1);
            transform-style: preserve-3d;
        }
        .ritbordet-card.is-flipped .flip-card-inner {
            transform: rotateY(180deg);
        }
        .flip-card-front,
        .flip-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden; /* Safari */
            backface-visibility: hidden;
            border-radius: 1rem; /* Måste sitta här nu */
            display: flex; 
            flex-direction: column;
            padding: 1.5rem; /* Återställ paddingen */
        }
        .flip-card-front {
            background: rgba(var(--nord-sym-deep-space-blue-rgb), 0.6);
            border: 1px solid rgba(var(--nord-sym-cyan-rgb), 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            /* Behöver peka på innehållet */
            text-align: left;
            transition: box-shadow 0.3s ease, border-color 0.3s ease;
        }
        .flip-card-back {
            background: rgba(var(--nord-sym-cyan-rgb), 0.1); 
            border: 1px solid rgba(var(--nord-sym-cyan-rgb), 0.4);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            transform: rotateY(180deg);
            text-align: left;
        }
        .flip-card-back h5 {
            font-family: 'Comfortaa', sans-serif;
            color: var(--nord-sym-light-accent);
            font-size: 1rem;
            margin-bottom: 1rem;
            border-bottom: 1px solid rgba(var(--nord-sym-cyan-rgb), 0.3);
            padding-bottom: 0.5rem;
        }
        .flip-card-back ul {
            list-style: none;
            padding: 0;
            margin: 0;
            flex-grow: 1;
        }
        .flip-card-back li {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            color: var(--nord-sym-text-medium);
            margin-bottom: 0.5rem;
        }
        .flip-card-back li i {
            font-size: 1rem;
            color: var(--nord-sym-cyan);
        }
        /* --- Slut på Flip Card --- */

        .ritbordet-card i { font-size: 1.75rem; color: var(--nord-sym-cyan); margin-bottom: 0.75rem; }
        .ritbordet-card h4 { font-family: 'Comfortaa', sans-serif; font-size: 1rem; color: var(--nord-sym-text-light); margin-bottom: 0.5rem; }
        .ritbordet-card p { font-size: 0.875rem; color: var(--nord-sym-text-medium); flex-grow: 1; margin-bottom: 1rem; }
        .ritbordet-card button { margin-top: auto; }

        .portal-btn-placeholder { /* Harmoni-fix: Egen klass för centrering */
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 1rem 0;
        }
        
        #geometry-cta {
            position: relative;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(var(--nord-sym-cyan-rgb), 0.15) 0%, rgba(var(--nord-sym-deep-space-blue), 0) 70%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.4s ease;
            border: 1px solid transparent;
        }
        #geometry-cta:hover {
            transform: scale(1.05);
            background: radial-gradient(circle, rgba(var(--nord-sym-cyan-rgb), 0.25) 0%, rgba(var(--nord-sym-deep-space-blue), 0) 70%);
            border-color: rgba(var(--nord-sym-cyan-rgb), 0.3);
            box-shadow: 0 0 30px rgba(var(--nord-sym-cyan-rgb), 0.2);
        }
        #geometry-cta i { font-size: 3rem; color: var(--nord-sym-cyan); transition: all 0.3s ease; }
        #geometry-cta .cta-text { font-weight: 600; color: var(--nord-sym-text-light); margin-top: 0.5rem; transition: all 0.3s ease; }
        #geometry-cta:hover i { transform: rotate(45deg) scale(1.1); }
        #geometry-cta:hover .cta-text { color: var(--nord-sym-cyan); }
        
        #mobile-enter-workshop-btn {
            display: none; /* Hidden by default, shown by JS for mobile lobby */
        }
        body.ritbordet-visible #mobile-enter-workshop-btn {
            display: flex;
            position: fixed;
            bottom: 3rem;
            left: 50%;
            transform: translateX(-50%);
            width: 64px; height: 64px;
            background: rgba(var(--nord-sym-cyan-rgb), 0.15);
            backdrop-filter: blur(8px);
            border: 1px solid var(--nord-sym-cyan);
            border-radius: 50%;
            align-items: center; justify-content: center;
            z-index: 999;
            color: var(--nord-sym-cyan);
            font-size: 2rem;
            box-shadow: 0 0 20px rgba(var(--nord-sym-cyan-rgb), 0.3);
        }
        body.labb-active #mobile-enter-workshop-btn {
            display: none !important;
        }
        @media (min-width: 1024px) { body.ritbordet-visible #mobile-enter-workshop-btn { display: none; } }
        
        #workshop-onboarding {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(12, 20, 39, 0.8); backdrop-filter: blur(10px);
            display: flex; justify-content: center; align-items: center; text-align: center;
            z-index: 2000;
            opacity: 0; pointer-events: none;
            transition: opacity 0.5s ease;
        }
        #workshop-onboarding.visible { opacity: 1; pointer-events: auto; }
        .onboarding-content {
            background: rgba(12, 20, 39, 0.7); border: 1px solid rgba(var(--nord-sym-cyan-rgb), 0.2);
            padding: 3rem; border-radius: 1.5rem; max-width: 500px;
        }
        .onboarding-content h3 { font-family: 'Comfortaa', sans-serif; font-size: 2rem; color: var(--nord-sym-text-light); }
        .esc-hint {
            position: absolute; bottom: 2rem; left: 50%; transform: translateX(-50%);
        }

        .joystick-portal {
            position: fixed;
            bottom: -100px;
            width: 80px; height: 80px;
            border-radius: 50%;
            z-index: 2006;
            display: flex; align-items: center; justify-content: center;
            transition: bottom 0.5s ease, opacity 0.3s ease;
            background: rgba(12, 20, 39, 0.5);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(var(--nord-sym-text-medium), 0.3);
            color: var(--nord-sym-text-medium);
            /* Harmoni-fix: Utrotar scroll-konflikten genom att göra joysticks helt icke-interaktiva som standard. */
            pointer-events: none;
            opacity: 0;
        }
        .joystick-portal.active { border-color: var(--nord-sym-cyan); color: var(--nord-sym-cyan); }
        .joystick-portal i { font-size: 2rem; }
        #joystick-portal-left { left: 2rem; }
        #joystick-portal-right { right: 2rem; }
        
        @media (max-width: 767px) {
            body.labb-active .joystick-portal { 
                bottom: 1.5rem;
                pointer-events: auto; /* Återaktiveras endast i verkstaden */
                opacity: 1;
            }
        }
        
        /* UPPDATERAD: Dölj joysticks helt på desktop/tablet */
        @media (min-width: 768px) {
             .joystick-portal {
                display: none !important;
            }
        }

        /* --- MOBIL VERKSTAD UI-HARMONISERING --- */
        #toolbar-toggle {
            display: none; /* Dold som standard */
            position: fixed;
            left: 1rem;
            top: 10rem; /* Harmoni-fix: Flyttad högre upp för att inte störa joysticken. */
            transform: translateY(-50%);
            z-index: 2005;
            background: rgba(12, 20, 39, 0.5);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(var(--nord-sym-text-medium), 0.3);
            transition: opacity 0.3s ease, transform 0.3s ease;
            width: 44px; height: 44px; /* Harmoni-fix: Matchar de andra knapparna */
            font-size: 1.25rem; /* Harmoni-fix: Ikonstorlek */
        }
        #toolbar-close {
            display: none; /* Dold som standard, visas bara i mobil-verktygsfältet */
        }
        @media (max-width: 767px) {
             /* Åsidosätt den gamla topp-placeringen */
            body.labb-active #elastic-toolbar {
                top: 50%;
                left: -200px; /* Börja utanför skärmen */
                bottom: auto;
                transform: translateY(-50%);
                transition: left 0.4s cubic-bezier(0.22, 1, 0.36, 1);
                width: auto; /* Harmoni-fix: Låt innehållet bestämma bredden. */
            }
            body.labb-active.toolbar-open #elastic-toolbar {
                left: 1rem; /* Glid in */
            }
            body.labb-active #elastic-toolbar .glass-control-group {
                flex-direction: column;
                padding: 0.75rem;
                border-radius: 1rem; /* Harmoni-fix: Ger verktygsfältet en mjukare form. */
            }
            body.labb-active #toolbar-close {
                display: flex;
                margin-bottom: 0.5rem; /* Avstånd till de andra knapparna */
            }

            body.labb-active #toolbar-toggle {
                display: flex; /* Visa bara i verkstadsläge på mobil */
            }
            /* Harmoni-fix: Tog bort regeln som dolde knappen, nu transformeras den istället. */

            /* Harmoni-fix: Dölj vänster joystick när verktygsfältet är öppet för att ge det andrum. */
            body.labb-active.toolbar-open #joystick-portal-left {
                opacity: 0;
                pointer-events: none;
            }
        }
        
        #joystick-portal-right .portal-ring {
            position: absolute; border-radius: 50%; border: 2px solid var(--nord-sym-cyan);
            opacity: 0; transition: all 0.4s ease;
        }
        #joystick-portal-right.active .portal-ring { opacity: 1; }
        .portal-ring-outer { width: 100%; height: 100%; }
        .portal-ring-inner { width: 80%; height: 80%; }
        #joystick-portal-right.active .portal-ring-outer { transform: scale(1.2); }
        #joystick-portal-right.active .portal-ring-inner { transform: scale(0.9); }
        #joystick-portal-right .portal-icon-exit { display: none; }
        body.labb-active #joystick-portal-right .portal-icon-exit { display: block; }
        body.labb-active #joystick-portal-right .portal-icon-enter { display: none; }

        #elastic-toolbar {
            position: fixed; 
            bottom: -100px; 
            left: 50%; 
            transform: translateX(-50%);
            z-index: 2002;
            transition: all 0.5s ease; /* Harmoni-fix: Ändrat till 'all' för att hantera både 'top' och 'bottom'. */
        }
        body.labb-active #elastic-toolbar { bottom: 2rem; }
        .glass-control-group {
            display: flex; gap: 0.5rem;
            background: rgba(12, 20, 39, 0.5); backdrop-filter: blur(10px);
            padding: 0.75rem; border-radius: 99px;
            border: 1px solid rgba(var(--nord-sym-text-light), 0.2);
        }
        .glass-btn {
            width: 44px; height: 44px;
            border-radius: 50%; border: none; background: transparent; color: var(--nord-sym-text-light);
            display: flex; justify-content: center; align-items: center; font-size: 1.25rem;
            cursor: pointer; transition: all 0.3s ease;
        }
        .glass-btn:hover { background: rgba(var(--nord-sym-cyan-rgb), 0.1); color: var(--nord-sym-cyan); }
        .glass-btn.active { background: var(--nord-sym-cyan); color: var(--nord-sym-deep-space-blue); font-weight: bold; }
        .glass-btn svg { width: 24px; height: 24px; }
        #fractal-mode-toggle.glow {
            box-shadow: 0 0 15px rgba(var(--nord-sym-cyan-rgb), 0.7), inset 0 0 5px rgba(var(--nord-sym-cyan-rgb), 0.5);
            color: var(--nord-sym-cyan);
        }
        
        /* --- UNIFIED CANVAS STYLES --- */
        #unified-geometry-canvas {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            z-index: -5 !important;
            pointer-events: none !important;
        }
        #unified-geometry-canvas.interactive {
            cursor: grab;
            pointer-events: auto !important; /* VIKTIGT: !important krävs för att skriva över basstilen. */
        }
        #unified-geometry-canvas.interactive:active {
            cursor: grabbing;
        }
        
        /* FORM NAME DISPLAY in Header */
        #form-name-display {
            position: absolute; /* Harmoni-fix för perfekt centrering */
            top: 70%; /* Harmoni-fix: Flyttad ned för att undvika överlappning */
            left: 50%;
            transform: translate(-50%, -50%);
            width: max-content;
            max-width: calc(100% - 200px); /* Undviker överlappning */
            z-index: 1;
            padding: 0.25rem 1rem;
            background: rgba(12, 20, 39, 0);
            color: var(--nord-sym-light-accent);
            font-family: 'Source Code Pro', monospace;
            font-size: 0.875rem;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
            text-transform: capitalize;
            text-align: center;
        }
        @media (max-width: 767px) {
            #form-name-display {
                max-width: calc(100% - 120px);
            }
        }
        body.labb-active #form-name-display.visible {
            opacity: 1;
        }

        /* NEW STYLES FOR LEGAL PAGES */
        .legal-content-card {
            background: rgba(var(--nord-sym-mid-space-blue-rgb), 0.1);
            border: 1px solid rgba(var(--nord-sym-cyan-rgb), 0.2);
            backdrop-filter: blur(10px);
            border-radius: 1.5rem;
            padding: 2.5rem 3rem;
        }
        .legal-content-container h4 {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-family: 'Comfortaa', sans-serif;
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--nord-sym-text-light);
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
        }
        .legal-content-container h4 i {
            font-size: 1.5rem;
            color: var(--nord-sym-cyan);
        }
        .legal-content-container p, .legal-content-container ul {
            line-height: 1.7;
            margin-bottom: 1rem;
        }
        .legal-content-container ul {
            list-style-position: inside;
            list-style-type: disc;
            padding-left: 1rem;
        }

        /* NEW STYLES FOR ARKITEKTUR PAGE */
        #om-oss .arkitektur-grid {
            display: grid;
            gap: 2rem;
            margin-top: 4rem;
        }
        @media (min-width: 1024px) {
            #om-oss .arkitektur-grid {
                grid-template-columns: 1fr 1fr;
                gap: 4rem;
                align-items: start;
            }
        }
        #om-oss .arkitektur-list {
            list-style: none;
            padding: 0;
            margin-top: 1.5rem;
        }
        #om-oss .arkitektur-list li {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 1rem;
            font-size: 1.125rem;
            color: var(--nord-sym-text-medium);
        }
        #om-oss .arkitektur-list i {
            color: var(--nord-sym-cyan);
            font-size: 1.5rem;
            margin-top: 0.2rem;
            flex-shrink: 0;
        }

        /* --- ARKITEKTUR PAGE CARD STYLING --- */
        .arkitektur-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(var(--nord-sym-cyan-rgb), 0.15);
            padding: 2.5rem 2rem;
            text-align: left;
            display: flex;
            flex-direction: column;
            border-radius: 1.5rem;
            height: 100%;
            transition: all 0.3s ease;
        }
        .arkitektur-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 25px rgba(var(--nord-sym-cyan-rgb), 0.2);
            border-color: rgba(var(--nord-sym-cyan-rgb), 0.4);
        }
        .arkitektur-card i {
            color: var(--nord-sym-cyan);
            font-size: 2.5rem;
            margin-bottom: 1rem;
            align-self: flex-start;
        }
        .arkitektur-card h3 {
            font-family: 'Comfortaa', sans-serif;
            color: var(--nord-sym-text-light);
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }
        .arkitektur-card p {
            color: var(--nord-sym-text-medium);
            line-height: 1.6;
            font-size: 1rem;
        }

        /* --- FORM MAKEOVER: QUANTUM HARMONY --- */
        .form-container {
            background: rgba(var(--nord-sym-mid-space-blue-rgb), 0.1);
            border: 1px solid rgba(var(--nord-sym-cyan-rgb), 0.25);
            backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            transition: box-shadow 0.3s ease, border-color 0.3s ease;
            border-radius: 1.5rem; /* Harmoni-fix: Matchar andra kort */
        }
        .form-container:hover {
            box-shadow: 0 0 30px rgba(var(--nord-sym-cyan-rgb), 0.15);
            border-color: rgba(var(--nord-sym-cyan-rgb), 0.4);
        }
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--nord-sym-text-light);
            font-size: 0.875rem;
        }
        .form-input, .form-textarea {
            width: 100%;
            background-color: rgba(var(--nord-sym-deep-space-blue-rgb), 0.8);
            border: 1px solid rgba(var(--nord-sym-text-light), 0.2);
            border-radius: 0.5rem;
            padding: 0.85rem 1rem;
            color: var(--nord-sym-text-light);
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .form-input::placeholder, .form-textarea::placeholder {
            color: var(--nord-sym-text-medium);
            opacity: 0.6;
        }
        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--nord-sym-cyan);
            box-shadow: 0 0 15px rgba(var(--nord-sym-cyan-rgb), 0.3);
        }
        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }
        .form-progress-bar {
            height: 4px;
            background-color: rgba(var(--nord-sym-text-light), 0.1);
            border-radius: 2px;
            margin-bottom: 2.5rem;
            margin-top: 0.5rem;
            overflow: hidden;
        }
        .form-progress-bar-inner {
            height: 100%;
            background: var(--nord-sym-cyan);
            width: 0%;
            border-radius: 2px;
            transition: width 0.4s ease;
            box-shadow: 0 0 10px rgba(var(--nord-sym-cyan-rgb), 0.7);
        }
        .form-step {
            display: none;
        }
        .form-step.active {
            display: block;
        }
        .form-navigation {
            padding-top: 2rem;
            border-top: 1px solid rgba(var(--nord-sym-cyan-rgb), 0.1);
            margin-top: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .form-loading .form-step, .form-loading .form-progress-bar {
            filter: blur(4px);
            opacity: 0.5;
            pointer-events: none;
            transition: all 0.3s ease;
        }
        .form-success-container {
            text-align: center;
            padding: 2rem 0;
        }
        .form-success-container i {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        .form-success-container p {
            font-size: 1.125rem;
            color: var(--nord-sym-text-light);
        }

        /* --- GRATIS AGENT-MODAL --- */
        #free-agent-modal {
            transition: opacity 0.3s ease;
        }
        #free-agent-modal .modal-content-wrapper {
            transition: transform 0.3s cubic-bezier(0.25, 1, 0.5, 1);
        }
        #free-agent-modal.visible {
            opacity: 1;
            pointer-events: auto;
        }
        #free-agent-modal.visible .modal-content-wrapper {
            transform: scale(1);
        }

        /* --- KOMMER SNART-MODAL --- */
        #coming-soon-modal {
            transition: opacity 0.3s ease;
        }
        #coming-soon-modal .modal-content-wrapper {
            transition: transform 0.3s cubic-bezier(0.25, 1, 0.5, 1);
        }
        #coming-soon-modal.visible {
            opacity: 1;
            pointer-events: auto;
        }
        #coming-soon-modal.visible .modal-content-wrapper {
            transform: scale(1);
        }

        /* --- CHAT WIDGET STYLES --- */
        #chat-widget-container {
            opacity: 0;
            transform: scale(0.8);
            transition: opacity 0.4s ease, transform 0.4s ease;
            pointer-events: none;
        }
        #chat-widget-container.visible {
            opacity: 1;
            transform: scale(1);
            pointer-events: auto;
        }
        #chat-bubble {
            background: radial-gradient(circle, var(--nord-sym-cyan) 0%, var(--nord-sym-mid-space-blue) 100%);
            box-shadow: 0 0 25px rgba(var(--nord-sym-cyan-rgb), 0.4);
            animation: chat-bubble-pulse 2.5s infinite ease-in-out;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        #chat-bubble:hover {
            transform: scale(1.1);
            box-shadow: 0 0 35px rgba(var(--nord-sym-cyan-rgb), 0.7);
        }
        #chat-bubble.hidden {
            transform: scale(0);
            opacity: 0;
            pointer-events: none;
        }
        @keyframes chat-bubble-pulse {
            50% { transform: scale(1.05); }
        }

        #chat-window {
            background: rgba(var(--nord-sym-deep-space-blue-rgb), 0.85);
            border: 1px solid rgba(var(--nord-sym-cyan-rgb), 0.3);
            backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            opacity: 0;
            transform: translateY(20px) scale(0.95);
            pointer-events: none;
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        #chat-window.visible {
            opacity: 1;
            transform: translateY(0) scale(1);
            pointer-events: auto;
        }

        #chat-header {
            background: rgba(var(--nord-sym-mid-space-blue-rgb), 0.2);
            border-bottom: 1px solid rgba(var(--nord-sym-cyan-rgb), 0.2);
        }

        #chat-messages {
            scrollbar-width: thin;
            scrollbar-color: var(--nord-sym-cyan) transparent;
        }
        #chat-messages::-webkit-scrollbar {
            width: 6px;
        }
        #chat-messages::-webkit-scrollbar-track {
            background: transparent;
        }
        #chat-messages::-webkit-scrollbar-thumb {
            background-color: var(--nord-sym-cyan);
            border-radius: 6px;
        }
        .message {
            max-width: 80%;
            margin-bottom: 1rem;
            display: flex;
            flex-direction: column;
        }
        .message p {
            padding: 0.75rem 1rem;
            border-radius: 1.25rem;
            line-height: 1.5;
            font-size: 0.9rem;
        }
        .bot-message {
            align-items: flex-start;
        }
        .bot-message p {
            background: rgba(var(--nord-sym-mid-space-blue-rgb), 0.4);
            color: var(--nord-sym-text-light);
            border-bottom-left-radius: 0.25rem;
        }
        .user-message {
            align-items: flex-end;
            margin-left: auto;
        }
        .user-message p {
            background: var(--nord-sym-cyan);
            color: var(--nord-sym-deep-space-blue);
            font-weight: 500;
            border-bottom-right-radius: 0.25rem;
        }
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        .typing-indicator span {
            width: 8px;
            height: 8px;
            /* NY ÄNDRING: Startar med cyan-färg, men nedtonad */
            background-color: rgba(var(--nord-sym-cyan-rgb), 0.3);
            border-radius: 50%;
            /* NY ÄNDRING: Byter till 'typing-glow' och justerar tiden */
            animation: typing-glow 1.5s infinite ease-in-out;
            /* NY ÄNDRING: Lägger till en matchande box-shadow och mjuk övergång */
            box-shadow: 0 0 4px rgba(var(--nord-sym-cyan-rgb), 0.3);
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }
        .typing-indicator span:nth-child(2) { animation-delay: 0.25s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.5s; }

        /* NY ÄNDRING: Ersätter 'typing-pulse' med 'typing-glow' */
        @keyframes typing-glow {
            0%, 100% {
                /* Start/slut-läge: svag */
                background-color: rgba(var(--nord-sym-cyan-rgb), 0.2);
                box-shadow: 0 0 4px rgba(var(--nord-sym-cyan-rgb), 0.2);
                transform: scale(0.9);
            }
            50% {
                /* Mitten-läge: stark */
                background-color: rgba(var(--nord-sym-cyan-rgb), 1);
                box-shadow: 0 0 8px rgba(var(--nord-sym-cyan-rgb), 0.7);
                transform: scale(1);
            }
        }

        #chat-input-area {
            border-top: 1px solid rgba(var(--nord-sym-cyan-rgb), 0.2);
        }
        #chat-input {
            background-color: rgba(var(--nord-sym-deep-space-blue-rgb), 0.8);
            border: 1px solid rgba(var(--nord-sym-text-light), 0.2);
            color: var(--nord-sym-text-light);
        }
        #chat-input:focus {
            outline: none;
            border-color: var(--nord-sym-cyan);
            box-shadow: 0 0 10px rgba(var(--nord-sym-cyan-rgb), 0.3);
        }
        #chat-send-btn {
            background-color: var(--nord-sym-cyan);
            color: var(--nord-sym-deep-space-blue);
            transition: transform 0.2s ease;
        }
        #chat-send-btn:hover {
            transform: scale(1.1);
        }
        @media (max-width: 480px) {
            #chat-widget-container {
                bottom: 1rem;
                right: 1rem;
                width: calc(100% - 2rem);
            }
            #chat-bubble {
                position: absolute;
                bottom: 0;
                right: 0;
            }
            #chat-window {
                width: 100%;
                height: 70vh; /* Use viewport height for mobile */
                height: 70dvh;
                max-height: 600px;
            }
        }

        #chat-close-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--nord-sym-text-medium);
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        #chat-close-btn:hover {
            background-color: rgba(var(--nord-sym-cyan-rgb), 0.15);
            color: var(--nord-sym-cyan);
        }

        /* --- NYTT: STEG 1.3 (CSS-regler för AI-First Spelet) --- */
        
        /* Döljer spel-elementen som standard */
        .ai-pulse {
            display: none;
            position: fixed;
            z-index: 100;
        }

        /* Styling för spelarens skepp (återanvänder befintlig ikon) */
        .ai-ship {
            /* Ikonen #ai-first-ship-icon är redan 'absolute' och har rätt stil.
               Vi behöver en klass för att hantera dess 'fixed' position under spelet.
               Vi lägger till 'will-change' för prestanda.
            */
            will-change: left, bottom, transform;
            transition: left 0.1s linear; /* För mjuk rörelse */
            z-index: 101; /* STEG 1: KRITISK BUGGFIX - Gör skeppet synligt ovanför sköldar/fiender. */
        }

        /* Styling för pulsen som skjuts */
        .ai-pulse {
            display: block;
            width: 6px; /* Lite bredare */
            height: 28px; /* Lite längre */
            /* Byt ut platt färg mot en gradient */
            background: linear-gradient(
                to top,
                rgba(var(--nord-sym-cyan-rgb), 0.5) 0%,
                rgba(var(--nord-sym-cyan-rgb), 1) 50%,
                #ffffff 100%
            );
            /* Starkare, snyggare skugga */
            box-shadow: 0 0 15px 5px rgba(var(--nord-sym-cyan-rgb), 0.7);
            border-radius: 3px;
            will-change: top;
        }

        /* Ny klass för korten när de är i "spel-läge".
           Vi kan inte animera .arkitektur-card direkt, eftersom
           Tailwinds grid-klasser stör 'position: fixed'.
           Vi kommer att klona dem eller applicera denna klass.
        */
        .invader-card-game {
            position: fixed;
            z-index: 100;
            /* Säkerställer att korten behåller sin stil */
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(var(--nord-sym-cyan-rgb), 0.15);
            padding: 2.5rem 2rem;
            border-radius: 1.5rem;
            width: var(--invader-width, 400px); /* Bredd sätts via JS */
            height: var(--invader-height, 250px); /* Höjd sätts via JS */
            will-change: transform, opacity;
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        
        /* En body-klass för att dölja scrollbars under spelet */
        body.game-active {
            overflow: hidden !important;
        }
        /* --- SLUT PÅ STEG 1.3 --- */

        /* --- NYTT: STEG 3.1 (Fiende-Triangel CSS) --- */
        .ai-enemy-triangle {
            position: fixed;
            z-index: 100;
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-bottom: 25px solid #FF4136; /* Röd färg */
            filter: drop-shadow(0 0 5px rgba(255, 65, 54, 0.7));
            will-change: transform, opacity;
            transition: opacity 0.3s ease;
        }
        /* --- SLUT PÅ STEG 3.1 --- */

        /* --- NYTT: STEG 3.2 (Fiende-Skott CSS) --- */
        .ai-enemy-pulse {
            position: fixed;
            z-index: 100;
            width: 5px;
            height: 15px;
            background-color: var(--nord-sym-orange); /* Använder temats orangea färg */
            border-radius: 2px;
            box-shadow: 0 0 10px rgba(255, 140, 0, 0.8);
            will-change: top;
        }
        /* --- SLUT PÅ STEG 3.2 --- */

        /* --- COOKIE CONSENT (HARMONISERAD) --- */
        #cookie-consent {
            position: fixed;
            bottom: 2rem;
            left: 2rem; /* Vänster sida för att balansera Chat Widget */
            width: calc(100% - 4rem);
            max-width: 320px;
            z-index: 2050; /* Över det mesta, men under extrema overlays */
            
            /* Dark Theme Default */
            background: rgba(12, 20, 39, 0.9);
            backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
            
            /* Animation State */
            opacity: 0;
            pointer-events: none;
            transform: translateY(20px);
            transition: all 0.6s cubic-bezier(0.22, 1, 0.36, 1);
        }
        
        #cookie-consent.visible {
            opacity: 1;
            pointer-events: auto;
            transform: translateY(0);
        }

        #cookie-consent p {
            font-size: 0.85rem;
            color: var(--nord-sym-text-medium);
            line-height: 1.5;
            margin-bottom: 1rem;
        }

        #cookie-consent a {
            color: var(--nord-sym-cyan);
            text-decoration: underline;
            transition: color 0.2s;
        }
        #cookie-consent a:hover { color: var(--nord-sym-light-accent); }

        /* Light Theme Overrides */
        body.light-theme #cookie-consent {
            background: var(--nord-sym-blueprint-bg);
            border: 1px solid var(--nord-sym-blueprint-lines);
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        body.light-theme #cookie-consent p {
            color: var(--nord-sym-blueprint-ink);
        }

        /* --- FAQ STYLES --- */
        details summary::-webkit-details-marker { display: none; }
        details summary { list-style: none; }
        details summary:focus { outline: none; }
        
        .faq-item {
            background: linear-gradient(155deg, rgba(var(--nord-sym-deep-space-blue-rgb), 0.4), rgba(var(--nord-sym-mid-space-blue-rgb), 0.1));
            border: 1px solid rgba(var(--nord-sym-cyan-rgb), 0.15);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
            overflow: hidden;
        }
        .faq-item:hover {
            border-color: var(--nord-sym-cyan);
            box-shadow: 0 0 15px rgba(var(--nord-sym-cyan-rgb), 0.1);
        }
        .faq-question {
            padding: 1.5rem;
            cursor: pointer;
            font-family: 'Comfortaa', sans-serif;
            font-weight: 700;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--nord-sym-text-light);
        }
        .faq-answer {
            padding: 0 1.5rem 1.5rem 1.5rem;
            color: var(--nord-sym-text-medium);
            line-height: 1.6;
            font-size: 0.95rem;
            border-top: 1px solid rgba(var(--nord-sym-cyan-rgb), 0.1);
            margin-top: 0;
            padding-top: 1rem;
        }
        details[open] .faq-icon { transform: rotate(180deg); }
        .faq-icon { transition: transform 0.3s ease; color: var(--nord-sym-cyan); }

        /* FAQ Light Theme */
        body.light-theme .faq-item {
            background: var(--nord-sym-blueprint-bg);
            border: 1px solid var(--nord-sym-blueprint-lines);
            box-shadow: 0 4px 6px rgba(0,0,0,0.04);
        }
        body.light-theme .faq-item:hover {
            border-color: var(--nord-sym-blueprint-cyan);
            box-shadow: 0 0 15px rgba(var(--nord-sym-blueprint-cyan-rgb), 0.1);
        }
        body.light-theme .faq-question { color: var(--nord-sym-blueprint-ink); }
        body.light-theme .faq-answer { 
            color: var(--nord-sym-blueprint-ink); 
            opacity: 0.8;
            border-top-color: var(--nord-sym-blueprint-lines-faint);
        }

        /* --- STARFALL BACKGROUND (NEW) --- */
        #starfall {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -10; /* Behind geometry (-5) and content */
            pointer-events: none;
            opacity: 1;
            transition: opacity 0.8s ease;
        }
        
        /* Dölj Starfall helt i ljust tema för att bevara Blåkopia-designen */
        body.light-theme #starfall {
            opacity: 0;
        }
    </style>
</head>
<body class="antialiased light-theme">
    <!-- CRAWLER NAVIGATION (AEO BOOST) -->
    <nav id="crawler-nav" class="sr-only" aria-label="Sitemap för sökrobotar">
        <ul>
            <li><a href="#hero">Start</a></li>
            <li><a href="#om-oss">Vår Arkitektur och Filosofi</a></li>
            <li><a href="#system">Systempaket och Priser</a></li>
            <li><a href="#ritbordet">Ritbordet och Process</a></li>
            <li><a href="#atom-gallery-section">AI-Byggstenar och Produkter</a></li>
            <li><a href="#karriar">Karriär och Rekrytering</a></li>
        </ul>
    </nav>

    <!-- Insert Starfall Canvas before Header -->
    <canvas id="starfall"></canvas>

    <header id="header" class="fixed w-full top-0 left-0 right-0 z-40 bg-nord-sym-deep-space-blue/95 transition-all duration-300" itemscope itemtype="https://schema.org/WPHeader">
        <div class="container mx-auto px-4 md:px-6 py-4 flex justify-between items-center"> 
            <a href="#" id="header-logo-link" onclick="window.nord.handleHeaderLogoClick(event); return false;" class="flex-shrink-0">
                <img src="https://raw.githubusercontent.com/GusHem/Logga-utan-text/refs/heads/main/Final%20logo%20no%20text.svg" alt="NordSym Logotyp" class="h-16 md:h-20 transition-all duration-300">
            </a>
            <nav aria-label="Huvudnavigation" class="hidden md:flex flex-grow justify-center space-x-5 items-center header-nav">
                <a href="#" onclick="window.nord.showPage('hero'); return false;" data-nav="hero" class="nav-link transition-colors font-medium">Hem</a>
                <a href="#" onclick="window.nord.showPage('om-oss'); return false;" data-nav="om-oss" class="nav-link transition-colors font-medium">Arkitektur</a>
                <a href="#" onclick="window.nord.showPage('system'); return false;" data-nav="system" class="nav-link transition-colors font-medium">System</a>
                <a href="#" onclick="window.nord.showPage('ritbordet'); return false;" data-nav="ritbordet" class="nav-link transition-colors font-medium">Ritbordet</a>
                <a href="#" onclick="window.nord.showPage('karriar'); return false;" data-nav="karriar" class="nav-link transition-colors font-medium">Gör din del</a>
            </nav>
            <div class="hidden md:flex items-center gap-x-4 flex-shrink-0 header-cta"> 
                <a href="#" onclick="window.nord.showPage('boka-samtal-skraddarsydd'); return false;" class="btn-base btn-cta-revised text-sm">Framtidsförsäkra er verksamhet</a>
                <!-- NY TEMAKNAPP (DESKTOP) -->
                <button id="theme-toggle-btn-desktop" class="theme-toggle-btn" aria-label="Växla ljus/mörkt tema">
                    <i class="ph ph-sun"></i>
                </button>
            </div>
            
            <!-- NY TEMAKNAPP (MOBIL) -->
            <button id="theme-toggle-btn-mobile" class="theme-toggle-btn md:hidden" aria-label="Växla ljus/mörkt tema">
                <i class="ph ph-sun"></i>
            </button>

            <!-- Form Name Display flyttad utanför grid-flödet för absolut centrering -->
            <div id="form-name-display"></div>
        </div>
        <div id="mobile-menu" class="md:hidden bg-nord-sym-deep-space-blue/95 backdrop-blur-sm shadow-lg rounded-b-xl absolute w-full left-0 top-full overflow-hidden transition-all duration-500 ease-in-out max-h-0">
            <a href="#" onclick="window.nord.showPage('hero'); return false;" data-nav="hero" class="block px-6 py-5 text-sky-100 hover:bg-sky-700/50 hover:nord-accent-text transition-colors">Hem</a>
            <a href="#" onclick="window.nord.showPage('om-oss'); return false;" data-nav="om-oss" class="block px-6 py-5 text-sky-100 hover:bg-sky-700/50 hover:nord-accent-text transition-colors">Arkitektur</a>
            <a href="#" onclick="window.nord.showPage('system'); return false;" data-nav="system" class="block px-6 py-5 text-sky-100 hover:bg-sky-700/50 hover:nord-accent-text transition-colors">System</a>
            <a href="#" onclick="window.nord.showPage('ritbordet'); return false;" data-nav="ritbordet" class="block px-6 py-5 text-sky-100 hover:bg-sky-700/50 hover:nord-accent-text transition-colors">Ritbordet</a>
            <a href="#" onclick="window.nord.showPage('karriar'); return false;" data-nav="karriar" class="block px-6 py-5 text-sky-100 hover:bg-sky-700/50 hover:nord-accent-text transition-colors">Gör din del</a>
            <div class="px-6 py-5 border-t border-sky-800/50 flex items-center gap-x-4">
                <a href="#" onclick="window.nord.showPage('boka-samtal-skraddarsydd'); return false;" data-nav="kontakt" class="btn-base btn-cta-revised w-full flex-grow">Framtidsförsäkra er verksamhet</a>
            </div>
        </div>
    </header>

    <main itemscope itemtype="https://schema.org/WebPage"> 
        <section id="hero" class="space-background-section">
            <div class="section-content-wrapper">
                <div class="flex flex-col items-center gap-y-8">
                    <div id="hero-logo-wrapper" onclick="window.nord.showPage('om-oss');">
                        <!-- UPDATED: Minskad logotypstorlek (200px bredd istället för 400px) -->
                        <img src="https://raw.githubusercontent.com/GusHem/Logga-utan-text/refs/heads/main/Final%20logo%20no%20text.svg" alt="NordSym Logotyp" width="200" height="57">
                    </div>
                    <h1 class="text-5xl md:text-6xl font-bold leading-tight text-center hero-headline-glow" style="color: var(--nord-sym-light-accent);">
                        System som tänker med er.
                    </h1>
                    <p class="text-lg md:text-xl text-sky-100 max-w-3xl mx-auto drop-shadow-sm text-center">
                        Vi bygger er framtidssäkra, intelligenta AI-arkitektur.
                    </p>
                    <div class="flex flex-col items-center gap-6">
                        <div class="flex flex-col md:flex-row items-center gap-4 md:gap-6">
                            <a href="#" onclick="window.nord.showPage('boka-samtal-skraddarsydd'); return false;" class="btn-base btn-cta-revised w-full md:w-auto">Framtidsförsäkra er verksamhet</a>
                            <a href="#" onclick="window.nord.showPage('ritbordet'); return false;" class="btn-base btn-secondary-on-dark w-full md:w-auto">Utforska Ritbordet</a>
                        </div>
                         <div class="flex flex-col sm:flex-row gap-4 sm:gap-8 mt-4 text-sm text-sky-300 justify-center">
                            <span>Kalibrerat för er verklighet</span>
                            <span>Byggt på beprövade mönster</span>
                            <span>🇸🇪 Svensk ingenjörskonst</span>
                        </div>
                    </div>
                </div>
            </section>
        </section>
        
        <section id="home-diagram-section" class="space-background-section py-16 lg:py-24">
            <div class="section-content-wrapper">
                <div class="text-center mb-16 max-w-4xl mx-auto">
                    <h2 class="section-title text-4xl md:text-5xl mb-4">Er Expertis, Aktiverad.</h2>
                    <p class="text-lg text-sky-200 mt-6 leading-relaxed">Vi synkroniserar er unika affärslogik med vår AI-arkitektur. Resultatet: ett intelligent, självlärande ekosystem som arbetar med er.</p>
                </div>
                <div class="venn-diagram-container">
                    <div class="venn-diagram-wrapper">
                        <div class="venn-circle venn-circle-1">
                            <span class="venn-circle-text">Er Verksamhet</span>
                        </div>
                        <div class="venn-circle venn-circle-2">
                             <span class="venn-circle-text">Rätt Arkitektur</span>
                        </div>
                        <div class="venn-overlap-text" onclick="window.nord.showPage('system'); return false;">Intelligent<br>Kapacitet</div>
                    </div>
                </div>
            </div>
        </section>

        <section id="atom-gallery-section" class="space-background-section py-20 lg:py-28">
            <div class="section-content-wrapper">
                <div class="text-center mb-16">
                    <!-- BORTTAGEN: Gammal span-rubrik -->
                    <!-- <span class="inline-block bg-sky-800/50 text-sky-200 text-2xl md:text-3xl font-semibold px-8 py-3 rounded-full uppercase tracking-wider" style="font-family: 'Comfortaa', sans-serif;">Byggstenar / Galleri</span> -->
                    
                    <!-- NY: Pill switch-växlare (Omstrukturerad för slide) -->
                    <div id="gallery-switch-container" class="relative inline-flex items-stretch rounded-full bg-sky-900/70 p-1.5" style="font-family: 'Comfortaa', sans-serif;">
                        <!-- Det glidande pillret -->
                        <div id="gallery-switch-slider" class="absolute h-full rounded-full bg-nord-sym-cyan transition-all duration-300 ease-in-out" style="top: 0; left: 0;"></div>
                        
                        <!-- Knapparna (nu transparenta, ovanpå) -->
                        <button id="gallery-switch-byggstenar" 
                                class="gallery-switch-btn active relative z-10 text-nord-sym-deep-space-blue rounded-full px-6 py-2 text-lg md:text-xl uppercase tracking-wider transition-colors duration-300">
                            Byggstenar
                        </button>
                        <button id="gallery-switch-galleri" 
                                class="gallery-switch-btn inactive relative z-10 text-sky-200 hover:text-white rounded-full px-6 py-2 text-lg md:text-xl uppercase tracking-wider transition-colors duration-300">
                            Produkter
                        </button>
                    </div>
                    
                    <!-- JUSTERAD: <p>-tagg med ny ID och borttagen länk -->
                    <p id="gallery-description-text" class="text-center text-sky-200 max-w-3xl mx-auto mt-8 mb-8">
                        Dessa är de beprövade grundelementen i vår arkitektur. Med dessa komponenter bygger vi allt från fokuserade Micro-SaaS-lösningar till fullskaliga, intelligenta arkitekturer.
                    </p>
                </div>
                <div class="gallery-container">
                    <div class="gallery-viewport">
                        <div id="galleryWrapper" class="gallery-wrapper">
                            <!-- Cards are dynamically injected by JS -->
                        </div>
                    </div>
                </div>
                <div class="flex items-center justify-center mt-16 gap-4 sm:gap-6">
                    <button id="galleryPrev" aria-label="Föregående byggsten" class="gallery-control-btn">
                        <i class="ph-arrow-left-bold"></i>
                    </button>
                    <span id="gallery-context-text" class="text-base sm:text-lg text-sky-300 select-none">Utforska byggstenarna</span>
                    <button id="galleryNext" aria-label="Nästa byggsten" class="gallery-control-btn">
                        <i class="ph-arrow-right-bold"></i>
                    </button>
                </div>
                <div id="galleryPagination" class="flex justify-center mt-6 gap-3"></div>
            </div>
        </section>

        <section id="home-contact-section" class="space-background-section py-20 lg:py-28">
            <div id="home-contact-anchor" class="absolute -top-24"></div>
            <div class="section-content-wrapper">
                 <div class="text-center mt-12 border-t border-sky-800/50 pt-16">
                    <h3 class="text-3xl font-bold text-white">Redo att påbörja er evolution?</h3>
                    <p class="text-lg text-content-dark-bg max-w-2xl mx-auto mt-4 mb-8">Låt oss boka ett strategisamtal för att definiera er arkitektur och påbörja er transformation.</p>
                    <a href="#" onclick="window.nord.showPage('boka-samtal-skraddarsydd'); return false;" class="btn-base btn-cta-revised px-10 py-4 text-lg">Framtidsförsäkra er verksamhet</a>
                </div>
            </div>
        </section>

        <section id="om-oss" class="space-background-section page-content-padding" style="display: none;">
            <div class="section-content-wrapper max-w-5xl mx-auto text-lg text-sky-100 leading-relaxed">
                <div class="text-center mb-16">
                    <h2 id="ai-first-game-title" class="section-title text-4xl md:text-5xl">Vår Arkitektur: <span>AI som Operativsystem</span></h2>
                    <p class="mt-6 max-w-3xl mx-auto">
                        Vad innebär ett <span class="interactive-ai-first-text">AI-First</span> Operativsystem? För konkurrenter är AI ett verktyg man lägger ovanpå gamla processer. För oss är det <strong>själva operativsystemet</strong>. Hela vår arkitektur – från första idé till driftsatt system – är byggd <em>för</em> och <em>med</em> intelligens. Skillnaden är fundamental: De bygger statisk kod som hanterar uppgifter. Vi bygger dynamiska, intelligenta system som förstår er affärslogik och blir smartare över tid.
                    </p>
                </div>

                <div class="grid md:grid-cols-2 gap-8 my-16">
                    <div class="arkitektur-card">
                        <i class="ph-rocket-launch"></i>
                        <h3 class="section-title text-2xl">Från Idé till Värde på Rekordtid</h3>
                        <p>
                            Traditionella projekt drunknar i "context restoration". Vårt system har noll kontextförlust. Varje specifikation, varje kodrad, varje affärsbeslut är omedelbart tillgängligt för våra AI-arkitekter. Vi lägger 98% av tiden på att <strong>bygga värde</strong>, inte på att leta efter filer.
                        </p>
                    </div>
                    <div class="arkitektur-card">
                        <i class="ph-brain"></i>
                        <h3 class="section-title text-2xl">Integrerad Nätverksintelligens</h3>
                        <p>
                            Vår arkitektur är inte bara kod; den är ett intelligent operativsystem som förstår hela affärslogiken – från automation till betalflöden. Det ger våra AI-arkitekter en unik 'nätverksintelligens'. Vi bygger inte isolerade funktioner; vi optimerar hela ert värdeflöde.
                        </p>
                    </div>
                     <div class="arkitektur-card">
                        <i class="ph-arrows-clockwise"></i>
                        <h3 class="section-title text-2xl">En Levande, Spårbar Arkitektur</h3>
                        <p>
                           Glöm 'version 1.0'. Er arkitektur är en levande organism. Varje beslut och varje ändring är spårbar, reviderbar och omedelbart driftsatt. Ni har en perfekt 'audit trail' för regelefterlevnad och en arkitektur som utvecklas dagligen, inte kvartalsvis.
                        </p>
                    </div>
                    <div class="arkitektur-card">
                        <i class="ph-lock-open"></i>
                        <h3 class="section-title text-2xl">Byggt för Frihet, Inte Inlåsning</h3>
                        <p>
                            Vi bygger ert centrala nervsystem, frikopplat från enskilda AI-leverantörer. När en ny, kraftfullare AI-modell släpps, byter vi den. Er kärnlogik – ert sanna värde – förblir er egendom. Systemet ackumulerar kunskap och blir exponentiellt smartare över tid.
                        </p>
                    </div>
                </div>
                
                <div class="text-center mt-16 border-t border-sky-800/50 pt-16 relative">
                    <!-- NYTT: AI-First Spel (Easter Egg) Skepp -->
                    <div id="ai-first-ship-icon" class="absolute -top-3 left-1/2 -translate-x-1/2 w-0 h-0"
                         style="border-left: 10px solid transparent; border-right: 10px solid transparent; border-bottom: 15px solid var(--nord-sym-cyan);">
                    </div>
                    <!-- Slut på AI-First Spel -->

                    <h3 class="text-3xl font-bold text-white">Redo att bygga med 4x hastighet?</h3>
                    <p class="text-lg text-content-dark-bg max-w-2xl mx-auto mt-4 mb-8">Boka ett strategisamtal och låt oss visa hur vår AI-drivna arkitektur levererar värde med oöverträffad hastighet och precision.</p>
                    <a href="#" onclick="window.nord.showPage('boka-samtal-skraddarsydd'); return false;" class="btn-base btn-cta-revised px-10 py-4 text-lg">Boka Strategisamtal</a>
                </div>
            </div>
        </section>

        <section id="system" class="space-background-section page-content-padding" style="display: none;">
            <div class="section-content-wrapper flex-grow">
                <div class="text-center mb-20">
                     <span class="inline-block bg-sky-800/50 text-sky-200 text-xs font-semibold px-3 py-1 rounded-full uppercase tracking-wider">System</span>
                    <h3 class="text-3xl md:text-4xl font-bold text-white mt-4">Välj er Ambitionsnivå</h3>
                     <p class="text-lg text-content-dark-bg max-w-3xl mx-auto mt-4">Från en <strong>Minimal Lovable Product</strong> till total marknadsdominans. Vi bygger system med <em>Vibe Code</em> – teknologi som känns organisk, inte mekanisk.</p>
                </div>
                
                <!-- Pricing Grid -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-6xl mx-auto items-stretch">
                    <!-- ... Pricing Cards (Same as before) ... -->
                    <div class="pricing-card card-base">
                        <div class="pricing-card-header text-center">
                            <h3>GRUND</h3>
                             <p class="text-sm text-sky-300 mt-2">Från idé till Minimal Lovable Product.</p>
                        </div>
                        <div class="price-display text-center">75k <span class="price-period">SEK</span></div>
                        <ul>
                            <li>
                                <i class="ph-check-circle"></i>
                                <div>
                                    <strong>Eliminera en flaskhals</strong>
                                    <span>Vi automatiserar en kritisk, tidskrävande process och frigör omedelbart resurser.</span>
                                </div>
                            </li>
                            <li>
                                <i class="ph-check-circle"></i>
                                <div>
                                    <strong>MLP, inte MVP</strong>
                                    <span>Vi bygger en första version som era användare faktiskt älskar att använda.</span>
                                </div>
                            </li>
                            <li>
                                <i class="ph-check-circle"></i>
                                <div>
                                    <strong>Teknisk Grund</strong>
                                    <span>En robust, skalbar bas redo för framtida expansion.</span>
                                </div>
                            </li>
                        </ul>
                        <div class="mt-auto">
                            <a href="#" onclick="window.nord.showPage('boka-samtal-skraddarsydd'); return false;" class="btn-base btn-secondary-on-dark w-full">Starta med Grunden</a>
                        </div>
                    </div>
                    <div class="pricing-card card-base ignite-package">
                         <div class="pricing-card-header text-center">
                            <h3>STRUKTUR</h3>
                             <p class="text-sm text-sky-300 mt-2">Bygg en maskin som skalar.</p>
                        </div>
                        <div class="price-display text-center">250k <span class="price-period">SEK</span></div>
                         <ul>
                            <li>
                                <i class="ph-check-circle"></i>
                                <div>
                                    <strong>Digital Arbetsstyrka</strong>
                                    <span>Ett team av samverkande AI-agenter som jobbar dygnet runt.</span>
                                </div>
                            </li>
                            <li>
                                <i class="ph-check-circle"></i>
                                <div>
                                    <strong>Obegränsad Skalning</strong>
                                    <span>Arkitektur designad för att hantera 10x volym utan att ni behöver anställa fler.</span>
                                </div>
                            </li>
                            <li>
                                <i class="ph-check-circle"></i>
                                <div>
                                    <strong>Total Kontroll</strong>
                                    <span>Ett "Mission Control"-gränssnitt för att styra och optimera flödet.</span>
                                </div>
                            </li>
                        </ul>
                         <div class="mt-auto">
                            <a href="#" onclick="window.nord.showPage('boka-samtal-skraddarsydd'); return false;" class="btn-base btn-cta-revised w-full">Forma er Struktur</a>
                        </div>
                    </div>
                    <div class="pricing-card card-base">
                         <div class="pricing-card-header text-center">
                            <h3>ARKITEKTUR</h3>
                             <p class="text-sm text-sky-300 mt-2">Äg er marknad. Definiera framtiden.</p>
                        </div>
                        <div class="price-display text-center">500k+ <span class="price-period">SEK</span></div>
                         <ul>
                            <li>
                                <i class="ph-check-circle"></i>
                                <div>
                                    <strong>AI-First Strategi</strong>
                                    <span>Hela verksamheten omdesignad runt intelligens.</span>
                                </div>
                            </li>
                            <li>
                                <i class="ph-check-circle"></i>
                                <div>
                                    <strong>Marknadsdominans</strong>
                                    <span>System som reagerar, lär sig och agerar snabbare än konkurrenterna.</span>
                                </div>
                            </li>
                            <li>
                                <i class="ph-check-circle"></i>
                                <div>
                                    <strong>Strategisk Vallgrav</strong>
                                    <span>Unik, egenägd teknologi som inte går att kopiera.</span>
                                </div>
                            </li>
                        </ul>
                         <div class="mt-auto">
                            <a href="#" onclick="window.nord.showPage('boka-samtal-skraddarsydd'); return false;" class="btn-base btn-secondary-on-dark w-full">Etablera er Arkitektur</a>
                        </div>
                    </div>
                </div>
                
                <!-- Support Text -->
                <div class="text-center mt-16 max-w-3xl mx-auto">
                    <p class="text-lg text-sky-200"><strong>AI Ops & Evolution:</strong> 15k SEK/mån.</p>
                    <p class="text-md text-sky-300 mt-2">Vi driftar, säkrar och uppgraderar era agenter i takt med att AI-modellerna blir smartare. Er försäkring mot att bli obsolet.</p>
                </div>

                <!-- FAQ Section (NEW) -->
                <div class="max-w-4xl mx-auto mt-24">
                    <h3 class="text-3xl font-bold text-white text-center mb-10 light-theme:text-nord-sym-blueprint-ink" style="font-family: 'Comfortaa', sans-serif;">Vanliga frågor</h3>
                    <div class="space-y-4">
                        <details class="faq-item group">
                            <summary class="faq-question">
                                <span>Vad menar ni med "AI som operativsystem"?</span>
                                <i class="ph-caret-down faq-icon"></i>
                            </summary>
                            <div class="faq-answer">
                                För oss är AI inte bara ett verktyg man lägger ovanpå gamla processer. Vi bygger om arkitekturen så att intelligens blir kärnan som driver flödena. Systemet förstår er affärslogik och agerar autonomt, snarare än att bara vänta på input.
                            </div>
                        </details>
                        <details class="faq-item group">
                            <summary class="faq-question">
                                <span>Hur säkert är det? Äger vi vår egen data?</span>
                                <i class="ph-caret-down faq-icon"></i>
                            </summary>
                            <div class="faq-answer">
                                Absolut. Vi bygger systemen så att ni behåller fullt ägandeskap och kontroll över er data. Vi designar "vallgravar" runt er kärnverksamhet och säkerställer att ingen känslig data tränar publika modeller utan ert medgivande.
                            </div>
                        </details>
                        <details class="faq-item group">
                            <summary class="faq-question">
                                <span>Kan ni integrera med våra gamla system (Legacy)?</span>
                                <i class="ph-caret-down faq-icon"></i>
                            </summary>
                            <div class="faq-answer">
                                Ja. En stor del av vår arkitektur handlar om att bygga bryggor mellan beprövade legacy-system (som affärssystem och databaser) och moderna AI-agenter. Vi moderniserar utan att ni behöver byta ut hela er infrastruktur dag ett.
                            </div>
                        </details>
                        <details class="faq-item group">
                            <summary class="faq-question">
                                <span>Vad händer om AI-modellerna förändras?</span>
                                <i class="ph-caret-down faq-icon"></i>
                            </summary>
                            <div class="faq-answer">
                                Vi bygger modulärt och modell-agnostiskt. Det betyder att vi snabbt kan byta ut "hjärnan" (t.ex. från GPT-4 till Claude 3.5 eller en lokal modell) utan att behöva bygga om hela systemet. Er arkitektur är framtidssäkrad.
                            </div>
                        </details>
                        <details class="faq-item group">
                            <summary class="faq-question">
                                <span>Hur snabbt ser vi ROI?</span>
                                <i class="ph-caret-down faq-icon"></i>
                            </summary>
                            <div class="faq-answer">
                                Vårt mål är alltid snabb "time-to-value". Genom att börja med att automatisera tydliga flaskhalsar (t.ex. administration, kundtjänst eller dataanalys) ser våra kunder ofta en mätbar ROI inom 4-8 veckor efter driftsättning.
                            </div>
                        </details>
                    </div>
                </div>

            </div>
        </section>

        <section id="ritbordet" class="space-background-section" style="display: none;">
            <div id="ritbordet-lobby" class="section-content-wrapper">
                <div class="max-w-5xl mx-auto w-full">
                    <!-- Desktop Layout -->
                    <div class="desktop-layout">
                        <div class="ritbordet-grid" id="ritbordet-grid-top">
                            <!-- Process cards injected by JS -->
                        </div>
                        <div class="portal-btn-placeholder">
                            <div id="geometry-cta" onclick="window.UnifiedGeometryManager.enterBuilderMode()">
                                <i class="ph ph-cube"></i>
                                <span class="cta-text">Forma er Arkitektur</span>
                            </div>
                        </div>
                        <div class="ritbordet-grid" id="ritbordet-grid-bottom">
                            <!-- Value cards injected by JS -->
                        </div>
                    </div>
                    <!-- Mobile Layout -->
                    <div class="mobile-layout" id="mobile-lobby-content">
                         <!-- Mobile cards injected by JS -->
                    </div>
                </div>
            </div>
        </section>

        <section id="karriar" class="space-background-section page-content-padding" style="display: none;">
            <div class="section-content-wrapper">
                <div class="flex flex-col items-center gap-y-8 text-center">
                    <div class="flex justify-center space-x-2">
                        <i class="ph-star-four nordsym-logo-star text-3xl" style="animation-delay: 0.1s;"></i>
                        <i class="ph-star-four nordsym-logo-star text-4xl" style="animation-delay: 0.3s;"></i>
                        <i class="ph-star-four nordsym-logo-star text-3xl" style="animation-delay: 0.5s;"></i>
                    </div>
                    <h2 class="section-title text-4xl md:text-5xl lg:text-6xl">Bli en <span class="section-title-accent relative">arkitekt för nästa generations operativsystem</span></h2>
                    <div class="max-w-3xl lg:max-w-4xl mx-auto">
                        <p class="text-lg md:text-xl leading-relaxed">
                            Detta är en roll för dig som ser bortom enskilda funktioner. Ditt uppdrag: att designa och bygga framtidens infrastruktur för affärsverksamhet. Vi bygger system som lär sig, anpassar sig och evolverar.
                        </p>
                        <p class="text-lg md:text-xl leading-relaxed mt-6">
                            Vi söker dig som vill definiera hur intelligenta ekosystem fungerar från grunden. Om du vill bygga system som skapar exponentiellt och bestående värde, är din plats här.
                        </p>
                    </div>
                    <div>
                        <a href="#" onclick="window.nord.showPage('vilka-ar-vi'); return false;" class="btn-base btn-secondary-on-dark px-10 py-4 text-lg lg:text-xl lg:px-12 lg:py-5">
                            Starta Din Resa <i class="ph-paper-plane-tilt ml-2"></i>
                        </a>
                    </div>
                </div>
            </div>
        </section>
        
        <section id="vilka-ar-vi" class="space-background-section page-content-padding" style="display: none;">
            <div class="section-content-wrapper text-center" id="vilka-ar-vi-content">
                <h2 class="text-4xl md:text-5xl font-extrabold text-white mb-8">Vilka är vi?</h2>
                <div class="max-w-2xl mx-auto text-left text-sky-100">
                     <p class="text-lg mb-6">
                        Vi är <strong>arkitekter av intelligenta ekosystem</strong>. Vårt fokus är att bygga AI-drivna system som är designade att samverka och förstärka varandra. Vår vision är att avancerad teknologi ska vara ett kraftfullt och tillgängligt verktyg för företag som vill ligga i framkant.
                    </p>
                     <p class="text-lg mb-10">
                        Är du redo att ansluta dig till ett team som bygger nästa generations operativsystem?
                    </p>
                </div>
                <div id="jobApplicationFormContainer" class="form-container p-8 md:p-12 mt-10 max-w-2xl mx-auto text-left"> 
                    <h3 class="text-2xl font-semibold text-white mb-2 text-center">Anslut Till Teamet på NordSym</h3>
                    <div class="form-progress-bar">
                        <div class="form-progress-bar-inner"></div>
                    </div>
                    <form id="jobApplicationForm">
                        <input type="hidden" name="_subject" value="Ny jobbansökan från NordSym">
                        <div class="form-step active" data-step="1">
                            <div class="space-y-6">
                                <div>
                                    <label for="applicant-name" class="form-label">Ditt Namn</label>
                                    <input type="text" name="applicant-name" id="applicant-name" required class="form-input">
                                </div>
                                <div>
                                    <label for="applicant-email" class="form-label">E-post</label>
                                    <input type="email" name="email" id="applicant-email" required class="form-input">
                                </div>
                            </div>
                            <div class="form-navigation">
                                <span></span>
                                <button type="button" class="btn-base btn-cta-revised">Nästa <i class="ph-arrow-right"></i></button>
                            </div>
                        </div>
                        <div class="form-step" data-step="2">
                             <div class="space-y-6">
                                <div>
                                    <label for="applicant-linkedin" class="form-label">LinkedIn-profil (URL)</label>
                                    <input type="url" name="linkedin" id="applicant-linkedin" class="form-input" placeholder="https://linkedin.com/in/dittnamn">
                                </div>
                                <div>
                                    <label for="applicant-motivation" class="form-label">Varför vill du jobba med oss på NordSym?</label>
                                    <textarea name="motivation" id="applicant-motivation" rows="4" class="form-textarea" required placeholder="Berätta kort om din motivation och hur du kan bidra."></textarea>
                                </div>
                            </div>
                            <div class="form-navigation">
                                <button type="button" class="btn-base btn-secondary-on-dark"><i class="ph-arrow-left"></i> Föregående</button>
                                <button type="submit" class="btn-base btn-cta-revised">Skicka Intresseanmälan</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </section>

        <section id="boka-samtal-skraddarsydd" class="space-background-section page-content-padding" style="display: none;">
            <div class="section-content-wrapper text-center">
                <h2 class="text-4xl md:text-5xl font-extrabold text-white mb-8">Starta er systemresa</h2>
                <p class="text-lg text-content-dark-bg max-w-xl mx-auto mb-10">Det första steget mot ett självgående ekosystem. Låt oss diskutera er vision.</p>
                <div id="formSkraddarsyddContainer" class="form-container p-8 md:p-12 mt-10 max-w-lg mx-auto text-left">
                    <h3 class="text-2xl font-semibold text-white mb-2 text-center">Kontaktinformation</h3>
                    <div class="form-progress-bar">
                        <div class="form-progress-bar-inner"></div>
                    </div>
                    <form id="formSkraddarsydd">
                        <input type="hidden" name="_subject" value="Ny förfrågan: Systemdiskussion från NordSym">
                        <div class="form-step active" data-step="1">
                            <div class="space-y-6">
                                <div><label for="skraddarsydd-name" class="form-label">Ditt Namn</label><input type="text" name="name" id="skraddarsydd-name" required class="form-input"></div>
                                <div><label for="skraddarsydd-company" class="form-label">Företagsnamn</label><input type="text" name="company" id="skraddarsydd-company" required class="form-input"></div>
                                <div><label for="skraddarsydd-email" class="form-label">E-post</label><input type="email" name="email" id="skraddarsydd-email" required class="form-input"></div>
                            </div>
                             <div class="form-navigation">
                                <span></span>
                                <button type="button" class="btn-base btn-cta-revised">Nästa <i class="ph-arrow-right"></i></button>
                            </div>
                        </div>
                        <div class="form-step" data-step="2">
                            <div class="space-y-6">
                                <div><label for="skraddarsydd-phone" class="form-label">Telefon (valfritt)</label><input type="tel" name="phone" id="skraddarsydd-phone" class="form-input"></div>
                                <div><label for="skraddarsydd-main-goal" class="form-label">Vad är det viktigaste ni vill automatisera eller förbättra?</label><textarea name="main-goal" id="skraddarsydd-main-goal" rows="3" class="form-textarea" required></textarea></div>
                            </div>
                            <div class="form-navigation">
                                <button type="button" class="btn-base btn-secondary-on-dark"><i class="ph-arrow-left"></i> Föregående</button>
                                <button type="submit" class="btn-base btn-cta-revised">Boka diskussion</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </section>
        
        <section id="privacy-policy-en" class="space-background-section page-content-padding" style="display: none;">
            <div class="section-content-wrapper">
                <div class="legal-content-container max-w-4xl mx-auto text-left">
                    <h2 class="section-title text-4xl md:text-5xl mb-8 text-center">Privacy Policy</h2>
                    <div class="legal-content-card">
                        <p><strong>Last Updated: July 3, 2025</strong></p>
                        <h4><i class="ph-info"></i>About This Policy</h4><p>NordSym AB (Swedish Org. No. 559535-5768) values your trust and privacy. This Privacy Policy describes how we collect, use, and protect your personal data when you visit our website or use our services.</p>
                        <h4><i class="ph-user-circle"></i>Who We Are</h4><p>NordSym AB<br>Organization Number: 559535-5768<br>Email: <a href="mailto:gustav@nordsym.com">gustav@nordsym.com</a><br>Website: nordsym.com</p><p>We are the data controller for the processing of personal data described in this policy.</p>
                        <h4><i class="ph-database"></i>What Personal Data We Collect</h4><ul><li><strong>Contact Forms and Inquiries:</strong> Name and contact details (email, phone), company information, job title, and a description of your needs.</li><li><strong>Job Applications:</strong> Name, contact details, CV, professional background, relevant links (LinkedIn, etc.), and a motivational description.</li><li><strong>Website Usage:</strong> Anonymized IP address, browser information, and user interaction via cookies.</li><li><strong>Client and Project Data:</strong> Business processes, technical requirements, and communication history necessary for project delivery.</li></ul>
                        <h4><i class="ph-arrows-clockwise"></i>Why We Process Your Personal Data</h4><p>We process your data to fulfill our commitments (Art. 6.1.b GDPR), such as responding to inquiries and delivering services. We also have a legitimate interest (Art. 6.1.f GDPR) in developing our services and communicating with potential clients. For certain marketing activities, we obtain your consent (Art. 6.1.a GDPR).</p>
                        <h4><i class="ph-share-network"></i>Data Sharing and Third Parties</h4><p>We use trusted service providers such as Formspree, Google Analytics, Microsoft 365, Notion, Airtable, GitHub, and leading AI platforms (Anthropic, OpenAI) as well as automation tools (Make, n8n) to conduct our business. All providers are selected to comply with GDPR requirements. We ensure an adequate level of protection for any transfers of data outside the EU/EEA.</p>
                        <h4><i class="ph-shield-check"></i>Your Rights</h4><p>You have the right to access, rectify, erase, restrict, and port your personal data, and to object to its processing. You can also withdraw your consent at any time. Contact <a href="mailto:gustav@nordsym.com">gustav@nordsym.com</a> to exercise your rights.</p>
                        <h4><i class="ph-chats-circle"></i>Contact and Complaints</h4><p>For questions, contact us at <a href="mailto:gustav@nordsym.com">gustav@nordsym.com</a>. Complaints can be filed with the Swedish Authority for Privacy Protection (IMY).</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="terms-of-service-en" class="space-background-section page-content-padding" style="display: none;">
            <div class="section-content-wrapper">
                <div class="legal-content-container max-w-4xl mx-auto text-left">
                    <h2 class="section-title text-4xl md:text-5xl mb-8 text-center">Terms of Service</h2>
                    <div class="legal-content-card">
                        <p><strong>Last Updated: July 3, 2025</strong></p>
                        <h4><i class="ph-file-text"></i>General</h4><p>These Terms of Service govern your use of the NordSym AB ("we", "us", "NordSym") website (nordsym.com) and services. By using our services, you accept these terms.</p>
                        <h4><i class="ph-user-gear"></i>User Responsibilities</h4><p>You are responsible for providing accurate information and for not using our services for illegal purposes. You may not reverse engineer our systems or resell our services without written approval.</p>
                        <h4><i class="ph-detective"></i>Intellectual Property and Data Ownership</h4><p>NordSym äger våra algoritmer, metoder och ramverk. Du som kund behåller full äganderätt till dina affärsdata och de specifika resultat som genereras av dina data. För skräddarsydda AI-agenter utvecklade specifikt för dig, tillhör äganderätten dig, medan den underliggande tekniska plattformen förblir vår egendom.</p>
                        <h4><i class="ph-scales"></i>Limitation of Liability</h4><p>We are not liable for indirect damages such as lost profits or data. Our total liability is limited to the amount paid for the specific service. We do not guarantee specific business results or ROI, although that is our goal.</p>
                        <h4><i class="ph-gavel"></i>Governing Law and Disputes</h4><p>These terms are governed by Swedish law. Disputes shall primarily be resolved through negotiation. If an agreement cannot be reached, the dispute shall be settled by a Swedish court.</p>
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <div id="coming-soon-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-nord-sym-deep-space-blue/80 backdrop-blur-sm opacity-0 pointer-events-none">
        <div class="modal-content-wrapper form-container p-8 md:p-12 max-w-lg w-full m-4 relative scale-95 text-center">
            <button onclick="window.nord.closeComingSoonModal()" class="absolute top-4 right-4 text-sky-300 hover:text-nord-sym-cyan transition-colors text-2xl" aria-label="Stäng modal">
                <i class="ph-x"></i>
            </button>
            <i id="modal-waitlist-icon" class="ph-rocket-launch text-4xl text-nord-sym-cyan mb-4"></i>
            <h3 id="modal-waitlist-title" class="text-2xl font-semibold text-white mb-2">Demonstration under utveckling</h3>
            <p id="modal-waitlist-desc" class="text-sky-300 mb-4">Vi håller på att färdigställa den interaktiva demon. Skriv upp dig så meddelar vi när den är redo.</p>
            
            <!-- DYNAMISK LÄNK (Tjuvkika) -->
            <a id="modal-waitlist-link" href="#" target="_blank" rel="noopener noreferrer" class="inline-block text-nord-sym-cyan hover:text-white transition-colors text-sm mb-6 font-medium underline decoration-dotted underline-offset-4 hidden">
                <!-- Text injiceras via JS -->
            </a>
            
            <!-- VÄNTELISTA FORMULÄR -->
            <form id="waitlistForm" class="text-left mt-0">
                <input type="hidden" id="modal-waitlist-subject" name="_subject" value="Ny anmälan: Väntelista">
                <div class="space-y-4">
                    <div>
                        <label for="waitlist-email" class="form-label sr-only">E-post</label>
                        <input type="email" name="email" id="waitlist-email" required class="form-input text-center" placeholder="Din e-postadress">
                    </div>
                    <button type="submit" class="btn-base btn-cta-revised w-full">Bevaka lansering</button>
                </div>
                <div class="form-success-container hidden mt-4">
                    <p class="text-nord-sym-cyan"><i class="ph-check-circle"></i> Du är uppskriven!</p>
                </div>
            </form>
        </div>
    </div>

    <div id="free-agent-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-nord-sym-deep-space-blue/80 backdrop-blur-sm opacity-0 pointer-events-none">
        <div class="modal-content-wrapper form-container p-8 md:p-12 max-w-lg w-full m-4 relative scale-95">
            <button onclick="window.nord.closeFreeAgentModal()" class="absolute top-4 right-4 text-sky-300 hover:text-nord-sym-cyan transition-colors text-2xl" aria-label="Stäng modal">
                <i class="ph-x"></i>
            </button>
            <div id="free-agent-modal-content">
                <h3 class="text-2xl font-semibold text-white mb-2 text-center">Designa er Kostnadsfria Agent</h3>
                <p class="text-center text-sky-300 mb-6">Beskriv en uppgift ni vill automatisera, så bygger vi en prototyp utan kostnad.</p>
                <form id="freeAgentForm">
                    <input type="hidden" name="_subject" value="Förfrågan: Gratis AI-Agent prototyp">
                    <div>
                        <label for="agent-description" class="form-label">Agentens Uppgift</label>
                        <textarea name="description" id="agent-description" rows="4" class="form-textarea" required placeholder="T.ex. 'Sammanfatta dagens branschnyheter från tre källor och skicka som ett mail kl 08:00 varje morgon.'"></textarea>
                    </div>
                     <div>
                        <label for="agent-email" class="form-label mt-4">Er E-post</label>
                        <input type="email" name="email" id="agent-email" required class="form-input" placeholder="Vi skickar resultatet hit">
                    </div>
                    <div class="mt-8 text-center">
                        <button type="submit" class="btn-base btn-cta-revised w-full">Skicka min idé</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <footer id="main-footer" class="relative bg-nord-sym-deep-space-blue">
        <div class="section-content-wrapper py-10 relative z-10">
            <div class="grid md:grid-cols-3 gap-8 text-sm">
                <div class="md:col-span-1 flex flex-col items-center md:items-start text-center md:text-left">
                    <a href="#" onclick="window.nord.showPage('hero'); return false;" class="inline-block mb-4">
                        <img src="https://raw.githubusercontent.com/GusHem/Logga-utan-text/refs/heads/main/Final%20logo%20no%20text.svg" alt="NordSym Logotyp" class="h-16" loading="lazy" decoding="async">
                    </a>
                    
                    <p class="text-sm font-bold text-white mb-1">Framtidsförsäkra eran verksamhet</p>
                    <p class="text-xs text-sky-200 mb-4">Vi hjälper er att bli ett AI-First företag.</p>
                    <a href="#" onclick="window.nord.showPage('boka-samtal-skraddarsydd'); return false;" class="btn-base btn-service-cta text-xs px-6 py-2 mb-6">Boka Strategisamtal</a>

                </div>
                <div class="md:col-span-1 text-center md:text-left">
                    <p class="font-semibold text-nord-sym-text-light mb-2">Snabblänkar</p>
                    <div class="footer-quicklinks">
                        <a href="#" onclick="window.nord.showPage('om-oss'); return false;" class="footer-link">Arkitektur</a>
                        <a href="#" onclick="window.nord.showPage('system'); return false;" class="footer-link">System</a>
                        <a href="#" onclick="window.nord.showPage('ritbordet'); return false;" class="footer-link">Ritbordet</a>
                        <a href="#" onclick="window.nord.showPage('karriar'); return false;" class="footer-link">Gör din del</a>
                    </div>
                </div>
                <div class="md:col-span-1 text-center md:text-left">
                     <p class="font-semibold text-nord-sym-text-light mb-2">Följ Oss</p>
                     <div class="footer-quicklinks">
                        <a href="https://www.linkedin.com/company/nordsym-ab/" target="_blank" rel="noopener noreferrer" class="footer-link inline-flex items-center gap-2"><i class="ph-linkedin-logo"></i>LinkedIn</a>
                        <a href="https://x.com/NordSym" target="_blank" rel="noopener noreferrer" class="footer-link inline-flex items-center gap-2"><i class="ph-twitter-logo"></i>X (Twitter)</a>
                        <a href="https://www.instagram.com/nordsym_ab/" target="_blank" rel="noopener noreferrer" class="footer-link inline-flex items-center gap-2"><i class="ph-instagram-logo"></i>Instagram</a>
                    </div>

                    <!-- GDPR LOGO (Solid, Smaller & Clean) -->
                    <div class="mt-8 flex flex-col items-center md:items-start opacity-60 hover:opacity-100 transition-opacity duration-300 select-none cursor-help" title="Dataskydd och Integritet">
                        <svg width="100" height="32" viewBox="0 0 140 45" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-nord-sym-text-light">
                            <!-- Huvudtext "GDPR" (Solid - Inget mask-hål) -->
                            <text x="0" y="28" font-family="'Inter', sans-serif" font-weight="900" font-size="32" fill="currentColor" letter-spacing="-1">GDPR</text>
                            
                            <!-- Undertitel "COMPLIANT" -->
                            <text x="2" y="42" font-family="'Inter', sans-serif" font-weight="700" font-size="10" fill="currentColor" letter-spacing="4.5">COMPLIANT</text>
                        </svg>
                    </div>

                </div>
            </div>
            <div class="mt-8 border-t border-sky-700/50 pt-6 text-center text-xs text-content-dark-bg space-x-4">
                <span>© <span id="currentYear"></span> NordSym.</span>
                <a href="#privacy-policy-en" onclick="window.nord.showPage('privacy-policy-en'); return false;" class="footer-link hover:underline ml-4">Privacy Policy</a>
                <a href="#terms-of-service-en" onclick="window.nord.showPage('terms-of-service-en'); return false;" class="footer-link hover:underline">Terms of Service</a>
            </div>
        </div>
    </footer>
    
    <!-- CHAT WIDGET START -->
    <div id="chat-widget-container" class="fixed bottom-6 right-6 z-50">
        <!-- Chat Bubble -->
        <button id="chat-bubble" class="w-16 h-16 rounded-full flex items-center justify-center text-white shadow-lg" aria-label="Öppna chatt">
            <i class="ph-chats-circle-bold text-4xl"></i>
        </button>
    
        <!-- Chat Window -->
        <div id="chat-window" class="absolute bottom-20 right-0 w-[350px] h-[500px] flex flex-col rounded-2xl shadow-2xl overflow-hidden origin-bottom-right">
            <!-- Header -->
            <div id="chat-header" class="flex items-center justify-between p-4 flex-shrink-0">
                <div class="flex items-center gap-3">
                    <div class="relative">
                        <i class="ph-robot text-2xl text-nord-sym-cyan"></i>
                        <span class="absolute bottom-0 right-0 w-2.5 h-2.5 bg-green-400 rounded-full border-2 border-[var(--nord-sym-deep-space-blue)]"></span>
                    </div>
                    <div>
                        <h3 class="font-bold text-base text-white">Digital Assistent</h3>
                        <p class="text-xs text-green-400">Online</p>
                    </div>
                </div>
                <button id="chat-close-btn" aria-label="Minimera chatt">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 256 256"><path d="M224,128a8,8,0,0,1-8,8H40a8,8,0,0,1,0-16H216A8,8,0,0,1,224,128Z"></path></svg>
                </button>
            </div>
    
            <!-- Messages -->
            <div id="chat-messages" class="flex-grow p-4 overflow-y-auto">
                <!-- Bot welcome message -->
                <div class="message bot-message">
                    <p>Hej! Jag är NordSyms digitala assistent. Hur kan jag hjälpa dig idag?</p>
                </div>
            </div>
    
            <!-- Input -->
            <div id="chat-input-area" class="p-4 flex-shrink-0">
                <div class="relative">
                    <input type="text" id="chat-input" placeholder="Skriv ditt meddelande..." class="w-full rounded-full py-3 pl-4 pr-12 text-sm">
                    <button id="chat-send-btn" class="absolute right-2 top-1/2 -translate-y-1/2 w-8 h-8 rounded-full flex items-center justify-center" aria-label="Skicka meddelande">
                        <i class="ph-paper-plane-tilt-bold text-xl"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- CHAT WIDGET END -->

    <!-- COOKIE CONSENT BANNER -->
    <div id="cookie-consent">
        <div class="flex flex-col">
            <div class="flex items-center gap-3 mb-3">
                <i class="ph-cookie text-2xl text-nord-sym-cyan"></i>
                <span class="font-bold text-white text-sm light-theme:text-nord-sym-blueprint-ink" style="font-family: 'Comfortaa', sans-serif;">Digital Integritet</span>
            </div>
            <p>
                Vi använder cookies för att optimera systemets prestanda. Genom att fortsätta godkänner du vår <a href="#" onclick="window.nord.showPage('privacy-policy-en'); return false;">Integritetspolicy</a>.
            </p>
            <button id="cookie-accept-btn" class="btn-base btn-cta-revised w-full py-2 text-sm">
                OK, jag förstår
            </button>
        </div>
    </div>

    <!-- === UI OVERLAYS & FIXED CONTROLS (ARKITEKTONISK SEPARATION) === -->
    
    <!-- GHOST HINTS (Ersätter den gamla modala rutan) -->
    <div id="workshop-ghost-hints">
        <div class="ghost-hint-text">Scrolla för att Transformera</div>
        <div class="ghost-hint-sub">Dra för att Rotera</div>
    </div>

    <!-- BORTTAGET: Gammal #workshop-onboarding kod -->

    <button id="mobile-enter-workshop-btn" onclick="window.UnifiedGeometryManager.enterBuilderMode()">
        <i class="ph ph-cube"></i>
    </button>
    <button id="toolbar-toggle" class="glass-btn" title="Visa verktyg">
        <i class="ph ph-list"></i>
    </button>
    <button id="joystick-portal-left" class="joystick-portal" title="Rotationskontroll">
        <i class="ph ph-arrows-out-cardinal"></i>
    </button>
    <button id="joystick-portal-right" class="joystick-portal" title="Gå in/ut ur verkstad">
        <div class="portal-ring portal-ring-outer"></div>
        <div class="portal-ring portal-ring-inner"></div>
        <i class="ph-atom portal-icon-enter"></i>
        <i class="ph-x portal-icon-exit"></i>
    </button>

    <div id="elastic-toolbar">
        <div class="glass-control-group">
            <button class="glass-btn" data-theme="fundamental" title="Grundläggande">◎</button>
            <button class="glass-btn" data-theme="struktur" title="Struktur">◉</button>
            <button class="glass-btn" data-theme="flode" title="Flöde">◊</button>
            <button class="glass-btn" data-theme="precision" title="Precision">Ψ</button>
            <button class="glass-btn" data-theme="paradigm" title="Paradigm">∞</button>
            <button class="glass-btn" data-theme="ekosystem" title="Ekosystem">⟠</button>
            <button class="glass-btn" id="fractal-mode-toggle" title="Partikel-manifestation">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2 C 17 7, 7 17, 2 12 C 7 7, 17 17, 22 12 C 17 7, 7 7, 12 2"></path></svg>
            </button>
        </div>
    </div>
    
    <script id="simplex-noise-glsl" type="x-shader/x-fragment">
        // Simplex Noise GLSL implementation
        vec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
        vec4 mod289(vec4 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
        vec4 permute(vec4 x) { return mod289(((x*34.0)+1.0)*x); }
        vec4 taylorInvSqrt(vec4 r) { return 1.79284291400159 - 0.85373472095314 * r; }

        float snoise(vec3 v) {
            const vec2 C = vec2(1.0/6.0, 1.0/3.0);
            const vec4 D = vec4(0.0, 0.5, 1.0, 2.0);
            vec3 i  = floor(v + dot(v, C.yyy));
            vec3 x0 = v - i + dot(i, C.xxx);
            vec3 g = step(x0.yzx, x0.xyz);
            vec3 l = 1.0 - g;
            vec3 i1 = min(g.xyz, l.zxy);
            vec3 i2 = max(g.xyz, l.zxy);
            vec3 x1 = x0 - i1 + C.xxx;
            vec3 x2 = x0 - i2 + C.yyy;
            vec3 x3 = x0 - D.yyy;
            i = mod289(i);
            vec4 p = permute(permute(permute(i.z + vec4(0.0, i1.z, i2.z, 1.0)) + i.y + vec4(0.0, i1.y, i2.y, 1.0)) + i.x + vec4(0.0, i1.x, i2.x, 1.0));
            float n_ = 0.142857142857; // 1.0/7.0
            vec3 ns = n_ * D.wyz - D.xzx;
            vec4 j = p - 49.0 * floor(p * ns.z * ns.z);
            vec4 x_ = floor(j * ns.z);
            vec4 y_ = floor(j - 7.0 * x_);
            vec4 x = x_ * ns.x + ns.yyyy;
            vec4 y = y_ * ns.x + ns.yyyy;
            vec4 h = 1.0 - abs(x) - abs(y);
            vec4 b0 = vec4(x.xy, y.xy);
            vec4 b1 = vec4(x.zw, y.zw);
            vec4 s0 = floor(b0)*2.0 + 1.0;
            vec4 s1 = floor(b1)*2.0 + 1.0;
            vec4 sh = -step(h, vec4(0.0));
            vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy;
            vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww;
            vec3 p0 = vec3(a0.xy,h.x);
            vec3 p1 = vec3(a0.zw,h.y);
            vec3 p2 = vec3(a1.xy,h.z);
            vec3 p3 = vec3(a1.zw,h.w);
            vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2,p2), dot(p3,p3)));
            p0 *= norm.x; p1 *= norm.y; p2 *= norm.z; p3 *= norm.w;
            vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
            m = m * m;
            return 42.0 * dot(m*m, vec4(dot(p0,x0), dot(p1,x1), dot(p2,x2), dot(p3,x3)));
        }
    </script>

    <script>
    /**
     * ATOMSMED vFINAL: TOTAL HARMONI (Anti-Fragile Manifestation)
     * "Från universum till användare. Klarhet genom magi, inte trots den."
     * MANIFESTATION PROTOCOL: Systemet har uppnått universell harmoni. Alla dimensioner är synkroniserade.
     */

    // --- GLOBAL NAMESPACE & STATE MANAGEMENT ---
    window.nord = {};
    window.nord.currentPage = 'hero'; // NYTT: Steg 1 (Återställning) - Sätt en standard
    window.UnifiedGeometryManager = null;

    const SACRED_GEOMETRY_LIBRARY = {
        fundamental: {
            material: 'neural', // Harmoni-fix: Återställer den solida grundformen.
            forms: [
                // Harmoni-fix: En språklig makeover för en mer kraftfull berättelse.
                { name: 'synergy', displayName: 'Syntes' },
                { name: 'structure', displayName: 'Ramverk' },
                { name: 'relation', displayName: 'Koppling' },
                { name: 'adaptation', displayName: 'Formning' },
                { name: 'potential', displayName: 'Ursprung' }
            ],
            currentIndex: 0
        },
        struktur: { 
            material: 'neural', 
            forms: [
                { name: 'tetrahedron', displayName: 'Tetrahedron' }, 
                { name: 'cube', displayName: 'Kub' }, 
                { name: 'octahedron', displayName: 'Oktahedron' }, 
                { name: 'dodecahedron', displayName: 'Dodekahedron' }, 
                { name: 'icosahedron', displayName: 'Ikosahedron' }
            ], 
            currentIndex: 0 
        },
        flode: { 
            material: 'organic', 
            forms: [
                { name: 'seed_of_life', displayName: 'Kärna' }, 
                { name: 'flower_of_life', displayName: 'Nätverk' }, 
                { name: 'metatrons_cube', displayName: 'Matris' }, 
                { name: 'torus', displayName: 'Torus' }, 
                { name: 'trinity_knot', displayName: 'Treenighetsknut' }
            ], 
            currentIndex: 0 
        },
        precision: { 
            material: 'crystal', 
            forms: [
                { name: 'diamond_brilliant', displayName: 'Briljant' }, 
                { name: 'quartz_point', displayName: 'Bergkristall' }, 
                { name: 'bismuth_spiral', displayName: 'Vismutkristall' }, 
                { name: 'geode', displayName: 'Geod' }, 
                { name: 'prism_triangular', displayName: 'Prisma' }
            ], 
            currentIndex: 0 
        },
        paradigm: { 
            material: 'quantum', 
            forms: [
                { name: 'tesseract', displayName: 'Tesserakt' }, 
                { name: 'klein_bottle', displayName: 'Kleinflaska' }, 
                { name: 'mobius_strip', displayName: 'Möbiusband' }, 
                { name: 'hopf_fibration', displayName: 'Hopf-fibrering' }, 
                { name: 'calabi_yau', displayName: 'Calabi-Yau-rum' }
            ], 
            currentIndex: 0 
        },
        ekosystem: { 
            material: 'nebula',
            forms: [
                { name: 'fibonacci_spiral', displayName: 'Fibonaccispiral' },
                { name: 'galaxy_spiral', displayName: 'Galaxspiral' }, 
                { name: 'galactic_arm', displayName: 'Galaktisk Arm' }, 
                { name: 'cosmic_web', displayName: 'Kosmiskt Nät' }, 
                { name: 'supernova_remnant', displayName: 'Supernova-rest' }, 
                { name: 'accretion_disk', displayName: 'Ackretionsskiva' }, 
                { name: 'stellated_dodecahedron', displayName: 'Stjärndodekaeder' }, 
                { name: 'merkaba', displayName: 'Merkaba' }, 
                { name: 'atomic_orbitals', displayName: 'Atomorbitaler' }, 
                { name: 'fibonacci_sphere', displayName: 'Fibonacci-sfär' }, 
                { name: 'fibonacci_spiral', displayName: 'Fibonaccispiral' },
                { name: 'tetrahedron_grid_64', displayName: 'Vakuumgeometri' }, 
                { name: 'nebula_cloud', displayName: 'Nebulosa' }
            ], 
            currentIndex: 0 
        }
    };

    // --- ANTI-FRAGILE CORE ---
    function logToExternalService(error, context) {
        // I en verklig applikation skulle detta skicka data till en tjänst som Sentry, LogRocket, etc.
        console.warn(`[EXTERNAL LOG] Disharmoni observerad i ${context}:`, error);
    }

    // --- CORE PAGE ROUTING LOGIC ---
    document.addEventListener('DOMContentLoaded', () => {
        // KALIBRERING: Neutralisera webbläsarens scroll-återställning för att säkerställa harmonisk start.
        if ('scrollRestoration' in history) {
            history.scrollRestoration = 'manual';
        }
        window.scrollTo(0, 0);

        const pageConfig = {
            'hero': { isMultiPart: true, parts: ['hero', 'home-diagram-section', 'atom-gallery-section', 'home-contact-section'], display: 'flex', hasFooter: true, navAlias: 'hero' },
            'om-oss': { display: 'flex', hasFooter: true, navAlias: 'om-oss' },
            'system': { display: 'flex', hasFooter: true, navAlias: 'system' },
            'ritbordet': { display: 'flex', hasFooter: true, navAlias: 'ritbordet' },
            'karriar': { display: 'flex', hasFooter: false, navAlias: 'karriar' },
            'vilka-ar-vi': { display: 'flex', hasFooter: false, navAlias: 'karriar' },
            'boka-samtal-skraddarsydd': { display: 'flex', hasFooter: true, navAlias: 'system' },
            'privacy-policy-en': { display: 'flex', hasFooter: true, navAlias: 'hero' },
            'terms-of-service-en': { display: 'flex', hasFooter: true, navAlias: 'hero' },
        };

        window.nord.showPage = function(pageId, isPoppingState = false) {
            // --- NYTT: Steg 3 (Återställning) ---
            // Logik för att återställa "Arkitektur-Invasion" om vi lämnar den sidan
            if (window.nord.currentPage === 'om-oss' && 
                pageId !== 'om-oss' && 
                window.aiFirstGameManager && 
                window.aiFirstGameManager.isActive) 
            {
                window.aiFirstGameManager.endGame();
            }
            // Uppdatera nuvarande sida
            window.nord.currentPage = pageId;
            // --- SLUT PÅ Steg 3 ---
            
            // New chat visibility logic
            const chatContainer = document.getElementById('chat-widget-container');
            const homePageIds = ['hero', 'home-diagram-section', 'atom-gallery-section', 'home-contact-section'];
            const configForPage = pageConfig[pageId];
            const isHomePage = configForPage && configForPage.isMultiPart && configForPage.parts.some(p => homePageIds.includes(p));
            
            if (chatContainer) {
                chatContainer.classList.toggle('visible', isHomePage);
            }

            // Harmoni-fix: URL-hantering med History API
            if (!isPoppingState) {
                const currentHash = window.location.hash.substring(1);
                if (currentHash !== pageId) {
                    history.pushState({ page: pageId }, '', '#' + pageId);
                }
            }
            
            // Harmoni-fix: Geometrin svarar på varje interaktion.
            if (window.UnifiedGeometryManager && !isPoppingState) {
                window.UnifiedGeometryManager.nudgeGeometry();
            }

            const config = pageConfig[pageId];
            if (!config) return;
            
            // Harmoni-fix: Säkerställ att verkstaden och dess kontroller stängs när man navigerar bort.
            if (pageId !== 'ritbordet' && document.body.classList.contains('labb-active')) {
                if (window.UnifiedGeometryManager) {
                    window.UnifiedGeometryManager.exitBuilderMode();
                }
            } else if (pageId === 'ritbordet') {
                // Harmoni-fix: Tvinga systemet att återställa till lobbyn om den redan är i verkstadsläge.
                if (document.body.classList.contains('labb-active') && window.UnifiedGeometryManager) {
                    window.UnifiedGeometryManager.exitBuilderMode();
                }
            }

            document.body.classList.toggle('ritbordet-visible', pageId === 'ritbordet');

            const targetState = pageId === 'ritbordet' ? 'WORKSHOP' : (pageId === 'hero' ? 'HERO' : 'PAGE');
            
            const main = document.querySelector('main');
            gsap.to(main, { opacity: 0, duration: 0.4, ease: 'power2.in', onComplete: () => {
                document.querySelectorAll('main > section').forEach(s => s.style.display = 'none');
                const footer = document.getElementById('main-footer');
                if (footer) footer.style.display = config.hasFooter ? 'block' : 'none';
                
                if (config.isMultiPart) {
                    config.parts.forEach(partId => document.getElementById(partId)?.style.setProperty('display', config.display, 'important'));
                } else {
                    document.getElementById(pageId)?.style.setProperty('display', config.display, 'important');
                }

                if (config.initFn) config.initFn();
                window.nord.updateActiveLink(config.navAlias || pageId);
                
                // KALIBRERING: Säkerställ att vyn är vid toppen vid sidbyte, förutom vid återgång från ritbordet.
                if (window.UnifiedGeometryManager && window.UnifiedGeometryManager.lastState !== 'WORKSHOP') {
                    window.scrollTo({ top: 0, left: 0, behavior: 'instant' });
                }

                requestAnimationFrame(() => {
                    gsap.to(main, { opacity: 1, duration: 0.6, ease: 'power2.out' });
                });
            }});
            
            if (window.UnifiedGeometryManager && !window.UnifiedGeometryManager.initializationFailed) {
                window.UnifiedGeometryManager.transitionTo(targetState);
            }
            
            window.nord.closeMobileMenu();
        };

        // Harmoni-fix: En dedikerad, GSAP-driven funktion för all mjuk scrollning på sidan.
        window.nord.smoothScrollTo = function(selector) {
            // Harmoni-fix: Geometrin svarar på varje interaktion.
            if (window.UnifiedGeometryManager) {
                window.UnifiedGeometryManager.nudgeGeometry();
            }
            // Fallback om ScrollTo-plugin inte laddats
            if (typeof gsap.to === 'function' && typeof gsap.plugins.ScrollToPlugin !== 'undefined') {
                gsap.to(window, { duration: 1.5, scrollTo: selector, ease: 'power2.inOut' });
            } else {
                // Nativ JavaScript fallback
                const targetElement = document.querySelector(selector);
                if (targetElement) {
                    targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }
        };

        /* --- GLOBAL STARFIELD REMOVED --- */
        /* Den gamla Three.js-stjärnhimlen har avvecklats till förmån för StarfallManager (Canvas) */

        class UnifiedGeometryManager {
            constructor() {
                this.isInitialized = false;
                this.initializationFailed = false;
                this.composer = null;
                this.states = {
                HERO: { zoom: 15, y: 0, opacity: 0.4, rotSpeed: 0.1 }, /* Harmoni-fix: Ytterligare ökad ljusstyrka för en ljusare känsla. */
                PAGE: { zoom: 35, y: 10, opacity: 0.4, rotSpeed: 0.05 }, /* Harmoni-fix: Matchar ljusstyrkan på Hero-sektionen. */
                WORKSHOP: { zoom: 22, y: 0, opacity: 1.0, rotSpeed: 0.2 },
                HIDDEN: { zoom: 60, y: 0, opacity: 0.0, rotSpeed: 0.02 } // Harmoni-fix: Mjukare, horisontell ingångsanimation.
            };
            this.currentState = 'HIDDEN';
            this.lastState = 'HIDDEN';
            this.targetState = this.states.HIDDEN;
            
            // State Management Refactor
            this.activeThemeKey = 'ekosystem';
            this.isParticleModeActive = true; 
            this.attractorParams = { a: 10, b: 28, c: 8.0 / 3.0, dt: 0.01 };
            
            this.isMorphing = false;
            this.currentMorphProgress = 0;
            this.isWorkshopBuilderActive = false;
            
            this.morphVelocity = 0;
                this.dampingFactor = 0.94;
                this.forceFactor = 0.0015;
                this.MAX_INPUT_FORCE = 0.035;
            this.onboardingTimeout = null;
            this.activeParticleMorph = { from: null, to: null };
                this.themeSwitchCooldown = 500; // Harmoni-fix: En "andningspaus" för temaväxling.
                this.lastThemeSwitchTime = 0;

                this.interaction = {
                    targetRotationX: 0.5, targetRotationY: 0,
                    actualRotationX: 0.5, actualRotationY: 0,
                    targetZoom: this.states.HIDDEN.zoom, 
                    actualZoom: this.states.HIDDEN.zoom,
                    targetY: this.states.HIDDEN.y, 
                    actualY: this.states.HIDDEN.y // Harmoni-fix: Återställer startanimationen till en ren zoom för en mer kontrollerad ingång på alla enheter.
                };
                
                this.joystick = {
                    left: { active: false, id: null, startX: 0, startY: 0, currentX: 0, currentY: 0 },
                    right: { active: false, id: null, startX: 0, startY: 0, currentX: 0, currentY: 0 },
                    creatorMode: false,
                    rightTapTimeout: null
                };

                this.boundWheelHandler = this.handleWheel.bind(this);
            this.boundJoystickTouchStart = this.handleJoystickTouchStart.bind(this);
            this.boundJoystickTouchMove = this.handleJoystickTouchMove.bind(this);
            this.boundJoystickTouchEnd = this.handleJoystickTouchEnd.bind(this);
            // this.boundHideOnboarding = null; // Ej längre nödvändig
            this.clock = new THREE.Clock();

            // NYA BINDNINGAR FÖR MUS-ROTATION
            this.boundMouseDown = this.handleMouseDown.bind(this);
            this.boundMouseMove = this.handleMouseMove.bind(this);
            this.boundMouseUp = this.handleMouseUp.bind(this);
            this.isDragging = false;
            this.lastMouseX = 0;
            this.lastMouseY = 0;
        }

        setTheme(themeKey) {
                this.activeThemeKey = themeKey;
                if (this.elasticGeometry) {
                    const theme = SACRED_GEOMETRY_LIBRARY[this.activeThemeKey];
                    this.elasticGeometry.setMaterial(theme?.material || 'organic');
                }
            }

            get activeTheme() {
                return this.activeThemeKey || 'cosmic';
            }

            handleResize() {
                this.camera.aspect = window.innerWidth / window.innerHeight;
                this.camera.updateProjectionMatrix();
                this.renderer.setSize(window.innerWidth, window.innerHeight);
                if (this.composer) {
                    this.composer.setSize(window.innerWidth, window.innerHeight);
                }
            }

            init() {
                try {
                    if (this.isInitialized) return;
                    this.initRenderer();
                    
                    // REMOVED: this.stars = new GlobalStarfield(this.scene);

                    this.elasticGeometry = new ElasticGeometry(this.renderer);
                    this.scene.add(this.elasticGeometry.mesh);
                    
                    this.setTheme(this.activeTheme);

                    this.setupInteractionListeners();
                    window.addEventListener('resize', () => this.handleResize(), false);

                    this.animate = this.animate.bind(this);
                    this.animate();

                    // Harmoni-fix: Anropa updateViewState() vid initiering
                    // för att ställa in den korrekta standardgeometrin (BUG 1).
                    this.updateViewState();

                    this.isInitialized = true;
                } catch (error) {
                    this.initializationFailed = true;
                    console.error("Total disharmoni i UnifiedGeometryManager:", error);
                    logToExternalService(error, "UnifiedGeometryManager.init");
                }
            }

            setGlobalTheme(theme) {
                if (!this.isInitialized) return;
                
                const isLight = theme === 'light';
                
                if (this.elasticGeometry) {
                    this.elasticGeometry.updateMaterialsForTheme(isLight);
                }

                // REMOVED: Star visibility logic (Handled by CSS on #starfall now)
    
                // Uppdatera dimma och bloom
                const fogTargetColor = isLight ? new THREE.Color(0xFDFDFD) : new THREE.Color(0x0c1427);
                const fogTargetDensity = isLight ? 0.005 : 0.015; 
                if (this.scene.fog) {
                    gsap.to(this.scene.fog, { color: fogTargetColor, density: fogTargetDensity, duration: 1.5 });
                }
    
                if (this.composer) {
                    const bloomPass = this.composer.passes[1];
                    if (bloomPass) {
                        const bloomTarget = isLight ? { strength: 0.6, radius: 0.5 } : { strength: 1.3, radius: 0.4 };
                        gsap.to(bloomPass, { ...bloomTarget, duration: 1.5 });
                    }
                }
            }

            initRenderer() {
                this.canvas = document.createElement('canvas');
                this.canvas.id = 'unified-geometry-canvas';
                document.body.appendChild(this.canvas);
                this.renderer = new THREE.WebGLRenderer({ canvas: this.canvas, alpha: true, antialias: true, powerPreference: 'high-performance' });
                this.scene = new THREE.Scene();
                
                // NYTT: Kontrollera initialt tema för korrekt dimma direkt vid start
                const isLight = document.body.classList.contains('light-theme');
                const fogColor = isLight ? 0xFDFDFD : 0x0c1427;
                const fogDensity = isLight ? 0.005 : 0.015;
                this.scene.fog = new THREE.FogExp2(fogColor, fogDensity);

                this.camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
                
                if (typeof THREE.EffectComposer !== 'undefined' && typeof THREE.UnrealBloomPass !== 'undefined') {
                    this.composer = new THREE.EffectComposer(this.renderer);
                    this.composer.addPass(new THREE.RenderPass(this.scene, this.camera));
                    const bloomPass = new THREE.UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 1.3, 0.4, 0.8);
                    this.composer.addPass(bloomPass);
                } else {
                    this.composer = null;
                }
                this.handleResize();
            }

            setupInteractionListeners() {
                const isTouchDevice = window.matchMedia('(pointer: coarse)').matches;
                const joystickLeft = document.getElementById('joystick-portal-left');
                const joystickRight = document.getElementById('joystick-portal-right');

                // Harmoni-fix: Separerar logiken för touch-enheter och desktop för att säkerställa att rätt kontroller alltid laddas.
                if (isTouchDevice && joystickLeft && joystickRight) {
                    // Specifika listeners för mobil (touch)
                    joystickLeft.addEventListener('touchstart', (e) => this.boundJoystickTouchStart(e, 'left'), { passive: false });
                    joystickRight.addEventListener('touchstart', (e) => this.boundJoystickTouchStart(e, 'right'), { passive: false });
                    
                    window.addEventListener('touchmove', this.boundJoystickTouchMove, { passive: false });
                    window.addEventListener('touchend', this.boundJoystickTouchEnd, { passive: false });
                    window.addEventListener('touchcancel', this.boundJoystickTouchEnd, { passive: false });
                } else {
                    // Specifika listeners för desktop (mus & hjul)
                    window.addEventListener('wheel', this.boundWheelHandler, { passive: false });
                    
                    // NYA LISTENERS FÖR MUS-ROTATION
                    this.canvas.addEventListener('mousedown', this.boundMouseDown);
                    window.addEventListener('mousemove', this.boundMouseMove);
                    window.addEventListener('mouseup', this.boundMouseUp);
                    
                    if (joystickRight) {
                        joystickRight.addEventListener('click', () => {
                         if (document.body.classList.contains('labb-active')) { this.exitBuilderMode(); }
                         else { this.enterBuilderMode(); }
                    });
                }
                }
                
                // Gemensamma listeners för både mobil och desktop
                document.querySelectorAll('.glass-btn[data-theme]').forEach(btn => {
                    btn.addEventListener('click', () => this.handleThemeClick(btn.dataset.theme));
                });

                document.getElementById('fractal-mode-toggle').addEventListener('click', () => this.handleParticleClick());

                window.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && this.isWorkshopBuilderActive) this.exitBuilderMode();
                });

                // Harmoni-fix: Dedikerad logik för det nya, hopfällbara verktygsfältet på mobil.
                const toolbarToggle = document.getElementById('toolbar-toggle');
                const body = document.body;

                if (toolbarToggle) {
                    toolbarToggle.addEventListener('click', () => {
                        body.classList.toggle('toolbar-open');
                        const icon = toolbarToggle.querySelector('i');
                        if (body.classList.contains('toolbar-open')) {
                            icon.className = 'ph ph-x';
                            toolbarToggle.title = 'Dölj verktyg';
                        } else {
                            icon.className = 'ph ph-list';
                            toolbarToggle.title = 'Visa verktyg';
                        }
                    });
                }
            }

            // NYA HANDLERS FÖR MUS-ROTATION
            handleMouseDown(e) {
                if (!this.isWorkshopBuilderActive) return;
                e.preventDefault();
                this.isDragging = true;
                this.lastMouseX = e.clientX;
                this.lastMouseY = e.clientY;
            }

            handleMouseMove(e) {
                if (!this.isDragging || !this.isWorkshopBuilderActive) return;
                e.preventDefault();
                const deltaX = e.clientX - this.lastMouseX;
                const deltaY = e.clientY - this.lastMouseY;
                
                this.interaction.targetRotationY += deltaX * 0.005;
                this.interaction.targetRotationX -= deltaY * 0.005;
                this.interaction.targetRotationX = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, this.interaction.targetRotationX));
                
                this.lastMouseX = e.clientX;
                this.lastMouseY = e.clientY;
            }

            handleMouseUp() {
                this.isDragging = false;
            }
            // SLUT PÅ NYA HANDLERS

            handleWheel(e) {
                if (!this.isWorkshopBuilderActive) return;
                e.preventDefault();

                // Harmoni-fix: Ny hierarki av interaktion med Shift och Option/Alt.
                if (e.altKey) { // Skulptering (Option på Mac)
                    this.elasticGeometry.sculpt(e.deltaY);
                    return;
                }

                if (e.shiftKey) { // Temaväxling
                    // Harmoni-fix: "Den Stora Resan" är nu mer intelligent och behaglig.
                    if (this.isParticleModeActive) return; 
                    const now = Date.now();
                    if (now - this.lastThemeSwitchTime < this.themeSwitchCooldown) return;

                    const themeKeys = Object.keys(SACRED_GEOMETRY_LIBRARY);
                    const currentIndex = themeKeys.indexOf(this.activeThemeKey || 'struktur');
                    let nextIndex;
                    if (e.deltaY > 0) { // Scrolla ner
                        nextIndex = (currentIndex + 1) % themeKeys.length;
                    } else { // Scrolla upp
                        nextIndex = (currentIndex - 1 + themeKeys.length) % themeKeys.length;
                    }
                    this.handleThemeClick(themeKeys[nextIndex]);
                    this.lastThemeSwitchTime = now; // Notera tidpunkten för växlingen.
                    return;
                }
                
                // Ordinarie interaktion (Dansen)
                if (this.isParticleModeActive && !this.activeThemeKey) {
                    this.attractorParams.b += e.deltaY * 0.01;
                    this.elasticGeometry.regenerateAttractor(this.attractorParams);
                    this.displayFormName({ displayName: `Attraktor [b=${this.attractorParams.b.toFixed(2)}]` });
                    return;
                }

                const rawForce = e.deltaY * this.forceFactor;
                const force = Math.max(-this.MAX_INPUT_FORCE, Math.min(this.MAX_INPUT_FORCE, rawForce));
                this.morphVelocity += force;
                this.isMorphing = true;
            }

            handleJoystickTouchStart(e, side) {
                // Harmoni-fix: e.preventDefault() är borttagen härifrån för att tillåta
                // webbläsaren att initiera en scroll-gest även om den startar på en joystick.
                const touch = e.changedTouches[0];
                this.joystick[side].active = true;
                this.joystick[side].id = touch.identifier;
                this.joystick[side].startX = touch.clientX;
                this.joystick[side].startY = touch.clientY;
                this.joystick[side].currentX = touch.clientX;
                this.joystick[side].currentY = touch.clientY;
                e.currentTarget.classList.add('active');

                if (side === 'right') {
                    clearTimeout(this.joystick.rightTapTimeout);
                    this.joystick.rightTapTimeout = setTimeout(() => {
                        this.joystick.rightTapTimeout = null;
                    }, 200);
                }
            }

            handleJoystickTouchMove(e) {
                // Harmoni-fix: En "skyddsvakt" säkerställer att joystick-logiken ENDAST körs
                // när verkstaden är aktiv. Detta frigör scroll-funktionen på alla andra sidor.
                if (!this.isWorkshopBuilderActive) return;

                // e.preventDefault() anropas nu endast villkorligt, inuti logiken
                // för varje aktiv joystick. Detta säkerställer att vi bara blockerar scrollning
                // när användaren aktivt manipulerar en kontroll, inte annars.
                for (let i = 0; i < e.changedTouches.length; i++) {
                    const touch = e.changedTouches[i];
                    if (touch.identifier === this.joystick.left.id && this.joystick.left.active) {
                        e.preventDefault(); 
                        const deltaX = touch.clientX - this.joystick.left.currentX;
                        const deltaY = touch.clientY - this.joystick.left.currentY;
                        this.interaction.targetRotationY += deltaX * 0.008;
                        this.interaction.targetRotationX -= deltaY * 0.008;
                        this.interaction.targetRotationX = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, this.interaction.targetRotationX));
                        this.joystick.left.currentX = touch.clientX;
                        this.joystick.left.currentY = touch.clientY;
                    } else if (touch.identifier === this.joystick.right.id && this.joystick.right.active) {
                        e.preventDefault();
                        const deltaY = touch.clientY - this.joystick.right.currentY;
                        if (this.isParticleModeActive && !this.activeThemeKey) {
                           // Harmoni-fix: Återställer den stabila, direkta interaktionen för Attraktorn.
                           this.attractorParams.b -= deltaY * 0.05;
                           this.elasticGeometry.regenerateAttractor(this.attractorParams);
                           this.displayFormName({ displayName: `Attraktor [b=${this.attractorParams.b.toFixed(2)}]` });
                        } else if (this.activeThemeKey) {
                            const rawForce = deltaY * this.forceFactor * 2;
                            const force = Math.max(-this.MAX_INPUT_FORCE, Math.min(this.MAX_INPUT_FORCE, rawForce));
                            this.morphVelocity -= force;
                            this.isMorphing = true;
                        }
                        this.joystick.right.currentX = touch.clientX;
                        this.joystick.right.currentY = touch.clientY;
                    }
                }
            }
            
            handleJoystickTouchEnd(e) {
                for (let i = 0; i < e.changedTouches.length; i++) {
                    const touch = e.changedTouches[i];
                    if (touch.identifier === this.joystick.left.id) {
                        this.joystick.left.active = false;
                        const joyLeft = document.getElementById('joystick-portal-left');
                        joyLeft.classList.remove('active');
                    } else if (touch.identifier === this.joystick.right.id) {
                        if (this.joystick.rightTapTimeout) {
                            clearTimeout(this.joystick.rightTapTimeout);
                            if (document.body.classList.contains('labb-active')) this.exitBuilderMode();
                            else this.enterBuilderMode();
                        }
                        this.joystick.right.active = false;
                        // Harmoni-fix: Borttagen för att höger joystick ska förbli visuellt aktiv i verkstadsläget.
                        // const joyRight = document.getElementById('joystick-portal-right');
                        // joyRight.classList.remove('active');
                    }
                }
            }
            
            transitionTo(targetStateKey) {
                const baseState = this.states[targetStateKey];
                if (!baseState) return;
                this.lastState = this.currentState;
                this.currentState = targetStateKey;
                
                let finalState = { ...baseState }; 
                if (window.innerWidth < 768) {
                    if (targetStateKey === 'PAGE') {
                        finalState.zoom = 60; 
                    } else if (targetStateKey === 'HERO') {
                        finalState.zoom = 22; // Harmoni-fix: För geometrin närmare på mobil (endast 'Hem').
                        finalState.y = 4; // Harmoni-fix: HÖJER kamerans blickpunkt för att SÄNKA geometrin under sidhuvudet.
                    } else if (targetStateKey === 'WORKSHOP') {
                        finalState.y = 0; // Harmoni-fix: Perfekt vertikal centrering på mobil.
                        finalState.zoom = 24; // Harmoni-fix: Anpassad zoom för optimal visning på mobil.
                    }
                }
                
                this.targetState = finalState;
                gsap.to(this.interaction, { targetZoom: finalState.zoom, targetY: finalState.y, duration: 2.5, ease: 'power3.inOut' });
                const mat = this.elasticGeometry.mesh.material;
                const uniforms = mat.uniforms;
                gsap.to(uniforms?.opacity || mat, { value: finalState.opacity, duration: 1.5, ease: 'power2.inOut' });
                
                // REMOVED: const starMat = this.stars.material.uniforms.opacity;
                // REMOVED: gsap.to(starMat, { value: finalState.opacity > 0 ? 1 : 0, duration: 1.5, ease: 'power2.inOut' });

                // --- BORTTAGEN ÅTERSTÄLLNINGSKOD ---
                // Den tvingande koden som låg här är nu borttagen
                // för att tillåta geometrin att "minnas" sitt tillstånd.
            }

            handleThemeClick(themeKey) {
                if (this.activeThemeKey === themeKey) {
                    this.activeThemeKey = null; // Deselect
                } else {
                    this.activeThemeKey = themeKey;
                    // Harmoni-fix: Nollställ form-index BARA när ett nytt tema väljs (BUG 2)
                    if (SACRED_GEOMETRY_LIBRARY[this.activeThemeKey]) {
                        SACRED_GEOMETRY_LIBRARY[this.activeThemeKey].currentIndex = 0;
                    }
                }
                this.updateViewState();
            }
            
            handleParticleClick() {
                this.isParticleModeActive = !this.isParticleModeActive;
                this.updateViewState();
            }
            
            // Harmoni-fix: updateViewState är nu uppdelad.
            // updateButtonUI() synkroniserar BARA knapparna med det aktiva läget.
            // updateViewState() gör allt (knappar OCH geometri-ändring).
            updateButtonUI() {
                document.querySelectorAll('.glass-btn[data-theme]').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.theme === this.activeThemeKey);
                });
                const fractalBtn = document.getElementById('fractal-mode-toggle');
                fractalBtn.classList.toggle('active', this.isParticleModeActive);
                fractalBtn.classList.toggle('glow', this.isParticleModeActive && !!this.activeThemeKey);
            }

            updateViewState() {
                // Steg 1: Synkronisera knapparna
                this.updateButtonUI();

                // Steg 2: Uppdatera geometrin (detta är logiken som återställde)
                this.elasticGeometry.setParticleMode(this.isParticleModeActive, this.activeThemeKey);
                this.isMorphing = false;
                this.currentMorphProgress = 0;
                this.morphVelocity = 0;

                if (this.isParticleModeActive || (SACRED_GEOMETRY_LIBRARY[this.activeThemeKey]?.material === 'nebula')) {
                    if (this.activeThemeKey) {
                        const theme = SACRED_GEOMETRY_LIBRARY[this.activeThemeKey];
                        // theme.currentIndex = 0; // Harmoni-fix: Borttagen för att bevara minne (BUG 2)
                        this.activeShape = theme.forms[theme.currentIndex];
                        this.elasticGeometry.morphToShape(this.activeShape.name);
                        this.displayFormName(this.activeShape);
                    } else {
                        // Pure fractal mode: Ursprunglig Attraktor
                        this.activeShape = { name: 'lorenz_attractor', displayName: 'Ursprunglig Attraktor' };
                        this.elasticGeometry.morphToShape(this.activeShape.name);
                        this.displayFormName(this.activeShape);
                    }
                } else {
                    if (this.activeThemeKey) {
                        const theme = SACRED_GEOMETRY_LIBRARY[this.activeThemeKey];
                        // theme.currentIndex = 0; // Harmoni-fix: Borttagen för att bevara minne (BUG 2)
                        this.activeShape = theme.forms[theme.currentIndex];
                        this.elasticGeometry.morphToShape(this.activeShape.name);
                        this.displayFormName(this.activeShape);
                    } else {
                        // No theme, no fractal -> Fade out
                        gsap.to(this.elasticGeometry.mesh.material.uniforms?.opacity || this.elasticGeometry.mesh.material, { value: 0.1, duration: 0.5 });
                        this.hideFormName();
                    }
                }
            }

            enterBuilderMode() {
                this.isWorkshopBuilderActive = true;
                document.body.classList.add('labb-active');
                this.transitionTo('WORKSHOP');
                document.getElementById('joystick-portal-right')?.classList.add('active');
                
                // Gör canvasen interaktiv för musen på desktop
                if (!window.matchMedia('(pointer: coarse)').matches) {
                    this.canvas.classList.add('interactive');
                }

                // --- NYTT: Hantera Ghost Hints istället för Modal ---
                const ghostHints = document.getElementById('workshop-ghost-hints');
                if (ghostHints) {
                    // Visa hints
                    ghostHints.classList.add('visible');
                    
                    // Tona ut dem automatiskt efter 4.5 sekunder
                    clearTimeout(this.onboardingTimeout);
                    this.onboardingTimeout = setTimeout(() => {
                        ghostHints.classList.remove('visible');
                    }, 4500);
                }

                // Harmoni-fix: Aktivera bara de globala touch-lyssnarna när verkstaden är aktiv.
                if (window.matchMedia('(pointer: coarse)').matches) {
                    window.addEventListener('touchmove', this.boundJoystickTouchMove, { passive: false });
                    window.addEventListener('touchend', this.boundJoystickTouchEnd, { passive: false });
                    window.addEventListener('touchcancel', this.boundJoystickTouchEnd, { passive: false });
                } 

                // Harmoni-fix: Anropa BARA UI-synken.
                this.updateButtonUI();
            }
            
            exitBuilderMode() {
                clearTimeout(this.onboardingTimeout);
                this.isWorkshopBuilderActive = false;
                document.body.classList.remove('labb-active');
                document.body.classList.remove('toolbar-open'); 
                this.transitionTo(this.lastState === 'HIDDEN' ? 'HERO' : this.lastState);
                
                // Nollställ mus-interaktion
                this.isDragging = false;
                this.canvas.classList.remove('interactive');
                
                // Dölj hints direkt vid exit
                document.getElementById('workshop-ghost-hints')?.classList.remove('visible');
                
                // this.hideOnboarding(); // Behövs ej då modalen är borta
                this.hideFormName();
                document.getElementById('joystick-portal-right')?.classList.remove('active');
                
                // Harmoni-fix: Utrotar scroll-konflikten...
                if (window.matchMedia('(pointer: coarse)').matches) {
                    window.removeEventListener('touchmove', this.boundJoystickTouchMove);
                    window.removeEventListener('touchend', this.boundJoystickTouchEnd);
                    window.removeEventListener('touchcancel', this.boundJoystickTouchEnd);
                }
            }

            // Harmoni-fix: Exponerar en global funktion för att "knuffa" geometrin,
            // vilket skapar en levande känsla vid interaktion.
            nudgeGeometry() {
                if (this.elasticGeometry) {
                    this.elasticGeometry.nudge();
                }
            }
            
            displayFormName(shape) {
                if (!this.isWorkshopBuilderActive || !shape) return;
                const el = document.getElementById('form-name-display'); if (!el) return;
                const name = shape.displayName || shape.name.replace(/_/g, ' ');
                el.textContent = name; 
                el.classList.add('visible');
            }
            
            hideFormName() { document.getElementById('form-name-display')?.classList.remove('visible'); }

            animate() {
                requestAnimationFrame(this.animate);
                const time = this.clock.getElapsedTime();
                
                this.interaction.actualRotationX += (this.interaction.targetRotationX - this.interaction.actualRotationX) * 0.1;
                this.interaction.actualRotationY += (this.interaction.targetRotationY - this.interaction.actualRotationY) * 0.1;
                this.interaction.actualZoom += (this.interaction.targetZoom - this.interaction.actualZoom) * 0.05;
                this.interaction.actualY += (this.interaction.targetY - this.interaction.actualY) * 0.05;
                
                if (this.isWorkshopBuilderActive && this.activeThemeKey) {
                    this.currentMorphProgress += this.morphVelocity; this.morphVelocity *= this.dampingFactor;
                    if (Math.abs(this.morphVelocity) < 0.0001) { this.morphVelocity = 0; if(this.isMorphing) this.isMorphing = false; }
                    const theme = SACRED_GEOMETRY_LIBRARY[this.activeThemeKey];
                    if (this.currentMorphProgress >= 1) { theme.currentIndex = (theme.currentIndex + 1) % theme.forms.length; this.activeShape = theme.forms[theme.currentIndex]; this.currentMorphProgress -= 1.0; if ('vibrate' in navigator) navigator.vibrate(30); } 
                    else if (this.currentMorphProgress < 0) { theme.currentIndex = (theme.currentIndex - 1 + theme.forms.length) % theme.forms.length; this.activeShape = theme.forms[theme.currentIndex]; this.currentMorphProgress += 1.0; if ('vibrate' in navigator) navigator.vibrate(30); }
                    const fromShape = theme.forms[theme.currentIndex], toShape = theme.forms[(theme.currentIndex + 1) % theme.forms.length];
                    
                    // Harmoni-fix: Optimerad animationslogik för partiklar.
                    if (this.elasticGeometry.isParticleSystem) {
                        // Om formen vi morfar mellan har ändrats, uppdaterar vi geometri-buffrarna en enda gång.
                        if (this.activeParticleMorph.from !== fromShape.name || this.activeParticleMorph.to !== toShape.name) {
                            this.elasticGeometry.setMorph(fromShape.name, toShape.name, this.currentMorphProgress);
                            this.activeParticleMorph.from = fromShape.name;
                            this.activeParticleMorph.to = toShape.name;
                        }
                        // I varje frame uppdaterar vi endast progress-värdet i grafikprocessorn, vilket ger en helt mjuk animation.
                        this.elasticGeometry.mesh.material.uniforms.morphProgress.value = this.currentMorphProgress;
                    } else {
                        // Solida geometrier använder en annan fysikbaserad morfning.
                        this.elasticGeometry.setMorph(fromShape.name, toShape.name, this.currentMorphProgress);
                    }
                    
                    const fromName = fromShape.displayName || fromShape.name.replace(/_/g, ' ');
                    const toName = toShape.displayName || toShape.name.replace(/_/g, ' ');

                    this.displayFormName(this.isMorphing ? { displayName: `${fromName} → ${toName}` } : this.activeShape);
                }
                
                const cameraX = Math.sin(this.interaction.actualRotationY) * Math.cos(this.interaction.actualRotationX) * this.interaction.actualZoom;
                const cameraZ = Math.cos(this.interaction.actualRotationY) * Math.cos(this.interaction.actualRotationX) * this.interaction.actualZoom;
                const cameraY = Math.sin(this.interaction.actualRotationX) * this.interaction.actualZoom + this.interaction.actualY;

                this.camera.position.set(cameraX, cameraY, cameraZ);
                this.camera.lookAt(0, this.interaction.actualY, 0);
                
                // REMOVED: this.stars.material.uniforms.time.value = time;
                this.elasticGeometry.update(time);
                
                if (this.composer) {
                    this.composer.render();
                } else {
                    this.renderer.render(this.scene, this.camera);
                }
            }
        }

        class ElasticGeometry {
            constructor(renderer) {
                this.renderer = renderer; this.SPRING_STRENGTH = 0.04; this.DAMPING = 0.88; this.velocityThreshold = 0.0001; this.isParticleSystem = false; this.activeMorph = null;
               this.initGeometry(); this.initPhysics(); this.initMaterials(); this.initVisuals();
            }

            _addColorAttribute(geometry) {
                if (geometry.attributes.color) return;
                const count = geometry.attributes.position.count;
                const colors = new Float32Array(count * 3);
                const life = new Float32Array(count); // Harmoni-fix: Partiklarna får ett individuellt liv.
                const color1 = new THREE.Color(0x00D4FF); // NordSym Cyan
                const color2 = new THREE.Color(0x9370DB); // NordSym Purple
                const tempColor = new THREE.Color();
                for (let i = 0; i < count; i++) {
                    tempColor.copy(color1).lerp(color2, Math.random());
                    colors[i * 3] = tempColor.r;
                    colors[i * 3 + 1] = tempColor.g;
                    colors[i * 3 + 2] = tempColor.b;
                    life[i] = Math.random() * 10.0; // Ett unikt startvärde för varje partikel.
                }
                geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
                geometry.setAttribute('life', new THREE.BufferAttribute(life, 1));
            }

            initGeometry() {
                this.geometries = {
                    tetrahedron: new THREE.TetrahedronGeometry(5, 1), cube: new THREE.BoxGeometry(7, 7, 7),
                    octahedron: new THREE.OctahedronGeometry(5, 1), dodecahedron: new THREE.DodecahedronGeometry(5, 1),
                    icosahedron: new THREE.IcosahedronGeometry(5, 2), seed_of_life: new THREE.SphereGeometry(4.5, 64, 64),
                    flower_of_life: new THREE.TorusGeometry(4, 1.5, 8, 50), metatrons_cube: new THREE.IcosahedronGeometry(5, 1),
                    torus: new THREE.TorusGeometry(4, 1.5, 16, 100), trinity_knot: new THREE.TorusKnotGeometry(3.5, 0.8, 128, 16, 2, 3),
                    diamond_brilliant: new THREE.OctahedronGeometry(5, 0), quartz_point: new THREE.CylinderGeometry(0, 3, 8, 6),
                    bismuth_spiral: new THREE.BoxGeometry(6,6,6), geode: new THREE.SphereGeometry(4.5, 32, 32),
                    prism_triangular: new THREE.CylinderGeometry(4, 4, 6, 3), tesseract: new THREE.BoxGeometry(7, 7, 7),
                    klein_bottle: new THREE.TorusKnotGeometry(3.5, 1, 64, 8, 1, 3), mobius_strip: new THREE.TorusGeometry(4, 0.5, 8, 50),
                    hopf_fibration: new THREE.TorusKnotGeometry(3.5, 0.8, 128, 16, 2, 3), calabi_yau: new THREE.TorusKnotGeometry(3.5, 1.2, 128, 16, 3, 7),
                    fibonacci_spiral: new THREE.TorusGeometry(4, 0.2, 16, 100), galaxy_spiral: new THREE.SphereGeometry(5, 64, 64),
                    merkaba: new THREE.TetrahedronGeometry(5, 0), tetrahedron_grid_64: new THREE.IcosahedronGeometry(5, 2),
                    nebula_cloud: new THREE.SphereGeometry(5, 64, 64), 
                    fractal_fibonacci: this.createFractalGeometry(),
                    fibonacci_sphere: this.createFibonacciSphereGeometry(),
                    galactic_arm: this.createGalacticArmGeometry(),
                    accretion_disk: this.createAccretionDiskGeometry(),
                    cosmic_web: this.createCosmicWebGeometry(),
                    stellated_dodecahedron: this.createStellatedDodecahedronGeometry(),
                    atomic_orbitals: this.createAtomicOrbitalsGeometry(),
                    supernova_remnant: this.createSupernovaRemnantGeometry(),
                    lorenz_attractor: this.createLorenzAttractorGeometry(),
                     // Formerna för det nya "Grundläggande" temat
                    potential: this.createPotentialGeometry(),
                    relation: this.createRelationGeometry(),
                    structure: this.createStructureGeometry(),
                    adaptation: this.createAdaptationGeometry(),
                    synergy: this.createSynergyGeometry()
                };
                
                Object.values(this.geometries).forEach(geo => this._addColorAttribute(geo));

                this.geometry = this.geometries.seed_of_life.clone(); this.geometry.computeVertexNormals();
            }
            createFractalGeometry(count = 10000) {
                const points = []; let x = 0.1, y = 0, z = 0; const a = 10, b = 28, c = 8.0 / 3.0; const dt = 0.01;
                for (let i = 0; i < count; i++) { const dx = a * (y - x) * dt; const dy = (x * (b - z) - y) * dt; const dz = (x * y - c * z) * dt; x += dx; y += dy; z += dz; if (i > 100) points.push(x * 0.2, y * 0.2, z * 0.2); }
                const geometry = new THREE.BufferGeometry(); geometry.setAttribute('position', new THREE.Float32BufferAttribute(points, 3)); return geometry;
            }
             createPotentialGeometry(count = 8000, radius = 5) { 
                // Harmoni-fix: "Ursprung" är nu en Lorenz-attraktor. 
                // Detta transformerar den från en "trasslig boll" till en vacker representation 
                // av hur ordning och struktur uppstår ur kaotiska system.
                const points = [];
                let x = 0.1, y = 0, z = 0;
                const a = 10, b = 28, c = 8.0 / 3.0, dt = 0.01;

                for (let i = 0; i < count; i++) {
                    const dx = a * (y - x) * dt;
                    const dy = (x * (b - z) - y) * dt;
                    const dz = (x * y - c * z) * dt;
                    x += dx; y += dy; z += dz;
                    if (i > 100) { // Låt systemet "värmas upp" för att hitta attraktorn
                        points.push(x * 0.25, y * 0.25, (z * 0.25) - 8);
                    }
                }
                const geometry = new THREE.BufferGeometry(); 
                geometry.setAttribute('position', new THREE.Float32BufferAttribute(points, 3)); 
                return geometry;
            }
            createRelationGeometry(nodes = 50, connectionsPerNode = 1, radius = 8) { // Harmoni-fix: Minskat antalet kopplingar för en tydligare, mindre trasslig struktur.
                const geometry = new THREE.BufferGeometry();
                const nodePoints = [];
                for(let i = 0; i < nodes; i++) { 
                    nodePoints.push(new THREE.Vector3((Math.random() - 0.5) * radius * 2, (Math.random() - 0.5) * radius * 2, (Math.random() - 0.5) * radius * 2)); 
                }
                const vertices = [];
                const connected = new Set();
                nodePoints.forEach((p1, i) => {
                    const distances = nodePoints.map((p2, j) => ({ index: j, dist: p1.distanceTo(p2) }))
                        .sort((a, b) => a.dist - b.dist)
                        .slice(1, connectionsPerNode + 1);

                    distances.forEach(d => {
                        const j = d.index;
                        const key1 = `${i}-${j}`, key2 = `${j}-${i}`;
                        if (!connected.has(key1) && !connected.has(key2)) {
                            const p2 = nodePoints[j];
                            vertices.push(p1.x, p1.y, p1.z);
                            vertices.push(p2.x, p2.y, p2.z);
                            connected.add(key1);
                        }
                    });
                });

                geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
                return geometry;
            }
            createStructureGeometry(size = 8, divisions = 5) {
                const geometry = new THREE.BufferGeometry();
                const vertices = [];
                const step = size / divisions;
                const halfSize = size / 2;

                for (let i = 0; i <= divisions; i++) {
                    const x = -halfSize + i * step;
                    const y = -halfSize + i * step;
                    const z = -halfSize + i * step;

                    // Lines along X
                    vertices.push(-halfSize, y, z, halfSize, y, z);
                    // Lines along Y
                    vertices.push(x, -halfSize, z, x, halfSize, z);
                    // Lines along Z
                    vertices.push(x, y, -halfSize, x, y, halfSize);
                }

                geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
                return geometry;
            }
            createAdaptationGeometry(size = 8, divisions = 5) { // Harmoni-fix: Minskat antalet "trådar" för en luftigare, mer genomskinlig känsla.
                 const geometry = new THREE.PlaneGeometry(size, size, divisions, divisions);
                 // Deform it into a sphere-like shape
                 const vertices = geometry.attributes.position;
                 for (let i = 0; i < vertices.count; i++) {
                     const vertex = new THREE.Vector3().fromBufferAttribute(vertices, i);
                     vertex.normalize().multiplyScalar(size / 2);
                     vertices.setXYZ(i, vertex.x, vertex.y, vertex.z);
                 }
                 geometry.computeVertexNormals();
                 return geometry;
            }
            createSynergyGeometry(radius = 5, detail = 5) {
                return new THREE.IcosahedronGeometry(radius, detail);
            }
            createLorenzAttractorGeometry(params = { a: 10, b: 28, c: 8.0 / 3.0, dt: 0.01 }, count = 15000) {
                const points = [];
                let x = 0.1, y = 0, z = 0;
                const { a, b, c, dt } = params;
                for (let i = 0; i < count; i++) {
                    const dx = a * (y - x) * dt;
                    const dy = (x * (b - z) - y) * dt;
                    const dz = (x * y - c * z) * dt;
                    x += dx; y += dy; z += dz;
                    if (i > 100) points.push(x * 0.3, y * 0.3, (z * 0.3) - 10);
                }
                const geometry = new THREE.BufferGeometry();
                geometry.setAttribute('position', new THREE.Float32BufferAttribute(points, 3));
                return geometry;
            }
            regenerateAttractor(params) {
                const newGeo = this.createLorenzAttractorGeometry(params);
                this.geometries['lorenz_attractor'] = newGeo;
                this._addColorAttribute(newGeo);
                // Harmoni-fix: Återgår till den direkta, stabila metoden för att uppdatera Attraktorn.
                this.morphToShape('lorenz_attractor');
            }
            createFibonacciSphereGeometry(count = 2000, radius = 5) {
                const points = []; const phi = Math.PI * (3. - Math.sqrt(5.)); 
                for (let i = 0; i < count; i++) { const y = 1 - (i / (count - 1)) * 2; const r = Math.sqrt(1 - y * y); const theta = phi * i; const x = Math.cos(theta) * r; const z = Math.sin(theta) * r; points.push(x * radius, y * radius, z * radius); }
                const geometry = new THREE.BufferGeometry(); geometry.setAttribute('position', new THREE.Float32BufferAttribute(points, 3)); return geometry;
            }
            createGalacticArmGeometry(count = 3000, radius = 6) {
                const points = []; const armCount = 2; const spread = 1.5;
                for (let i = 0; i < count; i++) {
                    const r = Math.sqrt(Math.random()) * radius;
                    const angle = Math.random() * 2 * Math.PI + (r / radius) * 5;
                    const arm = Math.floor(Math.random() * armCount);
                    const armAngle = (2 * Math.PI / armCount) * arm;
                    const x = Math.cos(angle + armAngle) * r + (Math.random() - 0.5) * spread;
                    const y = (Math.random() - 0.5) * (spread / 2) * (1 - r / radius);
                    const z = Math.sin(angle + armAngle) * r + (Math.random() - 0.5) * spread;
                    points.push(x, y, z);
                }
                const geometry = new THREE.BufferGeometry(); geometry.setAttribute('position', new THREE.Float32BufferAttribute(points, 3)); return geometry;
            }
            createAccretionDiskGeometry(count = 15000) {
                const points = [];
                for (let i = 0; i < count; i++) {
                    const r = Math.pow(Math.random(), 2) * 8;
                    const angle = Math.random() * Math.PI * 10;
                    const x = Math.cos(angle) * r;
                    const z = Math.sin(angle) * r;
                    const y = (Math.random() - 0.5) * 0.2 * (1 - r/8);
                    points.push(x, y, z);
                }
                const geometry = new THREE.BufferGeometry(); geometry.setAttribute('position', new THREE.Float32BufferAttribute(points, 3)); return geometry;
            }
            createCosmicWebGeometry(count = 15000) {
                const points = [];
                const nodes = [];
                for(let i = 0; i < 20; i++) { nodes.push(new THREE.Vector3((Math.random() - 0.5) * 30, (Math.random() - 0.5) * 30, (Math.random() - 0.5) * 30)); }
                for (let i = 0; i < count; i++) {
                    const p1 = nodes[Math.floor(Math.random() * nodes.length)];
                    const p2 = nodes[Math.floor(Math.random() * nodes.length)];
                    const point = new THREE.Vector3().lerpVectors(p1, p2, Math.random());
                    point.x += (Math.random() - 0.5) * 0.5;
                    point.y += (Math.random() - 0.5) * 0.5;
                    point.z += (Math.random() - 0.5) * 0.5;
                    points.push(point.x, point.y, point.z);
                }
                const geometry = new THREE.BufferGeometry(); geometry.setAttribute('position', new THREE.Float32BufferAttribute(points, 3)); return geometry;
            }
            createStellatedDodecahedronGeometry() {
                const baseGeo = new THREE.DodecahedronGeometry(5, 0);
                const vertices = [];
                const basePositions = baseGeo.attributes.position;
                for (let i = 0; i < basePositions.count; i += 3) {
                    const v1 = new THREE.Vector3().fromBufferAttribute(basePositions, i);
                    const v2 = new THREE.Vector3().fromBufferAttribute(basePositions, i + 1);
                    const v3 = new THREE.Vector3().fromBufferAttribute(basePositions, i + 2);
                    const center = new THREE.Vector3().add(v1).add(v2).add(v3).divideScalar(3);
                    const stellatedPoint = center.clone().normalize().multiplyScalar(8);
                    vertices.push(v1.x, v1.y, v1.z, v2.x, v2.y, v2.z, stellatedPoint.x, stellatedPoint.y, stellatedPoint.z);
                    vertices.push(v2.x, v2.y, v2.z, v3.x, v3.y, v3.z, stellatedPoint.x, stellatedPoint.y, stellatedPoint.z);
                    vertices.push(v3.x, v3.y, v3.z, v1.x, v1.y, v1.z, stellatedPoint.x, stellatedPoint.y, stellatedPoint.z);
                }
                const geometry = new THREE.BufferGeometry(); geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3)); return geometry;
            }
            createAtomicOrbitalsGeometry(count = 15000) {
                const points = [];
                const radii = [3, 6, 9];
                for (let i = 0; i < count; i++) {
                    const r = radii[Math.floor(Math.random() * radii.length)];
                    const u = Math.random();
                    const v = Math.random();
                    const theta = 2 * Math.PI * u;
                    const phi = Math.acos(2 * v - 1);
                    const x = r * Math.sin(phi) * Math.cos(theta);
                    const y = r * Math.sin(phi) * Math.sin(theta);
                    const z = r * Math.cos(phi);
                    points.push(x, y, z);
                }
                const geometry = new THREE.BufferGeometry();
                geometry.setAttribute('position', new THREE.Float32BufferAttribute(points, 3));
                return geometry;
            }
            createSupernovaRemnantGeometry(count = 20000, radius = 10) {
                const points = [];
                for (let i = 0; i < count; i++) {
                    const u = Math.random();
                    const v = Math.random();
                    const r = radius * Math.sqrt(u);
                    const theta = 2 * Math.PI * v;
                    const shell_thickness = 0.5 * Math.random();
                    const R = r * (1.0 - shell_thickness * shell_thickness);

                    const phi = Math.acos(2 * Math.random() - 1);
                    const x = R * Math.sin(phi) * Math.cos(theta);
                    const y = R * Math.sin(phi) * Math.sin(theta);
                    const z = R * Math.cos(phi);
                    points.push(x, y, z);
                }
                const geometry = new THREE.BufferGeometry();
                geometry.setAttribute('position', new THREE.Float32BufferAttribute(points, 3));
                return geometry;
            }
            initMaterials() {
                const nebulaShader = {
                    uniforms: { time: { value: 0 }, rotation: { value: 0}, opacity: { value: 1.0 }, pointSize: { value: 2.5 }, morphProgress: { value: 0.0 }, pulseIntensity: { value: 1.0 }, u_isLightTheme: { value: 0.0 } },
                    vertexShader: `attribute vec3 color; attribute float life; attribute vec3 morphTarget; uniform float time; uniform float rotation; uniform float pointSize; uniform float morphProgress; varying vec3 vColor; varying float vLife; void main() { vColor = color; vLife = life; vec3 p = mix(position, morphTarget, morphProgress); mat2 rot = mat2(cos(rotation), -sin(rotation), sin(rotation), cos(rotation)); p.xz = rot * p.xz; vec4 mvPosition = modelViewMatrix * vec4(p, 1.0); gl_PointSize = pointSize * (20.0 / -mvPosition.z); gl_Position = projectionMatrix * mvPosition; }`,
                    fragmentShader: `
                        uniform float time;
                        uniform float opacity;
                        uniform float pulseIntensity;
                        uniform float u_isLightTheme;
                        varying vec3 vColor;
                        varying float vLife;
                        
                        // Blueprint Ink Color (RGB: 10, 37, 64)
                        const vec3 inkColor = vec3(10.0/255.0, 37.0/255.0, 64.0/255.0);
                        
                        void main() {
                            float dist = length(gl_PointCoord - vec2(0.5));
                            if (dist > 0.45) discard;
                            
                            vec3 finalColor;
                            float pulse;
            
                            if (u_isLightTheme > 0.5) {
                                // LIGHT THEME: Use Normal Blending (set in JS) and Ink Color
                                pulse = 0.5 + 0.5 * sin(time * 3.0 + vLife);
                                finalColor = inkColor;
                            } else {
                                // DARK THEME: Use Additive Blending (set in JS) and vColor
                                pulse = 0.8 + 0.2 * sin(time * 3.0 + vLife);
                                finalColor = vColor;
                            }
                            
                            gl_FragColor = vec4(finalColor * pulse * pulseIntensity, smoothstep(0.45, 0.1, dist) * opacity);
                        }
                    `,
                    transparent: true, blending: THREE.AdditiveBlending, depthWrite: false
                };
                this.materials = {
                    neural: new THREE.ShaderMaterial({ uniforms: { time: { value: 0 }, rotation: { value: 0 }, opacity: { value: 1.0 }, thickness: { value: 0.1 } }, vertexShader: `uniform float rotation; void main() { vec3 p = position; mat2 rot = mat2(cos(rotation), -sin(rotation), sin(rotation), cos(rotation)); p.xz = rot * p.xz; gl_Position = projectionMatrix * modelViewMatrix * vec4(p, 1.0); }`, fragmentShader: `uniform float opacity; uniform float thickness; void main() { gl_FragColor = vec4(0.0, 0.83, 1.0, 0.5 * opacity); }`, wireframe: true, transparent: true }),
                    organic: new THREE.ShaderMaterial({ uniforms: { time: { value: 0 }, rotation: { value: 0}, opacity: { value: 1.0 }, displacement: { value: 0.0 } }, vertexShader: `uniform float time; uniform float rotation; uniform float displacement; varying vec3 vNormal; void main() { vNormal = normal; float d = sin(position.y * 2.0 + time * 3.0) * displacement + cos(position.x * 2.0 + time * 2.0) * displacement; vec3 newPosition = position + normal * d; mat2 rot = mat2(cos(rotation), -sin(rotation), sin(rotation), cos(rotation)); newPosition.xz = rot * newPosition.xz; gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0); }`, fragmentShader: `varying vec3 vNormal; uniform float opacity; void main() { float intensity = pow(0.7 - dot(vNormal, vec3(0.0, 0.0, 1.0)), 2.0); gl_FragColor = vec4(vec3(0.5, 0.8, 1.0) * intensity, opacity); }`, wireframe: true, transparent: true }),
                    crystal: new THREE.ShaderMaterial({ uniforms: { time: { value: 0 }, rotation: { value: 0}, opacity: { value: 1.0 }, fresnelPower: { value: 2.0 } }, vertexShader: `uniform float rotation; varying vec3 vNormal; varying vec3 vViewPosition; void main() { vNormal = normalize(normalMatrix * normal); vec3 p = position; mat2 rot = mat2(cos(rotation), -sin(rotation), sin(rotation), cos(rotation)); p.xz = rot * p.xz; vec4 mvPosition = modelViewMatrix * vec4(p, 1.0); vViewPosition = -mvPosition.xyz; gl_Position = projectionMatrix * mvPosition; }`, fragmentShader: `uniform float fresnelPower; varying vec3 vNormal; varying vec3 vViewPosition; uniform float opacity; void main() { vec3 viewDir = normalize(vViewPosition); float fresnel = 1.0 - dot(viewDir, vNormal); fresnel = pow(fresnel, fresnelPower); vec3 iceColor = vec3(0.9, 0.95, 1.0); vec3 shadowColor = vec3(0.7, 0.85, 1.0); vec3 color = mix(shadowColor, iceColor, fresnel); float frost = sin(vNormal.y * 10.0) * 0.05 + 0.95; gl_FragColor = vec4(color * frost, (0.9 + fresnel * 0.1) * opacity); }`, transparent: true, side: THREE.DoubleSide }),
                    quantum: new THREE.ShaderMaterial({ uniforms: { time: { value: 0 }, rotation: { value: 0}, opacity: { value: 1.0 }, flickerIntensity: { value: 0.2 } }, vertexShader: `uniform float rotation; varying vec3 vNormal; varying vec3 vViewPosition; void main() { vNormal = normalize(normalMatrix * normal); vec3 p = position; mat2 rot = mat2(cos(rotation), -sin(rotation), sin(rotation), cos(rotation)); p.xz = rot * p.xz; vec4 mvPosition = modelViewMatrix * vec4(p, 1.0); vViewPosition = -mvPosition.xyz; gl_Position = projectionMatrix * mvPosition; }`, fragmentShader: `uniform float time; uniform float flickerIntensity; varying vec3 vNormal; varying vec3 vViewPosition; uniform float opacity; void main() { vec3 viewDir = normalize(vViewPosition); float fresnel = 1.0 - dot(viewDir, vNormal); fresnel = pow(fresnel, 4.0); float flicker = 0.8 + sin(vNormal.x * 10.0 + time * 2.0) * flickerIntensity; vec3 baseColor = vec3(0.1, 0.15, 0.3) * flicker; vec3 rimColor = vec3(0.6, 0.8, 1.0); vec3 color = mix(baseColor, rimColor, fresnel); gl_FragColor = vec4(color, (fresnel * 0.5 + 0.3) * opacity); }`, transparent: true, blending: THREE.AdditiveBlending }),
                    nebula: new THREE.ShaderMaterial(nebulaShader)
                };
            }
            initPhysics() { const vertexCount = this.geometry.attributes.position.count; this.originalPositions = new Float32Array(this.geometry.attributes.position.array); this.velocities = new Array(vertexCount).fill(0).map(() => new THREE.Vector3()); }
            initVisuals() { this.mesh = new THREE.Mesh(this.geometry, this.materials.organic); this.mesh.renderOrder = 0; }
            
            setMaterial(materialKey) {
                const newMat = this.materials[materialKey]; if (!newMat) return;
                const currentOpacity = this.mesh.material.uniforms?.opacity?.value ?? this.mesh.material.opacity;
                if (newMat.uniforms?.opacity) newMat.uniforms.opacity.value = currentOpacity; else newMat.opacity = currentOpacity;
                Object.values(this.materials).forEach(mat => { if(mat.wireframe) mat.wireframe = false; });
                if (newMat.wireframe !== undefined) newMat.wireframe = true;
                
                const isNebulaType = (materialKey === 'nebula');
                const needsMeshTypeChange = (isNebulaType && this.mesh.type !== 'Points') || (!isNebulaType && this.mesh.type !== 'Mesh');

                if (needsMeshTypeChange) {
                    const currentScene = this.mesh.parent;
                    if (currentScene) currentScene.remove(this.mesh);

                    if (isNebulaType) {
                        this.mesh = new THREE.Points(this.geometry, newMat);
                        // Harmoni-fix: Detta är den kritiska pusselbiten. När en solid form blir partiklar,
                        // måste den få ett 'morphTarget'-attribut så att partikel-shadern vet hur den ska kunna
                        // transformera sig i framtiden. Utan detta kraschar shadern och ingenting syns.
                        if (!this.geometry.attributes.morphTarget) {
                            this.geometry.setAttribute('morphTarget', new THREE.BufferAttribute(new Float32Array(this.geometry.attributes.position.array), 3));
                        }
                    } else {
                        this.mesh = new THREE.Mesh(this.geometry, newMat);
                    }
                    
                    if (currentScene) currentScene.add(this.mesh);
                } else {
                    this.mesh.material = newMat;
                }
            }

            updateMaterialsForTheme(isLight) {
                const nebulaMat = this.materials.nebula;
                if (!nebulaMat) return;
    
                if (isLight) {
                    nebulaMat.blending = THREE.NormalBlending;
                    nebulaMat.uniforms.u_isLightTheme.value = 1.0;
                } else {
                    nebulaMat.blending = THREE.AdditiveBlending;
                    nebulaMat.uniforms.u_isLightTheme.value = 0.0;
                }
            }

            update(time) {
                if (this.mesh.material.uniforms && this.mesh.material.uniforms.time) { this.mesh.material.uniforms.time.value = time; }
                if (this.mesh.material.uniforms && this.mesh.material.uniforms.rotation) { this.mesh.material.uniforms.rotation.value = time * 0.1; }
                
                if (this.mesh.type === 'Points') return; // Don't run physics on particle systems
                const positions = this.geometry.attributes.position.array; const restPos = new THREE.Vector3(); const currentPos = new THREE.Vector3();
                for (let i = 0; i < this.velocities.length; i++) {
                    restPos.fromArray(this.originalPositions, i * 3); currentPos.fromArray(positions, i * 3);
                    if (this.velocities[i].lengthSq() < this.velocityThreshold * this.velocityThreshold && currentPos.distanceToSquared(restPos) < 0.001) { this.velocities[i].set(0, 0, 0); currentPos.copy(restPos); } else { const springForce = restPos.clone().sub(currentPos).multiplyScalar(this.SPRING_STRENGTH); this.velocities[i].add(springForce); this.velocities[i].multiplyScalar(this.DAMPING); currentPos.add(this.velocities[i]); }
                    currentPos.toArray(positions, i * 3);
                }
                this.geometry.attributes.position.needsUpdate = true; this.geometry.computeVertexNormals();
            }
            nudge() { 
                if (this.mesh.type === 'Points') { 
                    gsap.to(this.mesh.material.uniforms.pulseIntensity, { value: 2.5, duration: 0.3, yoyo: true, repeat: 1, ease: 'power2.inOut' });
                } else {
                    for (let i = 0; i < this.velocities.length; i++) { this.velocities[i].add(new THREE.Vector3(Math.random()-0.5, Math.random()-0.5, Math.random()-0.5).multiplyScalar(0.1)); }
                }
            }
             sculpt(delta) {
                const material = this.mesh.material;
                if (!material.uniforms) return;

                if (this.isParticleSystem) {
                    const size = material.uniforms.pointSize;
                    if (size) size.value = Math.max(0.5, Math.min(5.0, size.value - delta * 0.01));
                } else {
                    const themeKey = window.UnifiedGeometryManager.activeTheme;
                    switch(themeKey) {
                        case 'organic':
                            const displacement = material.uniforms.displacement;
                            if (displacement) displacement.value = Math.max(0, Math.min(1.0, displacement.value - delta * 0.001));
                            break;
                        case 'crystal':
                             const fresnelPower = material.uniforms.fresnelPower;
                             if (fresnelPower) fresnelPower.value = Math.max(0.1, Math.min(8.0, fresnelPower.value - delta * 0.01));
                            break;
                        case 'quantum':
                            const flicker = material.uniforms.flickerIntensity;
                            if (flicker) flicker.value = Math.max(0, Math.min(1.0, flicker.value - delta * 0.001));
                            break;
                        default:
                            break;
                    }
                }
            }
            morphToShape(shapeKey, scale = 1.0) {
                const targetGeo = this.geometries[shapeKey.toLowerCase()]; if (!targetGeo || !targetGeo.attributes.position) return; if (this.activeMorph) this.activeMorph.kill();
                
                const vertexCount = this.originalPositions.length / 3;
                const targetPositions = new Float32Array(vertexCount * 3);
                const targetColors = new Float32Array(vertexCount * 3);
                const targetLifes = new Float32Array(vertexCount);

                const targetPosAttr = targetGeo.attributes.position;
                const targetColorAttr = targetGeo.attributes.color;
                const targetLifeAttr = targetGeo.attributes.life;

                for (let i = 0; i < vertexCount; i++) { 
                    const targetIndex = i % targetPosAttr.count;
                    
                    targetPositions[i*3] = targetPosAttr.array[targetIndex*3] * scale; 
                    targetPositions[i*3+1] = targetPosAttr.array[targetIndex*3+1] * scale; 
                    targetPositions[i*3+2] = targetPosAttr.array[targetIndex*3+2] * scale;
                    
                    if(targetColorAttr) {
                        targetColors[i*3] = targetColorAttr.array[targetIndex*3];
                        targetColors[i*3+1] = targetColorAttr.array[targetIndex*3+1];
                        targetColors[i*3+2] = targetColorAttr.array[targetIndex*3+2];
                    }
                    
                    if(targetLifeAttr) {
                        targetLifes[i] = targetLifeAttr.array[targetIndex];
                    }
                }
                
                if (this.mesh.type === 'Points') { 
                    this.geometry.setAttribute('position', new THREE.BufferAttribute(targetPositions, 3)); 
                    this.geometry.setAttribute('color', new THREE.BufferAttribute(targetColors, 3));
                    this.geometry.setAttribute('life', new THREE.BufferAttribute(targetLifes, 1));
                    this.geometry.attributes.position.needsUpdate = true; 
                    this.geometry.attributes.color.needsUpdate = true;
                    this.geometry.attributes.life.needsUpdate = true;
                } else { 
                    this.activeMorph = gsap.to(this.originalPositions, { endArray: targetPositions, duration: 2.0, ease: "power3.inOut" }); 
                }
            }

            setParticleMode(asParticles, activeTheme) {
                const themeMaterial = SACRED_GEOMETRY_LIBRARY[activeTheme]?.material || 'neural';
                const shouldUseParticles = asParticles || themeMaterial === 'nebula';

                // Harmoni-fix: Omstrukturerad och förenklad logik för att garantera att alla teman kan bli partiklar.
                if (shouldUseParticles) {
                    this.isParticleSystem = true;
                    this.setMaterial('nebula');
                } else {
                    this.isParticleSystem = false;
                    this.setMaterial(themeMaterial);
                }
            }

            setMorph(fromKey, toKey, progress) {
                const fromGeo = this.geometries[fromKey.toLowerCase()];
                const toGeo = this.geometries[toKey.toLowerCase()];
                if (!fromGeo || !toGeo) return;

                const vertexCount = this.originalPositions.length / 3;

                if (this.isParticleSystem) {
                    // Particle system morphing logic
                    if (!this.geometry.attributes.morphTarget) {
                        this.geometry.setAttribute('morphTarget', new THREE.BufferAttribute(new Float32Array(vertexCount * 3), 3));
                    }

                    const startArray = this.geometry.attributes.position.array;
                    const targetArray = this.geometry.attributes.morphTarget.array;
                    const colorArray = this.geometry.attributes.color.array;
                    const fromColors = fromGeo.attributes.color.array;

                    for (let i = 0; i < vertexCount; i++) {
                        const fromIndex = (i % fromGeo.attributes.position.count) * 3;
                        const toIndex = (i % toGeo.attributes.position.count) * 3;
                        
                        startArray[i * 3]     = fromGeo.attributes.position.array[fromIndex];
                        startArray[i * 3 + 1] = fromGeo.attributes.position.array[fromIndex + 1];
                        startArray[i * 3 + 2] = fromGeo.attributes.position.array[fromIndex + 2];

                        targetArray[i * 3]     = toGeo.attributes.position.array[toIndex];
                        targetArray[i * 3 + 1] = toGeo.attributes.position.array[toIndex + 1];
                        targetArray[i * 3 + 2] = toGeo.attributes.position.array[toIndex + 2];

                        const fromColorIndex = (i % fromGeo.attributes.color.count) * 3;
                        colorArray[i * 3]     = fromColors[fromColorIndex];
                        colorArray[i * 3 + 1] = fromColors[fromColorIndex + 1];
                        colorArray[i * 3 + 2] = fromColors[fromColorIndex + 2];
                    }

                    this.geometry.attributes.position.needsUpdate = true;
                    this.geometry.attributes.morphTarget.needsUpdate = true;
                    this.geometry.attributes.color.needsUpdate = true;
                    this.mesh.material.uniforms.morphProgress.value = progress;
                } else {
                    // Solid geometry morphing logic (physics-based)
                    const fromPos = fromGeo.attributes.position.array;
                    const toPos = toGeo.attributes.position.array;
                    
                    for (let i = 0; i < vertexCount; i++) {
                        const fromIndex = (i % fromGeo.attributes.position.count) * 3;
                        const toIndex = (i % toGeo.attributes.position.count) * 3;

                        const x = fromPos[fromIndex] * (1 - progress) + toPos[toIndex] * progress;
                        const y = fromPos[fromIndex + 1] * (1 - progress) + toPos[toIndex + 1] * progress;
                        const z = fromPos[fromIndex + 2] * (1 - progress) + toPos[toIndex + 2] * progress;
                        
                        this.originalPositions[i * 3] = x;
                        this.originalPositions[i * 3 + 1] = y;
                        this.originalPositions[i * 3 + 2] = z;
                    }
                }
            }
        }
    
    // Anti-Fragile Initialization Sequence
        try {
            window.UnifiedGeometryManager = new UnifiedGeometryManager();
            window.UnifiedGeometryManager.init();

            if (!window.UnifiedGeometryManager.initializationFailed) {
                new RitbordetManager().init();
                new GalleryManager().init();
                
                // NEW: Initialize Starfall Manager
                window.StarfallManager = new StarfallManager();
            } else {
                throw new Error("Kritisk visuell komponent (UnifiedGeometryManager) misslyckades att initiera. Faller tillbaka till grundläggande funktionalitet.");
            }
        } catch (error) {
            console.error("Total systemharmoni kunde inte uppnås:", error);
            logToExternalService(error, "GlobalInitialization");
        }

        window.nord.handleHeaderLogoClick = (event) => {
            event.preventDefault();

            // Använd Tailwind md breakpoint (768px)
            if (window.innerWidth < 768) {
                const mobileMenu = document.getElementById('mobile-menu');
                const logoLink = document.getElementById('header-logo-link');
                if (!mobileMenu || !logoLink) return;

                mobileMenu.classList.toggle('open');
                logoLink.classList.toggle('menu-open', mobileMenu.classList.contains('open'));
                
                if (mobileMenu.classList.contains('open')) {
                    mobileMenu.style.maxHeight = mobileMenu.scrollHeight + "px";
                } else {
                    mobileMenu.style.maxHeight = '0px';
                }
            } else {
                window.nord.showPage('hero');
            }
        };

        window.nord.closeMobileMenu = () => {
             const mobileMenu = document.getElementById('mobile-menu');
             const logoLink = document.getElementById('header-logo-link');
             if(mobileMenu && logoLink) {
                mobileMenu.classList.remove('open');
                logoLink.classList.remove('menu-open');
                mobileMenu.style.maxHeight = '0px';
             }
        };
        window.nord.updateActiveLink = function(navId) {
            document.querySelectorAll('header nav a.nav-link, #mobile-menu a').forEach(link => {
                link.classList.remove('active');
                if (link.closest('#mobile-menu')) { link.classList.remove('bg-sky-700/50', 'nord-accent-text', 'font-semibold'); }
            });
            const activeLinks = document.querySelectorAll(`a[data-nav="${navId}"]`);
            activeLinks.forEach(link => {
                link.classList.add('active');
                if (link.closest('#mobile-menu')) { link.classList.add('bg-sky-700/50', 'nord-accent-text', 'font-semibold'); }
            });
        };
        
        // Uppdaterad sidladdning och popstate-hantering
        window.addEventListener('popstate', (event) => {
            const page = (event.state && event.state.page) ? event.state.page : 'hero';
            window.nord.showPage(page, true);
        });

        window.addEventListener('load', () => { 
            const hash = window.location.hash.substring(1); 
            const initialPage = pageConfig[hash] ? hash : 'hero';

            // Sätt initial historik-status korrekt
            history.replaceState({ page: initialPage }, '', '#' + initialPage);

            // Visa sidan utan att skapa en ny historik-post
            window.nord.showPage(initialPage, true);
        });
        
        // --- DYNAMIC WAITLIST SYSTEM ---
        const productWaitlistConfig = {
            beaver: {
                icon: 'ph-person-arms-spread', // Construction/Worker metaphor
                title: 'Beaver - Byggbranschens Verktyg',
                desc: 'Beaver är vårt system för byggbranschen. Vi håller på att färdigställa den interaktiva demon.',
                subject: 'Intresseanmälan: Beaver'
            },
            flownode: {
                icon: 'ph-arrows-split', // Workflow/Orchestration metaphor
                title: 'FlowNode - AI Agent Orchestration',
                desc: 'Vi utvecklar en visuell workflow-builder för att orkestrera AI-agenter. Målet är att förenkla skapandet av komplexa flöden mellan modeller och API:er.',
                subject: 'Intresseanmälan: FlowNode'
            },
            seo: {
                icon: 'ph-magnifying-glass', // Search/Analysis metaphor
                title: 'SEO Hälsovakt - Kampanj',
                desc: 'Vi bjuder på tekniska analyser fram till 1:a januari. Skriv upp dig nu så kör vi en fullständig scan av er webbplats manuellt och skickar rapporten.',
                subject: 'Beställning: Gratis SEO-Analys',
                linkText: 'Tjuvkika på verktyget (Live Demo) →',
                linkUrl: 'https://nordsym.github.io/Nordsym-Seo-Halsovakt/'
            }
        };

        window.nord.openDynamicWaitlist = function(productKey) {
            const config = productWaitlistConfig[productKey];
            if (!config) {
                console.warn(`[NordSym] Okänd produktnyckel för väntelista: ${productKey}`);
                return;
            }

            // Uppdatera innehåll
            const iconEl = document.getElementById('modal-waitlist-icon');
            const titleEl = document.getElementById('modal-waitlist-title');
            const descEl = document.getElementById('modal-waitlist-desc');
            const subjectEl = document.getElementById('modal-waitlist-subject');
            const linkEl = document.getElementById('modal-waitlist-link');

            if (iconEl) iconEl.className = `${config.icon} text-4xl text-nord-sym-cyan mb-4`;
            if (titleEl) titleEl.textContent = config.title;
            if (descEl) descEl.textContent = config.desc;
            if (subjectEl) subjectEl.value = config.subject;

            // Hantera extern länk (Tjuvkika)
            if (linkEl) {
                if (config.linkUrl && config.linkText) {
                    linkEl.href = config.linkUrl;
                    linkEl.textContent = config.linkText;
                    linkEl.classList.remove('hidden');
                } else {
                    linkEl.classList.add('hidden');
                }
            }

            // Öppna modalen (återanvänder befintlig logik)
            window.nord.openComingSoonModal();
        };

        // --- MODAL-LOGIK FÖR KOMMER SNART ---
        window.nord.openComingSoonModal = function() {
            const modal = document.getElementById('coming-soon-modal');
            if (modal) {
                document.body.style.overflow = 'hidden';
                modal.classList.add('visible');
            }
        };

        window.nord.closeComingSoonModal = function() {
            const modal = document.getElementById('coming-soon-modal');
            if (modal) {
                document.body.style.overflow = '';
                modal.classList.remove('visible');
            }
        };

        const comingSoonModal = document.getElementById('coming-soon-modal');
        if (comingSoonModal) {
            comingSoonModal.addEventListener('click', function(event) {
                // Om klicket sker på den halvtransparenta bakgrunden, stäng rutan.
                if (event.target === comingSoonModal) {
                    window.nord.closeComingSoonModal();
                }
            });
        }
        
        // --- MODAL-LOGIK FÖR GRATIS AGENT ---
        window.nord.openFreeAgentModal = function() {
            const modal = document.getElementById('free-agent-modal');
            if (modal) {
                document.body.style.overflow = 'hidden';
                modal.classList.add('visible');
            }
        };

        window.nord.closeFreeAgentModal = function() {
            const modal = document.getElementById('free-agent-modal');
            if (modal) {
                document.body.style.overflow = '';
                modal.classList.remove('visible');
            }
        };

        const freeAgentModal = document.getElementById('free-agent-modal');
        if (freeAgentModal) {
            freeAgentModal.addEventListener('click', function(event) {
                // Om klicket sker på den halvtransparenta bakgrunden, stäng rutan.
                if (event.target === freeAgentModal) {
                    window.nord.closeFreeAgentModal();
                }
            });
        }
        
        new FormManager('formSkraddarsydd', 'xqabggao');
        new FormManager('jobApplicationForm', 'xblypplz');
        // NY: Koppla vänteliste-formuläret (Återanvänder kontakt-ID tills vidare)
        new FormManager('waitlistForm', 'xqabggao'); 
        
        new ChatManager(); // Instantiate the new chat manager
        new ThemeManager(); // <-- NY TEMAHANTERARE
        new CookieManager(); // <-- NY COOKIE MANAGER

        // --- NYTT: STEG 1.1 & STEG 2 (Återställning) ---
        // Exponerar spel-managern globalt
        window.aiFirstGameManager = new AIFirstGameManager();
        window.aiFirstGameManager.init();
        // --- SLUT PÅ STEG 1.1 & 2 ---

        document.getElementById('currentYear').textContent = new Date().getFullYear();
    });

    class ThemeManager {
        constructor() {
            this.themeToggleBtns = document.querySelectorAll('.theme-toggle-btn');
            this.body = document.body;
            // UPPDATERAD: 'light' är nu standard om inget val sparats
            this.currentTheme = localStorage.getItem('theme') || 'light';
            
            this.init();
        }

        init() {
            // Sätt det sparade temat direkt vid laddning
            this.setTheme(this.currentTheme);

            // Lägg till klick-lyssnare på båda knapparna
            this.themeToggleBtns.forEach(btn => {
                btn.addEventListener('click', () => this.toggleTheme());
            });
            
            // Meddela UnifiedGeometryManager om det initiala temat
            // Vi lägger en liten fördröjning för att säkerställa att three.js har initierats
            setTimeout(() => {
                if (window.UnifiedGeometryManager) {
                    window.UnifiedGeometryManager.setGlobalTheme(this.currentTheme);
                }
            }, 100);
        }

        toggleTheme() {
            const newTheme = this.body.classList.contains('light-theme') ? 'dark' : 'light';
            this.setTheme(newTheme);
        }

        setTheme(theme) {
            // Ta bort gammal klass, lägg till ny
            this.body.classList.remove('light-theme', 'dark-theme');
            this.body.classList.add(`${theme}-theme`);
            
            // Spara valet
            localStorage.setItem('theme', theme);
            this.currentTheme = theme;

            // Meddela UnifiedGeometryManager om ändringen
            if (window.UnifiedGeometryManager) {
                window.UnifiedGeometryManager.setGlobalTheme(theme);
            }

            // Uppdatera ikon på båda knapparna
            const iconClass = theme === 'light' ? 'ph-moon' : 'ph-sun';
            this.themeToggleBtns.forEach(btn => {
                btn.innerHTML = `<i class="ph ${iconClass}"></i>`;
            });

            // Uppdatera aria-label för tillgänglighet
            const newLabel = theme === 'light' ? 'Växla till mörkt tema' : 'Växla till ljust tema';
            this.themeToggleBtns.forEach(btn => {
                btn.setAttribute('aria-label', newLabel);
            });

            // Meddela UnifiedGeometryManager om ändringen (vi bygger denna funktion sen)
            // if (window.UnifiedGeometryManager) {
            //     window.UnifiedGeometryManager.setGlobalTheme(theme);
            // }
        }
    }

    class CookieManager {
        constructor() {
            this.banner = document.getElementById('cookie-consent');
            this.acceptBtn = document.getElementById('cookie-accept-btn');
            this.storageKey = 'nordsym_cookie_consent'; // Unik nyckel för NordSym
            
            if (this.banner && this.acceptBtn) {
                this.init();
            }
        }

        init() {
            // 1. Kolla om nyckeln saknas i localStorage
            if (!localStorage.getItem(this.storageKey)) {
                // 2. Visa bannern efter en liten fördröjning för snyggare UX
                setTimeout(() => {
                    this.banner.classList.add('visible');
                }, 1500);
            }

            // 3. Lyssna på klick
            this.acceptBtn.addEventListener('click', () => {
                this.acceptCookies();
            });
        }

        acceptCookies() {
            // Animera ut bannern
            this.banner.classList.remove('visible');
            
            // Spara godkännandet
            localStorage.setItem(this.storageKey, 'true');
            
            // Valfritt: Om vi hade Google Analytics eller liknande som krävde
            // explicit samtycke innan laddning, skulle vi initiera det här.
            // Just nu laddas GA/Clarity direkt, så detta är främst informativt (Soft opt-in).
        }
    }

    class RitbordetManager {
        constructor() {
            this.processCardsData = [
                { 
                    icon: 'ph-map-trifold', 
                    title: 'KARTLÄGGNING', 
                    description: 'Vi avkodar era värdeflöden och identifierar möjligheter för intelligent förstärkning.', 
                    isFlippable: true,
                    backside: {
                        title: 'Leveranser',
                        items: [
                            { icon: 'ph-graph', text: 'Värdeflödesanalys' },
                            { icon: 'ph-map-trifold', text: 'Systemkarta' },
                            { icon: 'ph-check-square', text: 'Roadmap för Transformation' }
                        ]
                    }
                },
                { 
                    icon: 'ph-compass-tool', 
                    title: 'ARKITEKTUR', 
                    description: 'Vi designar intelligenta system kalibrerade för era unika processer och affärslogik.', 
                    isFlippable: true,
                    backside: {
                        title: 'Kärnkomponenter',
                        items: [
                            { icon: 'ph-brain', text: 'AI-Agent Design' },
                            { icon: 'ph-database', text: 'Datamodellering' },
                            { icon: 'ph-shield-check', text: 'Säkerhet & Skalbarhet' }
                        ]
                    }
                },
                { 
                    icon: 'ph-rocket-launch', 
                    title: 'AKTIVERING', 
                    description: 'Systemet integreras. Era processer förvandlas till lärande intelligens.', 
                    isFlippable: true,
                    backside: {
                        title: 'Resultat',
                        items: [
                            { icon: 'ph-rocket-launch', text: 'Driftsatt Ekosystem' },
                            { icon: 'ph-chart-line', text: 'Realtids-Dashboard' },
                            { icon: 'ph-arrows-clockwise', text: 'Kontinuerlig Evolution' }
                        ]
                    }
                }
            ];
            this.valueCardsData = [
                 { type: 'default', icon: 'ph-graph', title: 'TRANSFORMATION', description: 'Intelligenta system som växer med er verksamhet och möjliggör obegränsad skalning.', buttonText: 'Läs Caset →', externalLink: 'https://gushem.github.io/Landningsida-Nordsym-Klara-agent/' },
                 { type: 'default', icon: 'ph-atom', title: 'KÄRNKOMPONENTER', description: 'Distribuerad intelligens byggd på era affärsregler - system som förstår er branschlogik och utvecklas med den.', buttonText: 'Utforska Arkitekturen', page: 'system', tooltip: 'Vår motor för sömlös synkronisering av intelligens.' },
                 { type: 'pricing-preview', title: 'INVESTERING', price: '75k - 500k+', description: 'Från investering till intelligent evolution. Er framtidsförsäkring börjar här.', buttonText: 'Se Paket →', page: 'system' }
            ];
        }

        init() {
            // Harmoni-fix: Förenklad och robust logik. Skapa alltid innehållet för både desktop och mobil.
            // Låt CSS sköta synligheten via @media queries. Detta eliminerar komplex och felbenägen JS-logik.
            this.populateDesktopCards();
            this.renderMobileLayout();
        }

        populateDesktopCards() {
            const topContainer = document.getElementById('ritbordet-grid-top');
            const bottomContainer = document.getElementById('ritbordet-grid-bottom');
            if(!topContainer || !bottomContainer) return;
            
            topContainer.innerHTML = this.processCardsData.map(card => this.createCardHTML(card)).join('');
            bottomContainer.innerHTML = this.valueCardsData.map(card => this.createCardHTML(card)).join('');
        }
        
        createCardHTML(card) {
            // Harmoni-fix: Länken "Läs Caset" pekar nu mot den externa landningssidan.
            // Logiken har anpassats för att hantera både interna och externa länkar.
            let buttonHTML = '';
            if (card.buttonText) {
                if (card.externalLink) {
                    buttonHTML = `<a href="${card.externalLink}" target="_blank" rel="noopener noreferrer" class="btn-base btn-secondary-on-dark text-sm">${card.buttonText}</a>`;
                } else {
                    const clickHandler = `window.nord.showPage('hero'); setTimeout(() => document.getElementById('${card.page}').scrollIntoView({ behavior: 'smooth' }), 500);`;
                    buttonHTML = `<button onclick="${card.page === 'atom-gallery-section' ? clickHandler : `window.nord.showPage('${card.page}')`}" class="btn-base btn-secondary-on-dark text-sm">${card.buttonText}</button>`;
                }
            }
            
            // NYTT: Lägg till "vänd"-ikon om kortet är markerat som vändbart
            const flipIconHTML = card.isFlippable 
                ? `<i class="ph ph-arrows-clockwise absolute top-4 right-4 text-sky-600/70 text-xl transition-all group-hover:text-sky-400" aria-hidden="true"></i>`
                : '';

            if(card.type === 'pricing-preview') {
                return `<div class="ritbordet-card pricing-preview card-base group">
                            <i class="ph ph-tag"></i>
                            <h4>${card.title}</h4>
                            <div class="price-range">${card.price}</div>
                            <p>${card.description}</p>
                            ${buttonHTML}
                        </div>`;
            }

            // --- NYTT: Logik för vändbara kort ---
            if (card.isFlippable) {
                const backsideHTML = `
                    <div class="flip-card-back">
                        <h5>${card.backside.title}</h5>
                        <ul>
                            ${card.backside.items.map(item => `
                                <li><i class="ph ${item.icon}"></i> ${item.text}</li>
                            `).join('')}
                        </ul>
                        <!-- Ikon för att vända tillbaka, placerad på baksidan -->
                        <i class="ph ph-arrow-u-left-top absolute top-4 right-4 text-sky-600/70 text-xl transition-all group-hover:text-sky-400" aria-hidden="true"></i>
                    </div>
                `;

                const frontsideHTML = `
                    <div class="flip-card-front group"> <!-- 'group' flyttad hit för hover-effekt på ikon -->
                        ${flipIconHTML} <!-- Ikon för att vända -->
                        <i class="ph ${card.icon}"></i>
                        <h4>${card.title}</h4>
                        <p>${card.description}</p>
                        ${buttonHTML}
                    </div>
                `;

                return `<div class="ritbordet-card card-base flippable" onclick="this.classList.toggle('is-flipped')">
                            <div class="flip-card-inner">
                                ${frontsideHTML}
                                ${backsideHTML}
                            </div>
                        </div>`;
            }
            // --- Slut på vändbar logik ---

            return `<div class="ritbordet-card card-base group" ${card.tooltip ? `title="${card.tooltip}"` : ''}>
                        ${flipIconHTML} <!-- Här läggs ikonen till -->
                        <i class="ph ${card.icon}"></i>
                        <h4>${card.title}</h4>
                        <p>${card.description}</p>
                        ${buttonHTML}
                    </div>`;
        }

        renderMobileLayout() {
            const mobileContent = document.getElementById('mobile-lobby-content');
            if (!mobileContent) return;

            const allCards = [...this.processCardsData, ...this.valueCardsData];
            const mobileHTML = `<div class="ritbordet-grid">${allCards.map(c => this.createCardHTML(c)).join('')}</div>`;
            
            mobileContent.innerHTML = mobileHTML;
        }
    }

    /* --- NYTT: STARFALL MANAGER (CANVAS ENGINE) - CLEAN VERSION --- */
    class StarfallManager {
        constructor() {
            this.canvas = document.getElementById('starfall');
            if (!this.canvas) return;
            
            this.ctx = this.canvas.getContext('2d');
            this.stars = [];
            this.meteors = [];
            this.width = window.innerWidth;
            this.height = window.innerHeight;
            this.isMobile = window.innerWidth < 768;
            
            // Konfiguration
            this.config = {
                starCount: this.isMobile ? 150 : 400,
                meteorChance: 0.008, // Tillbaka till original-frekvens
                colors: {
                    star: '255, 255, 255',
                    meteorHead: '#00BFFF', // NordSym Cyan
                    meteorTrailEnd: 'rgba(0, 191, 255, 0)'
                }
            };

            this.init();
        }

        init() {
            this.handleResize();
            window.addEventListener('resize', () => this.handleResize());
            this.createStars();
            this.animate();
        }

        handleResize() {
            this.width = window.innerWidth;
            this.height = window.innerHeight;
            this.canvas.width = this.width;
            this.canvas.height = this.height;
            this.isMobile = this.width < 768;
            
            const targetCount = this.isMobile ? 150 : 400;
            if (this.stars.length < targetCount) {
                for (let i = this.stars.length; i < targetCount; i++) this.stars.push(this.createStar());
            } else if (this.stars.length > targetCount) {
                this.stars.length = targetCount;
            }
        }

        createStar() {
            return {
                x: Math.random() * this.width,
                y: Math.random() * this.height,
                size: Math.random() * 1.5 + 0.5,
                baseOpacity: Math.random() * 0.5 + 0.1,
                pulseSpeed: Math.random() * 0.02 + 0.005,
                pulseOffset: Math.random() * Math.PI * 2
            };
        }

        createStars() {
            this.stars = [];
            for (let i = 0; i < this.config.starCount; i++) {
                this.stars.push(this.createStar());
            }
        }

        createMeteor() {
            const startX = Math.random() * this.width * 1.5; 
            const startY = -150;
            return {
                x: startX, y: startY,
                length: Math.random() * 80 + 40,
                speed: Math.random() * 10 + 6,
                thickness: Math.random() * 1.5 + 0.5,
                angle: Math.PI / 4 + (Math.random() * 0.1 - 0.05),
                type: 'meteor'
            };
        }

        drawStars() {
            const time = Date.now();
            for (let i = 0; i < this.stars.length; i++) {
                const star = this.stars[i];
                const pulse = Math.sin(time * 0.002 * star.pulseSpeed + star.pulseOffset);
                const currentOpacity = star.baseOpacity + (pulse * 0.2);
                this.ctx.fillStyle = `rgba(${this.config.colors.star}, ${Math.max(0, Math.min(1, currentOpacity))})`;
                this.ctx.fillRect(star.x, star.y, star.size, star.size);
            }
        }

        updateAndDrawMeteors() {
            if (Math.random() < this.config.meteorChance && this.meteors.length < 5) {
                this.meteors.push(this.createMeteor());
            }
            for (let i = this.meteors.length - 1; i >= 0; i--) {
                const m = this.meteors[i];
                m.x -= m.speed * Math.cos(m.angle); 
                m.y += m.speed * Math.sin(m.angle);
                const tailX = m.x + m.length * Math.cos(m.angle);
                const tailY = m.y - m.length * Math.sin(m.angle);
                const gradient = this.ctx.createLinearGradient(m.x, m.y, tailX, tailY);
                gradient.addColorStop(0, this.config.colors.meteorHead); 
                gradient.addColorStop(1, this.config.colors.meteorTrailEnd);
                this.ctx.strokeStyle = gradient;
                this.ctx.lineWidth = m.thickness;
                this.ctx.lineCap = 'round';
                this.ctx.beginPath();
                this.ctx.moveTo(m.x, m.y);
                this.ctx.lineTo(tailX, tailY);
                this.ctx.stroke();
                if (m.y > this.height + 200 || m.x < -200) this.meteors.splice(i, 1);
            }
        }

        animate() {
            this.ctx.clearRect(0, 0, this.width, this.height);
            this.drawStars();
            this.updateAndDrawMeteors();
            requestAnimationFrame(() => this.animate());
        }
    }

    class GalleryManager {
        constructor() {
            this.isInitialMobileLoad = true; // HARMONI-FIX: Flagga för att förhindra initial scroll.
            this.paginationContainer = document.getElementById('galleryPagination');
            this.lastCardsPerPage = 0; // To track resize changes
            
            // --- DATAHARMONISERING START ---
            // BORTTAGEN: Den gamla monolitiska galleryData
            
            // NYTT: Data uppdelad i två källor
            this.komponenterData = [
                {
                    icon: 'ph-robot',
                    title: 'AI-Agenter',
                    description: 'Vi designar autonoma AI-agenter för allt från research till kunddialog. De kan integreras i ett större ekosystem eller driftsättas som kraftfulla, fristående lösningar.',
                    signatures: [
                        { icon: 'ph-brain', text: 'Intelligens' },
                        { icon: 'ph-chats-circle', text: 'Dialog' },
                        { icon: 'ph-file-search', text: 'Research' }
                    ],
                    indicator: 'Bygger på en hybridarkitektur: kraften från branschledande automationssystem och precisionen från våra egna, egenutvecklade ramverk.',
                    ctaText: 'Designa en gratis agent',
                    ctaIcon: 'ph-pencil-line',
                    ctaAction: 'openFreeAgentModal'
                },
                {
                    icon: 'ph-chart-pie-slice', // <-- ÄNDRAD IKON
                    title: 'AI-First Arkitektur', // <-- ÄNDRAD
                    description: 'Designar system där AI inte är ett tillägg, utan kärnan. Varje process och datapunkt utvärderas för sin potential att tränas, automatiseras eller agera autonomt.', // <-- ÄNDRAD
                     signatures: [ // <-- ÄNDRAD (anpassad till objektformat)
                        { icon: 'ph-brain', text: 'Kärnlogik' },
                        { icon: 'ph-compass-tool', text: 'Agent-design' },
                        { icon: 'ph-sparkle', text: 'Proaktivt' }
                    ],
                    indicator: 'Arkitektur', // <-- ÄNDRAD
                    indicatorColor: 'text-rose-400' // <-- NY EGENSKAP
                },
                {
                    icon: 'ph-cube', // <-- ÄNDRAD (Bytt från 'ph-server' för att garantera rendering)
                    title: 'Model Context Protocol', // <-- Behållen
                    description: 'Vår interna arkitektur för att hantera och \'streama\' kontext mellan AI-modeller. Vi bygger och driftar egna MCP-servrar som säkerställer att agenter har delat, persistent minne oavsett vilken AI-modell som anropas.', // <-- Behållen
                    signatures: [ // <-- ÄNDRAD
                        { icon: 'ph-database', text: 'Persistent Minne' },
                        { icon: 'ph-arrows-split', text: 'Kontext-flöde' },
                        { icon: 'ph-check-circle', text: 'Modell-oberoende' } // <-- ÄNDRAD (Bytt från 'ph-pluggable')
                    ],
                    indicator: 'Kärnprotokoll' // <-- Behållen
                },
                {
                    icon: 'ph-layout',
                    title: 'Intelligenta Gränssnitt',
                    description: 'Vi bygger skräddarsydda webbapplikationer och intelligenta dashboards som ger era team och kunder full kontroll över era nya AI-system.',
                     signatures: [
                        { icon: 'ph-palette', text: 'Design' },
                        { icon: 'ph-chart-line', text: 'Data' },
                        { icon: 'ph-user-focus', text: 'Upplevelse' }
                    ],
                    indicator: 'Från interaktiva dashboards till fullskaliga SaaS-plattformar.'
                },
                {
                    icon: 'ph-arrows-clockwise',
                    title: 'Intelligent Automation',
                    description: 'Vi kartlägger och transformerar era kärnprocesser. Genom att koppla samman era befintliga system med AI-agenter skapar vi självgående flöden som eliminerar manuellt arbete.',
                     signatures: [
                        { icon: 'ph-map-trifold', text: 'Kartläggning' },
                        { icon: 'ph-plugs-connected', text: 'Integration' },
                        { icon: 'ph-timer', text: 'Effektivitet' }
                    ],
                    indicator: 'Optimerar allt från säljstöd (CRM) till intern administration.'
                },
                {
                    icon: 'ph-database',
                    title: 'Data & Insikter',
                    description: 'Vi bygger system som inte bara samlar in, utan också förstår och agerar på er data. Från automatiserad research till att omvandla rådata till strategiska, prediktiva insikter.',
                    signatures: [
                        { icon: 'ph-magnifying-glass', text: 'Analys' },
                        { icon: 'ph-chart-line-up', text: 'Prediktion' },
                        { icon: 'ph-presentation-chart', text: 'Rapportering' }
                    ],
                    indicator: 'Levererar sammansatt intelligens från 20+ modeller för dataanalys.'
                },
                {
                    icon: 'ph-books',
                    title: 'Dynamiska Kunskapsbaser',
                    description: 'Vi bygger system som inte bara utför uppgifter, utan som aktivt samlar in, strukturerar och förädlar er interna kunskap. Vi skapar ett levande företagsminne som gör hela organisationen smartare.',
                    signatures: [
                        { icon: 'ph-download-simple', text: 'Insamling' },
                        { icon: 'ph-list-dashes', text: 'Strukturering' },
                        { icon: 'ph-brain', text: 'Resonemang' }
                    ],
                    indicator: 'Från spridd data till ett centraliserat, intelligent \'företagsminne\'.'
                },
                {
                    icon: 'ph-shield-check',
                    title: 'Evolution & Säkerhet',
                    description: 'Ett intelligent system måste vara säkert. Vi bygger självreparerande och säkra arkitekturer med proaktiv övervakning, åtkomstkontroll och en plan för kontinuerlig evolution.',
                    signatures: [
                        { icon: 'ph-lock', text: 'Säkerhet' },
                        { icon: 'ph-binoculars', text: 'Övervakning' },
                        { icon: 'ph-graph', text: 'Skalbarhet' }
                    ],
                    indicator: 'Byggt för 99.9% drifttid och proaktivt hotförsvar.'
                }
                // BORTTAGNA: De två sista teaser-korten flyttas till 'arketyperData'
            ];

            this.arketyperData = [
                {
                    imageUrl: 'https://raw.githubusercontent.com/GusHem/Logga-utan-text/refs/heads/main/Final%20logo%20no%20text.svg',
                    title: 'FlowVault', 
                    description: 'Ett kurerat bibliotek av produktionsfärdiga n8n-flöden. Från komplexa svenska integrationer (Fortnox, BankID, Skatteverket) till avancerade AI-svärmar. Hämta verifierade blåkopior och accelerera er utvecklingstakt drastiskt.',
                    signatures: [
                        { icon: 'ph-stack', text: 'Svenska API:er' },
                        { icon: 'ph-robot', text: 'AI-Svärmar' },
                        { icon: 'ph-lock-open', text: 'Open Source' }
                    ],
                    indicator: 'Automatisera snabbare. Sluta bygga om hjulet.',
                    ctaText: 'Öppna Valvet', 
                    ctaIcon: 'ph-arrow-square-out',
                    ctaLink: 'https://nordsym.github.io/flowvault/'
                },
                {
                    imageUrl: 'https://raw.githubusercontent.com/GusHem/Logga-utan-text/refs/heads/main/Final%20logo%20no%20text.svg',
                    title: 'Syns du i AI-Sök?',
                    description: 'Från SEO till AEO. Optimera din digitala närvaro för AI-sökmotorer som ChatGPT, Claude och Perplexity. Vi transformerar din webbplats från en statisk sida till en källa som AI-motorer litar på och citerar.',
                    signatures: [
                        { icon: 'ph-brain', text: 'AEO & GEO' },
                        { icon: 'ph-robot', text: 'ChatGPT Ready' },
                        { icon: 'ph-globe-hemisphere-east', text: 'Auktoritet' }
                    ],
                    indicator: 'Är ditt varumärke redo för framtidens sök?',
                    ctaText: 'Gör Gratis Analys',
                    ctaIcon: 'ph-sparkle',
                    ctaLink: 'https://nordsym.github.io/aeo-platform/'
                },
                {
                    imageUrl: 'https://raw.githubusercontent.com/GusHem/NordSym-Logga/refs/heads/main/B%C3%A4ver%20byggledare.svg',
                    title: 'Beaver',
                    description: 'Vi testar ett verktyg för byggbranschen som förenklar administration. Demo kommer snart – skriv upp dig för tidig access.',
                    signatures: [
                        { icon: 'ph-calendar-check', text: 'Planering' },
                        { icon: 'ph-truck', text: 'Logistik' },
                        { icon: 'ph-chart-line-up', text: 'Effektivitet' }
                    ],
                    indicator: 'Designad för att automatisera administration och frigöra tid för själva bygget.',
                    ctaText: 'Få Tidig Access',
                    ctaIcon: 'ph-play-circle',
                    ctaAction: 'openDynamicWaitlist',
                    ctaActionParam: 'beaver'
                },
                {
                    imageUrl: 'https://raw.githubusercontent.com/GusHem/NordSym-Logga/refs/heads/main/Klara%20avatar%20closeup%20v.3.svg',
                    title: 'Klara', 
                    description: 'Ett specialiserat AI-ekosystem för catering. Klara hanterar hela kedjan: från inkommande förfrågningar och offerering till inköpsunderlag och logistik. En autonom kollega som låter er fokusera på hantverket och gästen.',
                    signatures: [
                        { icon: 'ph-file-text', text: 'Offert & Admin' },
                        { icon: 'ph-fork-knife', text: 'Menyplanering' },
                        { icon: 'ph-truck', text: 'Logistik' }
                    ],
                    indicator: 'En specialiserad AI-agent för event- och restaurangbranschen.',
                    ctaText: 'Utforska Klara',
                    ctaIcon: 'ph-play-circle',
                    ctaLink: 'https://nordsym.github.io/Landningsida-Nordsym-Klara-agent/'
                },
                {
                    imageUrl: 'https://raw.githubusercontent.com/GusHem/NordSym-Logga/refs/heads/main/Gra%CC%88vling%20flownode%20avatar.svg',
                    title: 'FlowNode',
                    description: 'Vi utvecklar en visuell workflow-builder för AI-automationer. Målet är att låta er bygga komplexa flöden mellan modeller och API:er utan kod.',
                    signatures: [
                        { icon: 'ph-arrows-split', text: 'Orkestrering' },
                        { icon: 'ph-plugs-connected', text: 'Integration' },
                        { icon: 'ph-brain', text: 'Logik' }
                    ],
                    indicator: 'Möjliggör portabilitet och framtidssäkrar er tekniska arkitektur.',
                    ctaText: 'Få Tidig Access',
                    ctaIcon: 'ph-play-circle',
                    ctaAction: 'openDynamicWaitlist',
                    ctaActionParam: 'flownode'
                },
                // NYA TILLAGDA KORT (Flyttade från Byggstenar)
                {
                    teaser: true,
                    icon: 'ph-lock-simple',
                    title: 'Nästa Generations AI-Kärna',
                    description: 'En ny nivå av autonomi och proaktiv intelligens, designad för att förutse och agera på framtida behov.',
                    indicator: 'Lansering Q2 2026'
                },
                {
                    teaser: true,
                    icon: 'ph-puzzle-piece',
                    title: 'Adaptiva Gränssnitt',
                    description: 'Revolutionerande UI som anpassar sig i realtid efter användarens unika kontext, mål och arbetsflöde.',
                    indicator: 'Lansering Q3 2026'
                }
            ];

            this.dataSources = {
                'byggstenar': this.komponenterData,
                'galleri': this.arketyperData
            };
            
            // ÄNDRING: Refaktorisera textSources till objekt
            this.textSources = {
                'byggstenar': {
                    description: 'Dessa är de beprövade grundelementen i vår arkitektur. Med dessa komponenter bygger vi allt från fokuserade Micro-SaaS-lösningar till fullskaliga, intelligenta arkitekturer.', // <-- JUSTERAD
                    context: 'Utforska byggstenarna'
                },
                'galleri': {
                    description: 'Här hittar du våra färdiga Produkter & Micro-SaaS. Kompletta, verifierade system byggda på vår arkitektur som genererar värde från dag ett.',
                    context: 'Utforska produkterna'
                }
            };
            
            this.currentView = 'byggstenar'; // Startvy
            // --- DATAHARMONISERING SLUT ---
            
            // BORTTAGEN: Den buggiga state-variabeln
            // this.lastPageCount = 0;
        }
        init() {
            this.populateGallery();
            this.setupGalleryControls(); // <-- Måste köras efter populate
            this.initGallerySwitch(); // <-- NYTT ANROP
        }
        populateGallery() {
            const wrapper = document.getElementById('galleryWrapper');
            if (!wrapper) return;
            
            // NY LOGIK: Hämta data från den aktiva källan
            const currentData = this.dataSources[this.currentView];
            wrapper.innerHTML = currentData.map(cardData => this.createCardHTML(cardData)).join('');

            // BORTTAGEN: Den gamla, buggiga "hack"-logiken
            // this.lastCardsPerPage = 0; 
            
            // ERSÄTTNING: Återställ status och uppdatera UI manuellt
            this.isInitialMobileLoad = true; // Förhindra mobil auto-scroll
            this.currentIndex = 0; // Återställ index till SIDA 0
            // this.lastCardsPerPage = 0; // BORTTAGEN
            this.updatePagination(); // Bygger om prickarna
            this.updateGallery(); // Uppdaterar position och knappstatus
        }
        createCardHTML(data) {
             const isTeaser = data.teaser || false;
             const cardClasses = `archetype-card card-base ${isTeaser ? 'teaser' : ''}`;

             let ctaButton = '';
             if (data.ctaText) {
                const isExternal = data.ctaLink && data.ctaLink.startsWith('http');
                const pageId = data.ctaLink && data.ctaLink.startsWith('#') ? data.ctaLink.substring(1) : data.ctaLink;
                const action = data.ctaAction;

                const iconHTML = `<i class="ph ${data.ctaIcon || 'ph-arrow-square-out'}"></i>`;
                const textHTML = `<span>${data.ctaText}</span>`;
                
                if (action) {
                     // DYNAMIC ACTION HANDLER: Support for parameters
                     const param = data.ctaActionParam ? `'${data.ctaActionParam}'` : '';
                     ctaButton = `<a href="#" onclick="event.preventDefault(); window.nord['${action}'](${param});" class="archetype-cta btn-base">${iconHTML}${textHTML}</a>`;
                } else if (isExternal) {
                    ctaButton = `<a href="${data.ctaLink}" target="_blank" rel="noopener noreferrer" class="archetype-cta btn-base">${iconHTML}${textHTML}</a>`;
                } else if (pageId) {
                    ctaButton = `<a href="${data.ctaLink}" onclick="event.preventDefault(); window.nord.showPage('${pageId}');" class="archetype-cta btn-base">${iconHTML}${textHTML}</a>`;
                }
             }
            
            const signaturesHTML = data.signatures ? `
                <div class="tech-signature-container">
                    ${data.signatures.map(sig => `
                        <div class="tech-signature-item">
                            <i class="ph ${sig.icon}"></i>
                            <span>${sig.text}</span>
                        </div>
                    `).join('')}
                </div>
            ` : '';

            const imageOrIconHTML = data.imageUrl 
                ? `<img src="${data.imageUrl}" alt="${data.title} Avatar" class="avatar-image">`
                : `<i class="ph ${data.icon}"></i>`;

             return `
                <div class="${cardClasses}">
                    ${imageOrIconHTML}
                    <h4>${data.title}</h4>
                    <p class="description">${data.description}</p>
                    ${signaturesHTML}
                    ${ctaButton}
                    <p class="indicator ${data.indicatorColor || ''}">${data.indicator}</p>
                </div>
            `;
        }

        // --- NY FUNKTION START ---
        initGallerySwitch() {
            const btnByggstenar = document.getElementById('gallery-switch-byggstenar');
            const btnGalleri = document.getElementById('gallery-switch-galleri');
            const slider = document.getElementById('gallery-switch-slider');

            if (!btnByggstenar || !btnGalleri || !slider) return;

            const updateSwitchUI = (activeBtn, inactiveBtn) => {
                // Flytta slidern
                slider.style.width = `${activeBtn.offsetWidth}px`;
                slider.style.left = `${activeBtn.offsetLeft}px`;

                // Uppdatera textfärger
                activeBtn.classList.remove('inactive', 'text-sky-200', 'hover:text-white');
                activeBtn.classList.add('active', 'text-nord-sym-deep-space-blue');

                inactiveBtn.classList.remove('active', 'text-nord-sym-deep-space-blue');
                inactiveBtn.classList.add('inactive', 'text-sky-200', 'hover:text-white');
            };

            // Sätt initialt läge (körs efter en kort fördröjning för att låta DOM renderas)
            setTimeout(() => {
                const activeBtn = document.querySelector('.gallery-switch-btn.active') || btnByggstenar;
                const inactiveBtn = activeBtn === btnByggstenar ? btnGalleri : btnByggstenar;
                updateSwitchUI(activeBtn, inactiveBtn);
            }, 100);

            // Lägg till klick-lyssnare
            btnByggstenar.addEventListener('click', () => {
                if (btnByggstenar.classList.contains('active')) return;
                updateSwitchUI(btnByggstenar, btnGalleri);
                // NYTT: Anropa logik för att byta vy
                this.switchView('byggstenar');
            });

            btnGalleri.addEventListener('click', () => {
                if (btnGalleri.classList.contains('active')) return;
                updateSwitchUI(btnGalleri, btnByggstenar); // KORRIGERAD: Rätt ordning
                // NYTT: Anropa logik för att byta vy
                this.switchView('galleri');
            });
        }
        // --- NY FUNKTION SLUT ---

        // --- NY FUNKTION START (ÅTERSTÄLLD FRÅN PLANEN) ---
        // Denna funktion saknades, vilket orsakade 'TypeError'
        switchView(viewName) {
            if (this.currentView === viewName || !gsap) return;
            this.currentView = viewName;
            
            const wrapper = document.getElementById('galleryWrapper');
            const descriptionText = document.getElementById('gallery-description-text');
            const contextText = document.getElementById('gallery-context-text');
            
            const oldCards = gsap.utils.toArray('#galleryWrapper .archetype-card');
            const newTexts = this.textSources[viewName];

            // 1. Animera ut texter
            gsap.to([descriptionText, contextText], {
                opacity: 0,
                duration: 0.3,
                ease: 'power2.in',
                onComplete: () => {
                    // 2. Uppdatera texter när de är dolda
                    descriptionText.textContent = newTexts.description;
                    contextText.textContent = newTexts.context;
                    
                    // 3. Animera in texter
                    gsap.to([descriptionText, contextText], {
                        opacity: 1,
                        duration: 0.4,
                        delay: 0.5, // Vänta tills korten börjar vända in
                        ease: 'power2.out'
                    });
                }
            });

            // 4. Animera ut gamla kort med stagger
            gsap.to(oldCards, {
                rotateY: -90,
                opacity: 0,
                duration: 0.35,
                stagger: 0.07, // Liten fördröjning mellan varje kort
                ease: 'power2.in',
                onComplete: () => {
                    // 5. Byt innehåll
                    this.isInitialMobileLoad = true; // Förhindra mobil auto-scroll
                    this.currentIndex = 0; // Återställ index
                    this.lastCardsPerPage = 0; // Tvinga paginering att ritas om
                    this.populateGallery(); // Bygger om HTML med ny data
                    
                    const newCards = gsap.utils.toArray('#galleryWrapper .archetype-card');
                    
                    // 6. Sätt starttillstånd för nya kort (vända 90 grader)
                    gsap.set(newCards, { rotateY: 90, opacity: 0 });
                    
                    // 7. Animera in nya kort med stagger
                    gsap.to(newCards, {
                        rotateY: 0,
                        opacity: 1,
                        duration: 0.45,
                        stagger: 0.07,
                        delay: 0.2, // Liten paus innan de vänds in
                        ease: 'power2.out'
                    });
                }
            });
        }
        // --- NY FUNKTION SLUT ---

        // ÄNDRING: Helt omstrukturerad för att hantera "stale closures"
        // Logiken är utbruten till klassmetoder, setup körs bara en gång.
        setupGalleryControls() {
            const galleryWrapper = document.getElementById('galleryWrapper'),
                nextBtn = document.getElementById('galleryNext'),
                prevBtn = document.getElementById('galleryPrev');
            
            if (!galleryWrapper || !nextBtn || !prevBtn) return;

            // Lyssnare binds EN GÅNG till klassmetoderna
            nextBtn.addEventListener('click', () => this.next());
            prevBtn.addEventListener('click', () => this.prev());
            
            // Mobil scroll-hantering
            if (window.innerWidth <= 768) {
                let scrollTimeout;
                galleryWrapper.addEventListener('scroll', () => {
                    clearTimeout(scrollTimeout);
                    scrollTimeout = setTimeout(() => {
                        const cardWidth = galleryWrapper.children[0].offsetWidth;
                        const gap = 24;
                        this.currentIndex = Math.round(galleryWrapper.scrollLeft / (cardWidth + gap));
                        this.updateGallery();
                    }, 150);
                });
            }

            // Global resize-lyssnare
            window.addEventListener('resize', () => {
                this.isInitialMobileLoad = true;
                this.updatePagination(); // Bygg om paginering om antalet sidor ändras
                this.updateGallery(); // Uppdatera position och knappstatus
            });
        } // <-- FIX: DEN SAKNADE MÅSVINGEN FÖR setupGalleryControls()

        // NY KLASSMETOD: Logik för nästa kort (uppdaterad)
        next() {
            const cardsPerPage = this.getCardsPerPage();
            const currentTotalCards = this.dataSources[this.currentView].length;
            // KORRIGERAD: Logik baserad på pageCount
            const pageCount = Math.ceil(currentTotalCards / cardsPerPage);
            const maxPageIndex = pageCount - 1;
            
            if (this.currentIndex < maxPageIndex) {
                this.currentIndex++;
                this.updateGallery();
            }
        }

        // NY KLASSMETOD: Logik för föregående kort
        prev() {
            if (this.currentIndex > 0) {
                this.currentIndex--;
                this.updateGallery();
            }
        }
        // NY KLASSMETOD: Hämtar kort per sida (KORRIGERAD)
        getCardsPerPage() {
            if (window.innerWidth > 1024) return 3; // KORRIGERAD: 1280 -> 1024
            if (window.innerWidth > 768) return 2;
            return 1;
        }

        // NY KLASSMETOD: Bygger om pagineringsprickarna (KORRIGERAD)
        // BORTTAGEN: Den felaktiga, duplicerade 'updatePagination() {'-raden som orsakade SyntaxError har tagits bort härifrån.
        // NY KLASSMETOD: Bygger om pagineringsprickarna (KORRIGERAD OCH FÖRENKLAD)
        updatePagination() {
            if (!this.paginationContainer) return;
            const cardsPerPage = this.getCardsPerPage();
            const currentTotalCards = this.dataSources[this.currentView].length;
            const pageCount = Math.ceil(currentTotalCards / cardsPerPage);

            // KORRIGERAD: Den 'smarta' if-satsen är borttagen.
            // Vi ritar ALLTID om punkterna när denna funktion anropas
            // (vilket bara är vid 'switchView' eller 'resize').
            this.paginationContainer.innerHTML = '';
            
            if (pageCount <= 1) {
                return; // Inga prickar behövs för en sida
            }

            for (let i = 0; i < pageCount; i++) {
                const dot = document.createElement('button');
                    dot.classList.add('gallery-pagination-dot');
                    dot.setAttribute('aria-label', `Gå till sida ${i + 1}`);
                    dot.addEventListener('click', () => {
                        this.currentIndex = i; // Sätt nuvarande SIDA
                        this.updateGallery();
                    });
                this.paginationContainer.appendChild(dot);
            }
            
            // BORTTAGEN: `this.lastPageCount = pageCount;`
            
            // BORTTAGEN: Den redundanta "active dot"-logiken.
            // `updateGallery` anropas alltid efter `updatePagination`
            // och hanterar detta.
        }

        // NY KLASSMETOD: Uppdaterar galleriets position och knappstatus (KORRIGERAD)
        updateGallery() {
            const galleryWrapper = document.getElementById('galleryWrapper');
            const nextBtn = document.getElementById('galleryNext');
            const prevBtn = document.getElementById('galleryPrev');
            if (!galleryWrapper || !nextBtn || !prevBtn || !galleryWrapper.children.length) return;

            const cardsPerPage = this.getCardsPerPage();
            const currentTotalCards = this.dataSources[this.currentView].length;
            // KORRIGERAD: Logik baserad på pageCount
            const pageCount = Math.ceil(currentTotalCards / cardsPerPage);
            const maxPageIndex = pageCount - 1;
            
            if (this.currentIndex > maxPageIndex) this.currentIndex = maxPageIndex;
            if (this.currentIndex < 0) this.currentIndex = 0;

            const cardWidth = galleryWrapper.children[0]?.offsetWidth || 0;
            if (cardWidth === 0) return;
            
            const gap = window.innerWidth > 768 ? 32 : 24;

            if (window.innerWidth > 768) {
                // KORRIGERAD: Beräkna flytt baserat på SIDA (currentIndex)
                // istället för kort-index.
                const cardIndexToMoveTo = this.currentIndex * cardsPerPage;
                const totalMove = (cardWidth + gap) * cardIndexToMoveTo;
                
                // Vi måste begränsa sista sidans scroll
                const totalWidth = (cardWidth + gap) * currentTotalCards - gap;
                const viewportWidth = galleryWrapper.parentElement.offsetWidth;
                const maxScroll = Math.max(0, totalWidth - viewportWidth);
                
                // Om vi är på sista sidan, scrolla till max
                if (this.currentIndex === maxPageIndex) {
                     galleryWrapper.style.transform = `translateX(-${maxScroll}px)`;
                } else {
                     galleryWrapper.style.transform = `translateX(-${totalMove}px)`;
                }
                
            } else {
                if (!this.isInitialMobileLoad) {
                    const card = galleryWrapper.children[this.currentIndex];
                    if (card) {
                        const scrollTarget = card.offsetLeft;
                        galleryWrapper.scrollTo({ left: scrollTarget, behavior: 'smooth' });
                    }
                }
                this.isInitialMobileLoad = false;
            }

            prevBtn.classList.toggle('disabled', this.currentIndex === 0);
            nextBtn.classList.toggle('disabled', this.currentIndex >= maxPageIndex); // KORRIGERAD
            
            // Uppdatera pagineringsprickarnas status
            const dots = this.paginationContainer.querySelectorAll('.gallery-pagination-dot');
            dots.forEach((dot, index) => {
                dot.classList.toggle('active', index === this.currentIndex);
            });
        }
    }

    class ChatManager {
        constructor() {
            this.elements = {
                container: document.getElementById('chat-widget-container'),
                bubble: document.getElementById('chat-bubble'),
                window: document.getElementById('chat-window'),
                closeBtn: document.getElementById('chat-close-btn'),
                messages: document.getElementById('chat-messages'),
                input: document.getElementById('chat-input'),
                sendBtn: document.getElementById('chat-send-btn')
            };
            if (!this.elements.container) return; // Don't run if HTML isn't there
            this.isOpen = false;
            
            // NYTT: Lägg till sessionId-hantering
            this.sessionId = localStorage.getItem('nordsym_chat_session_id') || this.generateUUID();
            localStorage.setItem('nordsym_chat_session_id', this.sessionId);
            
            this.initEventListeners();
        }

        initEventListeners() {
            this.elements.bubble.addEventListener('click', () => this.toggleChat(true));
            this.elements.closeBtn.addEventListener('click', () => this.toggleChat(false));
            this.elements.sendBtn.addEventListener('click', () => this.sendMessage());
            this.elements.input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    this.sendMessage();
                }
            });
        }

        // NYTT: Enkel UUID-generator
        generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        toggleChat(forceOpen) {
            if (typeof forceOpen === 'boolean') {
                this.isOpen = forceOpen;
            } else {
                this.isOpen = !this.isOpen;
            }
            
            this.elements.window.classList.toggle('visible', this.isOpen);
            this.elements.bubble.classList.toggle('hidden', this.isOpen);
        }

        sendMessage() {
            const messageText = this.elements.input.value.trim();
            if (messageText === '') return;

            this.addMessage(messageText, 'user');
            this.elements.input.value = '';
            this.elements.input.focus();

            this.showTypingIndicator();
            
            // MODIFIED: Call getBotResponse directly, which is now async
            this.getBotResponse(messageText);
        }

        addMessage(text, sender) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('message', `${sender}-message`);
            
            const p = document.createElement('p');
            p.textContent = text;
            messageElement.appendChild(p);
            
            this.elements.messages.appendChild(messageElement);
            this.scrollToBottom();
        }

        showTypingIndicator() {
            const typingElement = document.createElement('div');
            typingElement.classList.add('message', 'bot-message', 'typing-indicator');
            typingElement.innerHTML = `<span></span><span></span><span></span>`;
            this.elements.messages.appendChild(typingElement);
            this.scrollToBottom();
        }

        removeTypingIndicator() {
            const indicator = this.elements.messages.querySelector('.typing-indicator');
            if (indicator) {
                indicator.remove();
            }
        }

        async getBotResponse(userInput) { // MODIFIED: Made async
            const webhookUrl = "https://nordsym.app.n8n.cloud/webhook/399ddc2e-9a3c-4b72-9757-079b730a782c/chat";

            try {
                const response = await fetch(webhookUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    // MODIFIERAD: Skicka med både meddelande och sessionId
                    body: JSON.stringify({ 
                        message: userInput,
                        sessionId: this.sessionId 
                    })
                });

                this.removeTypingIndicator(); // Remove typing indicator *after* fetch

                if (!response.ok) {
                    throw new Error(`Webhook response was not ok: ${response.statusText}`);
                }

                const data = await response.json();
                
                // MODIFIERAD: Parsa den nya, platta svarsstrukturen från n8n ("output")
                const responseText = data?.output;

                if (responseText) {
                    this.addMessage(responseText, 'bot');
                } else {
                    console.error('Oväntat svarsformat från n8n:', data);
                    this.addMessage("Kunde inte tolka svaret från assistenten. Försök igen.", 'bot');
                }

            } catch (error) {
                this.removeTypingIndicator(); // Se till att ta bort den även vid fel
                console.error("Fel vid anrop till webhook:", error);
                this.addMessage("Ursäkta, jag har problem med anslutningen just nu. Försök igen om en liten stund.", 'bot');
            }
        }

        scrollToBottom() {
            this.elements.messages.scrollTop = this.elements.messages.scrollHeight;
        }
    }

    class FormManager {
        constructor(formId, formspreeId) {
            this.formId = formId;
            this.formspreeId = formspreeId;
            this.formElement = document.getElementById(this.formId);
            if (!this.formElement) return;

            this.container = this.formElement.closest('.form-container');
            
            // HARMONI-FIX: Auto-detektering av formulärtyp (Wizard vs. Enkel)
            // Om inga .form-step hittas, behandla hela formuläret som ett enda steg.
            const detectedSteps = this.formElement.querySelectorAll('.form-step');
            this.steps = detectedSteps.length > 0 ? detectedSteps : [this.formElement];
            
            this.progressBar = this.container ? this.container.querySelector('.form-progress-bar-inner') : null;
            this.currentStep = 0;
            this.totalSteps = this.steps.length;

            this.init();
        }

        init() {
            this.setupEventListeners();
            this.updateProgress();
            // Säkerställ att första steget är aktivt (säkrad åtkomst)
            if (this.steps[0]) {
                this.steps[0].classList.add('active');
            }
        }

        setupEventListeners() {
            this.formElement.addEventListener('submit', this.handleSubmit.bind(this));
            
            this.formElement.querySelectorAll('.form-navigation button').forEach(button => {
                button.addEventListener('click', (e) => {
                    if (e.currentTarget.type === 'button') {
                        const isNext = e.currentTarget.textContent.includes('Nästa');
                        if (isNext) this.nextStep();
                        else this.prevStep();
                    }
                });
            });
        }

        changeStep(stepIndex) {
            const currentStepElement = this.steps[this.currentStep];
            const nextStepElement = this.steps[stepIndex];

            gsap.to(currentStepElement, {
                opacity: 0, 
                y: -10, 
                duration: 0.3, 
                ease: 'power2.in', 
                onComplete: () => {
                    currentStepElement.classList.remove('active');
                    nextStepElement.classList.add('active');
                    this.currentStep = stepIndex;
                    this.updateProgress();
                    gsap.fromTo(nextStepElement, 
                        { opacity: 0, y: 10 }, 
                        { opacity: 1, y: 0, duration: 0.3, ease: 'power2.out' }
                    );
                }
            });
        }

        validateStep() {
            const currentStepElement = this.steps[this.currentStep];
            const inputs = currentStepElement.querySelectorAll('input[required], textarea[required]');
            for (const input of inputs) {
                if (!input.value.trim()) {
                    input.focus();
                    gsap.fromTo(input, { x: -5 }, { x: 5, duration: 0.05, repeat: 5, yoyo: true, clearProps: 'x' });
                    return false;
                }
            }
            return true;
        }

        nextStep() {
            if (this.validateStep() && this.currentStep < this.totalSteps - 1) {
                this.changeStep(this.currentStep + 1);
            }
        }

        prevStep() {
            if (this.currentStep > 0) {
                this.changeStep(this.currentStep - 1);
            }
        }

        updateProgress() {
            const progress = ((this.currentStep + 1) / this.totalSteps) * 100;
            if (this.progressBar) {
                this.progressBar.style.width = `${progress}%`;
            }
        }

        handleSubmit(e) {
            e.preventDefault();
            if (!this.validateStep()) return;

            this.container.classList.add('form-loading');
            
            fetch(`https://formspree.io/f/${this.formspreeId}`, {
                method: 'POST',
                body: new FormData(this.formElement),
                headers: { 'Accept': 'application/json' }
            }).then(response => {
                this.container.classList.remove('form-loading');
                if (response.ok) {
                    this.showSuccess();
                } else {
                    throw new Error('Form submission failed');
                }
            }).catch(() => {
                this.container.classList.remove('form-loading');
                this.showError();
            });
        }

        showSuccess() {
            const successHTML = `
                <div class="form-success-container">
                    <i class="ph-star-four nordsym-logo-star"></i>
                    <p>Tack! Ditt meddelande har skickats. Vi återkommer snart.</p>
                </div>`;
            
            gsap.to(this.container.children, {
                opacity: 0,
                duration: 0.5,
                ease: 'power2.in',
                onComplete: () => {
                    this.container.innerHTML = successHTML;
                    gsap.fromTo(this.container.children, 
                        { opacity: 0, scale: 0.9 },
                        { opacity: 1, scale: 1, duration: 0.5, ease: 'power2.out' }
                    );
                }
            });
        }

        showError() {
            const errorHTML = `<div class="form-message form-error-message" style="display:block;">Ett fel uppstod. Försök igen eller kontakta oss direkt.</div>`;
            this.formElement.innerHTML = errorHTML;
        }
    }

    // --- NYTT: STEG 1.1 (Stomme för AI-First Spelet) ---
    class AIFirstGameManager {
        constructor() {
            this.isActive = false;
            this.gameTrigger = null;
            this.playerShip = null;
            this.invaderCards = [];
            
            // NYTT: Steg 2.1 - State för spelaren
            this.playerMovement = { left: false, right: false, up: false, down: false }; // UPPDATERAD
            
            // NYTT: Steg 2.2 - State för skjutmekanik
            this.pulses = []; // Håller reda på skott
            this.canFire = true; // För skjut-cooldown
            
            // NYTT: Steg 3.1 - State för fiender
            this.enemies = []; // Håller reda på fiender
            
            // NYTT: Steg 3.2 - State för fiendernas rörelse och skott
            this.enemyPulses = [];
            
            // STEG 5: "Jobbig" AI - Ta bort den globala rörelselogiken.
            /*
            this.enemyMovement = {
                direction: 1,       // 1 för höger, -1 för vänster
                speed: 10,          // Pixlar per rörelsesteg
                moveTimer: 0,
                moveInterval: 60    // Rör sig varje 60 frames (ca 1 sekund)
            };
            */
            this.enemyFireTimer = 0;
            this.enemyFireInterval = 100; // Skjuter ca var 1.6 sekund

            // BORTTAGET: Steg 3.0 (KORRIGERING) - Korten är nu sköldar, inte fiender.
            // this.invaderDirection = 1; 
            // this.invaderSpeed = 2; 
            // this.invaderMoveTimer = 0; 
            // this.invaderMoveInterval = 20; 
            // this.invaderBounds = {}; 

            // NYTT: Steg 2.1 - Bind "this" för event-lyssnare
            this.boundHandleKeyDown = this.handleKeyDown.bind(this);
            this.boundHandleKeyUp = this.handleKeyUp.bind(this);

            console.log("AIFirstGameManager Stomme Laddad."); // Verifiering
        }

        init() {
            // --- NYTT: STEG 1.2 (Koppla Event-lyssnare) ---
            // KORRIGERING: Ändrar till den glödande texten i brödtexten.
            this.gameTrigger = document.querySelector('#om-oss .interactive-ai-first-text');
            
            if (this.gameTrigger) {
                // Vi måste binda 'this' så att 'startGame' anropas med rätt kontext (klassen AIFirstGameManager)
                this.boundStartGame = this.startGame.bind(this);
                this.gameTrigger.addEventListener('click', this.boundStartGame);
            } else {
                // Lägger till en varning om vi inte hittar knappen, bra för felsökning.
                // KORRIGERING: Uppdaterar varningsmeddelandet
                console.warn("AIFirstGameManager: Kunde inte hitta spel-triggern (#om-oss .interactive-ai-first-text).");
            }
            // --- SLUT PÅ STEG 1.2 ---
        }

        startGame() {
            // --- NYTT: STEG 1.2 (Verifiering) ---
            if (this.isActive) return; // Förhindrar att spelet startas flera gånger
            // --- SLUT PÅ STEG 1.2 ---
            console.log("Steg 1.4: Spelet initieras, tonar ut text...");
            this.isActive = true;
            document.body.classList.add('game-active');

            // --- NYTT: STEG 1.4 (Tona ut text-element) ---

            // 1. Hitta elementen som ska tonas ut
            const titleElements = document.querySelectorAll('#om-oss .text-center.mb-16 > *');
            // 2. Hitta CTA-elementen, MEN exkludera skeppet (#ai-first-ship-icon)
            const ctaElements = document.querySelectorAll('#om-oss .text-center.mt-16 > *:not(#ai-first-ship-icon)');

            // 3. Skapa en GSAP-tidslinje för att animera ut dem
            const tl = gsap.timeline({
                // KORRIGERING: Anropa positionGameElements
                onComplete: () => {
                    // KORRIGERING (Steg 2.0): Byt till omedelbar aktivering
                    // this.positionGameElements(); // Gå till Steg 1.5
                    this.activateGameElements(); // NYTT: Steg 2.0
                }
            });

            // KORRIGERING: Ta bort all kod som animerar skepp och kort härifrån.
            // Lägg till text-animationen
            tl.to([...titleElements, ...ctaElements], {
                opacity: 0,
                y: -10, // Lyft dem lätt
                duration: 0.5,
                ease: 'power2.in',
                stagger: 0.05 // Tona ut dem en i taget
            });
       }

       // BORTTAGEN (Steg 2.0): Ersatt av activateGameElements
       /*
       positionGameElements() {
            console.log("Steg 1.5: Positionerar spelelement...");
            
            // 1. Hämta elementen
            this.playerShip = document.getElementById('ai-first-ship-icon');
            this.invaderCards = Array.from(document.querySelectorAll('#om-oss .arkitektur-card'));
            
            if (!this.playerShip || this.invaderCards.length !== 4) {
                console.error("Kunde inte hitta alla spelelement. Avbryter.");
                this.endGame(true); // Återställ omedelbart
                return;
            }

            // 2. Mät och lås skeppet
            const shipRect = this.playerShip.getBoundingClientRect();
            gsap.set(this.playerShip, {
                position: 'fixed',
                top: shipRect.top,
                left: shipRect.left,
                width: shipRect.width,
                height: shipRect.height,
                margin: 0 // Nollställ eventuella marginaler
            });
            this.playerShip.classList.add('ai-ship');

            // 3. Mät och lås korten (fienderna)
            const cardRects = this.invaderCards.map(card => {
                const rect = card.getBoundingClientRect();
                // Applicera .invader-card-game klassen och sätt position
                card.classList.add('invader-card-game');
                gsap.set(card, {
                    position: 'fixed', // Dubbelkolla att det är fixed
                    top: rect.top,
                    left: rect.left,
                    width: rect.width, // Behåll ursprunglig bredd
                    height: rect.height, // Behåll ursprunglig höjd
                    margin: 0,
                    // Sätt CSS-variablerna som klassen förväntar sig
                    '--invader-width': `${rect.width}px`,
                    '--invader-height': `${rect.height}px`
                });
                return rect; // Vi behöver inte returnera något specifikt här
            });

            // 4. Skapa animationen till spel-positioner
            const tl = gsap.timeline({
                onComplete: () => {
                    this.setupInputListeners(); // NYTT: Steg 2.1
                    // BORTTAGET: Steg 3.0 (KORRIGERING)
                    // this.calculateInvaderBounds(); // NYTT: Steg 3.1
                    this.startGameLoop(); // Gå till Steg 2.1
                }
            });

            // Animera skeppet till botten
            tl.to(this.playerShip, {
                top: 'auto', // Ta bort top
                bottom: '5vh',
                left: '50vw',
                xPercent: -50, // Centrera exakt
                duration: 0.8,
                ease: 'power2.out'
            }, 0); // Starta vid 0 sekunder

            // Animera korten till en 2x2-grid högst upp
            // Vi behöver beräkna positionerna baserat på kortens bredd för att centrera dem
            const cardWidth = this.invaderCards[0].offsetWidth;
            const screenWidth = window.innerWidth;
            const gap = 50; // Mellanrum mellan korten

            // Beräkna vänster-positioner för en centrerad 2x2 grid
            const leftPos = (screenWidth / 2) - cardWidth - (gap / 2);
            const rightPos = (screenWidth / 2) + (gap / 2);

            tl.to(this.invaderCards[0], { top: '10vh', left: leftPos, duration: 0.8, ease: 'power2.out' }, 0);
            tl.to(this.invaderCards[1], { top: '10vh', left: rightPos, duration: 0.8, ease: 'power2.out' }, 0);
            tl.to(this.invaderCards[2], { top: '30vh', left: leftPos, duration: 0.8, ease: 'power2.out' }, 0);
            tl.to(this.invaderCards[3], { top: '30vh', left: rightPos, duration: 0.8, ease: 'power2.out' }, 0);
       }
       */

       // NYTT (Steg 2.0): Omedelbar aktivering
       activateGameElements() {
            console.log("Steg 2.0: Omedelbar aktivering...");
            
            // 1. Hämta elementen
            this.playerShip = document.getElementById('ai-first-ship-icon');
            
            // STEG 3: Sköld-hälsa. Konvertera element-arrayen till en array av objekt.
            this.invaderCards = Array.from(document.querySelectorAll('#om-oss .arkitektur-card')).map(cardEl => ({
                element: cardEl,
                health: 5, // 5 träffar
                initialOpacity: 1 // Start-opacity
            }));
            
            if (!this.playerShip || this.invaderCards.length !== 4) {
                console.error("Kunde inte hitta alla spelelement. Avbryter.");
                this.endGame(true); // Återställ omedelbart
                return;
            }

            // 2. Mät och LÅS skeppet (ingen animation)
            const shipRect = this.playerShip.getBoundingClientRect();
            gsap.set(this.playerShip, {
                position: 'fixed',
                top: shipRect.top,
                left: shipRect.left,
                width: shipRect.width,
                height: shipRect.height,
                margin: 0,
                // Sätt startposition för kontrollen (botten, centrerat)
                top: 'auto',
                bottom: '5vh',
                left: '50vw',
                xPercent: -50 // Centrera exakt
            });
            this.playerShip.classList.add('ai-ship');

            // 3. Mät och LÅS sköldarna (ingen animation)
            // const cardWidth = this.invaderCards[0].offsetWidth; // Gammal referens
            const cardWidth = this.invaderCards[0].element.offsetWidth; // STEG 3: Ny referens
            const screenWidth = window.innerWidth;
            const gap = 50;
            const leftPos = (screenWidth / 2) - cardWidth - (gap / 2);
            const rightPos = (screenWidth / 2) + (gap / 2);
            
            const cardPositions = [
                { top: '10vh', left: leftPos },
                { top: '10vh', left: rightPos },
                { top: '30vh', left: leftPos },
                { top: '30vh', left: rightPos }
            ];

            // this.invaderCards.forEach((card, index) => { // Gammal referens
            this.invaderCards.forEach((shield, index) => { // STEG 3: Ny referens
                const card = shield.element; // Hämta DOM-elementet
                const rect = card.getBoundingClientRect();
                card.classList.add('invader-card-game'); // Din CSS-klass för sköldar
                gsap.set(card, {
                    position: 'fixed',
                    top: rect.top, // Starta på nuvarande plats
                    left: rect.left, // Starta på nuvarande plats
                    width: rect.width,
                    height: rect.height,
                    margin: 0,
                    '--invader-width': `${rect.width}px`,
                    '--invader-height': `${rect.height}px`,
                    // Sätt omedelbart till slutposition
                    ...cardPositions[index]
                });
                
                // NYTT (Steg 2.0): Lägg till en "aktiverings-glöd"
                gsap.fromTo(card, 
                    { opacity: 0.5, borderColor: 'rgba(var(--nord-sym-cyan-rgb), 0.2)' },
                    { opacity: 1, borderColor: 'rgba(var(--nord-sym-cyan-rgb), 0.8)', duration: 0.5, repeat: 2, yoyo: true, ease: 'power1.inOut' }
                );
            });

            // 4. Starta spelet OMEDELBART
            this.setupInputListeners();
            this.startGameLoop();
            this.spawnEnemies(); // Nästa steg!
       }

       // --- NYTT: Den saknade funktionen från Steg 2.1 ---
       setupInputListeners() {
            console.log("Steg 2.1 (Korrekt): Sätter upp input-lyssnare.");
            window.addEventListener('keydown', this.boundHandleKeyDown);
            window.addEventListener('keyup', this.boundHandleKeyUp);
       }
       // --- SLUT PÅ KORRIGERING ---

       // KORRIGERING: Tömmer framtida metoder
       // NYTT: Steg 2.1 - Ta bort lyssnare
       removeInputListeners() {
            window.removeEventListener('keydown', this.boundHandleKeyDown);
            window.removeEventListener('keyup', this.boundHandleKeyUp);
       }

       // KORRIGERING: Tömmer framtida metoder
       // NYTT: Steg 2.1 - Hantera tangenttryck
       handleKeyDown(e) {
            if (e.key === 'ArrowLeft') {
                this.playerMovement.left = true;
            } else if (e.key === 'ArrowRight') {
                this.playerMovement.right = true;
            }
            // NYTT: Lade till Upp/Ner
            if (e.key === 'ArrowUp') {
                this.playerMovement.up = true;
            } else if (e.key === 'ArrowDown') {
                this.playerMovement.down = true;
            }
            
            // NYTT: Steg 2.2 - Hantera mellanslag
            if (e.key === ' ' || e.key === 'Spacebar') {
                e.preventDefault(); // Förhindra att sidan scrollar
                this.firePulse();
            }
        }

        // KORRIGERING: Tömmer framtida metoder
        // NYTT: Steg 2.1 - Hantera när tangent släpps
        handleKeyUp(e) {
            if (e.key === 'ArrowLeft') {
                this.playerMovement.left = false;
            } else if (e.key === 'ArrowRight') {
                this.playerMovement.right = false;
            }
            // NYTT: Lade till Upp/Ner
            if (e.key === 'ArrowUp') {
                this.playerMovement.up = false;
            } else if (e.key === 'ArrowDown') {
                this.playerMovement.down = false;
            }
        }

       // KORRIGERING: Tömmer framtida metoder
       // NYTT: Steg 2.2 - Skjutmekanik
       firePulse() {
           if (!this.canFire || !this.playerShip) return;

           this.canFire = false;
           // 300ms cooldown innan man kan skjuta igen
           setTimeout(() => { this.canFire = true; }, 300); 

           const pulse = document.createElement('div');
           pulse.className = 'ai-pulse';
           // Lägg till pulsen i body så att 'position: fixed' fungerar
           document.body.appendChild(pulse);

           // Hämta skeppets nuvarande position
           const shipRect = this.playerShip.getBoundingClientRect();
           const startLeft = shipRect.left + (shipRect.width / 2) - 2; // 2 är halva pulsbredden (4px)
           const startTop = shipRect.top;

           // Lägg till i vår array för spårning (för kollisioner i Steg 3)
           this.pulses.push(pulse);

           // Animera pulsen uppåt
           gsap.fromTo(pulse, 
                { left: startLeft, top: startTop }, 
                {
                    top: -50, // Flyg utanför skärmen
                    duration: 1.5,
                    ease: 'linear',
                    onComplete: () => {
                        // Ta bort från DOM och array när den är klar
                        pulse.remove();
                        this.pulses = this.pulses.filter(p => p !== pulse);
                    }
                }
            );
       }

       // UPPDATERAD: Steg 2.1 - Initierar spellopen
       startGameLoop() {
           console.log("Steg 2.1: Spellopen initierad.");
           // Bind 'this' för requestAnimationFrame
           this.gameLoop = this.gameLoop.bind(this);
           requestAnimationFrame(this.gameLoop);
       }

       // KORRIGERING: Tömmer framtida metoder
       // NYTT: Steg 2.1 - Huvud-spellopen
       gameLoop() {
           if (!this.isActive) return; // Stoppa loopen om spelet är över

           // Uppdatera spelarens position
           this.updatePlayer();

           // NYTT: Steg 3.1 - Anropa fiende-logik
           this.updateEnemies();

           // STEG 2: Anropa den nya kollisionslogiken
           this.checkCollisions();

           // STEG 6: Våg-logik
           if (this.enemies.length === 0 && this.isActive) {
               console.log("Våg rensad! Ny våg inkommande...");
               // Lägg till en liten paus innan nästa våg
               setTimeout(() => {
                   if (this.isActive) this.spawnEnemies();
               }, 1000);
           }

           // Fortsätt loopen
           requestAnimationFrame(this.gameLoop);
       }

       // KORRIGERING: Tömmer framtida metoder
       // NYTT: Steg 2.1 - Uppdatera spelarens position
       updatePlayer() {
           if (!this.playerShip) return;

           try {
                // Vi använder gsap.getProperty för att läsa det 'fixed' värdet
                const currentLeft = gsap.getProperty(this.playerShip, "left");
                const currentBottom = gsap.getProperty(this.playerShip, "bottom"); // NYTT
                const speed = 8;
                let newLeft = currentLeft;
                let newBottom = currentBottom; // NYTT

                if (this.playerMovement.left) {
                    newLeft -= speed;
                }
                if (this.playerMovement.right) {
                    newLeft += speed;
                }
                // NYTT: Lade till Upp/Ner
                if (this.playerMovement.up) {
                    newBottom += speed;
                }
                if (this.playerMovement.down) {
                    newBottom -= speed;
                }

                // Begränsa till skärmens kanter
                const shipWidth = this.playerShip.offsetWidth;
                const shipHeight = this.playerShip.offsetHeight; // NYTT
                const screenWidth = window.innerWidth;
                const screenHeight = window.innerHeight; // NYTT
                
                // Säkerställ att newLeft är inom 0 och (skärmbredd - skeppsbredd)
                newLeft = Math.max(0, Math.min(screenWidth - shipWidth, newLeft));
                // NYTT: Begränsa newBottom
                newBottom = Math.max(0, Math.min(screenHeight - shipHeight, newBottom));

                if (newLeft !== currentLeft || newBottom !== currentBottom) { // UPPDATERAD
                    // Använd gsap.set för omedelbar respons, ingen animation
                    gsap.set(this.playerShip, { left: newLeft, bottom: newBottom }); // UPPDATERAD
                }
           } catch (e) {
                // Om skeppet tas bort (t.ex. vid endGame) kan detta ge fel
                console.warn("Kunde inte hämta spelarens position, spelet kanske avslutades?", e);
           }
       }
 
       // NYTT (Steg 3.2): Tom platshållare för fiendeuppdateringar
       // STEG 5: "Jobbig" AI - Hela denna metod skrivs om.
       updateEnemies() {
            const screenWidth = window.innerWidth;
            const screenHeight = window.innerHeight;
            const time = Date.now() * 0.001; // Global tid för sinus-vågor

            // Individuell rörelselogik - SVÄRM-INTELLIGENS
            this.enemies.forEach((enemy, index) => {
                // 1. Organisk Rörelse: Sinusvåg baserad på tid + index (för att de inte ska röra sig exakt likadant)
                // Detta skapar en "ormande" eller "svävande" effekt istället för stel robotrörelse.
                const waveX = Math.sin(time * 2 + index) * 3; 
                
                // 2. Aggressivitet: Ökar hastigheten ju längre ner de kommer
                const aggression = 1 + (enemy.y / screenHeight); 

                enemy.x += (enemy.speedX * aggression) + waveX;
                enemy.y += enemy.speedY * aggression; 

                // Vägg-studs med dämpning
                if (enemy.x < 20) {
                    enemy.x = 20;
                    enemy.speedX = Math.abs(enemy.speedX);
                } else if (enemy.x > screenWidth - 50) {
                    enemy.x = screenWidth - 50;
                    enemy.speedX = -Math.abs(enemy.speedX);
                }

                // Uppdatera elementets position med transform för prestanda
                // Vi roterar dem också lite baserat på rörelseriktningen för en snyggare effekt
                const tilt = enemy.speedX * 5; 
                gsap.set(enemy.element, { left: enemy.x, top: enemy.y, rotation: tilt });

                // STEG 6: Förlust-villkor (Fiende når botten)
                if (enemy.y > screenHeight - 50) {
                    console.log("En fiende nådde botten. Game Over.");
                    this.endGame();
                }
            });
            
            // --- Skjutlogik (behålls) ---
            this.enemyFireTimer++;
            // Skjut oftare om det finns färre fiender kvar (Desperation mode)
            const dynamicInterval = Math.max(20, this.enemyFireInterval - (4 - this.enemies.length) * 15);
            
            if (this.enemyFireTimer >= dynamicInterval && this.enemies.length > 0) {
                this.enemyFireTimer = 0;
                this.enemyFire(); 
            }
       }

        // NYTT (Steg 3.2): Fienderna skjuter
        // STEG 4: "Jobbig" AI - Hela denna metod skrivs om för målsökning.
        enemyFire() {
            if (this.enemies.length === 0 || !this.playerShip) return;

            // Välj en slumpmässig fiende som ska skjuta
            const randomEnemy = this.enemies[Math.floor(Math.random() * this.enemies.length)];

            // 1. Välj ett mål (Prioritera spelaren för att skapa stress)
            let targetElement = this.playerShip;
            
            // Ibland (30%) skjuter de på sköldarna för att rensa vägen
            const validShields = this.invaderCards.filter(shield => shield.health > 0);
            if (Math.random() < 0.3 && validShields.length > 0) {
                targetElement = validShields[Math.floor(Math.random() * validShields.length)].element;
            }

            const pulse = document.createElement('div');
            pulse.className = 'ai-enemy-pulse';
            document.body.appendChild(pulse);
            this.enemyPulses.push(pulse);

            // 2. Startposition
            const startLeft = randomEnemy.x + 13; 
            const startTop = randomEnemy.y + 25;

            // 3. PREDIKTIVT SIKTE (Gemini 3 Logic)
            // Vi räknar inte bara ut var spelaren är, utan var de är på väg.
            const targetRect = targetElement.getBoundingClientRect();
            let targetX = targetRect.left + (targetRect.width / 2);
            const targetY = targetRect.top + (targetRect.height / 2);

            // Om målet är spelaren, lägg till "lead" (framförhållning)
            if (targetElement === this.playerShip) {
                // Enkel uppskattning: Om spelaren rör sig vänster, sikta vänster om nuvarande position
                if (this.playerMovement.left) targetX -= 100;
                if (this.playerMovement.right) targetX += 100;
            }

            // Lägg till lite slumpmässighet (spridning) så det inte blir omöjligt
            targetX += (Math.random() - 0.5) * 50;

            const deltaX = targetX - startLeft;
            const deltaY = targetY - startTop;
            const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
            
            // Projicera vektorn långt utanför skärmen
            const endX = startLeft + deltaX * (window.innerHeight / distance) * 2;
            const endY = startTop + deltaY * (window.innerHeight / distance) * 2;
            
            // Snabbare skott än tidigare (350 -> 450 px/s)
            const duration = distance / 450; 

            // 3. Animera
            gsap.fromTo(pulse, 
                { left: startLeft, top: startTop, rotation: Math.atan2(deltaY, deltaX) * (180/Math.PI) - 90 }, // Rotera skottet i färdriktningen
                {
                    left: endX,
                    top: endY,
                    duration: Math.max(1.0, duration),
                    ease: 'linear',
                    onComplete: () => {
                        pulse.remove();
                        this.enemyPulses = this.enemyPulses.filter(p => p !== pulse);
                    }
                }
            );
        }

        // STEG 2: Implementera Kollisionslogik
        checkCollisions() {
            if (!this.playerShip) return;
            const playerRect = this.playerShip.getBoundingClientRect();

            // Hjälpfunktion för Axis-Aligned Bounding Box (AABB) kollision
            const isColliding = (rect1, rect2) => {
                return !(
                    rect1.right < rect2.left ||
                    rect1.left > rect2.right ||
                    rect1.bottom < rect2.top ||
                    rect1.top > rect2.bottom
                );
            };

            // 1. Spelarens skott mot Fiender
            for (let i = this.pulses.length - 1; i >= 0; i--) {
                const pulse = this.pulses[i];
                if (!pulse) continue;
                const pulseRect = pulse.getBoundingClientRect();

                for (let j = this.enemies.length - 1; j >= 0; j--) {
                    const enemy = this.enemies[j];
                    const enemyRect = enemy.element.getBoundingClientRect();

                    if (isColliding(pulseRect, enemyRect)) {
                        // Träff!
                        // Stoppa pulsens animation och ta bort den
                        gsap.killTweensOf(pulse);
                        pulse.remove();
                        this.pulses.splice(i, 1);

                        // Ta bort fienden
                        enemy.element.remove();
                        this.enemies.splice(j, 1);

                        // Bryt den inre loopen eftersom pulsen är borta
                        break; 
                    }
                }
            }

            // 2. Fiendens skott mot Spelaren
            for (let i = this.enemyPulses.length - 1; i >= 0; i--) {
                const pulse = this.enemyPulses[i];
                if (!pulse) continue;
                const pulseRect = pulse.getBoundingClientRect();

                if (isColliding(pulseRect, playerRect)) {
                    // Spelaren träffad!
                    gsap.killTweensOf(pulse);
                    pulse.remove();
                    this.enemyPulses.splice(i, 1);
                    
                    console.log("Spelaren träffad! Game Over.");
                    // Explosionseffekt och anropa endGame
                    gsap.to(this.playerShip, { scale: 3, opacity: 0, duration: 0.3, onComplete: () => this.endGame() });
                    
                    return; // Stoppa all vidare kollisionskoll denna frame
                }
            }
            
            // 3. Fiendens skott mot Sköldarna
            for (let i = this.enemyPulses.length - 1; i >= 0; i--) {
                const pulse = this.enemyPulses[i];
                if (!pulse) continue;
                const pulseRect = pulse.getBoundingClientRect();

                for (let j = this.invaderCards.length - 1; j >= 0; j--) {
                    const shield = this.invaderCards[j];
                    if (shield.health <= 0) continue; // Hoppa över förstörda sköldar

                    const shieldRect = shield.element.getBoundingClientRect();

                    if (isColliding(pulseRect, shieldRect)) {
                        // Sköld träffad!
                        gsap.killTweensOf(pulse);
                        pulse.remove();
                        this.enemyPulses.splice(i, 1);

                        shield.health--;
                        const newOpacity = shield.health / 5.0; // Baserat på 5 hälsa
                        gsap.to(shield.element, { opacity: newOpacity, duration: 0.2 });
                        
                        if (shield.health <= 0) {
                            console.log("En sköld är förstörd!");
                            gsap.to(shield.element, { opacity: 0.1, duration: 0.5 }); // Låt den se förstörd ut
                        }
                        
                        // Bryt den inre loopen eftersom pulsen är borta
                        break;
                    }
                }
            }
        }

        endGame(forceImmediate = false) {
            if (!this.isActive && !forceImmediate) return; // Kör bara om spelet är aktivt

            this.isActive = false; // Stoppar rAF-loopen
            document.body.classList.remove('game-active');
            
            // KORRIGERING: removeInputListeners kommer anropas här senare
            this.removeInputListeners(); // NYTT: Steg 2.1
            console.log("Återställer 'om-oss'-sidan...");

            // --- NYTT: Steg 2 (Återställning) ---
            // Hitta elementen som doldes
            const titleElements = document.querySelectorAll('#om-oss .text-center.mb-16 > *');
            const ctaElements = document.querySelectorAll('#om-oss .text-center.mt-16 > *:not(#ai-first-ship-icon)');

            // Återställ dem omedelbart med GSAP.set() (ingen animation)
            gsap.set([...titleElements, ...ctaElements], {
                opacity: 1,
                y: 0
            });
            // STEG 3: Återställ sköldarnas hälsa och opacity
            if (this.invaderCards.length > 0) {
                this.invaderCards.forEach(shield => {
                    gsap.set(shield.element, { clearProps: 'all' });
                    shield.element.classList.remove('invader-card-game');
                    shield.health = 5; // Återställ hälsa
                });
                this.invaderCards = [];
            }
            // --- SLUT PÅ Steg 1.5 Återställning ---

            // --- NYTT: Steg 2.2 (Återställning av pulser) ---
            // Uppdaterad för att döda alla tweens
            [...this.pulses, ...this.enemyPulses].forEach(pulse => {
                gsap.killTweensOf(pulse);
                pulse.remove();
            });
            this.pulses = [];
            this.enemyPulses = [];
            
            this.canFire = true; // Återställ skjut-cooldown
            // --- SLUT PÅ Steg 2.2 Återställning ---

            // --- NYTT (Steg 3.2): Återställ fiendernas skott och timers ---
            // this.enemyPulses är redan rensad
            // this.enemyMovement.moveTimer = 0; // STEG 5: Borttagen
            this.enemyFireTimer = 0;
            // this.enemyMovement.direction = 1; // STEG 5: Borttagen
            // --- SLUT PÅ Steg 3.2 Återställning ---

            // --- NYTT (Steg 2.0): Platshållare för fiende-städning ---
            this.removeEnemies();
        }

        // --- NYTT (Steg 2.0): Platshållare ---
        spawnEnemies() {
            // console.log("Steg 3.1: Skapar fiender (EJ IMPLEMENTERAT)"); // Borttagen
             console.log("Steg 3.1: Skapar fiender...");

            const enemyCount = 4; // MINSKAT ANTAL: Sidan laggade med 8, testar med 4.
            const enemyWidth = 30; // Motsvarar 2 * border-left/right
            const enemySpacing = 20;
            const totalWidth = (enemyCount * enemyWidth) + ((enemyCount - 1) * enemySpacing);
            const screenWidth = window.innerWidth;
            let startX = (screenWidth / 2) - (totalWidth / 2);
            const startY = -50; // Starta precis ovanför skärmen

            for (let i = 0; i < enemyCount; i++) {
                const enemy = document.createElement('div');
                enemy.className = 'ai-enemy-triangle';
                document.body.appendChild(enemy);
                
                const enemyLeft = startX + i * (enemyWidth + enemySpacing);
                
                // Spara fiendens data
                const enemyData = {
                    element: enemy,
                    x: enemyLeft,
                    y: startY,
                    health: 1, // (För framtida bruk)
                    // STEG 5: Individuell AI
                    moveTimer: Math.random() * 100, // Slumpad start-timer
                    moveInterval: 60 + Math.random() * 40, // 1 - 1.6 sek
                    directionX: Math.random() < 0.5 ? 1 : -1, // Startriktning
                    speedX: (1 + Math.random()) * (Math.random() < 0.5 ? 1 : -1), // 1-2 px/frame
                    speedY: 0.3 + Math.random() * 0.3 // 0.3-0.6 px/frame nedåt
                };
                
                this.enemies.push(enemyData);
                
                // Placera fienden och animera in den
                gsap.fromTo(enemy, 
                    { left: enemyLeft, top: startY, opacity: 0 },
                    { 
                        top: 50, // Animera ner till sin startrad
                        opacity: 1,
                        duration: 0.5,
                        delay: 0.1 * i, // Stagger-effekt
                        ease: 'power2.out',
                        // --- STEG 1 BUGGFIX: Synkronisera den interna positionen ---
                        onComplete: () => {
                            enemyData.y = 50; // Sätt den interna Y-positionen till 50
                        }
                        // --- SLUT PÅ BUGGFIX ---
                    }
                );
            }
        }

        removeEnemies() {
             // console.log("Steg 4.0: Tar bort fiender (EJ IMPLEMENTERAT)"); // Borttagen
             console.log("Steg 4.0: Tar bort fiender...");
             this.enemies.forEach(enemy => {
                 // Ta bort från DOM
                 enemy.element.remove();
             });
             // Töm arrayen
             this.enemies = [];
        }
    }
    // --- SLUT PÅ STEG 1.1 ---
    
    </script>
</body>
</html>
